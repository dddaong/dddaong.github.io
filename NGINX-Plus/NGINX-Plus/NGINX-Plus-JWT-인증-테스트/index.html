<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=DDAONG><link href=https://wiki.ddaong.co.kr/NGINX-Plus/NGINX-Plus/NGINX-Plus-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/ rel=canonical><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-8.5.10"><title>NGINX+ - JWT 인증 테스트 - DDAONG WIKI</title><link rel=stylesheet href=../../../assets/stylesheets/main.975780f9.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CUbuntu+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Ubuntu";--md-code-font:"Ubuntu Mono"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=light data-md-color-primary=blue-grey data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#nginx-plus-jwt class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="DDAONG WIKI" class="md-header__button md-logo" aria-label="DDAONG WIKI" data-md-component=logo> <img src=../../../assets/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> DDAONG WIKI </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> NGINX+ - JWT 인증 테스트 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=light data-md-color-primary=blue-grey data-md-color-accent=indigo aria-label="Embrace the dark side" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Embrace the dark side" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent=deep-orange aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/dddaong/dddaong.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="DDAONG WIKI" class="md-nav__button md-logo" aria-label="DDAONG WIKI" data-md-component=logo> <img src=../../../assets/logo.png alt=logo> </a> DDAONG WIKI </label> <div class=md-nav__source> <a href=https://github.com/dddaong/dddaong.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> DDAONG Docs Archive </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Docker data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Docker/Private-container-Local-Registry/ class=md-nav__link> Docker - Private(Local) Container Registry </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> F5 BIG IP <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="F5 BIG IP" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> F5 BIG IP </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../F5-BIG-IP/00-F5-HW-SW-Support-Policy/ class=md-nav__link> F5 Hardware / Software Support Policy </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2> BIG IP CIS <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="BIG IP CIS" data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> BIG IP CIS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../F5-BIG-IP/BIG-IP-CIS/BIG-IP-CIS-01-Calico/ class=md-nav__link> F5 BIG-IP CIS 소개 </a> </li> <li class=md-nav__item> <a href=../../../F5-BIG-IP/BIG-IP-CIS/BIG-IP-CIS-02-Calico%2BClusterip/ class=md-nav__link> F5 BIG-IP CIS - Calico+ClusterIP 모드 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3> BIG IP TS <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="BIG IP TS" data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> BIG IP TS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../F5-BIG-IP/BIG-IP-TS/f5-ts-monitoring-prometheus-grafana/ class=md-nav__link> F5 Telemetry Streaming with Prometheus & Grafana Test </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4> BIG IP 일반 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="BIG IP 일반" data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> BIG IP 일반 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/BIG-IP-SYSLOG-Config-Sample/ class=md-nav__link> BIG-IP - Syslog Custom Config Sample </a> </li> <li class=md-nav__item> <a href=../../../F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/F5-BIG-IP-SNMP-OID/ class=md-nav__link> F5 BIG-IP - SNMP OID </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> K3s <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=K3s data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> K3s </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../K3s/00-Lightweight-Kubernetes-compare/ class=md-nav__link> Overview Lightweight Kubernetes </a> </li> <li class=md-nav__item> <a href=../../../K3s/01-K3S-Installation/ class=md-nav__link> K3S Installation for SingleNode Cluster Guide </a> </li> <li class=md-nav__item> <a href=../../../K3s/UsePrivateRegistryAsKubeService-in-K3S/ class=md-nav__link> K3s Installation with Private Registry </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Kubernetes/Kube-kubeadm-install/ class=md-nav__link> K8s Installation script for Centos7 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6> NGINX Plus <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="NGINX Plus" data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> NGINX Plus </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../NGINX-Plus-Product-Install-guide/ class=md-nav__link> NGINX Product Install Guides </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_2 type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2> NGINX Controller <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="NGINX Controller" data-md-level=2> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> NGINX Controller </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../NGINX-Controller/API-GW-Image-build-NAP/ class=md-nav__link> NGINX Controller - NAP Container Image build </a> </li> <li class=md-nav__item> <a href=../../NGINX-Controller/Arcadia-and-NGINX-Controller-Configuration-Hands-on/ class=md-nav__link> Arcadia and NGINX Controller Configuration </a> </li> <li class=md-nav__item> <a href=../../NGINX-Controller/Build-NGINX-Plus-API-GW-container-image/ class=md-nav__link> NGINX Controller - NGINX Plus Container Image build </a> </li> <li class=md-nav__item> <a href=../../NGINX-Controller/ConfigDB-Manual-Restore/ class=md-nav__link> ConfigDB Manual Restore </a> </li> <li class=md-nav__item> <a href=../../NGINX-Controller/NGINX-Controller-Alert-%EB%A9%94%EC%9D%BC-%EC%84%A4%EC%A0%95/ class=md-nav__link> NGINX Controller - Alert 메일 설정 </a> </li> <li class=md-nav__item> <a href=../../NGINX-Controller/NGINX-Controller-Deployment-Guide/ class=md-nav__link> NGINX Controller Deployment Guide </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_3 type=checkbox id=__nav_6_3> <label class=md-nav__link for=__nav_6_3> NGINX Ingress Ctlr <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="NGINX Ingress Ctlr" data-md-level=2> <label class=md-nav__title for=__nav_6_3> <span class="md-nav__icon md-icon"></span> NGINX Ingress Ctlr </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../NGINX-Ingress-Ctlr/Helm-Chart%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4-NPIC-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0/ class=md-nav__link> NGINX+ Ingress Controller - Helm Chart 배포 </a> </li> <li class=md-nav__item> <a href=../../NGINX-Ingress-Ctlr/NGINX-Ingress-Controller-Lua-package-path-%ED%85%8C%EC%8A%A4%ED%8A%B8/ class=md-nav__link> NGINX+ Ingress Controller - lua_package_path 테스트 </a> </li> <li class=md-nav__item> <a href=../../NGINX-Ingress-Ctlr/NGINX-Plus-Ingress-Controller%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/ class=md-nav__link> NGINX+ Ingress Controller - JWT 인증 </a> </li> <li class=md-nav__item> <a href=../../NGINX-Ingress-Ctlr/NPIC%EC%97%90%EC%84%9C-VS-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0/ class=md-nav__link> NGINX+ Ingress Controller - VS Crd로 Lua 사용 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_4 type=checkbox id=__nav_6_4 checked> <label class=md-nav__link for=__nav_6_4> NGINX Plus <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="NGINX Plus" data-md-level=2> <label class=md-nav__title for=__nav_6_4> <span class="md-nav__icon md-icon"></span> NGINX Plus </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> NGINX+ - JWT 인증 테스트 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> NGINX+ - JWT 인증 테스트 </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#nginx-plus-jwt class=md-nav__link> NGINX Plus + JWT 인증 테스트 </a> <nav class=md-nav aria-label="NGINX Plus + JWT 인증 테스트"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nginx-jwt-validation-supports class=md-nav__link> NGINX의 JWT Validation Supports </a> <nav class=md-nav aria-label="NGINX의 JWT Validation Supports"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#sample-config-nginx-plus-jwt-authentication-config class=md-nav__link> Sample Config : NGINX Plus JWT Authentication Config </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nginx-plus-jwt-auth-test-with-rs256 class=md-nav__link> NGINX Plus JWT Auth Test with RS256 </a> <nav class=md-nav aria-label="NGINX Plus JWT Auth Test with RS256"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#jwk-jwt-rsa256 class=md-nav__link> JWK와 JWT를 위한 RSA256 키 생성 </a> </li> <li class=md-nav__item> <a href=#jwk class=md-nav__link> JWK 파일 생성 </a> </li> <li class=md-nav__item> <a href=#jwt class=md-nav__link> JWT 생성 </a> </li> <li class=md-nav__item> <a href=#jwk-nginx-plus class=md-nav__link> JWK를 NGINX Plus에 적용 </a> <nav class=md-nav aria-label="JWK를 NGINX Plus에 적용"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#-authentication-failure class=md-nav__link> 테스트 - Authentication Failure </a> </li> <li class=md-nav__item> <a href=#-authentication-success class=md-nav__link> 테스트 - Authentication Success </a> </li> <li class=md-nav__item> <a href=#trouble-shooting class=md-nav__link> Trouble shooting </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../NGINX-Plus-NAP-WAF-DoS-Install-Guide/ class=md-nav__link> NGINX Plus NAP WAF DoS Install Guide </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Protocols <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Protocols data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Protocols </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Protocols/Bash-Script%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-JWT-JWK-JWKS-%EC%83%9D%EC%84%B1/ class=md-nav__link> JWT - Bash Script를 사용한 JWT, JWK, JWKS 생성 </a> </li> <li class=md-nav__item> <a href=../../../Protocols/JWT%EC%9D%98%EC%9D%B4%ED%95%B4-NGINX%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D/ class=md-nav__link> JWT - JWT Concept </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> Tools <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tools data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Tools/IP-Changer-Batch-Script/ class=md-nav__link> Windows IP Changer Batch Script </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#nginx-plus-jwt class=md-nav__link> NGINX Plus + JWT 인증 테스트 </a> <nav class=md-nav aria-label="NGINX Plus + JWT 인증 테스트"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nginx-jwt-validation-supports class=md-nav__link> NGINX의 JWT Validation Supports </a> <nav class=md-nav aria-label="NGINX의 JWT Validation Supports"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#sample-config-nginx-plus-jwt-authentication-config class=md-nav__link> Sample Config : NGINX Plus JWT Authentication Config </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nginx-plus-jwt-auth-test-with-rs256 class=md-nav__link> NGINX Plus JWT Auth Test with RS256 </a> <nav class=md-nav aria-label="NGINX Plus JWT Auth Test with RS256"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#jwk-jwt-rsa256 class=md-nav__link> JWK와 JWT를 위한 RSA256 키 생성 </a> </li> <li class=md-nav__item> <a href=#jwk class=md-nav__link> JWK 파일 생성 </a> </li> <li class=md-nav__item> <a href=#jwt class=md-nav__link> JWT 생성 </a> </li> <li class=md-nav__item> <a href=#jwk-nginx-plus class=md-nav__link> JWK를 NGINX Plus에 적용 </a> <nav class=md-nav aria-label="JWK를 NGINX Plus에 적용"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#-authentication-failure class=md-nav__link> 테스트 - Authentication Failure </a> </li> <li class=md-nav__item> <a href=#-authentication-success class=md-nav__link> 테스트 - Authentication Success </a> </li> <li class=md-nav__item> <a href=#trouble-shooting class=md-nav__link> Trouble shooting </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/dddaong/dddaong.github.io/edit/master/docs/NGINX-Plus/NGINX-Plus/NGINX-Plus-JWT-인증-테스트.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1>NGINX+ - JWT 인증 테스트</h1> <p>NGINX Plus로 간략한 JWT 인증 테스트를 수행합니다.</p> <h2 id=nginx-plus-jwt>NGINX Plus + JWT 인증 테스트<a class=headerlink href=#nginx-plus-jwt title="Permanent link">&para;</a></h2> <h3 id=nginx-jwt-validation-supports>NGINX의 JWT Validation Supports<a class=headerlink href=#nginx-jwt-validation-supports title="Permanent link">&para;</a></h3> <p>NGINX Plus는 R10 버전부터 Native JWT Validation을 지원하며, NGINX OSS에서는 <a href=https://github.com/zmartzone/lua-resty-openidc>lua-resty-openidc</a> 등 외부 모듈 사용이 필요합니다.</p> <p>NGINX Plus 는 표준에 정의된 <code>HSxxx</code>, <code>RSxxx</code>, and <code>ESxxx</code> <a href=https://nginx.org/en/docs/http/ngx_http_auth_jwt_module.html>signature algorithms</a>을 지원합니다.</p> <h4 id=sample-config-nginx-plus-jwt-authentication-config>Sample Config : NGINX Plus JWT Authentication Config<a class=headerlink href=#sample-config-nginx-plus-jwt-authentication-config title="Permanent link">&para;</a></h4> <p>아래는 <a href="https://www.nginx.com/blog/nginx-plus-r17-released/?_ga=2.18265401.1678908472.1617607349-1458027870.1616747210#r17-openid">Nginx Plus r17 Release</a>에서 발췌한 NGINX Plus Config 예시입니다.</p> <pre><code class=language-nginx># Create a directory to cache the keys received from IdP
proxy_cache_path /var/cache/nginx/jwk levels=1 keys_zone=jwk:1m max_size=10m;

server {
    listen 80; # Use SSL/TLS in production

    location / {
        auth_jwt &quot;closed site&quot;;
        auth_jwt_key_request /_jwks_uri; # Keys will be fetched by subrequest

        proxy_pass http://my_backend;
    }
    location = /_jwks_uri {
        internal;
        proxy_method GET;
        proxy_cache  jwk; # Cache responses
        proxy_pass   https://idp.example.com/oauth2/keys; # Obtain keys from here
    }
}
</code></pre> <ol> <li>이 Config는 <code>auth_jwt_key_file</code>를 사용하지 않고 <code>auth_jwt_key_request</code> Directive를 사용해 JWK를 Remote Location에서 가져오도록 작성되어 있습니다.</li> </ol> <p>이 Config에서 Remote Location은 <code>proxy_pass</code>에 정의된 IdP URI입니다. (대부분의 idP는 Key Set을 가져올 수 있는 URL을 제공한다고 합니다.)</p> <ol> <li> <p>Client Request를 수신하면 <code>auth_jet_key_request</code> Directive에 의해 <code>/_jwk_uri</code> 블록으로 Subrequest를 보냅니다.</p> </li> <li> <p><code>/_jwk_uri</code> 블록의 proxy_pass에 의해 idP의 고정 URL로 Subrequest가 전달되고, 응답으로 Key Set을 수신합니다. <code>/_jwk_uri</code> Location 블록은 <code>internal</code> Directive를 사용해 외부에서는 접근할 수 없도록 합니다.</p> </li> <li> <p>수신한 Key Set을 <code>proxy_cache</code> Directive로 <code>jwk keys_zone</code>에 캐시하여, Validation Overhead를 줄여줄 수 있도록 되어 있습니다.</p> </li> <li> <p>이 Config는 <code>auth_jwt "closed site";</code> 에서 기본값인 Bearer Token을 사용하고, realm만 작성되어 있습니다. JWT는 일반적으로 <code>Authorization</code> 헤더에 Bearer Token으로 인증 요청되지만, Cookie, Query String으로 사용될 수 있도록, <code>auth_jwt</code> Directive에서 세부 설정이 가능하도록 되어 있습니다.</p> </li> </ol> <p><code>nginx auth_jwt string [token=$variable] | off;</code></p> <p>예를 들어 아래와 같이 Query String을 통해 Token 인증 요청을 사용하려면</p> <p><code>curl http://192.168.1.1/products/widget1?apijwt=xxxxxxxxxxxxxxxxxxxxx...</code></p> <p>string을 realm 명, 토큰을 apijwt Argument의 Value를 참조하도록 합니다.</p> <p><code>nginx auth_jwt "API" token=$arg_apijwt;</code></p> <p>참고로, $arg_name 과 $cookie_name 변수는 <a href=http://nginx.org/en/docs/http/ngx_http_core_module.html#variables>ngx_http_core_module 모듈의 Embedded Variables</a>를 참조하면 됩니다.</p> <hr> <h3 id=nginx-plus-jwt-auth-test-with-rs256>NGINX Plus JWT Auth Test with RS256<a class=headerlink href=#nginx-plus-jwt-auth-test-with-rs256 title="Permanent link">&para;</a></h3> <p>NGINX Plus에서 JWT 인증 테스트를 기록한 내용입니다.</p> <ul> <li>RSA Pub/Priv Key 생성 - mkjwk.org 사용</li> <li>NGINX Plus에서 사용할 JWK 파일 작성 - mkjwk.org 사용</li> <li>JWT 생성 - jwt.io Debugger 사용</li> </ul> <h4 id=jwk-jwt-rsa256>JWK와 JWT를 위한 RSA256 키 생성<a class=headerlink href=#jwk-jwt-rsa256 title="Permanent link">&para;</a></h4> <p>테스트에서는 편의를 위해 <a href=https://mkjwk.org/ >mkjwk JSON Web Key Generator</a>를 사용했습니다. 아래는 생성시 선택한 옵션입니다.</p> <table> <thead> <tr> <th align=center>Tab</th> <th align=center>Key Size</th> <th align=center>Key Use</th> <th align=center>Algorithm</th> <th align=center>Key ID</th> <th align=center>Show X.509</th> </tr> </thead> <tbody> <tr> <td align=center>RSA</td> <td align=center>2048</td> <td align=center>Signature</td> <td align=center>RS256</td> <td align=center>Specify [0001]</td> <td align=center>Yes</td> </tr> </tbody> </table> <h4 id=jwk>JWK 파일 생성<a class=headerlink href=#jwk title="Permanent link">&para;</a></h4> <ol> <li> <p>Public Key 박스의 내용을 복사해</p> </li> <li> <p>NGINX Plus가 동작하고 있는 호스트에서 <code>vi /etc/nginx/conf.d/dddaong.jwk</code> 파일로 저장합니다.</p> </li> <li> <p>아래는 테스트에 사용한 샘플입니다.</p> </li> </ol> <p><code>json { "keys": [{ "kty":"RSA", "e":"AQAB", "use":"sig", "kid":"0001", "alg":"RS256", "n":"oS4lA_ePN4bmcaAM5AFnGVtzMmBBXoYxVGgNEtbhotDMkiIfhilRSH_IVktaDwdorEpQZxg66gwV0y5hZ4Nqo3wWxRVWKoVmdY0xQyPCtIHOs40FYVoc85vBU4giQnl_XqNHVnGOIZz7hiKgzzBBWiLFqgajzgvYN6QZBT0rb8OMj2u-iKQra9sHhlXBgg6W3YUE8BoPiDX2ehI35zXbsf4rI1IYeJvzEFLVcv6kHNJ7vSO0qDmVY4_m-0Kdi0KmJ_XZSNs7fRFwp1MYui9SXs-rZxrmHHES3xuTutJ5sJD6J2LgqkA8NgqhiTva-Dfyj08KVEj5RH1Af4F-bo6aBQ" }] }</code></p> <h4 id=jwt>JWT 생성<a class=headerlink href=#jwt title="Permanent link">&para;</a></h4> <p>JWT는 jwt.io의 Debugger를 사용하면 간단하게 생성할 수 있습니다.</p> <p>먼저, Header를 Base64url 인코딩한 스트링 + . + Payload를 Base64url 인코딩한 스트링을 준비합니다.</p> <ol> <li>Header와 Payload를 각각 작성해 Base64url 인코딩합니다.</li> </ol> <pre><code class=language-bash>HEAD=$(echo -n '{&quot;alg&quot;:&quot;RS256&quot;,&quot;typ&quot;:&quot;JWT&quot;,&quot;kid&quot;:&quot;0001&quot;}' | base64 | sed s/\+/-/ | sed -E s/=+$//)
PAYLOAD=$(echo -n '{&quot;sub&quot;:&quot;RS256TEST&quot;,&quot;aud&quot;:&quot;dddaong&quot;,&quot;iat&quot;: 1617778800}' | base64 | sed s/\+/-/ | sed -E s/=+$//)
echo &quot;$HEAD.$PAYLOAD&quot;
</code></pre> <p>결과물은 아래와 같이 나옵니다.</p> <pre><code class=language-bash>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJSUzI1NlRFU1QiLCJhdWQiOiJkZGRhb25nIn0
</code></pre> <ol> <li>생성한 내용을 <a href=https://jwt.io/#debugger-io>jwt.io Debugger</a>에 Encoded 부분에 붙여넣습니다.</li> <li><a href=https://jwt.io/#debugger-io>jwt.io Debugger</a> 우측 Decoded의 Verify Signature 항목의 아래쪽 박스에 <a href=https://mkjwk.org/ >mkjwk JSON Web Key Generator</a>에서 생성한 Private Key(X.509 PEM 포맷)을 붙여넣습니다. Private Key를 붙여넣는 즉시 Encoded에 JWT가 완성되어 나타납니다.</li> </ol> <p>결과물은 아래와 같이 나옵니다.</p> <pre><code class=language-bash>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJSUzI1NlRFU1QiLCJhdWQiOiJkZGRhb25nIiwiaWF0IjoxNjE3Nzc4ODAwfQ.RgG2pJVjmNs0HRN13PRgI8lhVrZgCClbkA5JWgliewp0FJDqFE_B9HNUOQN_Iroj8s_bWRTSAVpCznVdHiT_4dCpRZxpYdZEYAx9PT0H5J-mj2rBUAJYy6OC7mIXFD11nF2uSId9oVMhaa_itvNOPiV5_rIYVjVOOQWEK08DwAkQJ-dMGf8BNAnWWcsCnHE8jyrKxCpINwGSVNVL65v2Dr66bhbY2uGYs658BXnq233TQMsnj_UdxQkAgFVkm1tnkqq-vPAGV662q22mICIjGDKWyj_abOsvDGaX4PwCxyv_zj0JhiTzhi5iL27WIxXf9Je03KOvsnDc67VFV-yOCA
</code></pre> <ol> <li> <p>확인을 위해 Public Key로 Validation을 해보겠습니다.</p> </li> <li> <p>생성한 JWT 문자열을 메모장 등에 따로 보관해둡니다. 테스트 과정에서는 편의를 위해 토큰의 내용을 /etc/nginx/conf.d/dddaong.token 파일로 저장했습니다.</p> <p><code>bash echo "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJSUzI1NlRFU1QiLCJhdWQiOiJkZGRhb25nIiwiaWF0IjoxNjE3Nzc4ODAwfQ.RgG2pJVjmNs0HRN13PRgI8lhVrZgCClbkA5JWgliewp0FJDqFE_B9HNUOQN_Iroj8s_bWRTSAVpCznVdHiT_4dCpRZxpYdZEYAx9PT0H5J-mj2rBUAJYy6OC7mIXFD11nF2uSId9oVMhaa_itvNOPiV5_rIYVjVOOQWEK08DwAkQJ-dMGf8BNAnWWcsCnHE8jyrKxCpINwGSVNVL65v2Dr66bhbY2uGYs658BXnq233TQMsnj_UdxQkAgFVkm1tnkqq-vPAGV662q22mICIjGDKWyj_abOsvDGaX4PwCxyv_zj0JhiTzhi5iL27WIxXf9Je03KOvsnDc67VFV-yOCA" &gt; /etc/nginx/conf.d/dddaong.token</code></p> </li> <li> <p><a href=https://jwt.io/#debugger-io>jwt.io Debugger</a>의 Decoded에 붙여넣은 Private Key를 지워줍니다. Private Key를 지우면 JWT String도 모두 사라집니다.</p> </li> <li> <p>보관한 JWT String을 다시 붙여넣어 줍니다. 이 부분만 있어도 Header와 Payload의 내용을 확인할 수 있습니다.</p> </li> <li> <p><a href=https://mkjwk.org/ >mkjwk JSON Web Key Generator</a>의 Public Key(X.509 PEM Format)를 Decoded의 Verify Signature 항목의 위쪽 박스에 붙여넣습니다.</p> </li> <li> <p>Debugger 왼쪽 하단에 "Signature Verified"가 나타나면 정상입니다.</p> </li> </ol> <h4 id=jwk-nginx-plus>JWK를 NGINX Plus에 적용<a class=headerlink href=#jwk-nginx-plus title="Permanent link">&para;</a></h4> <p>NGINX Plus를 설치한 후, /etc/nginx/conf.d/ 디렉토리 아래 내용의 conf 파일을 생성합니다. 이 Config는 테스트를 위해 몇 가지 확인 기능을 넣었습니다.</p> <ul> <li>Authorization 성공시 index.html 페이지를 반환, 실패시 50x.html 페이지를 반환</li> <li>Access Log에서 토큰 Payload의 sub, aud Claim의 내용 확인 가능</li> <li>Error 발생시 Error Log에서 확인 가능</li> </ul> <pre><code class=language-nginx>map $jwt_claim_sub $jwt_sub {
    &quot;RS256TEST&quot; &quot;Authed&quot;;
    default &quot;CantReadSub&quot;;
}
map $jwt_claim_aud $jwt_aud {
    &quot;dddaong&quot; &quot;Authed&quot;;
    default &quot;CantReadAud&quot;;
}

log_format test_log '&quot;Request: $request\n Status: $status\n Request_URI: $request_uri\n JWT Claim sub: $jwt_sub'\n JWT Claim aud: $jwt_aud'\n;

server {
    listen 8080;
    access_log  /etc/nginx/conf.d/jwt.access.log  test_log;
    error_log  /etc/nginx/conf.d/jwt.error.log debug;

    auth_jwt &quot;dddaong&quot;;
    auth_jwt_key_file conf.d/dddaong.jwk;

    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
    }
    error_page 400 401 403 500 502 503 504  /50x.html;
    location = /50x.html {
        auth_jwt off;
        root   /usr/share/nginx/html;
    }
}
</code></pre> <h5 id=-authentication-failure>테스트 - Authentication Failure<a class=headerlink href=#-authentication-failure title="Permanent link">&para;</a></h5> <p>이 Config가 적용된 상태에서 <code>http://localhost:8080</code>으로 접근하면, 아래와 같이 401 Unauthorized를 반환합니다.</p> <pre><code class=language-bash>curl -Iv http://localhost:8080

* About to connect() to localhost port 8080 (#0)
*   Trying ::1...
* Connection refused
*   Trying 127.0.0.1...
* Connected to localhost (127.0.0.1) port 8080 (#0)
&gt; HEAD / HTTP/1.1
&gt; User-Agent: curl/7.29.0
&gt; Host: localhost:8080
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 401 Unauthorized
HTTP/1.1 401 Unauthorized
&lt; Server: nginx/1.19.5
Server: nginx/1.19.5
&lt; Date: Wed, 07 Apr 2021 05:41:47 GMT
Date: Wed, 07 Apr 2021 05:41:47 GMT
&lt; Content-Type: text/html
Content-Type: text/html
&lt; Content-Length: 179
Content-Length: 179
&lt; Connection: keep-alive
Connection: keep-alive
&lt; WWW-Authenticate: Bearer realm=&quot;dddaong&quot;
WWW-Authenticate: Bearer realm=&quot;dddaong&quot;

&lt;
* Connection #0 to host localhost left intact
</code></pre> <pre><code class=language-bash># tail -5 access.jwt.log &amp;&amp; tail -1 error.jwt.log

#Access Log
Request: HEAD / HTTP/1.1
 Status: 401
 Request_URI: /
 JWT Claim sub: CantReadSub
 JWT Claim aud: CantReadAud

#Error Log
2021/04/07 16:19:01 [info] 3405#3405: *93 client 127.0.0.1 closed keepalive connection
</code></pre> <h5 id=-authentication-success>테스트 - Authentication Success<a class=headerlink href=#-authentication-success title="Permanent link">&para;</a></h5> <p>이제 생성한 Token을 헤더에 삽입해 테스트해보겠습니다.</p> <p>테스트에 사용한 명령어는 아래와 같습니다.</p> <pre><code class=language-bash>curl -IvH &quot;Authorization: Bearer `cat /etc/nginx/conf.d/dddaong.token`&quot; \
     http://localhost:8080
</code></pre> <pre><code class=language-bash>* About to connect() to localhost port 8080 (#0)
*   Trying ::1...
* Connection refused
*   Trying 127.0.0.1...
* Connected to localhost (127.0.0.1) port 8080 (#0)
&gt; HEAD / HTTP/1.1
&gt; User-Agent: curl/7.29.0
&gt; Host: localhost:8080
&gt; Accept: */*
&gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjAwMDEifQ.eyJzdWIiOiJSUzI1NlRFU1QiLCJhdWQiOiJkZGRhb25nIiwiaWF0IjoxNjE3Nzc4ODAwfQ.GwapbNpOrl8nLlJEo9JenBRMrGXTm03PwWVe6Jtje-lsTakG4M384-TGnmP79NOobE5KHaQ_RvyYmF65jFjoLAnMsC00jb9HBMWmSKMM7lF5BWQhDWQUEjGdZsCuB7jPI-CbdkAno0wRUKECM-wP0chH7PN0dPsQgUetwpM4uCRTRzq2_v5CT_1gcWp2w1VNjBEhXoEzabNhgMDKsVSnpdl30Odg0arYLrJ1USCYPVXnfn54CPwZwts6kooWr28m5i9DGuRT2XuzsGdrrFV_xLtFFhXcTsoNtAHeVCstzB0BG7DwJiNR4Sx1CH1pTR3tkEVZII3ik_Vx0Y7duFitJg
&gt;
&lt; HTTP/1.1 200 OK
HTTP/1.1 200 OK
&lt; Server: nginx/1.19.5
Server: nginx/1.19.5
&lt; Date: Wed, 07 Apr 2021 09:17:33 GMT
Date: Wed, 07 Apr 2021 09:17:33 GMT
&lt; Content-Type: text/html
Content-Type: text/html
&lt; Content-Length: 612
Content-Length: 612
&lt; Last-Modified: Mon, 07 Dec 2020 21:10:20 GMT
Last-Modified: Mon, 07 Dec 2020 21:10:20 GMT
&lt; Connection: keep-alive
Connection: keep-alive
&lt; ETag: &quot;5fce9a3c-264&quot;
ETag: &quot;5fce9a3c-264&quot;
&lt; Accept-Ranges: bytes
Accept-Ranges: bytes

&lt;
</code></pre> <pre><code class=language-bash>#tail -5 access.jwt.log &amp;&amp; tail -2 error.jwt.log

#Access Log
Status: 200
 Request_URI: /
 JWT Claim sub: Authed
 JWT Claim aud: Authed

#Error Log
2021/04/07 18:17:33 [info] 3403#3403: *109 client 127.0.0.1 closed keepalive connection
2021/04/07 18:18:16 [info] 3405#3405: *110 client 127.0.0.1 closed keepalive connection
</code></pre> <h5 id=trouble-shooting>Trouble shooting<a class=headerlink href=#trouble-shooting title="Permanent link">&para;</a></h5> <ul> <li>500 Internal Server Error를 반환하는 경우 일반적으로 JWK의 형식이 맞지 않는 문제인 경우가 많습니다. Access Log에서 Header와 Payload를 읽을 수는 있으나, 아래와 같이 Error Log에서 Invalid JWK set 이라는 로그를 남깁니다.</li> </ul> <pre><code class=language-bash>  Request: HEAD / HTTP/1.1
   Status: 500
   Request_URI: /
   JWT Claim sub: Authed
   JWT Claim aud: Authed

  2021/04/07 18:25:26 [info] 3405#3405: *114 invalid JWK set, client: 127.0.0.1, server: , request: &quot;HEAD / HTTP/1.1&quot;, host: &quot;localhost:8080&quot;
</code></pre> <ul> <li>JWT에 오류가 있거나 변조되면 401 Unauthorized를 반환하며, Access Log에서 Claim을 대조한 결과를 읽어오지 못합니다. Error 로그에서 상세 내용을 확인할 수 있습니다.</li> </ul> <pre><code class=language-bash>   Status: 401
   Request_URI: /
   JWT Claim sub: CantReadSub
   JWT Claim aud: CantReadAud

  2021/04/07 18:22:03 [info] 3402#3402: *111 invalid JWT header while logging request, client: 127.0.0.1, server: , request: &quot;HEAD / HTTP/1.1&quot;, host: &quot;localhost:8080&quot;
</code></pre> <p>이 테스트 내용을 바탕으로 NGINX Plus Ingress Controller에서 JWT 테스트를 진행할 예정입니다.</p> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../NGINX-Ingress-Ctlr/NPIC%EC%97%90%EC%84%9C-VS-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0/ class="md-footer__link md-footer__link--prev" aria-label="Previous: NGINX+ Ingress Controller - VS Crd로 Lua 사용" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> NGINX+ Ingress Controller - VS Crd로 Lua 사용 </div> </div> </a> <a href=../NGINX-Plus-NAP-WAF-DoS-Install-Guide/ class="md-footer__link md-footer__link--next" aria-label="Next: NGINX Plus NAP WAF DoS Install Guide" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> NGINX Plus NAP WAF DoS Install Guide </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.5a2dcb6a.min.js></script> </body> </html>