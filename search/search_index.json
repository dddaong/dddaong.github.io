{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"DDAONG \ubb38\uc11c\ud568\uc785\ub2c8\ub2e4. \uac01\uc885 \ud14c\uc2a4\ud2b8 \ub0b4\uc6a9\uacfc \uacb0\uacfc\ub97c \uacf5\uc720\ud569\ub2c8\ub2e4.","title":"DDAONG Docs Archive"},{"location":"Docker/Private-container-Local-Registry/","text":"Docker.com\uc758 Local Docker Registry Server \ubb38\uc11c\ub97c \uae30\ubc18\uc73c\ub85c \uc218\ud589\ud55c \ud14c\uc2a4\ud2b8 \uacfc\uc815\uc744 \uc791\uc131\ud569\ub2c8\ub2e4. Docker Private(Local) Registry \ud14c\uc2a4\ud2b8 \u00b6 \uc774 \ud3ec\uc2a4\ud2b8\uc758 \uc8fc\ub41c \ub0b4\uc6a9\uc740 Deploy a registry server \ub0b4\uc6a9\uc744 \uae30\ubc18\uc73c\ub85c, \ud14c\uc2a4\ud2b8\uc6a9 Kubernetes Cluster \ud658\uacbd\uc5d0 \ub9de\uac8c \ucee4\uc2a4\ud130\ub9c8\uc774\uc988\ud55c [Local Docker Image Registry \uc0dd\uc131\ud558\uae30] \uc785\ub2c8\ub2e4. Docker.com\uc5d0\uc11c \uae30\ubcf8\uc73c\ub85c \uc81c\uacf5\ud558\ub294 Registry \uc11c\ubc84\ub294 \uae30\ubcf8\uac12\uc73c\ub85c Localhost\uc5d0\uc11c\ub9cc \uc811\uadfc\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucc38\uc870 : Run an externally-accessible registry \ub530\ub77c\uc11c \uc774 \ud3ec\uc2a4\ud2b8\ub294 \uc778\uc99d\uc11c \uc0dd\uc131 \ubc0f Self-signed Cert\uc758 \uc0dd\uc131 \ubc0f \uc801\uc6a9 \uacfc\uc815, \uadf8\ub9ac\uace0 \ub2e4\ub978 \ub178\ub4dc\uc5d0\uc11c Push/Pull \ud14c\uc2a4\ud2b8\uae4c\uc9c0 \ub0b4\uc6a9\uc744 \uc791\uc131\ud569\ub2c8\ub2e4. Self-signed Cert \uc0dd\uc131 \u00b6 varPATH=/var/tmp/registry/certs varO='dddaong' varOU='dddaong' varCN='dddaong.test' mkdir -p $varPATH openssl req \\ -newkey rsa:4096 -nodes -sha256 -keyout /var/tmp/registry/certs/$varCN.key \\ -subj \"/C=KR/ST=Seoul/L=Seoul/O=$varO/OU=$varOU Department/CN=$varCN\" \\ -x509 -days 365 -out /var/tmp/registry/certs/$varCN.crt Run Registry \ucee8\ud14c\uc774\ub108 \uc2e4\ud589 \u00b6 Localhost\uac00 \uc544\ub2cc \uc678\ubd80\uc5d0\uc11c Registry\ub85c \uc811\uadfc\ud560 \uc218 \uc788\ub3c4\ub85d \ud558\ub824\uba74, \uc0dd\uc131\ud55c \uc778\uc99d\uc11c\ub97c Container \ub0b4\ubd80\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ud558\ub294 \uc124\uc815\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \uc544\ub798 \uba85\ub839\uc5b4\ub85c \uc2e4\ud589\ud569\ub2c8\ub2e4. # $varCN='dddaong.test' # $varPATH=/var/tmp/registry/certs mkdir -p /var/tmp/registry/repos/ docker run -d \\ --restart=always \\ --name registry \\ -v \"$varPATH\":/certs \\ -v /var/tmp/registry/repos:/var/lib/registry \\ -e REGISTRY_HTTP_ADDR=0.0.0.0:443 \\ -e REGISTRY_HTTP_TLS_CERTIFICATE=/certs/$varCN.crt \\ -e REGISTRY_HTTP_TLS_KEY=/certs/$varCN.key \\ -p 44443:443 \\ registry:2 -v flag\ub85c HostPath\ub97c \ucee8\ud14c\uc774\ub108 \ub0b4\ubd80\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ubcfc\ub968\uc744 \uc7a1\uc544\uc90d\ub2c8\ub2e4. -v \"$varPATH\":/certs : \uc778\uc99d\uc11c \uacbd\ub85c\ub85c\uc11c, \uc678\ubd80 \uc811\uadfc\uc744 \uc704\ud574 \ud544\uc218\ub85c \uc7a1\uc544\uc8fc\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. -v /var/tmp/registry/repos:/var/lib/registry : Push \ub41c \uc774\ubbf8\uc9c0\uac00 \uc800\uc7a5\ub418\ub294 \uacbd\ub85c\ub85c\uc11c \ud544\uc218 \uc635\uc158\uc740 \uc544\ub2c8\uc9c0\ub9cc, Push \ud14c\uc2a4\ud2b8 \uc2dc \uadf8 \uacb0\uacfc\ub97c \uc27d\uac8c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Registry\uc758 \ud3ec\ud2b8\ub97c \ubcc0\uacbd\ud558\uace0 \uc2f6\uc740 \uacbd\uc6b0, \uc608\ub97c \ub4e4\uc5b4, 44443 \ud3ec\ud2b8\uc5d0\uc11c 443 \ud3ec\ud2b8\ub85c \ubcc0\uacbd\ud558\ub824\uba74 -p 44443:443 \ubd80\ubd84\uc744 -p 443:443 \uc73c\ub85c \ubcc0\uacbd\ud574\uc8fc\uba74 \ub429\ub2c8\ub2e4. \uc798 \ub3d9\uc791\ud558\ub294\uc9c0 \uc544\ub798 \uba85\ub839\uc5b4\ub85c \ud655\uc778\ud574\uc90d\ub2c8\ub2e4. bash curl -vsk https://localhost:44443 \uc544\ub798\uc640 \uac19\uc774 200 OK\ub97c \ubc1b\uc544\uc624\uba74 \uc815\uc0c1\uc785\ub2c8\ub2e4. # curl -vsk https://localhost:44443 * About to connect() to localhost port 44443 (#0) * Trying ::1... * Connected to localhost (::1) port 44443 (#0) * Initializing NSS with certpath: sql:/etc/pki/nssdb * skipping SSL peer certificate verification * SSL connection using TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 * Server certificate: * subject: CN=dddaong.test,OU=dddaong Department,O=dddaong,L=Seoul,ST=Seoul,C=KR * start date: Apr 15 04:03:42 2021 GMT * expire date: Apr 15 04:03:42 2022 GMT * common name: dddaong.test * issuer: CN=dddaong.test,OU=dddaong Department,O=dddaong,L=Seoul,ST=Seoul,C=KR > GET / HTTP/1.1 > User-Agent: curl/7.29.0 > Host: localhost:44443 > Accept: */* > < HTTP/1.1 200 OK < Cache-Control: no-cache < Date: Thu, 15 Apr 2021 04:49:22 GMT < Content-Length: 0 < * Connection #0 to host localhost left intact Client Docker Daemon \uc124\uc815 \u00b6 \uac01 Docker Host\uc758 /etc/docker/certs.d/ \ub514\ub809\ud1a0\ub9ac\ub85c \uc778\uc99d\uc11c\ub97c \ubcf5\uc0ac\ud574\uc8fc\ub294 \uacfc\uc815\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \uc774 \uacfc\uc815\uc740 \ub3d9\uc791 \uc911\uc778 Registry Server\uc758 Client\uac00 \ub420 Docker Host \ub4e4\uc774 Registry \uc11c\ubc84\uc5d0\uc11c \uc804\ub2ec\ud558\ub294 \uc778\uc99d\uc11c\ub97c \uc548\uc804\ud55c \uc778\uc99d\uc11c\ub85c \uc778\uc2dd\ud558\uac8c \ud574\uc8fc\ub294 \uacfc\uc815\uc785\ub2c8\ub2e4. Registry\uc758 \ubaa8\ub4e0 \ud074\ub77c\uc774\uc5b8\ud2b8 Docker Host\uc5d0\uc11c \uc218\ud589\ud574\uc57c \ud569\ub2c8\ub2e4. docker Client\uac00 \ub420 Host\uc758 SSH\ub85c \uc811\uc18d\ud574 \uc544\ub798 \uba85\ub839\uc744 \uc218\ud589\ud569\ub2c8\ub2e4. varRegiaddr \ubcc0\uc218\uc5d0\ub294 Registry \ucee8\ud14c\uc774\ub108\uac00 \uc2e4\ud589 \uc911\uc778 Host\uc758 IP\ub97c \uc791\uc131\ud574\uc8fc\uba74 \ub429\ub2c8\ub2e4. varRegiaddr=\"xxx.xxx.xxx.xxx\" varCN=\"dddaong.test\" varPort=\"44443\" echo \"$varRegiaddr $varCN\" >> /etc/hosts mkdir -p /etc/docker/certs.d/$varCN:$varPort/ scp root@$varRegiaddr:/var/tmp/registry/certs/$varCN.crt \\ /etc/docker/certs.d/$varCN:$varPort/ca.crt \uacfc\uc815\uc774 \uc798 \uc218\ud589\ub418\uc5c8\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4. tail -1 /etc/hosts && ls /etc/docker/certs.d/$varCN:$varPort/ \uc774\uc81c \uc678\ubd80\uc5d0\uc11c\ub3c4 Registry\ub97c \uc0ac\uc6a9\ud560 \uc900\ube44\uac00 \ub418\uc5c8\uc2b5\ub2c8\ub2e4. Registry \uc678\ubd80 \uc0ac\uc6a9 \ud14c\uc2a4\ud2b8 \u00b6 Debian \ub9ac\ub205\uc2a4 \uc774\ubbf8\uc9c0\ub97c Docker hub\uc5d0\uc11c Pulling\ud55c \ud6c4, Registry\uc5d0 Push \ud574\ubcf4\ub294 \uac04\ub2e8\ud55c \ud14c\uc2a4\ud2b8 \uc218\ud589\ud569\ub2c8\ub2e4. \uba3c\uc800 Debian \ub9ac\ub205\uc2a4 \uc774\ubbf8\uc9c0\ub97c Docker Hub\uc5d0\uc11c Pull \ud569\ub2c8\ub2e4. docker pull debian:buster-slim hosts \ud30c\uc77c\uc5d0 dddaong.test\uc758 IP\ub97c \uc791\uc131\ud574 \uc8fc\uace0, Tag \uba85\ub839\uc5b4\ub85c, \uc774\ubbf8\uc9c0\uc758 Registry \uc815\ubcf4\ub97c \uc791\uc131/\ubcc0\uacbd\ud574\uc90d\ub2c8\ub2e4. docker tag debian:buster-slim dddaong.test:44443/debian:buster-slim Registry \uc11c\ubc84\ub85c Push\ub97c \uc218\ud589\ud574\ubd05\ub2c8\ub2e4. \uacb0\uacfc\uac00 \uc544\ub798\uc640 \uac19\uc774 \ub098\ud0c0\ub09c\ub2e4\uba74 Push\uac00 \uc815\uc0c1\uc801\uc73c\ub85c \uc218\ud589\ub41c \uac83\uc785\ub2c8\ub2e4. # docker push dddaong.test:44443/debian:buster-slim The push refers to repository [dddaong.test:44443/debian] 7e718b9c0c8c: Pushed buster-slim: digest: sha256:f4793ff7e177674c0b8541165f67289907aaf4391f60d71ba2a3db8a70fa76dc size: 529 Registry Server\uac00 \ub3d9\uc791 \uc911\uc778 Host\uc5d0\uc11c, Push \ub41c Debian \uc774\ubbf8\uc9c0\ub97c \uc9c1\uc811 \ud655\uc778\ud574\ubd05\ub2c8\ub2e4. # -v /var/tmp/registry/repos:/var/lib/registry \uc9c0\uc815\ud55c \uacbd\uc6b0 ls /var/tmp/registry/repos # -v /var/tmp/registry/repos:/var/lib/registry \uc9c0\uc815\ud558\uc9c0 \uc54a\uc740 \uacbd\uc6b0 docker exec -t registry ls /var/lib/registry/docker/registry/v2/repositories/ Pull \ud14c\uc2a4\ud2b8\ub97c \uc704\ud574 Docker Hub\uc5d0\uc11c \uac00\uc838\uc628 Debian \ub9ac\ub205\uc2a4 \uc774\ubbf8\uc9c0\ub97c \uc0ad\uc81c\ud569\ub2c8\ub2e4. docker rmi debian:buster-slim docker rmi dddaong.test:44443/debian:buster-slim dddaong.test:44443\uc5d0\uc11c debian \ub9ac\ub205\uc2a4\ub97c Pull \ud574\ubd05\ub2c8\ub2e4. \uacb0\uacfc\uac00 \uc544\ub798\uc640 \uac19\uc774 \ub098\ud0c0\ub09c\ub2e4\uba74 Pull\uc774 \uc815\uc0c1\uc801\uc73c\ub85c \uc218\ud589\ub41c \uac83\uc785\ub2c8\ub2e4. # docker pull dddaong.test:44443/debian:buster-slim buster-slim: Pulling from debian f7ec5a41d630: Pull complete Digest: sha256:f4793ff7e177674c0b8541165f67289907aaf4391f60d71ba2a3db8a70fa76dc Status: Downloaded newer image for dddaong.test:44443/debian:buster-slim Native Basic Auth, NGINX\ub97c \uc778\uc99d \ud504\ub85d\uc2dc\ub85c \uc0ac\uc6a9\ud558\ub294 \ubc29\ubc95 \ub4f1\uc740 Docker.com\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 \ub9c1\ud06c : Basic Auth , \ub9c1\ud06c: Recipes List \ub97c \ucc38\uace0\ud558\uba74 \ub418\uaca0\uc2b5\ub2c8\ub2e4.","title":"Docker - Private(Local) Container Registry"},{"location":"Docker/Private-container-Local-Registry/#docker-privatelocal-registry","text":"\uc774 \ud3ec\uc2a4\ud2b8\uc758 \uc8fc\ub41c \ub0b4\uc6a9\uc740 Deploy a registry server \ub0b4\uc6a9\uc744 \uae30\ubc18\uc73c\ub85c, \ud14c\uc2a4\ud2b8\uc6a9 Kubernetes Cluster \ud658\uacbd\uc5d0 \ub9de\uac8c \ucee4\uc2a4\ud130\ub9c8\uc774\uc988\ud55c [Local Docker Image Registry \uc0dd\uc131\ud558\uae30] \uc785\ub2c8\ub2e4. Docker.com\uc5d0\uc11c \uae30\ubcf8\uc73c\ub85c \uc81c\uacf5\ud558\ub294 Registry \uc11c\ubc84\ub294 \uae30\ubcf8\uac12\uc73c\ub85c Localhost\uc5d0\uc11c\ub9cc \uc811\uadfc\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucc38\uc870 : Run an externally-accessible registry \ub530\ub77c\uc11c \uc774 \ud3ec\uc2a4\ud2b8\ub294 \uc778\uc99d\uc11c \uc0dd\uc131 \ubc0f Self-signed Cert\uc758 \uc0dd\uc131 \ubc0f \uc801\uc6a9 \uacfc\uc815, \uadf8\ub9ac\uace0 \ub2e4\ub978 \ub178\ub4dc\uc5d0\uc11c Push/Pull \ud14c\uc2a4\ud2b8\uae4c\uc9c0 \ub0b4\uc6a9\uc744 \uc791\uc131\ud569\ub2c8\ub2e4.","title":"Docker Private(Local) Registry \ud14c\uc2a4\ud2b8"},{"location":"Docker/Private-container-Local-Registry/#self-signed-cert","text":"varPATH=/var/tmp/registry/certs varO='dddaong' varOU='dddaong' varCN='dddaong.test' mkdir -p $varPATH openssl req \\ -newkey rsa:4096 -nodes -sha256 -keyout /var/tmp/registry/certs/$varCN.key \\ -subj \"/C=KR/ST=Seoul/L=Seoul/O=$varO/OU=$varOU Department/CN=$varCN\" \\ -x509 -days 365 -out /var/tmp/registry/certs/$varCN.crt","title":"Self-signed Cert \uc0dd\uc131"},{"location":"Docker/Private-container-Local-Registry/#run-registry","text":"Localhost\uac00 \uc544\ub2cc \uc678\ubd80\uc5d0\uc11c Registry\ub85c \uc811\uadfc\ud560 \uc218 \uc788\ub3c4\ub85d \ud558\ub824\uba74, \uc0dd\uc131\ud55c \uc778\uc99d\uc11c\ub97c Container \ub0b4\ubd80\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ud558\ub294 \uc124\uc815\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \uc544\ub798 \uba85\ub839\uc5b4\ub85c \uc2e4\ud589\ud569\ub2c8\ub2e4. # $varCN='dddaong.test' # $varPATH=/var/tmp/registry/certs mkdir -p /var/tmp/registry/repos/ docker run -d \\ --restart=always \\ --name registry \\ -v \"$varPATH\":/certs \\ -v /var/tmp/registry/repos:/var/lib/registry \\ -e REGISTRY_HTTP_ADDR=0.0.0.0:443 \\ -e REGISTRY_HTTP_TLS_CERTIFICATE=/certs/$varCN.crt \\ -e REGISTRY_HTTP_TLS_KEY=/certs/$varCN.key \\ -p 44443:443 \\ registry:2 -v flag\ub85c HostPath\ub97c \ucee8\ud14c\uc774\ub108 \ub0b4\ubd80\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ubcfc\ub968\uc744 \uc7a1\uc544\uc90d\ub2c8\ub2e4. -v \"$varPATH\":/certs : \uc778\uc99d\uc11c \uacbd\ub85c\ub85c\uc11c, \uc678\ubd80 \uc811\uadfc\uc744 \uc704\ud574 \ud544\uc218\ub85c \uc7a1\uc544\uc8fc\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. -v /var/tmp/registry/repos:/var/lib/registry : Push \ub41c \uc774\ubbf8\uc9c0\uac00 \uc800\uc7a5\ub418\ub294 \uacbd\ub85c\ub85c\uc11c \ud544\uc218 \uc635\uc158\uc740 \uc544\ub2c8\uc9c0\ub9cc, Push \ud14c\uc2a4\ud2b8 \uc2dc \uadf8 \uacb0\uacfc\ub97c \uc27d\uac8c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Registry\uc758 \ud3ec\ud2b8\ub97c \ubcc0\uacbd\ud558\uace0 \uc2f6\uc740 \uacbd\uc6b0, \uc608\ub97c \ub4e4\uc5b4, 44443 \ud3ec\ud2b8\uc5d0\uc11c 443 \ud3ec\ud2b8\ub85c \ubcc0\uacbd\ud558\ub824\uba74 -p 44443:443 \ubd80\ubd84\uc744 -p 443:443 \uc73c\ub85c \ubcc0\uacbd\ud574\uc8fc\uba74 \ub429\ub2c8\ub2e4. \uc798 \ub3d9\uc791\ud558\ub294\uc9c0 \uc544\ub798 \uba85\ub839\uc5b4\ub85c \ud655\uc778\ud574\uc90d\ub2c8\ub2e4. bash curl -vsk https://localhost:44443 \uc544\ub798\uc640 \uac19\uc774 200 OK\ub97c \ubc1b\uc544\uc624\uba74 \uc815\uc0c1\uc785\ub2c8\ub2e4. # curl -vsk https://localhost:44443 * About to connect() to localhost port 44443 (#0) * Trying ::1... * Connected to localhost (::1) port 44443 (#0) * Initializing NSS with certpath: sql:/etc/pki/nssdb * skipping SSL peer certificate verification * SSL connection using TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 * Server certificate: * subject: CN=dddaong.test,OU=dddaong Department,O=dddaong,L=Seoul,ST=Seoul,C=KR * start date: Apr 15 04:03:42 2021 GMT * expire date: Apr 15 04:03:42 2022 GMT * common name: dddaong.test * issuer: CN=dddaong.test,OU=dddaong Department,O=dddaong,L=Seoul,ST=Seoul,C=KR > GET / HTTP/1.1 > User-Agent: curl/7.29.0 > Host: localhost:44443 > Accept: */* > < HTTP/1.1 200 OK < Cache-Control: no-cache < Date: Thu, 15 Apr 2021 04:49:22 GMT < Content-Length: 0 < * Connection #0 to host localhost left intact","title":"Run Registry \ucee8\ud14c\uc774\ub108 \uc2e4\ud589"},{"location":"Docker/Private-container-Local-Registry/#client-docker-daemon","text":"\uac01 Docker Host\uc758 /etc/docker/certs.d/ \ub514\ub809\ud1a0\ub9ac\ub85c \uc778\uc99d\uc11c\ub97c \ubcf5\uc0ac\ud574\uc8fc\ub294 \uacfc\uc815\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \uc774 \uacfc\uc815\uc740 \ub3d9\uc791 \uc911\uc778 Registry Server\uc758 Client\uac00 \ub420 Docker Host \ub4e4\uc774 Registry \uc11c\ubc84\uc5d0\uc11c \uc804\ub2ec\ud558\ub294 \uc778\uc99d\uc11c\ub97c \uc548\uc804\ud55c \uc778\uc99d\uc11c\ub85c \uc778\uc2dd\ud558\uac8c \ud574\uc8fc\ub294 \uacfc\uc815\uc785\ub2c8\ub2e4. Registry\uc758 \ubaa8\ub4e0 \ud074\ub77c\uc774\uc5b8\ud2b8 Docker Host\uc5d0\uc11c \uc218\ud589\ud574\uc57c \ud569\ub2c8\ub2e4. docker Client\uac00 \ub420 Host\uc758 SSH\ub85c \uc811\uc18d\ud574 \uc544\ub798 \uba85\ub839\uc744 \uc218\ud589\ud569\ub2c8\ub2e4. varRegiaddr \ubcc0\uc218\uc5d0\ub294 Registry \ucee8\ud14c\uc774\ub108\uac00 \uc2e4\ud589 \uc911\uc778 Host\uc758 IP\ub97c \uc791\uc131\ud574\uc8fc\uba74 \ub429\ub2c8\ub2e4. varRegiaddr=\"xxx.xxx.xxx.xxx\" varCN=\"dddaong.test\" varPort=\"44443\" echo \"$varRegiaddr $varCN\" >> /etc/hosts mkdir -p /etc/docker/certs.d/$varCN:$varPort/ scp root@$varRegiaddr:/var/tmp/registry/certs/$varCN.crt \\ /etc/docker/certs.d/$varCN:$varPort/ca.crt \uacfc\uc815\uc774 \uc798 \uc218\ud589\ub418\uc5c8\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4. tail -1 /etc/hosts && ls /etc/docker/certs.d/$varCN:$varPort/ \uc774\uc81c \uc678\ubd80\uc5d0\uc11c\ub3c4 Registry\ub97c \uc0ac\uc6a9\ud560 \uc900\ube44\uac00 \ub418\uc5c8\uc2b5\ub2c8\ub2e4.","title":"Client Docker Daemon \uc124\uc815"},{"location":"Docker/Private-container-Local-Registry/#registry","text":"Debian \ub9ac\ub205\uc2a4 \uc774\ubbf8\uc9c0\ub97c Docker hub\uc5d0\uc11c Pulling\ud55c \ud6c4, Registry\uc5d0 Push \ud574\ubcf4\ub294 \uac04\ub2e8\ud55c \ud14c\uc2a4\ud2b8 \uc218\ud589\ud569\ub2c8\ub2e4. \uba3c\uc800 Debian \ub9ac\ub205\uc2a4 \uc774\ubbf8\uc9c0\ub97c Docker Hub\uc5d0\uc11c Pull \ud569\ub2c8\ub2e4. docker pull debian:buster-slim hosts \ud30c\uc77c\uc5d0 dddaong.test\uc758 IP\ub97c \uc791\uc131\ud574 \uc8fc\uace0, Tag \uba85\ub839\uc5b4\ub85c, \uc774\ubbf8\uc9c0\uc758 Registry \uc815\ubcf4\ub97c \uc791\uc131/\ubcc0\uacbd\ud574\uc90d\ub2c8\ub2e4. docker tag debian:buster-slim dddaong.test:44443/debian:buster-slim Registry \uc11c\ubc84\ub85c Push\ub97c \uc218\ud589\ud574\ubd05\ub2c8\ub2e4. \uacb0\uacfc\uac00 \uc544\ub798\uc640 \uac19\uc774 \ub098\ud0c0\ub09c\ub2e4\uba74 Push\uac00 \uc815\uc0c1\uc801\uc73c\ub85c \uc218\ud589\ub41c \uac83\uc785\ub2c8\ub2e4. # docker push dddaong.test:44443/debian:buster-slim The push refers to repository [dddaong.test:44443/debian] 7e718b9c0c8c: Pushed buster-slim: digest: sha256:f4793ff7e177674c0b8541165f67289907aaf4391f60d71ba2a3db8a70fa76dc size: 529 Registry Server\uac00 \ub3d9\uc791 \uc911\uc778 Host\uc5d0\uc11c, Push \ub41c Debian \uc774\ubbf8\uc9c0\ub97c \uc9c1\uc811 \ud655\uc778\ud574\ubd05\ub2c8\ub2e4. # -v /var/tmp/registry/repos:/var/lib/registry \uc9c0\uc815\ud55c \uacbd\uc6b0 ls /var/tmp/registry/repos # -v /var/tmp/registry/repos:/var/lib/registry \uc9c0\uc815\ud558\uc9c0 \uc54a\uc740 \uacbd\uc6b0 docker exec -t registry ls /var/lib/registry/docker/registry/v2/repositories/ Pull \ud14c\uc2a4\ud2b8\ub97c \uc704\ud574 Docker Hub\uc5d0\uc11c \uac00\uc838\uc628 Debian \ub9ac\ub205\uc2a4 \uc774\ubbf8\uc9c0\ub97c \uc0ad\uc81c\ud569\ub2c8\ub2e4. docker rmi debian:buster-slim docker rmi dddaong.test:44443/debian:buster-slim dddaong.test:44443\uc5d0\uc11c debian \ub9ac\ub205\uc2a4\ub97c Pull \ud574\ubd05\ub2c8\ub2e4. \uacb0\uacfc\uac00 \uc544\ub798\uc640 \uac19\uc774 \ub098\ud0c0\ub09c\ub2e4\uba74 Pull\uc774 \uc815\uc0c1\uc801\uc73c\ub85c \uc218\ud589\ub41c \uac83\uc785\ub2c8\ub2e4. # docker pull dddaong.test:44443/debian:buster-slim buster-slim: Pulling from debian f7ec5a41d630: Pull complete Digest: sha256:f4793ff7e177674c0b8541165f67289907aaf4391f60d71ba2a3db8a70fa76dc Status: Downloaded newer image for dddaong.test:44443/debian:buster-slim Native Basic Auth, NGINX\ub97c \uc778\uc99d \ud504\ub85d\uc2dc\ub85c \uc0ac\uc6a9\ud558\ub294 \ubc29\ubc95 \ub4f1\uc740 Docker.com\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 \ub9c1\ud06c : Basic Auth , \ub9c1\ud06c: Recipes List \ub97c \ucc38\uace0\ud558\uba74 \ub418\uaca0\uc2b5\ub2c8\ub2e4.","title":"Registry \uc678\ubd80 \uc0ac\uc6a9 \ud14c\uc2a4\ud2b8"},{"location":"F5-BIG-IP/00-F5-HW-SW-Support-Policy/","text":"F5 Hardware / Software Support Policy \u00b6 K4309: F5 hardware product lifecycle support policy \u00b6 Platform (Hardware) EoS, EoNSS, EoSD, EoTS, EoRMA \uc815\ubcf4 \ud655\uc778 \uac00\ub2a5 https://support.f5.com/csp/article/K4309 EoS : End of Sales \ud310\ub9e4 \uc911\uc9c0\uc77c EoNSS : End of New Software Support, \ud574\ub2f9 HW\uc5d0 \ub300\ud55c \uc2e0\uaddc \uc18c\ud504\ud2b8\uc6e8\uc5b4 \uc9c0\uc6d0 \uc911\ub2e8\uc77c EoTS : End of Technical Support, \ud574\ub2f9 HW\uc5d0 \ub300\ud55c \ubca4\ub354 \uae30\uc220 \uc9c0\uc6d0 \uc885\ub8cc\uc77c EoRMA : End of Return Material Authorization, RMA \uc9c0\uc6d0 \uc885\ub8cc\uc77c ( Extended Support \uc885\ub8cc\uc77c) K5903: BIG-IP software support policy \u00b6 TMOS (Software) EoSD, EoTS \uc815\ubcf4 \ud655\uc778 \uac00\ub2a5 https://support.f5.com/csp/article/K5903 EoSD : End of Software Development, \ud574\ub2f9 SW \ubc84\uc804\uc5d0 \ub300\ud55c \uac1c\ubc1c \uc911\ub2e8\uc77c EoTS : End of Technical Support, \ud574\ub2f9 SW\uc5d0 \ub300\ud55c \ubca4\ub354 \uae30\uc220 \uc9c0\uc6d0 \uc885\ub8cc\uc77c","title":"F5 Hardware / Software Support Policy"},{"location":"F5-BIG-IP/00-F5-HW-SW-Support-Policy/#f5-hardware-software-support-policy","text":"","title":"F5 Hardware / Software Support Policy"},{"location":"F5-BIG-IP/00-F5-HW-SW-Support-Policy/#k4309-f5-hardware-product-lifecycle-support-policy","text":"Platform (Hardware) EoS, EoNSS, EoSD, EoTS, EoRMA \uc815\ubcf4 \ud655\uc778 \uac00\ub2a5 https://support.f5.com/csp/article/K4309 EoS : End of Sales \ud310\ub9e4 \uc911\uc9c0\uc77c EoNSS : End of New Software Support, \ud574\ub2f9 HW\uc5d0 \ub300\ud55c \uc2e0\uaddc \uc18c\ud504\ud2b8\uc6e8\uc5b4 \uc9c0\uc6d0 \uc911\ub2e8\uc77c EoTS : End of Technical Support, \ud574\ub2f9 HW\uc5d0 \ub300\ud55c \ubca4\ub354 \uae30\uc220 \uc9c0\uc6d0 \uc885\ub8cc\uc77c EoRMA : End of Return Material Authorization, RMA \uc9c0\uc6d0 \uc885\ub8cc\uc77c ( Extended Support \uc885\ub8cc\uc77c)","title":"K4309: F5 hardware product lifecycle support policy"},{"location":"F5-BIG-IP/00-F5-HW-SW-Support-Policy/#k5903-big-ip-software-support-policy","text":"TMOS (Software) EoSD, EoTS \uc815\ubcf4 \ud655\uc778 \uac00\ub2a5 https://support.f5.com/csp/article/K5903 EoSD : End of Software Development, \ud574\ub2f9 SW \ubc84\uc804\uc5d0 \ub300\ud55c \uac1c\ubc1c \uc911\ub2e8\uc77c EoTS : End of Technical Support, \ud574\ub2f9 SW\uc5d0 \ub300\ud55c \ubca4\ub354 \uae30\uc220 \uc9c0\uc6d0 \uc885\ub8cc\uc77c","title":"K5903: BIG-IP software support policy"},{"location":"F5-BIG-IP/BIG-IP-CIS/BIG-IP-CIS-01-Calico/","text":"F5 BIG-IP Container Ingress Service \uc18c\uac1c \u00b6 Container Ingress Service(CIS)\ub780 \u00b6 Kubernetes \ud658\uacbd\uc5d0\uc11c\ub294 \ub0b4\ubd80 \uc6cc\ud06c\ub85c\ub4dc \uc11c\ube44\uc2a4\uc758 \ub178\ucd9c\uc744 \uc704\ud574, Ingress Controller\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. F5 Container Ingress Service\ub294 Kubernetes.io\uc758 Ingress Controller \ubb38\uc11c \uc5d0 \ub9ac\uc2a4\ud2b8\uc5c5 \ub418\uc5b4 \uc788\ub294 Ingress Controller\uc785\ub2c8\ub2e4. Ingress Controller\uc758 \uc694\uac74 \u00b6 Ingress Controller\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \ud074\ub7ec\uc2a4\ud130 \ub0b4 \ub2e4\ub978 Service \uac1c\uccb4\ub4e4\uc744 \ub300\ud45c\ud558\ub294 Service\ub85c\uc11c, Proxy \ub3d9\uc791\uc744 \uc218\ud589\ud558\uba70 Kubernetes \uc548\uc758 Workload \ubc0f Ingress \ub4f1\uc758 \uc124\uc815\uc744 \uc77d\uc5b4 \uc790\uae30 \uc790\uc2e0\uc758 Config\uc5d0 \ubc18\uc601\ud558\ub294 \ub3d9\uc791\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \ub300\ud45c\uc801 Ingress Controller\uc778 NGINX Ingress Controller\ub97c \uae30\uc900\uc73c\ub85c \uc124\uba85\ud574\ubcf4\uc790\uba74, NGINX Ingress Controller\ub294 Kubernetes Cluster \ub0b4\ubd80\uc5d0 NGINX Ingress Controller Pod\uac00 \uc874\uc7ac\ud558\uace0, \uadf8 Service\uac00 \ub2e4\ub978 \uc11c\ube44\uc2a4\ub97c \ub300\ud45c\ud574 \uc678\ubd80\ub85c \ub178\ucd9c\ub429\ub2c8\ub2e4. NGINX Ingress Controller\ub294 Ingress \uac1c\uccb4 \uc124\uc815\uc5d0 \ub530\ub77c \uc790\ub3d9\uc73c\ub85c NGINX Config\ub85c \ubc18\uc601\ud569\ub2c8\ub2e4. \uc0ac\uc6a9\uc790\uac00 \uc218\ub3d9\uc73c\ub85c NGINX Config\ub97c \uc218\uc815\ud560 \ud544\uc694\uac00 \uc5c6\uc2b5\ub2c8\ub2e4. \uc720\uc785\ub418\ub294 \uc2e4\uc81c \uc11c\ube44\uc2a4 \ud2b8\ub798\ud53d\uc740 \uc790\ub3d9 \uc0dd\uc131\ub41c NGINX Config\uc5d0 \ub530\ub77c L7 Routing\ub418\uc5b4 \ub2e4\ub978 \uc11c\ube44\uc2a4\ub85c \ud504\ub85d\uc2dc \ub429\ub2c8\ub2e4. \ud55c\ud3b8, BIG-IP Device\ub294 \uae30\ubcf8\uc801\uc73c\ub85c Proxy \ub3d9\uc791\uc744 \uc218\ud589\ud558\uae30 \ub54c\ubb38\uc5d0, Kubernetes Workload\uc758 \uc0c1\ud0dc\ub9cc \uc2e4\uc2dc\uac04\uc73c\ub85c TMOS Config\ub85c \ubc18\uc601\ud560 \uc218 \uc788\ub2e4\uba74, BIG-IP Device\ub97c Ingress Controller\ub85c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. F5 Container Ingress Service\ub294 \uc774 Kubernetes\uc758 \uc0c1\ud0dc\uac00 Config\ub85c \ubc18\uc601\ub418\ub3c4\ub85d \ud574\uc8fc\ub294 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc73c\ub85c\uc11c, BIG-IP LTM\uc744 Ingress Controller\ub85c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ud558\ub294 \uc77c\uc885\uc758 \ubbf8\ub4e4\uc6e8\uc5b4\uc774\uc790 Kubernetes Cluster\ub97c \ub300\uc2e0\ud574 TMOS\uc640 \ud1b5\uc2e0\ud574\uc8fc\ub294 \uc778\ud130\ud398\uc774\uc2a4 \uc5ed\ud560\uc758 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc785\ub2c8\ub2e4. \uc774 CIS\ub294 TMOS\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 F5 REST API\ub97c \ud1b5\ud574 Workload \uc0c1\ud0dc\ub97c Config\ub85c \ubc18\uc601\ud560 \uc218 \uc788\ub3c4\ub85d \ud569\ub2c8\ub2e4. F5 REST API Scheme - AS3 Extension\uc758 \uc0ac\uc6a9 \u00b6 \uc0ac\uc6a9\uc790\uac00 \uc9c1\uc811 \uc218\ub3d9\uc73c\ub85c F5 REST API\uc5d0\uc11c \uc5b4\ub5a4 \uc11c\ube44\uc2a4\ub97c \uc124\uc815\ud55c\ub2e4\uace0 \uac00\uc815\ud558\uba74, Pool \uc0dd\uc131, Profile \uc0dd\uc131, Virtual Server \uc0dd\uc131 \ub4f1 \uac01 \uac1c\uccb4\ub9c8\ub2e4 \uc5ec\ub7ec \ubc88\uc758 API Call\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \ub610\ud55c \uc774\ubbf8 \uc218\ud589\ud55c API Call\uc744 \ub2e4\uc2dc \uc694\uccad\ud558\ub294 \uacbd\uc6b0, Error \uba54\uc2dc\uc9c0\ub97c \ubc18\ud658\ud558\uae30\ub3c4 \ud558\uace0, Kubernetes Workload\ub97c Config\ub85c \ubc18\uc601\ud558\ub824\uba74 \uae30\uc874\uc758 REST API \uc2a4\ud0a4\ub9c8\ub85c\ub294 \ube44\ud6a8\uc728\uc801\uc774\uba70 Object\uc5d0 \ub530\ub77c \uc0ac\uc6a9\ud558\uae30 \ubcf5\uc7a1\ud55c \ubd80\ubd84\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uadf8\ub798\uc11c, CIS\ub294 AS3 Extension\uc774\ub77c\ub294 F5 REST API\uc758 \ud655\uc7a5 \uaddc\uaca9\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. F5 Service \uc124\uc815\uc5d0 \ud544\uc694\ud55c \ubaa8\ub4e0 \uac83\uc744 \ud558\ub098\uc758 Request\uc5d0\uc11c \uc791\uc131\ud558\uc5ec Application\uc758 \uc804\uccb4 Config\ub97c \ud558\ub098\uc758 API Request\uc5d0\uc11c \uad6c\uc131\ud560 \uc218 \uc788\ub3c4\ub85d \ud574\uc90d\ub2c8\ub2e4. \ub610\ud55c API Request\uac00 \uba85\ub839\ud615\uc774 \uc544\ub2cc, \uc120\uc5b8\ud615\uc73c\ub85c\uc11c AS3 Extension\uc740 Declarative(\uc120\uc5b8\ud615) Model API Scheme\uc744 \uc0ac\uc6a9\ud574, \ubaa9\ud45c \uad6c\uc131\uc744 \uc791\uc131\ud558\uba74, \uadf8\uc5d0 \ub530\ub77c \uc54c\uc544\uc11c Config\ub97c \uc644\uc131\ud558\ub294 \uc2dd\uc73c\ub85c \ub3d9\uc791\ud569\ub2c8\ub2e4. \uc774 \ubc29\uc2dd\uc744 \ud1b5\ud574 \ud55c \ubc88\uc758 API Call\ub85c TMOS Config\ub97c \uc644\uc131\ud560 \uc218 \uc788\ub3c4\ub85d \ud569\ub2c8\ub2e4. Imperative(\uba85\ub839\ud615) vs Declarative(\uc120\uc5b8\ud615) \uba85\ub839\ud615\uacfc \uc120\uc5b8\ud615\uc744 \uac04\ub7b5\ud558\uac8c \uc124\uba85\ud558\uc790\uba74, \uba85\ub839\ud615Imperative\uc740 \uc11c\ube44\uc2a4\ub97c \uad6c\uc131\ud558\uae30 \uc704\ud574 \ubb34\uc5c7\uc744 \ud560\uc9c0\ub97c \uc9c1\uc811 \uba85\ub839\ud558\ub294 \ubc29\uc2dd\uc774\uace0, \uc120\uc5b8\ud615\uc740 \uc6d0\ud558\ub294 \ucd5c\uc885 \uc124\uc815\uc744 \uc9c0\uc815\ud558\uba74 \uc2dc\uc2a4\ud15c\uc774 \uadf8\uc5d0 \ub9de\ub294 \ubc29\ubc95\uc744 \ud655\uc778\ud558\uc5ec \uc218\ud589\ud558\ub294 \ud615\uc2dd\uc785\ub2c8\ub2e4. \uc880\ub354 \uad6c\uccb4\uc801\uc73c\ub85c\ub294 \u201cWhat to DO\u201d\uc640 \u201cWhat to BE\u201d\uc758 \ucc28\uc774\uc774\uba70, \uae30\uc874 REST API\uc758 \ub3d9\uc791\uc778 Pool \uc0dd\uc131, Profile \uc0dd\uc131, Policy Rule \uc0dd\uc131, Virtual Server \uc0dd\uc131 \ub4f1 \uac01 \ub2e8\uacc4\ub9c8\ub2e4 \ub3d9\uc791\uc744 \uc9c0\uc815\ud558\ub294 \ubc29\ubc95\uc774 \uba85\ub839\ud615Imperative model API Scheme\uc774\uba70, AS3\ub294 \uc120\uc5b8\ud615Declarative model API Scheme\ub85c\uc11c, \uc6d0\ud558\ub294 \ubaa9\ud45c \uad6c\uc131\uc744 \uc791\uc131\ud558\uba74 \uc2e4\uc81c Config \ub3d9\uc791\uc740 BIG-IP\uc5d0\uc11c \uc774\ub904\uc9c0\ub294 \ud615\uc2dd\uc73c\ub85c \ub3d9\uc791\ud569\ub2c8\ub2e4. CIS\ub97c \uc0ac\uc6a9\ud558\ub294 \uc774\uc720 \u00b6 Kubernetes \ud074\ub7ec\uc2a4\ud130 \ub0b4\ubd80\uc5d0\uc11c Pod\ub85c\uc11c \ub3d9\uc791\ud558\ub294 \uc5ec\ud0c0 Ingress Controller\uc640 Container Ingress Service\uc640 \ube44\uad50\ud558\uc790\uba74, CIS\uac00 \ud558\ub4dc\uc6e8\uc5b4\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc5bb\uc744 \uc218 \uc788\ub294 \uac00\uc18d\uc758 \uc7a5\uc810, \uc124\uc815\uc5d0 \ub530\ub77c Pod\uae4c\uc9c0 \uc9c1\uc811 \ub3c4\ub2ec\ud560 \uc218 \uc788\uc5b4 Connection \uc81c\uc5b4 \ubc0f \ub2e4\uc591\ud55c Persistence\uc758 \uc0ac\uc6a9, \ube44\uad50\uc801 \uac04\ud3b8\ud55c VIP \ud560\ub2f9 \ubc0f BIG-IP\uc758 \uae30\ub2a5 \uc804\ubc18\uc744 \ud65c\uc6a9\ud560 \uc218 \uc788\ub294 \uc774\uc810\uc774 \uc788\uc2b5\ub2c8\ub2e4. CIS\uc758 Deployment options \u00b6 Nodeport \u00b6 NodePort \ubaa8\ub4dc\ub294 Kubernetes Cluster Overlay Network\uc640 \uc5f0\ub3d9\uc744 \ud558\uc9c0 \uc54a\ub294 \uc124\uce58 \ubc29\uc2dd\uc785\ub2c8\ub2e4. Overlay Network\uc640 \uc5f0\ub3d9 \uacfc\uc815\uc774 \ud544\uc694 \uc5c6\uae30 \ub54c\ubb38\uc5d0 \uc124\uce58\uac00 \uac00\uc7a5 \uac04\ub2e8\ud558\uba70, \ub54c\ubb38\uc5d0 BIG-IP\uc758 Pool member\uac00 Kubernetes Node IP + Node Port\uac00 \ub429\ub2c8\ub2e4. Node IP\ub97c Pool member\ub85c \ud558\uae30 \ub54c\ubb38\uc5d0 Pod Scale in/out \ub4f1\uc5d0 \uc601\ud5a5\uc744 \ubc1b\uc9c0 \uc54a\uace0, \ub530\ub77c\uc11cPool Member\uc758 \ubcc0\ud654\uac00 \uac70\uc758 \uc5c6\uc2b5\ub2c8\ub2e4. BIG-IP\uac00 Pod\uae4c\uc9c0 \uc9c1\uc811 \ub3c4\ub2ec\ud558\uc9c0 \ubabb\ud558\uace0, Service\ub97c \ud1b5\ud574 Pod\uc5d0 \uc811\uadfc\ud558\uae30 \ub54c\ubb38\uc5d0 Pod\uc5d0 \ub300\ud574 Cluster \ub0b4\uc5d0\uc11c \uc5b4\ub5a4 \uacbd\ub85c\ub85c \ud2b8\ub798\ud53d\uc774 \uc804\ub2ec\ub418\uc5c8\ub294\uc9c0, \ub2e8\uc77c Pod\uac00 \uac16\uace0 \uc788\ub294 Connection\uc758 \uc22b\uc790, LB \uc0c1\ud0dc \ub4f1 \uac00\uc2dc\uc131 \ud655\ubcf4\uac00 \uc5b4\ub835\uc2b5\ub2c8\ub2e4. Pod\uc5d0 \ub300\ud55c Load balance\uc758 \uc8fc\uccb4\ub294 Kubernetes Service\uc778 \ub9cc\ud07c Kube-Proxy \ub610\ub294 \uad6c\uc131\uc5d0 \ub530\ub77c IPVS\ub97c \ud1b5\ud574 Pod\uc5d0 \ub300\ud574 \ud55c\ubc88 \ub354 LB\uac00 \uc774\ub904\uc9c0\uac8c \ub418\uba70, \ubcf5\uc7a1\ud55c iptables \ud14c\uc774\ube14 \ub54c\ubb38\uc5d0 \uc57d\uac04\uc758 \uc131\ub2a5 \uc800\ud558\uac00 \uc788\uc744 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. ClusterIP \u00b6 ClusterIP \ubaa8\ub4dc\ub294 BIG-IP \uc7a5\ube44\uac00 Kubernetes Cluster Overlay Network\uc5d0 \uc811\uadfc\ud560 \uc218 \uc788\ub3c4\ub85d \ud558\ub294 \uc124\uce58 \ubc29\uc2dd\uc785\ub2c8\ub2e4. BIG-IP\uac00 Pod\uc5d0 \uc9c1\uc811 \uc811\uadfc\uc774 \uac00\ub2a5\ud558\uae30 \ub54c\ubb38\uc5d0 BIG-IP\uc758 Pool member\uac00 Pod\uc758 IP, Port\uac00 \ub429\ub2c8\ub2e4. Pod Scale-in/out\uc5d0 Pool Member config\uac00 \uc9c1\uc811 \uc601\ud5a5\uc744 \ubc1b\uc73c\uba70, \ube44\uad50\uc801 \uba85\ud655\ud55c \uac00\uc2dc\uc131\uc744 \ud655\ubcf4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Flannel CNI\uc640\uc758 \uc5f0\ub3d9\uc744 \uc704\ud574 VXLAN\uc744 \uc0ac\uc6a9\ud558\uac70\ub098, Calico \uc5f0\ub3d9\uc744 \uc704\ud574 BGP Peer \uc124\uc815\uc744 \uc218\ud589\ud558\uac70\ub098 \ud558\ub294 \uacfc\uc815\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. (Calico CNI\uc640 BGP \uc5f0\ub3d9 \uc2dc Dynamic Routing License\uac00 \ud544\uc694\ud569\ub2c8\ub2e4.) NodePortLocal \u00b6 Antrea CNI\uc758 NodePortLocal \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud558\ub294 \ubaa8\ub4dc\ub85c\uc11c, Antrea Agent\uac00 \uc81c\uacf5\ud558\ub294 \ud3ec\ud2b8\ub9f5\uc744 \uc0ac\uc6a9\ud574 Kube-Proxy\ub97c \ubc14\uc774\ud328\uc2a4\ud560 \uc218 \uc788\ub3c4\ub85d \ud569\ub2c8\ub2e4. NodePort \ubaa8\ub4dc\uc640 \uc720\uc0ac\ud558\uac8c Kubernetes Cluster Overlay Network\uc640 \uc5f0\ub3d9\uc744 \ud558\uc9c0 \uc54a\ub294 \uc124\uce58 \ubc29\uc2dd\uc785\ub2c8\ub2e4. Service \uac1c\uccb4\uc758 Type \ud56d\ubaa9\uc73c\ub85c NodePort\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0, Pod \ub610\ub294 Service\uc5d0 \uc791\uc131\ud55c \u2018NodePortLocal\u2019 Annotation\uc5d0 \ub530\ub77c BIG-IP\ub85c \ubc18\uc601\ub429\ub2c8\ub2e4. \ub530\ub77c\uc11c Load Balancing\uc758 \ub300\uc0c1\uc778 Pod\uac00 \uc874\uc7ac\ud558\ub294 Node\uc758 IP, Port\uac00 Pool Member\uac00 \ub418\uba70, \uc774 \uc815\ubcf4\ub294 Antrea Agent\uac00 \uc81c\uacf5\ud558\ub294 NodePort \ubaa8\ub4dc\uc5d0 \ube44\ud574 \uac00\uc2dc\uc131\uc774 \uc5b4\ub290\uc815\ub3c4 \ud655\ubcf4\ub41c\ub2e4\uace0 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4. [\ub9c1\ud06c] https://antrea.io/docs/main/","title":"F5 BIG-IP CIS \uc18c\uac1c"},{"location":"F5-BIG-IP/BIG-IP-CIS/BIG-IP-CIS-01-Calico/#f5-big-ip-container-ingress-service","text":"","title":"F5 BIG-IP Container Ingress Service \uc18c\uac1c"},{"location":"F5-BIG-IP/BIG-IP-CIS/BIG-IP-CIS-01-Calico/#container-ingress-servicecis","text":"Kubernetes \ud658\uacbd\uc5d0\uc11c\ub294 \ub0b4\ubd80 \uc6cc\ud06c\ub85c\ub4dc \uc11c\ube44\uc2a4\uc758 \ub178\ucd9c\uc744 \uc704\ud574, Ingress Controller\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. F5 Container Ingress Service\ub294 Kubernetes.io\uc758 Ingress Controller \ubb38\uc11c \uc5d0 \ub9ac\uc2a4\ud2b8\uc5c5 \ub418\uc5b4 \uc788\ub294 Ingress Controller\uc785\ub2c8\ub2e4.","title":"Container Ingress Service(CIS)\ub780"},{"location":"F5-BIG-IP/BIG-IP-CIS/BIG-IP-CIS-01-Calico/#ingress-controller","text":"Ingress Controller\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \ud074\ub7ec\uc2a4\ud130 \ub0b4 \ub2e4\ub978 Service \uac1c\uccb4\ub4e4\uc744 \ub300\ud45c\ud558\ub294 Service\ub85c\uc11c, Proxy \ub3d9\uc791\uc744 \uc218\ud589\ud558\uba70 Kubernetes \uc548\uc758 Workload \ubc0f Ingress \ub4f1\uc758 \uc124\uc815\uc744 \uc77d\uc5b4 \uc790\uae30 \uc790\uc2e0\uc758 Config\uc5d0 \ubc18\uc601\ud558\ub294 \ub3d9\uc791\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \ub300\ud45c\uc801 Ingress Controller\uc778 NGINX Ingress Controller\ub97c \uae30\uc900\uc73c\ub85c \uc124\uba85\ud574\ubcf4\uc790\uba74, NGINX Ingress Controller\ub294 Kubernetes Cluster \ub0b4\ubd80\uc5d0 NGINX Ingress Controller Pod\uac00 \uc874\uc7ac\ud558\uace0, \uadf8 Service\uac00 \ub2e4\ub978 \uc11c\ube44\uc2a4\ub97c \ub300\ud45c\ud574 \uc678\ubd80\ub85c \ub178\ucd9c\ub429\ub2c8\ub2e4. NGINX Ingress Controller\ub294 Ingress \uac1c\uccb4 \uc124\uc815\uc5d0 \ub530\ub77c \uc790\ub3d9\uc73c\ub85c NGINX Config\ub85c \ubc18\uc601\ud569\ub2c8\ub2e4. \uc0ac\uc6a9\uc790\uac00 \uc218\ub3d9\uc73c\ub85c NGINX Config\ub97c \uc218\uc815\ud560 \ud544\uc694\uac00 \uc5c6\uc2b5\ub2c8\ub2e4. \uc720\uc785\ub418\ub294 \uc2e4\uc81c \uc11c\ube44\uc2a4 \ud2b8\ub798\ud53d\uc740 \uc790\ub3d9 \uc0dd\uc131\ub41c NGINX Config\uc5d0 \ub530\ub77c L7 Routing\ub418\uc5b4 \ub2e4\ub978 \uc11c\ube44\uc2a4\ub85c \ud504\ub85d\uc2dc \ub429\ub2c8\ub2e4. \ud55c\ud3b8, BIG-IP Device\ub294 \uae30\ubcf8\uc801\uc73c\ub85c Proxy \ub3d9\uc791\uc744 \uc218\ud589\ud558\uae30 \ub54c\ubb38\uc5d0, Kubernetes Workload\uc758 \uc0c1\ud0dc\ub9cc \uc2e4\uc2dc\uac04\uc73c\ub85c TMOS Config\ub85c \ubc18\uc601\ud560 \uc218 \uc788\ub2e4\uba74, BIG-IP Device\ub97c Ingress Controller\ub85c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. F5 Container Ingress Service\ub294 \uc774 Kubernetes\uc758 \uc0c1\ud0dc\uac00 Config\ub85c \ubc18\uc601\ub418\ub3c4\ub85d \ud574\uc8fc\ub294 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc73c\ub85c\uc11c, BIG-IP LTM\uc744 Ingress Controller\ub85c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ud558\ub294 \uc77c\uc885\uc758 \ubbf8\ub4e4\uc6e8\uc5b4\uc774\uc790 Kubernetes Cluster\ub97c \ub300\uc2e0\ud574 TMOS\uc640 \ud1b5\uc2e0\ud574\uc8fc\ub294 \uc778\ud130\ud398\uc774\uc2a4 \uc5ed\ud560\uc758 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc785\ub2c8\ub2e4. \uc774 CIS\ub294 TMOS\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 F5 REST API\ub97c \ud1b5\ud574 Workload \uc0c1\ud0dc\ub97c Config\ub85c \ubc18\uc601\ud560 \uc218 \uc788\ub3c4\ub85d \ud569\ub2c8\ub2e4.","title":"Ingress Controller\uc758 \uc694\uac74"},{"location":"F5-BIG-IP/BIG-IP-CIS/BIG-IP-CIS-01-Calico/#f5-rest-api-scheme-as3-extension","text":"\uc0ac\uc6a9\uc790\uac00 \uc9c1\uc811 \uc218\ub3d9\uc73c\ub85c F5 REST API\uc5d0\uc11c \uc5b4\ub5a4 \uc11c\ube44\uc2a4\ub97c \uc124\uc815\ud55c\ub2e4\uace0 \uac00\uc815\ud558\uba74, Pool \uc0dd\uc131, Profile \uc0dd\uc131, Virtual Server \uc0dd\uc131 \ub4f1 \uac01 \uac1c\uccb4\ub9c8\ub2e4 \uc5ec\ub7ec \ubc88\uc758 API Call\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \ub610\ud55c \uc774\ubbf8 \uc218\ud589\ud55c API Call\uc744 \ub2e4\uc2dc \uc694\uccad\ud558\ub294 \uacbd\uc6b0, Error \uba54\uc2dc\uc9c0\ub97c \ubc18\ud658\ud558\uae30\ub3c4 \ud558\uace0, Kubernetes Workload\ub97c Config\ub85c \ubc18\uc601\ud558\ub824\uba74 \uae30\uc874\uc758 REST API \uc2a4\ud0a4\ub9c8\ub85c\ub294 \ube44\ud6a8\uc728\uc801\uc774\uba70 Object\uc5d0 \ub530\ub77c \uc0ac\uc6a9\ud558\uae30 \ubcf5\uc7a1\ud55c \ubd80\ubd84\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uadf8\ub798\uc11c, CIS\ub294 AS3 Extension\uc774\ub77c\ub294 F5 REST API\uc758 \ud655\uc7a5 \uaddc\uaca9\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. F5 Service \uc124\uc815\uc5d0 \ud544\uc694\ud55c \ubaa8\ub4e0 \uac83\uc744 \ud558\ub098\uc758 Request\uc5d0\uc11c \uc791\uc131\ud558\uc5ec Application\uc758 \uc804\uccb4 Config\ub97c \ud558\ub098\uc758 API Request\uc5d0\uc11c \uad6c\uc131\ud560 \uc218 \uc788\ub3c4\ub85d \ud574\uc90d\ub2c8\ub2e4. \ub610\ud55c API Request\uac00 \uba85\ub839\ud615\uc774 \uc544\ub2cc, \uc120\uc5b8\ud615\uc73c\ub85c\uc11c AS3 Extension\uc740 Declarative(\uc120\uc5b8\ud615) Model API Scheme\uc744 \uc0ac\uc6a9\ud574, \ubaa9\ud45c \uad6c\uc131\uc744 \uc791\uc131\ud558\uba74, \uadf8\uc5d0 \ub530\ub77c \uc54c\uc544\uc11c Config\ub97c \uc644\uc131\ud558\ub294 \uc2dd\uc73c\ub85c \ub3d9\uc791\ud569\ub2c8\ub2e4. \uc774 \ubc29\uc2dd\uc744 \ud1b5\ud574 \ud55c \ubc88\uc758 API Call\ub85c TMOS Config\ub97c \uc644\uc131\ud560 \uc218 \uc788\ub3c4\ub85d \ud569\ub2c8\ub2e4. Imperative(\uba85\ub839\ud615) vs Declarative(\uc120\uc5b8\ud615) \uba85\ub839\ud615\uacfc \uc120\uc5b8\ud615\uc744 \uac04\ub7b5\ud558\uac8c \uc124\uba85\ud558\uc790\uba74, \uba85\ub839\ud615Imperative\uc740 \uc11c\ube44\uc2a4\ub97c \uad6c\uc131\ud558\uae30 \uc704\ud574 \ubb34\uc5c7\uc744 \ud560\uc9c0\ub97c \uc9c1\uc811 \uba85\ub839\ud558\ub294 \ubc29\uc2dd\uc774\uace0, \uc120\uc5b8\ud615\uc740 \uc6d0\ud558\ub294 \ucd5c\uc885 \uc124\uc815\uc744 \uc9c0\uc815\ud558\uba74 \uc2dc\uc2a4\ud15c\uc774 \uadf8\uc5d0 \ub9de\ub294 \ubc29\ubc95\uc744 \ud655\uc778\ud558\uc5ec \uc218\ud589\ud558\ub294 \ud615\uc2dd\uc785\ub2c8\ub2e4. \uc880\ub354 \uad6c\uccb4\uc801\uc73c\ub85c\ub294 \u201cWhat to DO\u201d\uc640 \u201cWhat to BE\u201d\uc758 \ucc28\uc774\uc774\uba70, \uae30\uc874 REST API\uc758 \ub3d9\uc791\uc778 Pool \uc0dd\uc131, Profile \uc0dd\uc131, Policy Rule \uc0dd\uc131, Virtual Server \uc0dd\uc131 \ub4f1 \uac01 \ub2e8\uacc4\ub9c8\ub2e4 \ub3d9\uc791\uc744 \uc9c0\uc815\ud558\ub294 \ubc29\ubc95\uc774 \uba85\ub839\ud615Imperative model API Scheme\uc774\uba70, AS3\ub294 \uc120\uc5b8\ud615Declarative model API Scheme\ub85c\uc11c, \uc6d0\ud558\ub294 \ubaa9\ud45c \uad6c\uc131\uc744 \uc791\uc131\ud558\uba74 \uc2e4\uc81c Config \ub3d9\uc791\uc740 BIG-IP\uc5d0\uc11c \uc774\ub904\uc9c0\ub294 \ud615\uc2dd\uc73c\ub85c \ub3d9\uc791\ud569\ub2c8\ub2e4.","title":"F5 REST API Scheme - AS3 Extension\uc758 \uc0ac\uc6a9"},{"location":"F5-BIG-IP/BIG-IP-CIS/BIG-IP-CIS-01-Calico/#cis","text":"Kubernetes \ud074\ub7ec\uc2a4\ud130 \ub0b4\ubd80\uc5d0\uc11c Pod\ub85c\uc11c \ub3d9\uc791\ud558\ub294 \uc5ec\ud0c0 Ingress Controller\uc640 Container Ingress Service\uc640 \ube44\uad50\ud558\uc790\uba74, CIS\uac00 \ud558\ub4dc\uc6e8\uc5b4\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc5bb\uc744 \uc218 \uc788\ub294 \uac00\uc18d\uc758 \uc7a5\uc810, \uc124\uc815\uc5d0 \ub530\ub77c Pod\uae4c\uc9c0 \uc9c1\uc811 \ub3c4\ub2ec\ud560 \uc218 \uc788\uc5b4 Connection \uc81c\uc5b4 \ubc0f \ub2e4\uc591\ud55c Persistence\uc758 \uc0ac\uc6a9, \ube44\uad50\uc801 \uac04\ud3b8\ud55c VIP \ud560\ub2f9 \ubc0f BIG-IP\uc758 \uae30\ub2a5 \uc804\ubc18\uc744 \ud65c\uc6a9\ud560 \uc218 \uc788\ub294 \uc774\uc810\uc774 \uc788\uc2b5\ub2c8\ub2e4.","title":"CIS\ub97c \uc0ac\uc6a9\ud558\ub294 \uc774\uc720"},{"location":"F5-BIG-IP/BIG-IP-CIS/BIG-IP-CIS-01-Calico/#cis-deployment-options","text":"","title":"CIS\uc758 Deployment options"},{"location":"F5-BIG-IP/BIG-IP-CIS/BIG-IP-CIS-01-Calico/#nodeport","text":"NodePort \ubaa8\ub4dc\ub294 Kubernetes Cluster Overlay Network\uc640 \uc5f0\ub3d9\uc744 \ud558\uc9c0 \uc54a\ub294 \uc124\uce58 \ubc29\uc2dd\uc785\ub2c8\ub2e4. Overlay Network\uc640 \uc5f0\ub3d9 \uacfc\uc815\uc774 \ud544\uc694 \uc5c6\uae30 \ub54c\ubb38\uc5d0 \uc124\uce58\uac00 \uac00\uc7a5 \uac04\ub2e8\ud558\uba70, \ub54c\ubb38\uc5d0 BIG-IP\uc758 Pool member\uac00 Kubernetes Node IP + Node Port\uac00 \ub429\ub2c8\ub2e4. Node IP\ub97c Pool member\ub85c \ud558\uae30 \ub54c\ubb38\uc5d0 Pod Scale in/out \ub4f1\uc5d0 \uc601\ud5a5\uc744 \ubc1b\uc9c0 \uc54a\uace0, \ub530\ub77c\uc11cPool Member\uc758 \ubcc0\ud654\uac00 \uac70\uc758 \uc5c6\uc2b5\ub2c8\ub2e4. BIG-IP\uac00 Pod\uae4c\uc9c0 \uc9c1\uc811 \ub3c4\ub2ec\ud558\uc9c0 \ubabb\ud558\uace0, Service\ub97c \ud1b5\ud574 Pod\uc5d0 \uc811\uadfc\ud558\uae30 \ub54c\ubb38\uc5d0 Pod\uc5d0 \ub300\ud574 Cluster \ub0b4\uc5d0\uc11c \uc5b4\ub5a4 \uacbd\ub85c\ub85c \ud2b8\ub798\ud53d\uc774 \uc804\ub2ec\ub418\uc5c8\ub294\uc9c0, \ub2e8\uc77c Pod\uac00 \uac16\uace0 \uc788\ub294 Connection\uc758 \uc22b\uc790, LB \uc0c1\ud0dc \ub4f1 \uac00\uc2dc\uc131 \ud655\ubcf4\uac00 \uc5b4\ub835\uc2b5\ub2c8\ub2e4. Pod\uc5d0 \ub300\ud55c Load balance\uc758 \uc8fc\uccb4\ub294 Kubernetes Service\uc778 \ub9cc\ud07c Kube-Proxy \ub610\ub294 \uad6c\uc131\uc5d0 \ub530\ub77c IPVS\ub97c \ud1b5\ud574 Pod\uc5d0 \ub300\ud574 \ud55c\ubc88 \ub354 LB\uac00 \uc774\ub904\uc9c0\uac8c \ub418\uba70, \ubcf5\uc7a1\ud55c iptables \ud14c\uc774\ube14 \ub54c\ubb38\uc5d0 \uc57d\uac04\uc758 \uc131\ub2a5 \uc800\ud558\uac00 \uc788\uc744 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4.","title":"Nodeport"},{"location":"F5-BIG-IP/BIG-IP-CIS/BIG-IP-CIS-01-Calico/#clusterip","text":"ClusterIP \ubaa8\ub4dc\ub294 BIG-IP \uc7a5\ube44\uac00 Kubernetes Cluster Overlay Network\uc5d0 \uc811\uadfc\ud560 \uc218 \uc788\ub3c4\ub85d \ud558\ub294 \uc124\uce58 \ubc29\uc2dd\uc785\ub2c8\ub2e4. BIG-IP\uac00 Pod\uc5d0 \uc9c1\uc811 \uc811\uadfc\uc774 \uac00\ub2a5\ud558\uae30 \ub54c\ubb38\uc5d0 BIG-IP\uc758 Pool member\uac00 Pod\uc758 IP, Port\uac00 \ub429\ub2c8\ub2e4. Pod Scale-in/out\uc5d0 Pool Member config\uac00 \uc9c1\uc811 \uc601\ud5a5\uc744 \ubc1b\uc73c\uba70, \ube44\uad50\uc801 \uba85\ud655\ud55c \uac00\uc2dc\uc131\uc744 \ud655\ubcf4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Flannel CNI\uc640\uc758 \uc5f0\ub3d9\uc744 \uc704\ud574 VXLAN\uc744 \uc0ac\uc6a9\ud558\uac70\ub098, Calico \uc5f0\ub3d9\uc744 \uc704\ud574 BGP Peer \uc124\uc815\uc744 \uc218\ud589\ud558\uac70\ub098 \ud558\ub294 \uacfc\uc815\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. (Calico CNI\uc640 BGP \uc5f0\ub3d9 \uc2dc Dynamic Routing License\uac00 \ud544\uc694\ud569\ub2c8\ub2e4.)","title":"ClusterIP"},{"location":"F5-BIG-IP/BIG-IP-CIS/BIG-IP-CIS-01-Calico/#nodeportlocal","text":"Antrea CNI\uc758 NodePortLocal \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud558\ub294 \ubaa8\ub4dc\ub85c\uc11c, Antrea Agent\uac00 \uc81c\uacf5\ud558\ub294 \ud3ec\ud2b8\ub9f5\uc744 \uc0ac\uc6a9\ud574 Kube-Proxy\ub97c \ubc14\uc774\ud328\uc2a4\ud560 \uc218 \uc788\ub3c4\ub85d \ud569\ub2c8\ub2e4. NodePort \ubaa8\ub4dc\uc640 \uc720\uc0ac\ud558\uac8c Kubernetes Cluster Overlay Network\uc640 \uc5f0\ub3d9\uc744 \ud558\uc9c0 \uc54a\ub294 \uc124\uce58 \ubc29\uc2dd\uc785\ub2c8\ub2e4. Service \uac1c\uccb4\uc758 Type \ud56d\ubaa9\uc73c\ub85c NodePort\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0, Pod \ub610\ub294 Service\uc5d0 \uc791\uc131\ud55c \u2018NodePortLocal\u2019 Annotation\uc5d0 \ub530\ub77c BIG-IP\ub85c \ubc18\uc601\ub429\ub2c8\ub2e4. \ub530\ub77c\uc11c Load Balancing\uc758 \ub300\uc0c1\uc778 Pod\uac00 \uc874\uc7ac\ud558\ub294 Node\uc758 IP, Port\uac00 Pool Member\uac00 \ub418\uba70, \uc774 \uc815\ubcf4\ub294 Antrea Agent\uac00 \uc81c\uacf5\ud558\ub294 NodePort \ubaa8\ub4dc\uc5d0 \ube44\ud574 \uac00\uc2dc\uc131\uc774 \uc5b4\ub290\uc815\ub3c4 \ud655\ubcf4\ub41c\ub2e4\uace0 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4. [\ub9c1\ud06c] https://antrea.io/docs/main/","title":"NodePortLocal"},{"location":"F5-BIG-IP/BIG-IP-CIS/BIG-IP-CIS-02-Calico%2BClusterip/","text":"CIS Calico + ClusterIP \ubaa8\ub4dc \uad6c\uc131 \ud14c\uc2a4\ud2b8 \u00b6 Kubernetes Cluster\ub294 \uc774\ubbf8 \uad6c\uc131\ub418\uc5b4 \uc788\ub2e4\uace0 \uac00\uc815\ud569\ub2c8\ub2e4. \uc124\uce58 \uacfc\uc815 \u00b6 kubectl create secret generic bigip-login -n kube-system --from-literal=username=itian --from-literal=password=itian.co.kr kubectl create serviceaccount bigip-ctlr -n kube-system echo 'apiVersion: apps/v1 kind: Deployment metadata: name: k8s-bigip-ctlr-deployment namespace: kube-system spec: # DO NOT INCREASE REPLICA COUNT replicas: 1 selector: matchLabels: app: k8s-bigip-ctlr-deployment template: metadata: labels: app: k8s-bigip-ctlr-deployment spec: # Name of the Service Account bound to a Cluster Role with the required # permissions containers: - name: k8s-bigip-ctlr image: \"f5networks/k8s-bigip-ctlr:latest\" env: - name: BIGIP_USERNAME valueFrom: secretKeyRef: # Replace with the name of the Secret containing your login # credentials name: bigip-login key: username - name: BIGIP_PASSWORD valueFrom: secretKeyRef: # Replace with the name of the Secret containing your login # credentials name: bigip-login key: password command: [\"/app/bin/k8s-bigip-ctlr\"] args: [ # See the k8s-bigip-ctlr documentation for information about # all config options # https://clouddocs.f5.com/containers/latest/ \"--bigip-username=$(BIGIP_USERNAME)\", \"--bigip-password=$(BIGIP_PASSWORD)\", \"--bigip-url=<ip_address-or-hostname>\", \"--bigip-partition=<name_of_partition>\", \"--pool-member-type=nodeport\", \"--insecure\", ] serviceAccountName: bigip-ctlr ' > k8s_cis_deployment.yaml # for use in k8s clusters only kind: ClusterRole apiVersion: rbac.authorization.k8s.io/v1 metadata: name: bigip-ctlr-clusterrole rules: - apiGroups: [\"\", \"extensions\", \"networking.k8s.io\"] resources: [\"nodes\", \"services\", \"endpoints\", \"namespaces\", \"ingresses\", \"pods\", \"ingressclasses\"] verbs: [\"get\", \"list\", \"watch\"] - apiGroups: [\"\", \"extensions\", \"networking.k8s.io\"] resources: [\"configmaps\", \"events\", \"ingresses/status\", \"services/status\"] verbs: [\"get\", \"list\", \"watch\", \"update\", \"create\", \"patch\"] - apiGroups: [\"cis.f5.com\"] resources: [\"virtualservers\",\"virtualservers/status\", \"tlsprofiles\", \"transportservers\", \"ingresslinks\", \"externaldnss\"] verbs: [\"get\", \"list\", \"watch\", \"update\", \"patch\"] - apiGroups: [\"fic.f5.com\"] resources: [\"f5ipams\", \"f5ipams/status\"] verbs: [\"get\", \"list\", \"watch\", \"update\", \"create\", \"patch\", \"delete\"] - apiGroups: [\"apiextensions.k8s.io\"] resources: [\"customresourcedefinitions\"] verbs: [\"get\", \"list\", \"watch\", \"update\", \"create\", \"patch\"] - apiGroups: [\"\", \"extensions\"] resources: [\"secrets\"] verbs: [\"get\", \"list\", \"watch\"] --- kind: ClusterRoleBinding apiVersion: rbac.authorization.k8s.io/v1 metadata: name: bigip-ctlr-clusterrole-binding namespace: kube-system roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: bigip-ctlr-clusterrole subjects: - apiGroup: \"\" kind: ServiceAccount name: bigip-ctlr namespace: kube-system kubectl create secret generic bigip-login -n kube-system --from-literal=username=itian --from-literal=password=itian.co.kr kubectl create serviceaccount bigip-ctlr -n kube-system 6.2 BIG-IP System 6.2.1 AS3(3.18+) rpm Install F5Network Github\uc5d0\uc11c \ub2e4\uc6b4\ub85c\ub4dc\ud558\uc5ec iApps \u203a Package Management LX \uba54\ub274\uc5d0\uc11c Import\ud558\uc5ec \uc124\uce58 \ub9c1\ud06c \uc124\uce58 \ud655\uc778 : restcurl -u admin:itian.co.kr /mgmt/shared/appsvcs/info 6.2.2 BIG-IP Partition for Kubernetes \u2013 \uc804\uc6a9 \ud30c\ud2f0\uc158 \uc0dd\uc131 tmsh create auth partition CIS 6.2.3 \uad00\ub9ac\uc790 \uad8c\ud55c\uc758 \uacc4\uc815 create auth user itian shell bash encrypted-password itian.co.kr partition-access add { all-partitions { role admin } } 7 Calico \uc5f0\ub3d9 Route Domain\uc5d0\uc11c BGP \ud65c\uc131\ud654 \ubc0f Port Lockdown \uc124\uc815\uc5d0\uc11c tcp/179 \ucd94\uac00 Kubernetes Cluster\uc5d0\uc11c Calicoctl \uc124\uce58 \ubc0f BGP \uc5f0\ub3d9 \uc791\uc5c5 BIG-IP\uc5d0\uc11c imish\ub97c \ud1b5\ud574 BGP \uc5f0\ub3d9 \uc791\uc5c5 \ub9c1\ud06c cat << EOF | calicoctl create -f - apiVersion: projectcalico.org/v3 kind: BGPConfiguration metadata: name: default spec: logSeverityScreen: Info nodeToNodeMeshEnabled: true asNumber: 64512 EOF cat << EOF | calicoctl create -f - apiVersion: projectcalico.org/v3 kind: BGPPeer metadata: name: bgppeer-global-bigip1 spec: peerIP: 10.1.20.11 asNumber: 64512 EOF cat << EOF | calicoctl create -f - apiVersion: projectcalico.org/v3 kind: BGPPeer metadata: name: bgppeer-global-bigip2 spec: peerIP: 10.1.20.12 asNumber: 64512 EOF","title":"F5 BIG-IP CIS - Calico+ClusterIP \ubaa8\ub4dc"},{"location":"F5-BIG-IP/BIG-IP-CIS/BIG-IP-CIS-02-Calico%2BClusterip/#cis-calico-clusterip","text":"Kubernetes Cluster\ub294 \uc774\ubbf8 \uad6c\uc131\ub418\uc5b4 \uc788\ub2e4\uace0 \uac00\uc815\ud569\ub2c8\ub2e4.","title":"CIS Calico + ClusterIP \ubaa8\ub4dc \uad6c\uc131 \ud14c\uc2a4\ud2b8"},{"location":"F5-BIG-IP/BIG-IP-CIS/BIG-IP-CIS-02-Calico%2BClusterip/#_1","text":"kubectl create secret generic bigip-login -n kube-system --from-literal=username=itian --from-literal=password=itian.co.kr kubectl create serviceaccount bigip-ctlr -n kube-system echo 'apiVersion: apps/v1 kind: Deployment metadata: name: k8s-bigip-ctlr-deployment namespace: kube-system spec: # DO NOT INCREASE REPLICA COUNT replicas: 1 selector: matchLabels: app: k8s-bigip-ctlr-deployment template: metadata: labels: app: k8s-bigip-ctlr-deployment spec: # Name of the Service Account bound to a Cluster Role with the required # permissions containers: - name: k8s-bigip-ctlr image: \"f5networks/k8s-bigip-ctlr:latest\" env: - name: BIGIP_USERNAME valueFrom: secretKeyRef: # Replace with the name of the Secret containing your login # credentials name: bigip-login key: username - name: BIGIP_PASSWORD valueFrom: secretKeyRef: # Replace with the name of the Secret containing your login # credentials name: bigip-login key: password command: [\"/app/bin/k8s-bigip-ctlr\"] args: [ # See the k8s-bigip-ctlr documentation for information about # all config options # https://clouddocs.f5.com/containers/latest/ \"--bigip-username=$(BIGIP_USERNAME)\", \"--bigip-password=$(BIGIP_PASSWORD)\", \"--bigip-url=<ip_address-or-hostname>\", \"--bigip-partition=<name_of_partition>\", \"--pool-member-type=nodeport\", \"--insecure\", ] serviceAccountName: bigip-ctlr ' > k8s_cis_deployment.yaml # for use in k8s clusters only kind: ClusterRole apiVersion: rbac.authorization.k8s.io/v1 metadata: name: bigip-ctlr-clusterrole rules: - apiGroups: [\"\", \"extensions\", \"networking.k8s.io\"] resources: [\"nodes\", \"services\", \"endpoints\", \"namespaces\", \"ingresses\", \"pods\", \"ingressclasses\"] verbs: [\"get\", \"list\", \"watch\"] - apiGroups: [\"\", \"extensions\", \"networking.k8s.io\"] resources: [\"configmaps\", \"events\", \"ingresses/status\", \"services/status\"] verbs: [\"get\", \"list\", \"watch\", \"update\", \"create\", \"patch\"] - apiGroups: [\"cis.f5.com\"] resources: [\"virtualservers\",\"virtualservers/status\", \"tlsprofiles\", \"transportservers\", \"ingresslinks\", \"externaldnss\"] verbs: [\"get\", \"list\", \"watch\", \"update\", \"patch\"] - apiGroups: [\"fic.f5.com\"] resources: [\"f5ipams\", \"f5ipams/status\"] verbs: [\"get\", \"list\", \"watch\", \"update\", \"create\", \"patch\", \"delete\"] - apiGroups: [\"apiextensions.k8s.io\"] resources: [\"customresourcedefinitions\"] verbs: [\"get\", \"list\", \"watch\", \"update\", \"create\", \"patch\"] - apiGroups: [\"\", \"extensions\"] resources: [\"secrets\"] verbs: [\"get\", \"list\", \"watch\"] --- kind: ClusterRoleBinding apiVersion: rbac.authorization.k8s.io/v1 metadata: name: bigip-ctlr-clusterrole-binding namespace: kube-system roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: bigip-ctlr-clusterrole subjects: - apiGroup: \"\" kind: ServiceAccount name: bigip-ctlr namespace: kube-system kubectl create secret generic bigip-login -n kube-system --from-literal=username=itian --from-literal=password=itian.co.kr kubectl create serviceaccount bigip-ctlr -n kube-system 6.2 BIG-IP System 6.2.1 AS3(3.18+) rpm Install F5Network Github\uc5d0\uc11c \ub2e4\uc6b4\ub85c\ub4dc\ud558\uc5ec iApps \u203a Package Management LX \uba54\ub274\uc5d0\uc11c Import\ud558\uc5ec \uc124\uce58 \ub9c1\ud06c \uc124\uce58 \ud655\uc778 : restcurl -u admin:itian.co.kr /mgmt/shared/appsvcs/info 6.2.2 BIG-IP Partition for Kubernetes \u2013 \uc804\uc6a9 \ud30c\ud2f0\uc158 \uc0dd\uc131 tmsh create auth partition CIS 6.2.3 \uad00\ub9ac\uc790 \uad8c\ud55c\uc758 \uacc4\uc815 create auth user itian shell bash encrypted-password itian.co.kr partition-access add { all-partitions { role admin } } 7 Calico \uc5f0\ub3d9 Route Domain\uc5d0\uc11c BGP \ud65c\uc131\ud654 \ubc0f Port Lockdown \uc124\uc815\uc5d0\uc11c tcp/179 \ucd94\uac00 Kubernetes Cluster\uc5d0\uc11c Calicoctl \uc124\uce58 \ubc0f BGP \uc5f0\ub3d9 \uc791\uc5c5 BIG-IP\uc5d0\uc11c imish\ub97c \ud1b5\ud574 BGP \uc5f0\ub3d9 \uc791\uc5c5 \ub9c1\ud06c cat << EOF | calicoctl create -f - apiVersion: projectcalico.org/v3 kind: BGPConfiguration metadata: name: default spec: logSeverityScreen: Info nodeToNodeMeshEnabled: true asNumber: 64512 EOF cat << EOF | calicoctl create -f - apiVersion: projectcalico.org/v3 kind: BGPPeer metadata: name: bgppeer-global-bigip1 spec: peerIP: 10.1.20.11 asNumber: 64512 EOF cat << EOF | calicoctl create -f - apiVersion: projectcalico.org/v3 kind: BGPPeer metadata: name: bgppeer-global-bigip2 spec: peerIP: 10.1.20.12 asNumber: 64512 EOF","title":"\uc124\uce58 \uacfc\uc815"},{"location":"F5-BIG-IP/BIG-IP-TS/f5-ts-monitoring-prometheus-grafana/","text":"F5 Telemetry Streaming with Prometheus & Grafana Test \u00b6 F5 BIG-IP\uc640 Prometheus \ubc0f Grafana\ub97c \uc0ac\uc6a9\ud55c \ubaa8\ub2c8\ud130\ub9c1 \ud14c\uc2a4\ud2b8 UDF \uc138\uc158 \uc790\ub8cc github \uc790\ub8cc 0. \uac1c\uc694 \u00b6 \ubaa8\ub2c8\ud130\ub9c1 \uc194\ub8e8\uc158\uc774 Metric\uc744 \uc218\uc9d1\ud558\ub294 \ubc29\ubc95\uc744 Pull / Push \ubc29\uc2dd\uc73c\ub85c \uad6c\ubd84\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Support for the Prometheus pull consumer is available in TS 1.12.0 and later. 14.0.x \uc774\uc804 \ubc84\uc804\uc5d0\uc11c\ub294 \uc544\ub798 cmd\ub85c \ud504\ub808\uc784\uc6cc\ud06c\ub97c Enable\ud558\ub294 \uacfc\uc815\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. touch /var/config/rest/iapps/enable Pull \ubc29\uc2dd : \u00b6 \ubaa8\ub2c8\ud130\ub9c1 \uc194\ub8e8\uc158\uc774 \uba3c\uc800 \uc694\uccad\uc744 \ubcf4\ub0b4 \ub370\uc774\ud130 \uc218\uc9d1 Request\uc5d0 \ub300\ud55c \uc778\uc99d \ucc98\ub9ac\ub97c \ud1b5\ud574 \ubcf4\uc548 \uce21\uba74\uc5d0\uc11c \uc720\ub9ac Push \ubc29\uc2dd : \u00b6 \uac01 \uc11c\ubc84\uc758 Agent\uac00 \uba54\ud2b8\ub9ad \ub370\uc774\ud130\ub97c \uc218\uc9d1\ud574 \uc11c\ubc84\ub85c \uc804\ub2ec \uc774\ubca4\ud2b8 \uc0dd\uc131 \ube48\ub3c4\uac00 \ub192\uc740 \uc2dc\uc2a4\ud15c \ubaa8\ub2c8\ud130\ub9c1\uc5d0 \uc720\ub9ac F5 Telemetry Streaming \ud65c\uc131\ud654 \u00b6 F5network Github TS \uc5d0\uc11c RPM\ud30c\uc77c\uc744 \ub2e4\uc6b4\ub85c\ub4dc \ubc1b\uc2b5\ub2c8\ub2e4. \uc544\ub798 \ub9c1\ud06c\ub97c \uc0ac\uc6a9\ud558\uba74 \ud3b8\ub9ac\ud569\ub2c8\ub2e4. Github.com - f5-telemetry-streaming \ub2e4\uc6b4\ub85c\ub4dc \ubc1b\uc740 \ud30c\uc77c\uc740 iApps - Package Management LX \uba54\ub274\uc5d0\uc11c \uc5c5\ub85c\ub4dc \ubc0f \uc124\uce58\ub97c \uc218\ud589\ud569\ub2c8\ub2e4. \uc124\uce58\ub97c \uc644\ub8cc\ud558\uace0 \ub098\uba74, Telemetry Streaming\uc740 HTTP Endpoint\ub97c \ub178\ucd9c\ud569\ub2c8\ub2e4. \uc124\uce58\uac00 \uc798 \ub418\uc5c8\ub294\uc9c0, \uc544\ub798 URI\ub85c GET Request\ub97c \ubcf4\ub0b4\uc5b4 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4 # Variables BIGIP=\"192.168.1.245\" BIGIPUSER=\"admin\" BIGIPPASS=\"password\" CREDS=\"${BIGIPUSER}:${BIGIPPASS}\" # TS TEST CMD curl -sku $CREDS https://${BIGIP}/mgmt/shared/telemetry/info Declare POST Request\ub97c \ud1b5\ud574, TS Endpoint\ub97c \uc120\uc5b8\ud574\uc904 \uc218 \uc788\uc2b5\ub2c8\ub2e4. EndPoint Declaration \uc0d8\ud50c \ubc0f Prometheus Pull Consumer \uc124\uc815 \uc0d8\ud50c \uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. # Prometheus Declaration sample cat <<EOF> prom_pull_declare.json { \"class\": \"Telemetry\", \"Prom_Poller\": { \"class\": \"Telemetry_System_Poller\", \"interval\": 0 }, \"My_System\": { \"class\": \"Telemetry_System\", \"enable\": \"true\", \"systemPoller\": \"Prom_Poller\" }, \"Prom_Pull_Consumer\": { \"class\": \"Telemetry_Pull_Consumer\", \"type\": \"Prometheus\", \"systemPoller\": \"Prom_Poller\" } } EOF # Send a POST Declare Request curl -sku $CREDS -X POST https://${BIGIP}/mgmt/shared/telemetry/declare -H \"Content-type: application/json\" -d @prom_pull_declare.json # Pull Consumer TEST CMD curl -sku $CREDS https://${BIGIP}/mgmt/shared/telemetry/pullconsumer/Prom_Pull_Consumer Prometheus \uc124\uce58 \u00b6 Prometheus\ub294 HTTP Protocol \uae30\ubc18\uc758 Pull \ubc29\uc2dd\uc73c\ub85c Time-series(\uc2dc\uacc4\uc5f4) \ub370\uc774\ud130\ub97c \uc218\uc9d1\ud569\ub2c8\ub2e4. \uc774 \ud14c\uc2a4\ud2b8\uc5d0\uc11c\ub294 \uc55e\uc11c \uc124\uc815\ud55c Pull Consumer Endpoint \"https://${BIGIP}/mgmt/shared/telemetry/pullconsumer/Prom_Pull_Consumer\"\ub97c \ud1b5\ud574 \ubaa8\ub2c8\ud130\ub9c1\uc6a9 \uc2dc\uacc4\uc5f4 \ub370\uc774\ud130\ub97c \uc218\uc9d1\ud558\uac8c \ub429\ub2c8\ub2e4. Prometheus \uc774\uc678\uc5d0\ub3c4 F5 Telemetry Streaming\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ud234\uc740 \ub2e4\uc591\ud569\ub2c8\ub2e4. CloudDocs \uc5d0\uc11c TS\uc640 \uc5f0\ub3d9 \uac00\ub2a5\ud55c \ud234\uc758 \ub9ac\uc2a4\ud2b8 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Prometheus on Kubernetes \u00b6 \uc544\ub798 \ucee4\ub9e8\ub4dc\ub97c kubernetes Master\uc5d0\uc11c \uc218\ud589\ud569\ub2c8\ub2e4. cat <<EOF > prom_ns_rbac.yaml --- apiVersion: v1 kind: Namespace metadata: labels: kubernetes.io/metadata.name: monitoring name: monitoring --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: prometheus rules: - apiGroups: [\"\"] resources: - nodes - nodes/proxy - services - endpoints - pods verbs: [\"get\", \"list\", \"watch\"] - apiGroups: - extensions resources: - ingresses verbs: [\"get\", \"list\", \"watch\"] - nonResourceURLs: [\"/metrics\"] verbs: [\"get\"] --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: prometheus roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: prometheus subjects: - kind: ServiceAccount name: default namespace: monitoring EOF kubectl apply -f prom_ns_rbac.yaml cat <<EOF > prom_configmap_bigip.yaml apiVersion: v1 kind: ConfigMap metadata: name: prometheus-server-conf labels: name: prometheus-server-conf namespace: monitoring data: prometheus.rules: |- groups: - name: devopscube demo alert rules: - alert: High Pod Memory expr: sum(container_memory_usage_bytes) > 1 for: 1m labels: severity: slack annotations: summary: High Memory Usage prometheus.yml: |- global: scrape_interval: 5s evaluation_interval: 5s rule_files: - /etc/prometheus/prometheus.rules alerting: alertmanagers: - scheme: http static_configs: - targets: - \"alertmanager.monitoring.svc:9093\" scrape_configs: - job_name: 'BIGIP - TS' scrape_timeout: 30s scrape_interval: 30s scheme: https tls_config: insecure_skip_verify: true metrics_path: '/mgmt/shared/telemetry/pullconsumer/Prom_Pull_Consumer' basic_auth: username: '${BIGIPUSER}' password: '${BIGIPPASS}' static_configs: - targets: ['${BIGIP}'] - job_name: cis scrape_interval: 10s metrics_path: '/metrics' kubernetes_sd_configs: - role: pod relabel_configs: - source_labels: [__meta_kubernetes_namespace] action: replace target_label: k8s_namespace - source_labels: [__meta_kubernetes_pod_name] action: replace target_label: k8s_pod_name - source_labels: [__address__] action: replace regex: ([^:]+)(?::\\d+)? replacement: ${1}:8080 target_label: __address__ - source_labels: [__meta_kubernetes_pod_label_app] action: keep regex: k8s-bigip-ctlr EOF kubectl apply -f prom_configmap_bigip.yaml cat <<EOF > prom_deploy_svc.yaml apiVersion: apps/v1 kind: Deployment metadata: name: prometheus-deployment namespace: monitoring labels: app: prometheus-server spec: replicas: 1 selector: matchLabels: app: prometheus-server template: metadata: labels: app: prometheus-server spec: containers: - name: prometheus image: prom/prometheus args: - \"--config.file=/etc/prometheus/prometheus.yml\" - \"--storage.tsdb.path=/prometheus/\" ports: - containerPort: 9090 volumeMounts: - name: prometheus-config-volume mountPath: /etc/prometheus/ - name: prometheus-storage-volume mountPath: /prometheus/ volumes: - name: prometheus-config-volume configMap: defaultMode: 420 name: prometheus-server-conf - name: prometheus-storage-volume emptyDir: {} --- apiVersion: v1 kind: Service metadata: name: prometheus-service namespace: monitoring annotations: prometheus.io/scrape: 'true' prometheus.io/port: '9090' spec: selector: app: prometheus-server type: NodePort ports: - port: 8080 targetPort: 9090 nodePort: 30000 EOF kubectl apply -f prom_deploy_svc.yaml Grafana \uc124\uce58 \u00b6 Grafana\ub294 \ub370\uc774\ud130\uc758 \uc2dc\uac01\ud654\ub97c \ub2f4\ub2f9\ud569\ub2c8\ub2e4. Grafana.com - Documents cat <<EOF > grafana_pv_pvc.yaml --- apiVersion: v1 kind: PersistentVolume metadata: name: grafana-pv spec: capacity: storage: 10Gi volumeMode: Filesystem accessModes: - ReadWriteOnce persistentVolumeReclaimPolicy: Recycle storageClassName: local-storage local: path: /home/volume nodeAffinity: required: nodeSelectorTerms: - matchExpressions: - key: kubernetes.io/hostname operator: In values: - kube-worker.local --- apiVersion: v1 kind: PersistentVolumeClaim metadata: name: grafana-pvc spec: accessModes: - ReadWriteOnce resources: requests: storage: 1Gi storageClassName: local-storage EOF kubectl apply -f grafana_pv_pvc.yaml cat <<EOF > grafana_deploy_svc.yaml --- apiVersion: apps/v1 kind: Deployment metadata: labels: app: grafana name: grafana spec: selector: matchLabels: app: grafana template: metadata: labels: app: grafana spec: securityContext: fsGroup: 472 supplementalGroups: - 0 containers: - name: grafana image: grafana/grafana:8.4.4 imagePullPolicy: IfNotPresent ports: - containerPort: 3000 name: http-grafana protocol: TCP readinessProbe: failureThreshold: 3 httpGet: path: /robots.txt port: 3000 scheme: HTTP initialDelaySeconds: 10 periodSeconds: 30 successThreshold: 1 timeoutSeconds: 2 livenessProbe: failureThreshold: 3 initialDelaySeconds: 30 periodSeconds: 10 successThreshold: 1 tcpSocket: port: 3000 timeoutSeconds: 1 resources: requests: cpu: 250m memory: 750Mi volumeMounts: - mountPath: /var/lib/grafana name: grafana-pv volumes: - name: grafana-pv persistentVolumeClaim: claimName: grafana-pvc --- apiVersion: v1 kind: Service metadata: name: grafana spec: ports: - port: 3000 protocol: TCP targetPort: http-grafana selector: app: grafana sessionAffinity: None type: NodePort EOF kubectl apply -f grafana_deploy_svc.yaml","title":"F5 Telemetry Streaming with Prometheus & Grafana Test"},{"location":"F5-BIG-IP/BIG-IP-TS/f5-ts-monitoring-prometheus-grafana/#f5-telemetry-streaming-with-prometheus-grafana-test","text":"F5 BIG-IP\uc640 Prometheus \ubc0f Grafana\ub97c \uc0ac\uc6a9\ud55c \ubaa8\ub2c8\ud130\ub9c1 \ud14c\uc2a4\ud2b8 UDF \uc138\uc158 \uc790\ub8cc github \uc790\ub8cc","title":"F5 Telemetry Streaming with Prometheus &amp; Grafana Test"},{"location":"F5-BIG-IP/BIG-IP-TS/f5-ts-monitoring-prometheus-grafana/#0","text":"\ubaa8\ub2c8\ud130\ub9c1 \uc194\ub8e8\uc158\uc774 Metric\uc744 \uc218\uc9d1\ud558\ub294 \ubc29\ubc95\uc744 Pull / Push \ubc29\uc2dd\uc73c\ub85c \uad6c\ubd84\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Support for the Prometheus pull consumer is available in TS 1.12.0 and later. 14.0.x \uc774\uc804 \ubc84\uc804\uc5d0\uc11c\ub294 \uc544\ub798 cmd\ub85c \ud504\ub808\uc784\uc6cc\ud06c\ub97c Enable\ud558\ub294 \uacfc\uc815\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. touch /var/config/rest/iapps/enable","title":"0. \uac1c\uc694"},{"location":"F5-BIG-IP/BIG-IP-TS/f5-ts-monitoring-prometheus-grafana/#pull","text":"\ubaa8\ub2c8\ud130\ub9c1 \uc194\ub8e8\uc158\uc774 \uba3c\uc800 \uc694\uccad\uc744 \ubcf4\ub0b4 \ub370\uc774\ud130 \uc218\uc9d1 Request\uc5d0 \ub300\ud55c \uc778\uc99d \ucc98\ub9ac\ub97c \ud1b5\ud574 \ubcf4\uc548 \uce21\uba74\uc5d0\uc11c \uc720\ub9ac","title":"Pull \ubc29\uc2dd :"},{"location":"F5-BIG-IP/BIG-IP-TS/f5-ts-monitoring-prometheus-grafana/#push","text":"\uac01 \uc11c\ubc84\uc758 Agent\uac00 \uba54\ud2b8\ub9ad \ub370\uc774\ud130\ub97c \uc218\uc9d1\ud574 \uc11c\ubc84\ub85c \uc804\ub2ec \uc774\ubca4\ud2b8 \uc0dd\uc131 \ube48\ub3c4\uac00 \ub192\uc740 \uc2dc\uc2a4\ud15c \ubaa8\ub2c8\ud130\ub9c1\uc5d0 \uc720\ub9ac","title":"Push \ubc29\uc2dd :"},{"location":"F5-BIG-IP/BIG-IP-TS/f5-ts-monitoring-prometheus-grafana/#f5-telemetry-streaming","text":"F5network Github TS \uc5d0\uc11c RPM\ud30c\uc77c\uc744 \ub2e4\uc6b4\ub85c\ub4dc \ubc1b\uc2b5\ub2c8\ub2e4. \uc544\ub798 \ub9c1\ud06c\ub97c \uc0ac\uc6a9\ud558\uba74 \ud3b8\ub9ac\ud569\ub2c8\ub2e4. Github.com - f5-telemetry-streaming \ub2e4\uc6b4\ub85c\ub4dc \ubc1b\uc740 \ud30c\uc77c\uc740 iApps - Package Management LX \uba54\ub274\uc5d0\uc11c \uc5c5\ub85c\ub4dc \ubc0f \uc124\uce58\ub97c \uc218\ud589\ud569\ub2c8\ub2e4. \uc124\uce58\ub97c \uc644\ub8cc\ud558\uace0 \ub098\uba74, Telemetry Streaming\uc740 HTTP Endpoint\ub97c \ub178\ucd9c\ud569\ub2c8\ub2e4. \uc124\uce58\uac00 \uc798 \ub418\uc5c8\ub294\uc9c0, \uc544\ub798 URI\ub85c GET Request\ub97c \ubcf4\ub0b4\uc5b4 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4 # Variables BIGIP=\"192.168.1.245\" BIGIPUSER=\"admin\" BIGIPPASS=\"password\" CREDS=\"${BIGIPUSER}:${BIGIPPASS}\" # TS TEST CMD curl -sku $CREDS https://${BIGIP}/mgmt/shared/telemetry/info Declare POST Request\ub97c \ud1b5\ud574, TS Endpoint\ub97c \uc120\uc5b8\ud574\uc904 \uc218 \uc788\uc2b5\ub2c8\ub2e4. EndPoint Declaration \uc0d8\ud50c \ubc0f Prometheus Pull Consumer \uc124\uc815 \uc0d8\ud50c \uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. # Prometheus Declaration sample cat <<EOF> prom_pull_declare.json { \"class\": \"Telemetry\", \"Prom_Poller\": { \"class\": \"Telemetry_System_Poller\", \"interval\": 0 }, \"My_System\": { \"class\": \"Telemetry_System\", \"enable\": \"true\", \"systemPoller\": \"Prom_Poller\" }, \"Prom_Pull_Consumer\": { \"class\": \"Telemetry_Pull_Consumer\", \"type\": \"Prometheus\", \"systemPoller\": \"Prom_Poller\" } } EOF # Send a POST Declare Request curl -sku $CREDS -X POST https://${BIGIP}/mgmt/shared/telemetry/declare -H \"Content-type: application/json\" -d @prom_pull_declare.json # Pull Consumer TEST CMD curl -sku $CREDS https://${BIGIP}/mgmt/shared/telemetry/pullconsumer/Prom_Pull_Consumer","title":"F5 Telemetry Streaming \ud65c\uc131\ud654"},{"location":"F5-BIG-IP/BIG-IP-TS/f5-ts-monitoring-prometheus-grafana/#prometheus","text":"Prometheus\ub294 HTTP Protocol \uae30\ubc18\uc758 Pull \ubc29\uc2dd\uc73c\ub85c Time-series(\uc2dc\uacc4\uc5f4) \ub370\uc774\ud130\ub97c \uc218\uc9d1\ud569\ub2c8\ub2e4. \uc774 \ud14c\uc2a4\ud2b8\uc5d0\uc11c\ub294 \uc55e\uc11c \uc124\uc815\ud55c Pull Consumer Endpoint \"https://${BIGIP}/mgmt/shared/telemetry/pullconsumer/Prom_Pull_Consumer\"\ub97c \ud1b5\ud574 \ubaa8\ub2c8\ud130\ub9c1\uc6a9 \uc2dc\uacc4\uc5f4 \ub370\uc774\ud130\ub97c \uc218\uc9d1\ud558\uac8c \ub429\ub2c8\ub2e4. Prometheus \uc774\uc678\uc5d0\ub3c4 F5 Telemetry Streaming\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ud234\uc740 \ub2e4\uc591\ud569\ub2c8\ub2e4. CloudDocs \uc5d0\uc11c TS\uc640 \uc5f0\ub3d9 \uac00\ub2a5\ud55c \ud234\uc758 \ub9ac\uc2a4\ud2b8 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.","title":"Prometheus \uc124\uce58"},{"location":"F5-BIG-IP/BIG-IP-TS/f5-ts-monitoring-prometheus-grafana/#prometheus-on-kubernetes","text":"\uc544\ub798 \ucee4\ub9e8\ub4dc\ub97c kubernetes Master\uc5d0\uc11c \uc218\ud589\ud569\ub2c8\ub2e4. cat <<EOF > prom_ns_rbac.yaml --- apiVersion: v1 kind: Namespace metadata: labels: kubernetes.io/metadata.name: monitoring name: monitoring --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: prometheus rules: - apiGroups: [\"\"] resources: - nodes - nodes/proxy - services - endpoints - pods verbs: [\"get\", \"list\", \"watch\"] - apiGroups: - extensions resources: - ingresses verbs: [\"get\", \"list\", \"watch\"] - nonResourceURLs: [\"/metrics\"] verbs: [\"get\"] --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: prometheus roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: prometheus subjects: - kind: ServiceAccount name: default namespace: monitoring EOF kubectl apply -f prom_ns_rbac.yaml cat <<EOF > prom_configmap_bigip.yaml apiVersion: v1 kind: ConfigMap metadata: name: prometheus-server-conf labels: name: prometheus-server-conf namespace: monitoring data: prometheus.rules: |- groups: - name: devopscube demo alert rules: - alert: High Pod Memory expr: sum(container_memory_usage_bytes) > 1 for: 1m labels: severity: slack annotations: summary: High Memory Usage prometheus.yml: |- global: scrape_interval: 5s evaluation_interval: 5s rule_files: - /etc/prometheus/prometheus.rules alerting: alertmanagers: - scheme: http static_configs: - targets: - \"alertmanager.monitoring.svc:9093\" scrape_configs: - job_name: 'BIGIP - TS' scrape_timeout: 30s scrape_interval: 30s scheme: https tls_config: insecure_skip_verify: true metrics_path: '/mgmt/shared/telemetry/pullconsumer/Prom_Pull_Consumer' basic_auth: username: '${BIGIPUSER}' password: '${BIGIPPASS}' static_configs: - targets: ['${BIGIP}'] - job_name: cis scrape_interval: 10s metrics_path: '/metrics' kubernetes_sd_configs: - role: pod relabel_configs: - source_labels: [__meta_kubernetes_namespace] action: replace target_label: k8s_namespace - source_labels: [__meta_kubernetes_pod_name] action: replace target_label: k8s_pod_name - source_labels: [__address__] action: replace regex: ([^:]+)(?::\\d+)? replacement: ${1}:8080 target_label: __address__ - source_labels: [__meta_kubernetes_pod_label_app] action: keep regex: k8s-bigip-ctlr EOF kubectl apply -f prom_configmap_bigip.yaml cat <<EOF > prom_deploy_svc.yaml apiVersion: apps/v1 kind: Deployment metadata: name: prometheus-deployment namespace: monitoring labels: app: prometheus-server spec: replicas: 1 selector: matchLabels: app: prometheus-server template: metadata: labels: app: prometheus-server spec: containers: - name: prometheus image: prom/prometheus args: - \"--config.file=/etc/prometheus/prometheus.yml\" - \"--storage.tsdb.path=/prometheus/\" ports: - containerPort: 9090 volumeMounts: - name: prometheus-config-volume mountPath: /etc/prometheus/ - name: prometheus-storage-volume mountPath: /prometheus/ volumes: - name: prometheus-config-volume configMap: defaultMode: 420 name: prometheus-server-conf - name: prometheus-storage-volume emptyDir: {} --- apiVersion: v1 kind: Service metadata: name: prometheus-service namespace: monitoring annotations: prometheus.io/scrape: 'true' prometheus.io/port: '9090' spec: selector: app: prometheus-server type: NodePort ports: - port: 8080 targetPort: 9090 nodePort: 30000 EOF kubectl apply -f prom_deploy_svc.yaml","title":"Prometheus on Kubernetes"},{"location":"F5-BIG-IP/BIG-IP-TS/f5-ts-monitoring-prometheus-grafana/#grafana","text":"Grafana\ub294 \ub370\uc774\ud130\uc758 \uc2dc\uac01\ud654\ub97c \ub2f4\ub2f9\ud569\ub2c8\ub2e4. Grafana.com - Documents cat <<EOF > grafana_pv_pvc.yaml --- apiVersion: v1 kind: PersistentVolume metadata: name: grafana-pv spec: capacity: storage: 10Gi volumeMode: Filesystem accessModes: - ReadWriteOnce persistentVolumeReclaimPolicy: Recycle storageClassName: local-storage local: path: /home/volume nodeAffinity: required: nodeSelectorTerms: - matchExpressions: - key: kubernetes.io/hostname operator: In values: - kube-worker.local --- apiVersion: v1 kind: PersistentVolumeClaim metadata: name: grafana-pvc spec: accessModes: - ReadWriteOnce resources: requests: storage: 1Gi storageClassName: local-storage EOF kubectl apply -f grafana_pv_pvc.yaml cat <<EOF > grafana_deploy_svc.yaml --- apiVersion: apps/v1 kind: Deployment metadata: labels: app: grafana name: grafana spec: selector: matchLabels: app: grafana template: metadata: labels: app: grafana spec: securityContext: fsGroup: 472 supplementalGroups: - 0 containers: - name: grafana image: grafana/grafana:8.4.4 imagePullPolicy: IfNotPresent ports: - containerPort: 3000 name: http-grafana protocol: TCP readinessProbe: failureThreshold: 3 httpGet: path: /robots.txt port: 3000 scheme: HTTP initialDelaySeconds: 10 periodSeconds: 30 successThreshold: 1 timeoutSeconds: 2 livenessProbe: failureThreshold: 3 initialDelaySeconds: 30 periodSeconds: 10 successThreshold: 1 tcpSocket: port: 3000 timeoutSeconds: 1 resources: requests: cpu: 250m memory: 750Mi volumeMounts: - mountPath: /var/lib/grafana name: grafana-pv volumes: - name: grafana-pv persistentVolumeClaim: claimName: grafana-pvc --- apiVersion: v1 kind: Service metadata: name: grafana spec: ports: - port: 3000 protocol: TCP targetPort: http-grafana selector: app: grafana sessionAffinity: None type: NodePort EOF kubectl apply -f grafana_deploy_svc.yaml","title":"Grafana \uc124\uce58"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/BIG-IP-SYSLOG-Config-Sample/","text":"BIG-IP Syslog Custom Config \u00b6 \ubcf8 \ubb38\uc11c\uc5d0\uc11c\ub294 \uc8fc\uc694 Monitoring \ub300\uc0c1 \ub85c\uadf8\uc5d0 \ub300\ud574 Syslog Config include\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uc0d8\ud50c Config\ub97c \uc81c\uc2dc\ud569\ub2c8\ub2e4. \ubcf5\uc0ac/\ubd99\uc5ec\ub123\uae30 \uc6a9\ub3c4\uc758 \uac19\uc740 \uc774\ub984\uc758 TXT\ud30c\uc77c\uc744 \uc0ac\uc6a9\ud558\uba74 \uc880\ub354 \uc548\uc804\ud558\uac8c Custom Config\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Syslog Custom Config \ub300\uc0c1 \u00b6 Syslog Custom Config \ub300\uc0c1 \uc8fc\uc694 \uc774\ubca4\ud2b8\ub97c \uc544\ub798\uc640 \uac19\uc774 \uc815\ub9ac\ud569\ub2c8\ub2e4. \uc544\ub798 \ud45c\ub4e4\uc740 \ub9d0\uadf8\ub300\ub85c \ub85c\uadf8 \uc0d8\ud50c\uc774\uba70 Syslog\ub294 \ud574\ub2f9 \ub85c\uadf8\uc758 Text\ub97c Pattern matching\uc744 \uc218\ud589\ud558\uc5ec \ub9e4\uce6d\ub418\ub294 Syslog Line\uc744 Remote Server\ub85c \uc804\ub2ec\ud569\ub2c8\ub2e4. Hardware \ub85c\uadf8 \u00b6 \uad6c\ubd84 \uc704\uce58 \ub85c\uadf8 \uc0d8\ud50c CPU temp. high ltm Cpu %d: temperature (%d) is too high. FAN speed low ltm Cpu %d: fan speed (%d) is too low. FAN down ltm Chassis fan %d: status (%d) is bad. MEM usage high ltm %s: Aggressive mode %s %s (%llx) (%s %s). (%u/%u %s) DISK usage high ltm %s disk usage exceeds %d%%. Reduce log disk space now Chassis Temperature ltm Chassis %d: temperature (%d) is too high. PSU Down ltm Chassis power supply %d is not supplying power (status: %d): make sure it is plugged in. Interface Up/Down ltm Link: %s is %s \uc9c0\uc815\ub41c \uc778\uc99d\uc11c \ub9cc\ub8cc \ub85c\uadf8 \u00b6 \uad6c\ubd84 \uc704\uce58 \ub85c\uadf8 \uc0d8\ud50c Certificate \ub9cc\ub8cc \uc608\uc815 (30\uc77c\ubd80\ud130) ltm warning tmsh[16526]: 01420008:4: Certificate 'CN=test-domain.com,OU=ADC,O=IT,L=Seoul,ST=Seoul,C=KR' in file /Common/be_expire_soon will expire on Apr 30 01:36:52 2022 GMT Certificate \ub9cc\ub8cc ltm warning tmsh[16900]: 01420007:4: Certificate 'CN=I000105479,OU=Client certificates,O=NGINX Inc' in file /Common/expired expired on Jul 3 14:17:32 2021 GMT User \uc811\uc18d log \u00b6 \uad6c\ubd84 \uc704\uce58 \ub85c\uadf8 \uc0d8\ud50c SSH secure info sshd(pam_audit)[15360]: 01070417:6: AUDIT - user kjs - RAW: sshd(pam_audit): user=kjs(kjs) partition=[All] level=Administrator tty=ssh host=175.196.233.10 attempts=1 start=\"Fri Apr 15 10:24:49 2022\". HTTPD secure info httpd(pam_audit)[28883]: 01070417:6: AUDIT - user kjs - RAW: httpd(pam_audit): user=kjs(kjs) partition=[All] level=Administrator tty=(unknown) host=175.196.233.10 attempts=1 start=\"Fri Apr 15 10:33:27 2022\" end=\"Fri Apr 15 10:33:27 2022\". User \uc811\uc18d \uc2e4\ud328 log (\ubbf8\uc778\uac00 \uc811\uc18d \uc2dc\ub3c4) \u00b6 \uad6c\ubd84 \uc704\uce58 \ub85c\uadf8 \uc0d8\ud50c SSH Fail secure notice sshd[15293]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=175.196.233.10 user=kjs HTTPD Fail secure notice httpd[10459]: pam_unix(httpd:auth): authentication failure; logname= uid=48 euid=48 tty= ruser= rhost=175.196.233.10 user=admin Syslog Include \uc124\uc815 \u00b6 tmsh# edit sys syslog all-properties \uba85\ub839\uc5b4\ub85c vi \ud3b8\uc9d1\uae30\ub85c \uc9c4\uc785\ud574, include \ubd80\ubd84 \uc544\ub798\uc5d0 \uc544\ub798\uc640 \uac19\uc774 \uc791\uc131\ud569\ub2c8\ub2e4. sys syslog { include \" filter f_hw_1heat { facility(local0) and match(\\\"Cpu.*too\\\"); }; filter f_hw_2fan { facility(local0) and match(\\\"Cpu.*fan\"); }; filter f_hw_3fan { facility(local0) and match(\\\"Chassis fan\\\"); }; filter f_hw_4mem { facility(local0) and match(\\\"Aggressive mode\\\"); }; filter f_hw_5disk { facility(local0) and match(\\\"disk usage exceeds\"\\); }; filter f_hw_6psu { facility(local0) and match(\\\"power supply\"\\); }; filter f_warntoemerg { facility(local0); level(warning..emerg); }; filter f_authinfo { facility(local0) and match(\\\"pam_audit|pam_unix\\\"); }; filter f_checkcert { facility(local0) and match(\\\"Ceritificate.*expire\\\"); }; destination d_kjs_test { file(/var/log/kjs_syslog_test create_dirs(yes)); }; destination d_logsvr { udp(\\\"10.100.50.202\\\" port(514)); }; log { source(s_syslog_pipe); filter(f_hw_1heat); destination(d_kjs_test); }; log { source(s_syslog_pipe); filter(f_hw_2fan); destination(d_kjs_test); }; log { source(s_syslog_pipe); filter(f_hw_3fan); destination(d_kjs_test); }; log { source(s_syslog_pipe); filter(f_hw_4mem); destination(d_kjs_test); }; log { source(s_syslog_pipe); filter(f_hw_5disk); destination(d_kjs_test); }; log { source(s_syslog_pipe); filter(f_hw_6psu); destination(d_kjs_test); }; log { source(s_syslog_pipe); filter(f_authinfo); destination(d_kjs_test); }; log { source(s_syslog_pipe); filter(f_checkcert); destination(d_kjs_test); }; log { source(s_syslog_pipe); filter(f_warntoemerg); destination(d_kjs_test); }; \" }","title":"BIG-IP - Syslog Custom Config Sample"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/BIG-IP-SYSLOG-Config-Sample/#big-ip-syslog-custom-config","text":"\ubcf8 \ubb38\uc11c\uc5d0\uc11c\ub294 \uc8fc\uc694 Monitoring \ub300\uc0c1 \ub85c\uadf8\uc5d0 \ub300\ud574 Syslog Config include\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uc0d8\ud50c Config\ub97c \uc81c\uc2dc\ud569\ub2c8\ub2e4. \ubcf5\uc0ac/\ubd99\uc5ec\ub123\uae30 \uc6a9\ub3c4\uc758 \uac19\uc740 \uc774\ub984\uc758 TXT\ud30c\uc77c\uc744 \uc0ac\uc6a9\ud558\uba74 \uc880\ub354 \uc548\uc804\ud558\uac8c Custom Config\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.","title":"BIG-IP Syslog Custom Config"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/BIG-IP-SYSLOG-Config-Sample/#syslog-custom-config","text":"Syslog Custom Config \ub300\uc0c1 \uc8fc\uc694 \uc774\ubca4\ud2b8\ub97c \uc544\ub798\uc640 \uac19\uc774 \uc815\ub9ac\ud569\ub2c8\ub2e4. \uc544\ub798 \ud45c\ub4e4\uc740 \ub9d0\uadf8\ub300\ub85c \ub85c\uadf8 \uc0d8\ud50c\uc774\uba70 Syslog\ub294 \ud574\ub2f9 \ub85c\uadf8\uc758 Text\ub97c Pattern matching\uc744 \uc218\ud589\ud558\uc5ec \ub9e4\uce6d\ub418\ub294 Syslog Line\uc744 Remote Server\ub85c \uc804\ub2ec\ud569\ub2c8\ub2e4.","title":"Syslog Custom Config \ub300\uc0c1"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/BIG-IP-SYSLOG-Config-Sample/#hardware","text":"\uad6c\ubd84 \uc704\uce58 \ub85c\uadf8 \uc0d8\ud50c CPU temp. high ltm Cpu %d: temperature (%d) is too high. FAN speed low ltm Cpu %d: fan speed (%d) is too low. FAN down ltm Chassis fan %d: status (%d) is bad. MEM usage high ltm %s: Aggressive mode %s %s (%llx) (%s %s). (%u/%u %s) DISK usage high ltm %s disk usage exceeds %d%%. Reduce log disk space now Chassis Temperature ltm Chassis %d: temperature (%d) is too high. PSU Down ltm Chassis power supply %d is not supplying power (status: %d): make sure it is plugged in. Interface Up/Down ltm Link: %s is %s","title":"Hardware \ub85c\uadf8"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/BIG-IP-SYSLOG-Config-Sample/#_1","text":"\uad6c\ubd84 \uc704\uce58 \ub85c\uadf8 \uc0d8\ud50c Certificate \ub9cc\ub8cc \uc608\uc815 (30\uc77c\ubd80\ud130) ltm warning tmsh[16526]: 01420008:4: Certificate 'CN=test-domain.com,OU=ADC,O=IT,L=Seoul,ST=Seoul,C=KR' in file /Common/be_expire_soon will expire on Apr 30 01:36:52 2022 GMT Certificate \ub9cc\ub8cc ltm warning tmsh[16900]: 01420007:4: Certificate 'CN=I000105479,OU=Client certificates,O=NGINX Inc' in file /Common/expired expired on Jul 3 14:17:32 2021 GMT","title":"\uc9c0\uc815\ub41c \uc778\uc99d\uc11c \ub9cc\ub8cc \ub85c\uadf8"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/BIG-IP-SYSLOG-Config-Sample/#user-log","text":"\uad6c\ubd84 \uc704\uce58 \ub85c\uadf8 \uc0d8\ud50c SSH secure info sshd(pam_audit)[15360]: 01070417:6: AUDIT - user kjs - RAW: sshd(pam_audit): user=kjs(kjs) partition=[All] level=Administrator tty=ssh host=175.196.233.10 attempts=1 start=\"Fri Apr 15 10:24:49 2022\". HTTPD secure info httpd(pam_audit)[28883]: 01070417:6: AUDIT - user kjs - RAW: httpd(pam_audit): user=kjs(kjs) partition=[All] level=Administrator tty=(unknown) host=175.196.233.10 attempts=1 start=\"Fri Apr 15 10:33:27 2022\" end=\"Fri Apr 15 10:33:27 2022\".","title":"User \uc811\uc18d log"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/BIG-IP-SYSLOG-Config-Sample/#user-log_1","text":"\uad6c\ubd84 \uc704\uce58 \ub85c\uadf8 \uc0d8\ud50c SSH Fail secure notice sshd[15293]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=175.196.233.10 user=kjs HTTPD Fail secure notice httpd[10459]: pam_unix(httpd:auth): authentication failure; logname= uid=48 euid=48 tty= ruser= rhost=175.196.233.10 user=admin","title":"User \uc811\uc18d \uc2e4\ud328 \u00a0log  (\ubbf8\uc778\uac00 \uc811\uc18d \uc2dc\ub3c4)"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/BIG-IP-SYSLOG-Config-Sample/#syslog-include","text":"tmsh# edit sys syslog all-properties \uba85\ub839\uc5b4\ub85c vi \ud3b8\uc9d1\uae30\ub85c \uc9c4\uc785\ud574, include \ubd80\ubd84 \uc544\ub798\uc5d0 \uc544\ub798\uc640 \uac19\uc774 \uc791\uc131\ud569\ub2c8\ub2e4. sys syslog { include \" filter f_hw_1heat { facility(local0) and match(\\\"Cpu.*too\\\"); }; filter f_hw_2fan { facility(local0) and match(\\\"Cpu.*fan\"); }; filter f_hw_3fan { facility(local0) and match(\\\"Chassis fan\\\"); }; filter f_hw_4mem { facility(local0) and match(\\\"Aggressive mode\\\"); }; filter f_hw_5disk { facility(local0) and match(\\\"disk usage exceeds\"\\); }; filter f_hw_6psu { facility(local0) and match(\\\"power supply\"\\); }; filter f_warntoemerg { facility(local0); level(warning..emerg); }; filter f_authinfo { facility(local0) and match(\\\"pam_audit|pam_unix\\\"); }; filter f_checkcert { facility(local0) and match(\\\"Ceritificate.*expire\\\"); }; destination d_kjs_test { file(/var/log/kjs_syslog_test create_dirs(yes)); }; destination d_logsvr { udp(\\\"10.100.50.202\\\" port(514)); }; log { source(s_syslog_pipe); filter(f_hw_1heat); destination(d_kjs_test); }; log { source(s_syslog_pipe); filter(f_hw_2fan); destination(d_kjs_test); }; log { source(s_syslog_pipe); filter(f_hw_3fan); destination(d_kjs_test); }; log { source(s_syslog_pipe); filter(f_hw_4mem); destination(d_kjs_test); }; log { source(s_syslog_pipe); filter(f_hw_5disk); destination(d_kjs_test); }; log { source(s_syslog_pipe); filter(f_hw_6psu); destination(d_kjs_test); }; log { source(s_syslog_pipe); filter(f_authinfo); destination(d_kjs_test); }; log { source(s_syslog_pipe); filter(f_checkcert); destination(d_kjs_test); }; log { source(s_syslog_pipe); filter(f_warntoemerg); destination(d_kjs_test); }; \" }","title":"Syslog Include \uc124\uc815"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/F5-BIG-IP-SNMP-OID/","text":"\uc544\ub798 \ub9c1\ud06c\ub294 F5 \uacf5\uc2dd \uac00\uc774\ub4dc \ubb38\uc11c\uc785\ub2c8\ub2e4. \ubcf8 \ubb38\uc11c \ub0b4\uc6a9\uc5d0 \ub300\ud55c \uc0c1\uc138 \uc124\uba85\uc740 \uc544\ub798 \ubb38\uc11c\uc5d0\uc11c \ud655\uc778 \uac00\ub2a5\ud569\ub2c8\ub2e4. Monitoring BIG-IP System Traffic with SNMP CPU \u00b6 # BIG-IP\ub294 SNMP Response\ub85c Delta Value\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4. # Object Name \uc55e\uc5d0 \u2018F5-BIGIP-SYSTEM-MIB::\u2019\uac00 \uc0dd\ub7b5\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. # SNMP \uc870\ud68c \uc2dc \uc0dd\ub7b5\ub41c \uc0c1\ud0dc\uc778 sysGlobalHostCpuUser5s\ub85c \uc870\ud68c\ud574\ub3c4 \ub418\uace0, F5-BIGIP-SYSTEM-MIB::sysGlobalHostCpuUser5s\ub85c \uc870\ud68c\ud574\ub3c4 \ub429\ub2c8\ub2e4. OID \uac12\uc744 \ubc14\ub85c \uc0ac\uc6a9\ud574\ub3c4 \ub429\ub2c8\ub2e4. # Object name \ub9c8\uc9c0\ub9c9\uc758 5s\ub294 Polling Interval\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4. 5s, 1m, 5m\ub85c \uad6c\ubd84\ub429\ub2c8\ub2e4. \uc774 \ud45c\uc5d0\uc11c\ub294 5s\ub9cc \uc791\uc131\ud569\ub2c8\ub2e4. SNMP OID \u00b6 Parameter Object name OID Global Host CPU Usage sysGlobalHostCpuUser5s .1.3.6.1.4.1.3375.2.1.1.2.20.14 sysGlobalHostCpuNice5s .1.3.6.1.4.1.3375.2.1.1.2.20.15 sysGlobalHostCpuSystem5s .1.3.6.1.4.1.3375.2.1.1.2.20.16 sysGlobalHostCpuIdle5s .1.3.6.1.4.1.3375.2.1.1.2.20.17 sysGlobalHostCpuIrq5s .1.3.6.1.4.1.3375.2.1.1.2.20.18 sysGlobalHostCpuSoftirq5s .1.3.6.1.4.1.3375.2.1.1.2.20.19 sysGlobalHostCpuIowait5s .1.3.6.1.4.1.3375.2.1.1.2.20.20 sysGlobalHostCpuUsageRatio5s .1.3.6.1.4.1.3375.2.1.1.2.20.21 sysGlobalHostCpuUsageRatio .1.3.6.1.4.1.3375.2.1.1.2.20.13 Global Host CPU UsageRatio\ub294 \uc2dc\uc2a4\ud15c CPU \uc0ac\uc6a9\ub960\uc774\uba70, User, Niced, system\uc758 \ub378\ud0c0 \ud569\uc744 user, niced, system, idle, irq, softirq, iowait \ub378\ud0c0 \ud569\uc73c\ub85c \ub098\ub208 \uac12\uc785\ub2c8\ub2e4. \uc5ec\uae30\uc11c \ub378\ud0c0\ub294, \ucd5c\uadfc 10\ucd08 \uac04\uc758 Stat\uc5d0 \ub300\ud55c \ucc28\uc774\uc785\ub2c8\ub2e4. Global Host CPU UsageRatio5s\ub294 \uc0b0\ucd9c \ubc29\ubc95\uc740 \ub3d9\uc77c\ud558\uc9c0\ub9cc \ucd5c\uadfc 5-second interval\uc5d0 \ub300\ud55c \ub378\ud0c0 \uac12\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. BIG-IP\ub294 CPU Core \ubcc4\ub85c SNMP OID\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4. \uc544\ub798 OID\ub97c \uc870\ud68c\ud558\uba74 Core \ubcc4\ub85c \uacb0\uacfc\uac12\uc774 \ub098\ud0c0\ub0a9\ub2c8\ub2e4. Parameter Object name OID CPU Count sysMultiHostCpuCount .1.3.6.1.4.1.3375.2.1.7.4.2.1.5 CPU Usage sysMultiHostCpuUser5s .1.3.6.1.4.1.3375.2.1.7.4.2.1.12 sysMultiHostCpuNice5s .1.3.6.1.4.1.3375.2.1.7.4.2.1.13 sysMultiHostCpuSystem5s .1.3.6.1.4.1.3375.2.1.7.4.2.1.14 sysMultiHostCpuIdle5s .1.3.6.1.4.1.3375.2.1.7.4.2.1.15 sysMultiHostCpuIrq5s .1.3.6.1.4.1.3375.2.1.7.4.2.1.16 sysMultiHostCpuSoftirq5s .1.3.6.1.4.1.3375.2.1.7.4.2.1.17 sysMultiHostCpuIowait5s .1.3.6.1.4.1.3375.2.1.7.4.2.1.18 sysMultiHostCpuUsageRatio5s .1.3.6.1.4.1.3375.2.1.7.4.2.1.19 sysMultiHostCpuUsageRatio .1.3.6.1.4.1.3375.2.1.7.4.2.1.11 Memory \u00b6 BIG-IP\ub294 Memory\ub97c TMM, Other, Swap\uc73c\ub85c \uac01\uac01 \ub098\ub204\uc5b4 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. TMM\uc740 \uc2e4\uc81c \ud2b8\ub798\ud53d \ucc98\ub9ac\uc5d0 \uc0ac\uc6a9\ub418\ub294 \uba54\ubaa8\ub9ac, Other\ub294 BIG-IP TMOS \uad6c\ub3d9\uc5d0 \ud544\uc694\ud55c Memory, Swap\uc740 \ub9d0 \uadf8\ub300\ub85c Swap \uc601\uc5ed \uba54\ubaa8\ub9ac\uc785\ub2c8\ub2e4. TMSH\uc5d0\uc11c tmsh show sys memory \uba85\ub839\uc5b4\ub85c \uba54\ubaa8\ub9ac\ub97c \uc870\ud68c\ud558\uba74 \uc544\ub798\uc640 \uac19\uc774 \uad6c\ubd84\ub41c \uacb0\uacfc\ub97c \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc138\ubd80\ub0b4\uc5ed\uc740 \uc0dd\ub7b5\ud558\uace0 \uc62e\uaca8\uc654\uc2b5\ub2c8\ub2e4. Sys::System Memory Information ----------------------------------------------------------------- Memory Used(%) Current Average Max(since 12/03/20 14:04:34) ----------------------------------------------------------------- TMM Memory Used 7 7 7 Other Memory Used 73 73 73 Swap Used 2 2 2 ------------------------ sys::Host Memory (bytes) ------------------------ TMM: 0 Total 5.1G Used 355.3M Free 4.7G Other: 0 Total 8.6G Used 6.3G Free 2.3G Total: 0 Total 13.7G Used 6.6G Free 7.1G Swap: 0 Total 1023.9M Used 16.7M Free 1007.2M SNMP OID \u00b6 Parameter Object name OID Host Memory Total sysHostMemoryTotal .1.3.6.1.4.1.3375.2.1.7.1.1 Host Memory Used sysHostMemoryUsed .1.3.6.1.4.1.3375.2.1.7.1.2 TMM Memory Total sysGlobalTmmStatMemoryTotal .1.3.6.1.4.1.3375.2.1.1.2.21.28 TMM Memory Used sysGlobalTmmStatMemoryUsed .1.3.6.1.4.1.3375.2.1.1.2.21.29 Other(non-TMM) memory Total sysGlobalHostOtherMemoryTotal .1.3.6.1.4.1.3375.2.1.1.2.20.44 Other(non-TMM) memory Used sysGlobalHostOtherMemoryUsed .1.3.6.1.4.1.3375.2.1.1.2.20.45 Swap Memory Total sysGlobalHostSwapTotal .1.3.6.1.4.1.3375.2.1.1.2.20.46 Swap Memory Used sysGlobalHostSwapUsed .1.3.6.1.4.1.3375.2.1.1.2.20.47 Byte\uc640 KiloByte \ub2e8\uc704\ub85c \ud45c\uc2dc\ud569\ub2c8\ub2e4. KiloByte\ub294 Object Name \ub4a4\uc5d0 \u2018Kb\u2019\ub97c \ubd99\uc5ec\uc8fc\uba74 \ub429\ub2c8\ub2e4. Parameter Object name OID Host Memory Total sysHostMemoryTotal .1.3.6.1.4.1.3375.2.1.7.1.1 Host Memory Used sysMultiHostUsed .1.3.6.1.4.1.3375.2.1.7.4.2.1.3 TMM Memory Total sysTmmStatMemoryTotal .1.3.6.1.4.1.3375.2.1.7.4.2.1.31 TMM Memory Used sysTmmStatMemoryUsed .1.3.6.1.4.1.3375.2.1.7.4.2.1.32 Other(non-TMM) memory Total sysMultiHostOtherMemoryTotal .1.3.6.1.4.1.3375.2.1.7.4.2.1.7 Other(non-TMM) memory Used sysMultiHostOtherMemoryUsed .1.3.6.1.4.1.3375.2.1.7.4.2.1.8 Swap Memory Total sysMultiHostSwapTotal .1.3.6.1.4.1.3375.2.1.7.4.2.1.9 Swap Memory Used sysMultiHostSwapUsed .1.3.6.1.4.1.3375.2.1.7.4.2.1.10 Byte\uc640 KiloByte \ub2e8\uc704\ub85c \ud45c\uc2dc\ud569\ub2c8\ub2e4. KiloByte\ub294 Object Name \ub4a4\uc5d0 \u2018Kb\u2019\ub97c \ubd99\uc5ec\uc8fc\uba74 \ub429\ub2c8\ub2e4. Disk \u00b6 # Disk\uc758 \uacbd\uc6b0 SNMP OID\uac00 \uc81c\uacf5\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. # BIG-IP\uc2dc\uc2a4\ud15c\uc740 Disk Used Space/Available Space\ub97c Diskmonitor Utility\ub97c \uc0ac\uc6a9\ud574 \uccb4\ud06c\ud569\ub2c8\ub2e4. - Diskmonitor Utility\ub294 \uc8fc\uae30\uc801\uc73c\ub85c \ub3d9\uc791\ud574 \ub514\uc2a4\ud06c \uc0ac\uc6a9\ub960\uc744 \uccb4\ud06c\ud558\ub294 \uc2a4\ud06c\ub9bd\ud2b8\ub85c, BIG-IP file systems\uc774 \uac00\ub4dd \ucc28\uac8c \ub418\uba74, LTM Log\ub97c \uc0dd\uc131 \ubc0f Alertd\ub97c \ud1b5\ud574 \uba54\uc77c\uc744 \uc804\ub2ec\ud558\uac70\ub098 SNMP Trap\uc744 \uc0dd\uc131\ud558\ub294 \ub3d9\uc791\uc744 \uc218\ud589\ud569\ub2c8\ub2e4. Disk Monitor Utility \ub3d9\uc791 \uad6c\uc870 \u00b6 Inspecting Volumes \u00b6 Diskmonitor \uc720\ud2f8\ub9ac\ud2f0\ub294 \uc544\ub798 \ubcfc\ub968\uc744 \uae30\ubcf8\uac12\uc73c\ub85c \uccb4\ud06c\ud569\ub2c8\ub2e4. _root_ = / config = /config dev_shm = /dev/shm shared = /shared shared_rrd.1.2 = /shared/rrd.1.2 usr = /usr var = /var var_log = /var/log var_loipc = /var/loipc var_prompt = /var/prompt var_run = /var/run var_tmstat = /var/tmstat shared_vmdisks = /shared/vmdisks BIG-IP DB Variables \u00b6 diskmonitor utility\ub294 BIG-IP DB \ubcc0\uc218\ub97c \uc0ac\uc6a9\ud558\uba70, \ud65c\uc131\ud654/\ube44\ud65c\uc131\ud654, Monitoring \ubc29\uc2dd, Interval, Threshold \ub4f1\uc774 BIG-IP DB \uac12\uc73c\ub85c \uc9c0\uc815\ub429\ub2c8\ub2e4. diskmonitor utility\uc758 db variables\uc740 \ud30c\ud2f0\uc158 \ubcc4\ub85c Customization\uc774 \uac00\ub2a5\ud569\ub2c8\ub2e4. DB Description TMSH Command Last Available Value(%) list sys db platform.diskmonitor.freelast.\\ Alert Threshold(%) list sys db platform.diskmonitor.limitalert.\\ Warning Threshold(%) list sys db platform.diskmonitor.limitwarn.\\ Monitor Interval(%) list sys db platform.diskmonitor.interval Crontab \u00b6 crontab -l \uba85\ub839\uc5b4\ub85c diskmonitor\uc758 \uc8fc\uae30\uc801\uc778 \ub3d9\uc791\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub9e4 10\ubd84\ub9c8\ub2e4 \ub3d9\uc791\uc774 \uae30\ubcf8\uac12 \uc785\ub2c8\ub2e4.(11.5.x and later) MAILTO=\"\" 1-59/10 * * * * /usr/bin/diskmonitor 0 */4 * * * /usr/bin/diskwearoutstat \u2026 \u2026 Action - Log \u00b6 Diskmonitor Utility\ub294 Threshold\ub97c \ub118\uc73c\uba74 \ub85c\uadf8 \ud30c\uc77c /var/log/ltm\uc5d0 \uc544\ub798\uc640 \uc720\uc0ac\ud55c \ub85c\uadf8\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4. diskmonitor: 011d005: Disk partition shared has less than 30% free diskmonitor: 011d004: Disk partition shared has only 0% free Action \u2013 SNMP Trap \u00b6 \uc0dd\uc131\ub418\ub294 SNMP Trap\uc740 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. (Trap\uc740 \ud3c9\uc18c\uc5d0 \uac12\uc774 \uc870\ud68c\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.) \u2018F5-BIGIP-COMMON-MIB::\u2019\uac00 \uc0dd\ub7b5\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. Alert Name Object name OID BIGIP_DMON_ERR_DMON_ALERT bigipDiskPartitionWarn .1.3.6.1.4.1.3375.2.4.0.25 BIGIP_DMON_ERR_DMON_WARN bigipDiskPartitionWarn .1.3.6.1.4.1.3375.2.4.0.25 BIGIP_DMON_ERR_DMON_GROWTH bigipDiskPartitionGrowth .1.3.6.1.4.1.3375.2.4.0.26 \ub2e4\uc74c \uba85\ub839\uc5b4\ub85c Default Trap \uc124\uc815\uc744 \uc870\ud68c\ud574\ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4. #cat /etc/alertd/alert.conf | grep -i diskmonitor -A 10 \uba85\ub839\uc5b4\uc758 \uacb0\uacfc\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. * from diskmonitor (CR38227) * ALERT and WARN send the same trap */ alert BIGIP_DMON_ERR_DMON_ALERT { snmptrap OID=\".1.3.6.1.4.1.3375.2.4.0.25\" } alert BIGIP_DMON_ERR_DMON_WARN { snmptrap OID=\".1.3.6.1.4.1.3375.2.4.0.25\" } alert BIGIP_DMON_ERR_DMON_GROWTH { snmptrap OID=\".1.3.6.1.4.1.3375.2.4.0.26\" Diskmonitor\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \uc544\ub798 \ubb38\uc11c\uc5d0\uc11c \ud655\uc778\ud558\uc2e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. K8865: Overview of the diskmonitor utility Throughput \u00b6 # SNMP\ub85c \uc870\ud68c \uac00\ub2a5\ud55c Thoughput Response\ub294 \ud569\uc0b0 \uac12\uc785\ub2c8\ub2e4. # Current \ub4f1 Dashboard \ubc0f Tmsh\uc5d0\uc11c \uc218\uce58\ub97c \ud45c\ud604\ud560 \ub54c\ub294 \uc774\ub4e4\uc758 Delta \uac12\uacfc \uacc4\uc0b0\uc2dd\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. # \ubcf8 \ubb38\uc11c\uc5d0\ub294 SNMP OID \uac12\uacfc \uacc4\uc0b0\uc2dd\uc744 \ud45c\uae30\ud569\ub2c8\ub2e4. - \ubb38\uc11c \uac00\ub3c5\uc131\uc744 \uc704\ud574 SSL Transaction (Accel.) \ud56d\ubaa9\uc740 \uc81c\uc678\ud569\ub2c8\ub2e4. \uc6a9\uc5b4 \uc124\uba85 \u00b6 \uc790\uc138\ud55c \uc124\uba85\uc740 \uc544\ub798 \ubb38\uc11c\ub97c \ucc38\uc870\ud558\uc2dc\uba74 \uc88b\uc2b5\ub2c8\ub2e4. K50309321: Viewing BIG-IP system throughput statistics \ud56d\ubaa9\uac12 \uc124\uba85 Thoughput Management \uc778\ud130\ud398\uc774\uc2a4\ub97c \uc81c\uc678\ud558\uace0, TMM, PVA \uc2a4\uc704\uce58\ubcf4\ub4dc\ub97c \ube44\ub86f\ud55c BIG-IP Device\uc758 \ubaa8\ub4e0 \uc778\ud130\ud398\uc774\uc2a4\uc5d0\uc11c \uc218\uc9d1\ud55c Throughput \ud569\uc0b0 \uac12\uc785\ub2c8\ub2e4. (Dashboard\uc5d0\uc11c\ub294 Management Interface Traffic\uae4c\uc9c0 \ud3ec\ud568\ub41c\ub2e4\uace0 \ud569\ub2c8\ub2e4.) In: Client-side in/out \ud2b8\ub798\ud53d \ud569\uacc4 Out: Server-side in/out \ud2b8\ub798\ud53d \ud569\uacc4 Service: Request(Client-side in + Server-side Out), Response(Service-side in + Client-side Out) \uac12 \uc911 \ud070 \uac12\uc785\ub2c8\ub2e4. | TMM Client-side Throughput [Detail] | Client-side\uc758 TMM, PVA\uc5d0 \uc758\ud574 \ucc98\ub9ac\ub41c \ud569\uacc4 throughput\uc785\ub2c8\ub2e4. Client in: \uc720\uc785(Ingress) \ud2b8\ub798\ud53d \ud569\uacc4 Client out: \uc720\ucd9c(Egress) \ud2b8\ub798\ud53d \ud569\uacc4 | | TMM Server-side Throughput [Detail] | Server-side\uc758 TMM, PVA\uc5d0 \uc758\ud574 \ucc98\ub9ac\ub41c \ud569\uacc4 throughput\uc785\ub2c8\ub2e4. Server in: \uc720\uc785(Ingress) \ud2b8\ub798\ud53d \ud569\uacc4 Server out: \uc720\ucd9c(Egress) \ud2b8\ub798\ud53d \ud569\uacc4 | SNMP OID \u00b6 # Object Name \uc55e\uc5d0 \u2018F5-BIGIP-SYSTEM-MIB::\u2019\uac00 \uc0dd\ub7b5\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. # Object name \ub9c8\uc9c0\ub9c9\uc758 5s\ub294 Polling Interval, Average\ub97c \uc758\ubbf8\ud569\ub2c8\ub2e4. 5s, 1m, 5m\ub85c \uad6c\ubd84\ub429\ub2c8\ub2e4. \uc774 \ud45c\uc5d0\uc11c\ub294 5s\ub9cc \uc791\uc131\ud569\ub2c8\ub2e4. # Object Name\uc758 sysStat \ub4a4\uc5d0 Pva\ub97c \ucd94\uac00\ud558\uba74 PVA \ud2b8\ub798\ud53d\uc744 \ubcc4\ub3c4 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \\<\uc608\uc2dc> sysStatClientBytesIn.0 => sysStatPvaClientBytesIn.0 Statistics Group Object Name OID Throughput Client In sysStatClientBytesIn.0 .1.3.6.1.4.1.3375.2.1.1.2.1.3.0 sysStatClientPktsIn.0 .1.3.6.1.4.1.3375.2.1.1.2.1.2.0 sysStatClientBytesIn5s.0 .1.3.6.1.4.1.3375.2.1.1.2.1.60.0 sysStatClientPktsIn5s.0 .1.3.6.1.4.1.3375.2.1.1.2.1.59.0 Client Out sysStatClientBytesOut.0 .1.3.6.1.4.1.3375.2.1.1.2.1.5.0 sysStatClientPktsOut.0 .1.3.6.1.4.1.3375.2.1.1.2.1.4.0 sysStatClientBytesOut5s.0 .1.3.6.1.4.1.3375.2.1.1.2.1.62.0 sysStatClientPktsOut5s.0 .1.3.6.1.4.1.3375.2.1.1.2.1.61.0 Server In sysStatServerBytesIn.0 .1.3.6.1.4.1.3375.2.1.1.2.1.10.0 sysStatServerPktsIn.0 .1.3.6.1.4.1.3375.2.1.1.2.1.9.0 sysStatServerBytesIn5s.0 .1.3.6.1.4.1.3375.2.1.1.2.1.67.0 sysStatServerPktsIn5s.0 .1.3.6.1.4.1.3375.2.1.1.2.1.66.0 Server Out sysStatServerBytesOut.0 .1.3.6.1.4.1.3375.2.1.1.2.1.12.0 sysStatServerPktsOut.0 .1.3.6.1.4.1.3375.2.1.1.2.1.11.0 sysStatServerBytesOut5s.0 .1.3.6.1.4.1.3375.2.1.1.2.1.69.0 sysStatServerPktsOut5s.0 .1.3.6.1.4.1.3375.2.1.1.2.1.68.0 Calculation \u00b6 \uac01 \uacc4\uc0b0\uc2dd\uc758 Polling Interval\uc740 10s\uac00 \uae30\ubcf8\uac12\uc785\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \\ \uac12\uc744 \ucd94\ucd9c\ud558\ub824\uba74 OID sysStatServerBytesIn\uc5d0 \ub300\ud574 10\ucd08 \uac04\uaca9\uc73c\ub85c \ub450 \ubc88\uc758 \uc870\ud68c\uac00 \ud544\uc694\ud569\ub2c8\ub2e4. Statistic Group \uacc4\uc0b0\uc2dd Throughput In ( [DeltaStatClientBytesIn] + [DeltasysStatClientBytesOut] ) *8 / [interval] Out ( [DeltaStatServerBytesIn] + [DeltaStatServerBytesOut] )* 8 / [interval] TMM Client-side Throughput Client Bits In ( [DeltaStatClientBytesIn] *8 ) / [interval] Client Bits Out ( [DeltaStatClientBytesOut]* 8 ) / [interval] TMM Server-side Throughput Server Bits In ( [DeltaStatServerBytesIn] *8 ) / [interval] Server Bits Out ( [DeltaStatServerBytesOut]* 8 ) / [interval] New Connections Summary Client Accepts [DeltaTcpStatAccept] / [interval] Server Connects [DeltaStatServerTotConns] /[interval] Total New Connections Client Connects [DeltaStatClientTotConns] / [interval] Server Connects [DeltaStatServerTotConns] / [interval] New Accepts / Connects Client Accepts [DeltaTcpStatAccepts] / [interval] Server Connects [DeltaTcpStatConnects] / [interval]","title":"F5 BIG-IP - SNMP OID"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/F5-BIG-IP-SNMP-OID/#cpu","text":"# BIG-IP\ub294 SNMP Response\ub85c Delta Value\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4. # Object Name \uc55e\uc5d0 \u2018F5-BIGIP-SYSTEM-MIB::\u2019\uac00 \uc0dd\ub7b5\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. # SNMP \uc870\ud68c \uc2dc \uc0dd\ub7b5\ub41c \uc0c1\ud0dc\uc778 sysGlobalHostCpuUser5s\ub85c \uc870\ud68c\ud574\ub3c4 \ub418\uace0, F5-BIGIP-SYSTEM-MIB::sysGlobalHostCpuUser5s\ub85c \uc870\ud68c\ud574\ub3c4 \ub429\ub2c8\ub2e4. OID \uac12\uc744 \ubc14\ub85c \uc0ac\uc6a9\ud574\ub3c4 \ub429\ub2c8\ub2e4. # Object name \ub9c8\uc9c0\ub9c9\uc758 5s\ub294 Polling Interval\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4. 5s, 1m, 5m\ub85c \uad6c\ubd84\ub429\ub2c8\ub2e4. \uc774 \ud45c\uc5d0\uc11c\ub294 5s\ub9cc \uc791\uc131\ud569\ub2c8\ub2e4.","title":"CPU"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/F5-BIG-IP-SNMP-OID/#snmp-oid","text":"Parameter Object name OID Global Host CPU Usage sysGlobalHostCpuUser5s .1.3.6.1.4.1.3375.2.1.1.2.20.14 sysGlobalHostCpuNice5s .1.3.6.1.4.1.3375.2.1.1.2.20.15 sysGlobalHostCpuSystem5s .1.3.6.1.4.1.3375.2.1.1.2.20.16 sysGlobalHostCpuIdle5s .1.3.6.1.4.1.3375.2.1.1.2.20.17 sysGlobalHostCpuIrq5s .1.3.6.1.4.1.3375.2.1.1.2.20.18 sysGlobalHostCpuSoftirq5s .1.3.6.1.4.1.3375.2.1.1.2.20.19 sysGlobalHostCpuIowait5s .1.3.6.1.4.1.3375.2.1.1.2.20.20 sysGlobalHostCpuUsageRatio5s .1.3.6.1.4.1.3375.2.1.1.2.20.21 sysGlobalHostCpuUsageRatio .1.3.6.1.4.1.3375.2.1.1.2.20.13 Global Host CPU UsageRatio\ub294 \uc2dc\uc2a4\ud15c CPU \uc0ac\uc6a9\ub960\uc774\uba70, User, Niced, system\uc758 \ub378\ud0c0 \ud569\uc744 user, niced, system, idle, irq, softirq, iowait \ub378\ud0c0 \ud569\uc73c\ub85c \ub098\ub208 \uac12\uc785\ub2c8\ub2e4. \uc5ec\uae30\uc11c \ub378\ud0c0\ub294, \ucd5c\uadfc 10\ucd08 \uac04\uc758 Stat\uc5d0 \ub300\ud55c \ucc28\uc774\uc785\ub2c8\ub2e4. Global Host CPU UsageRatio5s\ub294 \uc0b0\ucd9c \ubc29\ubc95\uc740 \ub3d9\uc77c\ud558\uc9c0\ub9cc \ucd5c\uadfc 5-second interval\uc5d0 \ub300\ud55c \ub378\ud0c0 \uac12\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. BIG-IP\ub294 CPU Core \ubcc4\ub85c SNMP OID\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4. \uc544\ub798 OID\ub97c \uc870\ud68c\ud558\uba74 Core \ubcc4\ub85c \uacb0\uacfc\uac12\uc774 \ub098\ud0c0\ub0a9\ub2c8\ub2e4. Parameter Object name OID CPU Count sysMultiHostCpuCount .1.3.6.1.4.1.3375.2.1.7.4.2.1.5 CPU Usage sysMultiHostCpuUser5s .1.3.6.1.4.1.3375.2.1.7.4.2.1.12 sysMultiHostCpuNice5s .1.3.6.1.4.1.3375.2.1.7.4.2.1.13 sysMultiHostCpuSystem5s .1.3.6.1.4.1.3375.2.1.7.4.2.1.14 sysMultiHostCpuIdle5s .1.3.6.1.4.1.3375.2.1.7.4.2.1.15 sysMultiHostCpuIrq5s .1.3.6.1.4.1.3375.2.1.7.4.2.1.16 sysMultiHostCpuSoftirq5s .1.3.6.1.4.1.3375.2.1.7.4.2.1.17 sysMultiHostCpuIowait5s .1.3.6.1.4.1.3375.2.1.7.4.2.1.18 sysMultiHostCpuUsageRatio5s .1.3.6.1.4.1.3375.2.1.7.4.2.1.19 sysMultiHostCpuUsageRatio .1.3.6.1.4.1.3375.2.1.7.4.2.1.11","title":"SNMP OID"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/F5-BIG-IP-SNMP-OID/#memory","text":"BIG-IP\ub294 Memory\ub97c TMM, Other, Swap\uc73c\ub85c \uac01\uac01 \ub098\ub204\uc5b4 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. TMM\uc740 \uc2e4\uc81c \ud2b8\ub798\ud53d \ucc98\ub9ac\uc5d0 \uc0ac\uc6a9\ub418\ub294 \uba54\ubaa8\ub9ac, Other\ub294 BIG-IP TMOS \uad6c\ub3d9\uc5d0 \ud544\uc694\ud55c Memory, Swap\uc740 \ub9d0 \uadf8\ub300\ub85c Swap \uc601\uc5ed \uba54\ubaa8\ub9ac\uc785\ub2c8\ub2e4. TMSH\uc5d0\uc11c tmsh show sys memory \uba85\ub839\uc5b4\ub85c \uba54\ubaa8\ub9ac\ub97c \uc870\ud68c\ud558\uba74 \uc544\ub798\uc640 \uac19\uc774 \uad6c\ubd84\ub41c \uacb0\uacfc\ub97c \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc138\ubd80\ub0b4\uc5ed\uc740 \uc0dd\ub7b5\ud558\uace0 \uc62e\uaca8\uc654\uc2b5\ub2c8\ub2e4. Sys::System Memory Information ----------------------------------------------------------------- Memory Used(%) Current Average Max(since 12/03/20 14:04:34) ----------------------------------------------------------------- TMM Memory Used 7 7 7 Other Memory Used 73 73 73 Swap Used 2 2 2 ------------------------ sys::Host Memory (bytes) ------------------------ TMM: 0 Total 5.1G Used 355.3M Free 4.7G Other: 0 Total 8.6G Used 6.3G Free 2.3G Total: 0 Total 13.7G Used 6.6G Free 7.1G Swap: 0 Total 1023.9M Used 16.7M Free 1007.2M","title":"Memory"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/F5-BIG-IP-SNMP-OID/#snmp-oid_1","text":"Parameter Object name OID Host Memory Total sysHostMemoryTotal .1.3.6.1.4.1.3375.2.1.7.1.1 Host Memory Used sysHostMemoryUsed .1.3.6.1.4.1.3375.2.1.7.1.2 TMM Memory Total sysGlobalTmmStatMemoryTotal .1.3.6.1.4.1.3375.2.1.1.2.21.28 TMM Memory Used sysGlobalTmmStatMemoryUsed .1.3.6.1.4.1.3375.2.1.1.2.21.29 Other(non-TMM) memory Total sysGlobalHostOtherMemoryTotal .1.3.6.1.4.1.3375.2.1.1.2.20.44 Other(non-TMM) memory Used sysGlobalHostOtherMemoryUsed .1.3.6.1.4.1.3375.2.1.1.2.20.45 Swap Memory Total sysGlobalHostSwapTotal .1.3.6.1.4.1.3375.2.1.1.2.20.46 Swap Memory Used sysGlobalHostSwapUsed .1.3.6.1.4.1.3375.2.1.1.2.20.47 Byte\uc640 KiloByte \ub2e8\uc704\ub85c \ud45c\uc2dc\ud569\ub2c8\ub2e4. KiloByte\ub294 Object Name \ub4a4\uc5d0 \u2018Kb\u2019\ub97c \ubd99\uc5ec\uc8fc\uba74 \ub429\ub2c8\ub2e4. Parameter Object name OID Host Memory Total sysHostMemoryTotal .1.3.6.1.4.1.3375.2.1.7.1.1 Host Memory Used sysMultiHostUsed .1.3.6.1.4.1.3375.2.1.7.4.2.1.3 TMM Memory Total sysTmmStatMemoryTotal .1.3.6.1.4.1.3375.2.1.7.4.2.1.31 TMM Memory Used sysTmmStatMemoryUsed .1.3.6.1.4.1.3375.2.1.7.4.2.1.32 Other(non-TMM) memory Total sysMultiHostOtherMemoryTotal .1.3.6.1.4.1.3375.2.1.7.4.2.1.7 Other(non-TMM) memory Used sysMultiHostOtherMemoryUsed .1.3.6.1.4.1.3375.2.1.7.4.2.1.8 Swap Memory Total sysMultiHostSwapTotal .1.3.6.1.4.1.3375.2.1.7.4.2.1.9 Swap Memory Used sysMultiHostSwapUsed .1.3.6.1.4.1.3375.2.1.7.4.2.1.10 Byte\uc640 KiloByte \ub2e8\uc704\ub85c \ud45c\uc2dc\ud569\ub2c8\ub2e4. KiloByte\ub294 Object Name \ub4a4\uc5d0 \u2018Kb\u2019\ub97c \ubd99\uc5ec\uc8fc\uba74 \ub429\ub2c8\ub2e4.","title":"SNMP OID"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/F5-BIG-IP-SNMP-OID/#disk","text":"# Disk\uc758 \uacbd\uc6b0 SNMP OID\uac00 \uc81c\uacf5\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. # BIG-IP\uc2dc\uc2a4\ud15c\uc740 Disk Used Space/Available Space\ub97c Diskmonitor Utility\ub97c \uc0ac\uc6a9\ud574 \uccb4\ud06c\ud569\ub2c8\ub2e4. - Diskmonitor Utility\ub294 \uc8fc\uae30\uc801\uc73c\ub85c \ub3d9\uc791\ud574 \ub514\uc2a4\ud06c \uc0ac\uc6a9\ub960\uc744 \uccb4\ud06c\ud558\ub294 \uc2a4\ud06c\ub9bd\ud2b8\ub85c, BIG-IP file systems\uc774 \uac00\ub4dd \ucc28\uac8c \ub418\uba74, LTM Log\ub97c \uc0dd\uc131 \ubc0f Alertd\ub97c \ud1b5\ud574 \uba54\uc77c\uc744 \uc804\ub2ec\ud558\uac70\ub098 SNMP Trap\uc744 \uc0dd\uc131\ud558\ub294 \ub3d9\uc791\uc744 \uc218\ud589\ud569\ub2c8\ub2e4.","title":"Disk"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/F5-BIG-IP-SNMP-OID/#disk-monitor-utility","text":"","title":"Disk Monitor Utility \ub3d9\uc791 \uad6c\uc870"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/F5-BIG-IP-SNMP-OID/#inspecting-volumes","text":"Diskmonitor \uc720\ud2f8\ub9ac\ud2f0\ub294 \uc544\ub798 \ubcfc\ub968\uc744 \uae30\ubcf8\uac12\uc73c\ub85c \uccb4\ud06c\ud569\ub2c8\ub2e4. _root_ = / config = /config dev_shm = /dev/shm shared = /shared shared_rrd.1.2 = /shared/rrd.1.2 usr = /usr var = /var var_log = /var/log var_loipc = /var/loipc var_prompt = /var/prompt var_run = /var/run var_tmstat = /var/tmstat shared_vmdisks = /shared/vmdisks","title":"Inspecting Volumes"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/F5-BIG-IP-SNMP-OID/#big-ip-db-variables","text":"diskmonitor utility\ub294 BIG-IP DB \ubcc0\uc218\ub97c \uc0ac\uc6a9\ud558\uba70, \ud65c\uc131\ud654/\ube44\ud65c\uc131\ud654, Monitoring \ubc29\uc2dd, Interval, Threshold \ub4f1\uc774 BIG-IP DB \uac12\uc73c\ub85c \uc9c0\uc815\ub429\ub2c8\ub2e4. diskmonitor utility\uc758 db variables\uc740 \ud30c\ud2f0\uc158 \ubcc4\ub85c Customization\uc774 \uac00\ub2a5\ud569\ub2c8\ub2e4. DB Description TMSH Command Last Available Value(%) list sys db platform.diskmonitor.freelast.\\ Alert Threshold(%) list sys db platform.diskmonitor.limitalert.\\ Warning Threshold(%) list sys db platform.diskmonitor.limitwarn.\\ Monitor Interval(%) list sys db platform.diskmonitor.interval","title":"BIG-IP DB Variables"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/F5-BIG-IP-SNMP-OID/#crontab","text":"crontab -l \uba85\ub839\uc5b4\ub85c diskmonitor\uc758 \uc8fc\uae30\uc801\uc778 \ub3d9\uc791\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub9e4 10\ubd84\ub9c8\ub2e4 \ub3d9\uc791\uc774 \uae30\ubcf8\uac12 \uc785\ub2c8\ub2e4.(11.5.x and later) MAILTO=\"\" 1-59/10 * * * * /usr/bin/diskmonitor 0 */4 * * * /usr/bin/diskwearoutstat \u2026 \u2026","title":"Crontab"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/F5-BIG-IP-SNMP-OID/#action-log","text":"Diskmonitor Utility\ub294 Threshold\ub97c \ub118\uc73c\uba74 \ub85c\uadf8 \ud30c\uc77c /var/log/ltm\uc5d0 \uc544\ub798\uc640 \uc720\uc0ac\ud55c \ub85c\uadf8\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4. diskmonitor: 011d005: Disk partition shared has less than 30% free diskmonitor: 011d004: Disk partition shared has only 0% free","title":"Action - Log"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/F5-BIG-IP-SNMP-OID/#action-snmp-trap","text":"\uc0dd\uc131\ub418\ub294 SNMP Trap\uc740 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. (Trap\uc740 \ud3c9\uc18c\uc5d0 \uac12\uc774 \uc870\ud68c\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.) \u2018F5-BIGIP-COMMON-MIB::\u2019\uac00 \uc0dd\ub7b5\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. Alert Name Object name OID BIGIP_DMON_ERR_DMON_ALERT bigipDiskPartitionWarn .1.3.6.1.4.1.3375.2.4.0.25 BIGIP_DMON_ERR_DMON_WARN bigipDiskPartitionWarn .1.3.6.1.4.1.3375.2.4.0.25 BIGIP_DMON_ERR_DMON_GROWTH bigipDiskPartitionGrowth .1.3.6.1.4.1.3375.2.4.0.26 \ub2e4\uc74c \uba85\ub839\uc5b4\ub85c Default Trap \uc124\uc815\uc744 \uc870\ud68c\ud574\ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4. #cat /etc/alertd/alert.conf | grep -i diskmonitor -A 10 \uba85\ub839\uc5b4\uc758 \uacb0\uacfc\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. * from diskmonitor (CR38227) * ALERT and WARN send the same trap */ alert BIGIP_DMON_ERR_DMON_ALERT { snmptrap OID=\".1.3.6.1.4.1.3375.2.4.0.25\" } alert BIGIP_DMON_ERR_DMON_WARN { snmptrap OID=\".1.3.6.1.4.1.3375.2.4.0.25\" } alert BIGIP_DMON_ERR_DMON_GROWTH { snmptrap OID=\".1.3.6.1.4.1.3375.2.4.0.26\" Diskmonitor\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \uc544\ub798 \ubb38\uc11c\uc5d0\uc11c \ud655\uc778\ud558\uc2e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. K8865: Overview of the diskmonitor utility","title":"Action \u2013 SNMP Trap"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/F5-BIG-IP-SNMP-OID/#throughput","text":"# SNMP\ub85c \uc870\ud68c \uac00\ub2a5\ud55c Thoughput Response\ub294 \ud569\uc0b0 \uac12\uc785\ub2c8\ub2e4. # Current \ub4f1 Dashboard \ubc0f Tmsh\uc5d0\uc11c \uc218\uce58\ub97c \ud45c\ud604\ud560 \ub54c\ub294 \uc774\ub4e4\uc758 Delta \uac12\uacfc \uacc4\uc0b0\uc2dd\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. # \ubcf8 \ubb38\uc11c\uc5d0\ub294 SNMP OID \uac12\uacfc \uacc4\uc0b0\uc2dd\uc744 \ud45c\uae30\ud569\ub2c8\ub2e4. - \ubb38\uc11c \uac00\ub3c5\uc131\uc744 \uc704\ud574 SSL Transaction (Accel.) \ud56d\ubaa9\uc740 \uc81c\uc678\ud569\ub2c8\ub2e4.","title":"Throughput"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/F5-BIG-IP-SNMP-OID/#_1","text":"\uc790\uc138\ud55c \uc124\uba85\uc740 \uc544\ub798 \ubb38\uc11c\ub97c \ucc38\uc870\ud558\uc2dc\uba74 \uc88b\uc2b5\ub2c8\ub2e4. K50309321: Viewing BIG-IP system throughput statistics \ud56d\ubaa9\uac12 \uc124\uba85 Thoughput Management \uc778\ud130\ud398\uc774\uc2a4\ub97c \uc81c\uc678\ud558\uace0, TMM, PVA \uc2a4\uc704\uce58\ubcf4\ub4dc\ub97c \ube44\ub86f\ud55c BIG-IP Device\uc758 \ubaa8\ub4e0 \uc778\ud130\ud398\uc774\uc2a4\uc5d0\uc11c \uc218\uc9d1\ud55c Throughput \ud569\uc0b0 \uac12\uc785\ub2c8\ub2e4. (Dashboard\uc5d0\uc11c\ub294 Management Interface Traffic\uae4c\uc9c0 \ud3ec\ud568\ub41c\ub2e4\uace0 \ud569\ub2c8\ub2e4.) In: Client-side in/out \ud2b8\ub798\ud53d \ud569\uacc4 Out: Server-side in/out \ud2b8\ub798\ud53d \ud569\uacc4 Service: Request(Client-side in + Server-side Out), Response(Service-side in + Client-side Out) \uac12 \uc911 \ud070 \uac12\uc785\ub2c8\ub2e4. | TMM Client-side Throughput [Detail] | Client-side\uc758 TMM, PVA\uc5d0 \uc758\ud574 \ucc98\ub9ac\ub41c \ud569\uacc4 throughput\uc785\ub2c8\ub2e4. Client in: \uc720\uc785(Ingress) \ud2b8\ub798\ud53d \ud569\uacc4 Client out: \uc720\ucd9c(Egress) \ud2b8\ub798\ud53d \ud569\uacc4 | | TMM Server-side Throughput [Detail] | Server-side\uc758 TMM, PVA\uc5d0 \uc758\ud574 \ucc98\ub9ac\ub41c \ud569\uacc4 throughput\uc785\ub2c8\ub2e4. Server in: \uc720\uc785(Ingress) \ud2b8\ub798\ud53d \ud569\uacc4 Server out: \uc720\ucd9c(Egress) \ud2b8\ub798\ud53d \ud569\uacc4 |","title":"\uc6a9\uc5b4 \uc124\uba85"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/F5-BIG-IP-SNMP-OID/#snmp-oid_2","text":"# Object Name \uc55e\uc5d0 \u2018F5-BIGIP-SYSTEM-MIB::\u2019\uac00 \uc0dd\ub7b5\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. # Object name \ub9c8\uc9c0\ub9c9\uc758 5s\ub294 Polling Interval, Average\ub97c \uc758\ubbf8\ud569\ub2c8\ub2e4. 5s, 1m, 5m\ub85c \uad6c\ubd84\ub429\ub2c8\ub2e4. \uc774 \ud45c\uc5d0\uc11c\ub294 5s\ub9cc \uc791\uc131\ud569\ub2c8\ub2e4. # Object Name\uc758 sysStat \ub4a4\uc5d0 Pva\ub97c \ucd94\uac00\ud558\uba74 PVA \ud2b8\ub798\ud53d\uc744 \ubcc4\ub3c4 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \\<\uc608\uc2dc> sysStatClientBytesIn.0 => sysStatPvaClientBytesIn.0 Statistics Group Object Name OID Throughput Client In sysStatClientBytesIn.0 .1.3.6.1.4.1.3375.2.1.1.2.1.3.0 sysStatClientPktsIn.0 .1.3.6.1.4.1.3375.2.1.1.2.1.2.0 sysStatClientBytesIn5s.0 .1.3.6.1.4.1.3375.2.1.1.2.1.60.0 sysStatClientPktsIn5s.0 .1.3.6.1.4.1.3375.2.1.1.2.1.59.0 Client Out sysStatClientBytesOut.0 .1.3.6.1.4.1.3375.2.1.1.2.1.5.0 sysStatClientPktsOut.0 .1.3.6.1.4.1.3375.2.1.1.2.1.4.0 sysStatClientBytesOut5s.0 .1.3.6.1.4.1.3375.2.1.1.2.1.62.0 sysStatClientPktsOut5s.0 .1.3.6.1.4.1.3375.2.1.1.2.1.61.0 Server In sysStatServerBytesIn.0 .1.3.6.1.4.1.3375.2.1.1.2.1.10.0 sysStatServerPktsIn.0 .1.3.6.1.4.1.3375.2.1.1.2.1.9.0 sysStatServerBytesIn5s.0 .1.3.6.1.4.1.3375.2.1.1.2.1.67.0 sysStatServerPktsIn5s.0 .1.3.6.1.4.1.3375.2.1.1.2.1.66.0 Server Out sysStatServerBytesOut.0 .1.3.6.1.4.1.3375.2.1.1.2.1.12.0 sysStatServerPktsOut.0 .1.3.6.1.4.1.3375.2.1.1.2.1.11.0 sysStatServerBytesOut5s.0 .1.3.6.1.4.1.3375.2.1.1.2.1.69.0 sysStatServerPktsOut5s.0 .1.3.6.1.4.1.3375.2.1.1.2.1.68.0","title":"SNMP OID"},{"location":"F5-BIG-IP/BIG-IP-%EC%9D%BC%EB%B0%98/F5-BIG-IP-SNMP-OID/#calculation","text":"\uac01 \uacc4\uc0b0\uc2dd\uc758 Polling Interval\uc740 10s\uac00 \uae30\ubcf8\uac12\uc785\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \\ \uac12\uc744 \ucd94\ucd9c\ud558\ub824\uba74 OID sysStatServerBytesIn\uc5d0 \ub300\ud574 10\ucd08 \uac04\uaca9\uc73c\ub85c \ub450 \ubc88\uc758 \uc870\ud68c\uac00 \ud544\uc694\ud569\ub2c8\ub2e4. Statistic Group \uacc4\uc0b0\uc2dd Throughput In ( [DeltaStatClientBytesIn] + [DeltasysStatClientBytesOut] ) *8 / [interval] Out ( [DeltaStatServerBytesIn] + [DeltaStatServerBytesOut] )* 8 / [interval] TMM Client-side Throughput Client Bits In ( [DeltaStatClientBytesIn] *8 ) / [interval] Client Bits Out ( [DeltaStatClientBytesOut]* 8 ) / [interval] TMM Server-side Throughput Server Bits In ( [DeltaStatServerBytesIn] *8 ) / [interval] Server Bits Out ( [DeltaStatServerBytesOut]* 8 ) / [interval] New Connections Summary Client Accepts [DeltaTcpStatAccept] / [interval] Server Connects [DeltaStatServerTotConns] /[interval] Total New Connections Client Connects [DeltaStatClientTotConns] / [interval] Server Connects [DeltaStatServerTotConns] / [interval] New Accepts / Connects Client Accepts [DeltaTcpStatAccepts] / [interval] Server Connects [DeltaTcpStatConnects] / [interval]","title":"Calculation"},{"location":"K3s/00-Lightweight-Kubernetes-compare/","text":"Lightweight Kubernetes Distribution \u00b6 K3S \u00b6 Rancher Labs\uc758 Rancher Project\ub85c \uc2dc\uc791\ud55c K3S\ub294, 2020\ub144 SUSE\uc5d0 \uc778\uc218\ub418\uace0, SUSE\ub294 \uac19\uc740 \ud574 Linux Foundation\uc5d0 K3S \ud504\ub85c\uc81d\ud2b8\ub97c \uae30\ubd80\ud574 K3S\uac00 Opensource\ub85c \uc720\uc9c0\ub418\ub3c4\ub85d \ud558\uaca0\ub2e4\ub294 \uc57d\uc18d\uc744 \uc9c0\ucf30\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \uc5f0\uc720\ub85c K3S\ub294 \uacf5\uc2dd CNCF Sandbox Project\uac00 \ub418\uc5b4 \uac1c\ubc1c/\uc720\uc9c0\ub418\uace0 \uc788\uc2b5\ub2c8\ub2e4. K3S\ub294 IoT, Edge Computing \ub4f1\uc744 \ubaa9\uc801\uc73c\ub85c \ud558\ub294 \ucd08\uacbd\ub7c9\uc758 Kubernetes \ubc30\ud3ec\ud310\uc785\ub2c8\ub2e4. MicroK8S \u00b6 Ubuntu Linux\ub97c \uac1c\ubc1c\ud558\ub294 Canonical\uc758 Kubernetes\ud300\uc5d0 \uc758\ud574 \uac1c\ubc1c\ub41c MicroK8s\ub294 Ubuntu\uc758 Snaps\ub97c \ud1b5\ud574 \uac04\ud3b8\ud558\uac8c \uc124\uce58\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. LXD, juju \ub4f1\uacfc \ud568\uaed8 Canonical\uc758 \ud074\ub77c\uc6b0\uc2a4 \uc0dd\ud0dc\uacc4\ub97c \uafb8\ub824\uac00\uace0 \uc788\uc2b5\ub2c8\ub2e4. MiniKube \u00b6 Kubernetes \uacf5\uc2dd \ud648\ud398\uc774\uc9c0 Tutorial\uc5d0\ub3c4 \ub4f1\uc7a5\ud558\ub294 Minikube\ub294 Kubernetes SIG(Special Interested Group)\uc758 \uac1c\ubc1c\ub85c \ub9cc\ub4e4\uc5b4\uc9c4 \ucd5c\ucd08\uc758 \uacbd\ub7c9 Kubernetes\uc785\ub2c8\ub2e4. (2016\ub144\uc5d0 \ucd5c\ucd08 Release) \uac1c\uc778\uc801\uc73c\ub85c minikube\ub294 \uacf5\ubd80 \ubc0f \ud14c\uc2a4\ud2b8 \ubaa9\uc801\uc758 Kubernetes\ub77c\ub294 \uc774\ubbf8\uc9c0\uac00 \uac15\ud558\uace0, \uc2e4\uc81c\ub85c minikube\uc758 \ubaa9\uc801\uc774 Local Kubernetes \uc571 \uac1c\ubc1c \ud658\uacbd \uad6c\uc131 \ubc0f Kubernetes\uc758 \ubaa8\ub4e0 \uae30\ub2a5 \uc9c0\uc6d0\uc774\ub77c\uace0 \ubc1d\ud78c \ubc14 \uc788\uc2b5\ub2c8\ub2e4. K0S \u00b6 Docker enterprise business\ub97c \uc778\uc218\ud55c Mirantis\uc5d0\uc11c \ub9cc\ub4e0 \ucd08\uacbd\ub7c9 \ubc30\ud3ec\ud310\uc785\ub2c8\ub2e4. K3s\uc640 \uc885\uc885 \ube44\uad50\ub418\ub294\ub370, K3s\uc5d0 \ube44\ud574 \ub354 \uacbd\ub7c9\ud654\ub418\uc5c8\ub2e4\uace0 \ud558\uae34 \uc5b4\ub824\uc6cc \ubcf4\uc785\ub2c8\ub2e4. Compare Lightweight Kubernetes Distros \u00b6 K3S MicroK8S Minikube K0S CPU 1 2 2 1 RAM 0.5 GB 2 GB 1 GB 1 GB CNI Flannel Calico, Cilium Calico, Cilium, Flannel kube-router, Calico CRI containerd, CRI-O containerd, kata containerd, CRI-O containerd K3s\ub97c \uc120\ud0dd\ud55c \uc774\uc720 \u00b6 \uc77c\ubc18\uc801\uc778 \uacbd\ub7c9 Kubernetes Distro\uc758 \uc0ac\uc6a9 \ubaa9\uc801, \ub9ac\uc18c\uc2a4 \uc81c\uc57d, \ud3b8\uc758\uc131(\uce5c\ubc00\ub3c4)\ub97c \uae30\uc900\uc73c\ub85c \uc120\ud0dd\ud558\uac8c \ub429\ub2c8\ub2e4. Kubernetes \uae30\ubc18\uc73c\ub85c Home Server\ub97c \uad6c\ud604\ud560 \ub9ac\uc18c\uc2a4\uac00 \ub178\ud2b8\ubd81\uc774\ub77c \uc5c5\uadf8\ub808\uc774\ub4dc\uac00 \uc27d\uc9c0 \uc54a\uace0, \uc2ec\uc9c0\uc5b4 \uad6c\ud615\uc774\uae30 \ub54c\ubb38\uc5d0 RAM \ud655\uc7a5\uc774 \uc808\ub300 \ubd88\uac00\ub2a5\ud560 \uac83\uc73c\ub85c \uc0dd\uac01\ub418\uc5b4 \ub9ac\uc18c\uc2a4 \uc81c\uc57d\uc744 \uae30\uc900\uc73c\ub85c K3s\ub97c \uc120\ud0dd\ud588\uc2b5\ub2c8\ub2e4.","title":"Overview Lightweight Kubernetes"},{"location":"K3s/00-Lightweight-Kubernetes-compare/#lightweight-kubernetes-distribution","text":"","title":"Lightweight Kubernetes Distribution"},{"location":"K3s/00-Lightweight-Kubernetes-compare/#k3s","text":"Rancher Labs\uc758 Rancher Project\ub85c \uc2dc\uc791\ud55c K3S\ub294, 2020\ub144 SUSE\uc5d0 \uc778\uc218\ub418\uace0, SUSE\ub294 \uac19\uc740 \ud574 Linux Foundation\uc5d0 K3S \ud504\ub85c\uc81d\ud2b8\ub97c \uae30\ubd80\ud574 K3S\uac00 Opensource\ub85c \uc720\uc9c0\ub418\ub3c4\ub85d \ud558\uaca0\ub2e4\ub294 \uc57d\uc18d\uc744 \uc9c0\ucf30\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \uc5f0\uc720\ub85c K3S\ub294 \uacf5\uc2dd CNCF Sandbox Project\uac00 \ub418\uc5b4 \uac1c\ubc1c/\uc720\uc9c0\ub418\uace0 \uc788\uc2b5\ub2c8\ub2e4. K3S\ub294 IoT, Edge Computing \ub4f1\uc744 \ubaa9\uc801\uc73c\ub85c \ud558\ub294 \ucd08\uacbd\ub7c9\uc758 Kubernetes \ubc30\ud3ec\ud310\uc785\ub2c8\ub2e4.","title":"K3S"},{"location":"K3s/00-Lightweight-Kubernetes-compare/#microk8s","text":"Ubuntu Linux\ub97c \uac1c\ubc1c\ud558\ub294 Canonical\uc758 Kubernetes\ud300\uc5d0 \uc758\ud574 \uac1c\ubc1c\ub41c MicroK8s\ub294 Ubuntu\uc758 Snaps\ub97c \ud1b5\ud574 \uac04\ud3b8\ud558\uac8c \uc124\uce58\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. LXD, juju \ub4f1\uacfc \ud568\uaed8 Canonical\uc758 \ud074\ub77c\uc6b0\uc2a4 \uc0dd\ud0dc\uacc4\ub97c \uafb8\ub824\uac00\uace0 \uc788\uc2b5\ub2c8\ub2e4.","title":"MicroK8S"},{"location":"K3s/00-Lightweight-Kubernetes-compare/#minikube","text":"Kubernetes \uacf5\uc2dd \ud648\ud398\uc774\uc9c0 Tutorial\uc5d0\ub3c4 \ub4f1\uc7a5\ud558\ub294 Minikube\ub294 Kubernetes SIG(Special Interested Group)\uc758 \uac1c\ubc1c\ub85c \ub9cc\ub4e4\uc5b4\uc9c4 \ucd5c\ucd08\uc758 \uacbd\ub7c9 Kubernetes\uc785\ub2c8\ub2e4. (2016\ub144\uc5d0 \ucd5c\ucd08 Release) \uac1c\uc778\uc801\uc73c\ub85c minikube\ub294 \uacf5\ubd80 \ubc0f \ud14c\uc2a4\ud2b8 \ubaa9\uc801\uc758 Kubernetes\ub77c\ub294 \uc774\ubbf8\uc9c0\uac00 \uac15\ud558\uace0, \uc2e4\uc81c\ub85c minikube\uc758 \ubaa9\uc801\uc774 Local Kubernetes \uc571 \uac1c\ubc1c \ud658\uacbd \uad6c\uc131 \ubc0f Kubernetes\uc758 \ubaa8\ub4e0 \uae30\ub2a5 \uc9c0\uc6d0\uc774\ub77c\uace0 \ubc1d\ud78c \ubc14 \uc788\uc2b5\ub2c8\ub2e4.","title":"MiniKube"},{"location":"K3s/00-Lightweight-Kubernetes-compare/#k0s","text":"Docker enterprise business\ub97c \uc778\uc218\ud55c Mirantis\uc5d0\uc11c \ub9cc\ub4e0 \ucd08\uacbd\ub7c9 \ubc30\ud3ec\ud310\uc785\ub2c8\ub2e4. K3s\uc640 \uc885\uc885 \ube44\uad50\ub418\ub294\ub370, K3s\uc5d0 \ube44\ud574 \ub354 \uacbd\ub7c9\ud654\ub418\uc5c8\ub2e4\uace0 \ud558\uae34 \uc5b4\ub824\uc6cc \ubcf4\uc785\ub2c8\ub2e4.","title":"K0S"},{"location":"K3s/00-Lightweight-Kubernetes-compare/#compare-lightweight-kubernetes-distros","text":"K3S MicroK8S Minikube K0S CPU 1 2 2 1 RAM 0.5 GB 2 GB 1 GB 1 GB CNI Flannel Calico, Cilium Calico, Cilium, Flannel kube-router, Calico CRI containerd, CRI-O containerd, kata containerd, CRI-O containerd","title":"Compare Lightweight Kubernetes Distros"},{"location":"K3s/00-Lightweight-Kubernetes-compare/#k3s_1","text":"\uc77c\ubc18\uc801\uc778 \uacbd\ub7c9 Kubernetes Distro\uc758 \uc0ac\uc6a9 \ubaa9\uc801, \ub9ac\uc18c\uc2a4 \uc81c\uc57d, \ud3b8\uc758\uc131(\uce5c\ubc00\ub3c4)\ub97c \uae30\uc900\uc73c\ub85c \uc120\ud0dd\ud558\uac8c \ub429\ub2c8\ub2e4. Kubernetes \uae30\ubc18\uc73c\ub85c Home Server\ub97c \uad6c\ud604\ud560 \ub9ac\uc18c\uc2a4\uac00 \ub178\ud2b8\ubd81\uc774\ub77c \uc5c5\uadf8\ub808\uc774\ub4dc\uac00 \uc27d\uc9c0 \uc54a\uace0, \uc2ec\uc9c0\uc5b4 \uad6c\ud615\uc774\uae30 \ub54c\ubb38\uc5d0 RAM \ud655\uc7a5\uc774 \uc808\ub300 \ubd88\uac00\ub2a5\ud560 \uac83\uc73c\ub85c \uc0dd\uac01\ub418\uc5b4 \ub9ac\uc18c\uc2a4 \uc81c\uc57d\uc744 \uae30\uc900\uc73c\ub85c K3s\ub97c \uc120\ud0dd\ud588\uc2b5\ub2c8\ub2e4.","title":"K3s\ub97c \uc120\ud0dd\ud55c \uc774\uc720"},{"location":"K3s/01-K3S-Installation/","text":"K3S Installation Guide \u00b6 K3S\ub294 K3S \ud648\ud398\uc774\uc9c0\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 Script\ub97c \uc2e4\ud589\ud558\ub294 \ubc29\ubc95\uc73c\ub85c \uac04\ub2e8\ud558\uac8c \uad6c\ucd95\uc774 \uc644\ub8cc\ub429\ub2c8\ub2e4. \ub2e4\ub9cc, \uc774 Script\ub97c \ud1b5\ud574 \uc124\uce58\ub97c \uc218\ud589\ud558\uba74, \uc790\ub3d9\uc73c\ub85c Flannel CNI\ub97c \uc0ac\uc6a9\ud558\uac70\ub098, Ingress Controller\ub85c Traefik\uc774 \uc124\uce58 \ub418\ub294 \ub4f1, \uc775\uc219\ud558\uc9c0 \uc54a\uc740 Default Option\uc774 \uc124\uc815\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uadf8\ub798\uc11c Default Option\uc744 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0, \uc544\ub798\uc640 \uac19\uc774 \ubcc0\uacbd\ud558\uc5ec \uc124\uce58\ud558\ub824\uace0 \ud569\ub2c8\ub2e4. Use Docker as CRI Disable Flannel CNI / Configure Calico CNI Disable Traefik Ingress Controller \ud3b8\uc758\ub97c \uc704\ud574 \uc544\ub798 \uc11c\ube44\uc2a4\ub97c \uc124\uce58 \ucd94\uac00\ub85c \uc124\uce58\ud569\ub2c8\ub2e4. Cert-manager (Let's Encrypt - \ubb34\ub8cc SSL Cert \ubc1c\uae09) NGINX Ingress Controller K3s Installation with docker \u00b6 \uc0ac\uc804 \uc791\uc5c5 \u00b6 SVRNAME=\"itian.ddaong.ga\" sudo hostnamectl set-hostname ${SVRNAME} Docker, K3S \uc124\uce58 + Calico CNI \u00b6 # Install Docker 19.03 for k3s curl https://releases.rancher.com/install-docker/19.03.sh | sh sudo usermod -aG docker root ### K3s Install # rootless / no CNI / cidr \ubcc0\uacbd / no Traefik / Use Docker curl -sfL https://get.k3s.io | K3S_KUBECONFIG_MODE=\"644\" INSTALL_K3S_EXEC=\"--flannel-backend=none --disable-network-policy --cluster-cidr='10.10.0.0/16' --service-cidr='10.20.0.0/16' --disable=traefik --docker\" sh - # Calico CNI Install curl -O https://raw.githubusercontent.com/projectcalico/calico/master/manifests/calico.yaml ## Modify POD IPV4 POOL CIDR sed -i 's/\\#\\ \\-\\ name\\:\\ CALICO_IPV4POOL_CIDR/\\-\\ name\\:\\ CALICO_IPV4POOL_CIDR/g' calico.yaml sed -i 's/\\#\\ \\ \\ value\\:\\ \\\"192.168.0.0\\/16\\\"/\\ \\ value\\:\\ \\\"10.10.0.0\\/16\\\"/g' ## Enable IP Forwarding to avoid Klipper SVCLB CrashLoopback Error addlinehere=$(grep -En '\\\"policy\\\"\\:\\ \\{' calico.yaml | cut -d ':' -f 1) sed -i \"${addlinehere}i \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\\"container_settings\\\"\\: \\{\\\"allow_ip_forwarding\\\"\\:\\ true\\}\\,\" calico.yaml kubectl apply -f calico.yaml \uc124\uce58 \uc2a4\ud06c\ub9bd\ud2b8\uc758 --cluster-cidr='10.10.0.0/16' \uc635\uc158\uc740 Flannel CNI\uc5d0 \uc801\uc6a9\ub418\ub294 \ubd80\ubd84\uc73c\ub85c, \uc774\uac83\ub9cc\uc73c\ub85c\ub294 \ud6a8\uacfc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4. Calico\ub97c \uc0ac\uc6a9\ud558\ub294 \ud658\uacbd\uc5d0\uc11c\ub294 Calico YAML \ud30c\uc77c\uc5d0\uc11c \uc635\uc158\uc744 \uc218\uc815\ud574 \uc918\uc57c \ud569\ub2c8\ub2e4. LoadBalancer Type Service\ub97c \uc124\uc815\ud558\uac8c \ub418\uba74 Klipper \uc11c\ube44\uc2a4\uc5d0\uc11c\ub3c4 \uc544\ub798\uc758 \ub85c\uadf8\uc640 \ud568\uaed8 CrashLoopback Error\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. + cat /proc/sys/net/ipv4/ip_forward + '[' 1 '!=' 1 ] \uc544\ub798 \ub77c\uc778\uc744 calico.yaml \ub0b4\uc5d0 \ubbf8\ub9ac \ucd94\uac00\ud574\uc8fc\ub294 \ubc29\ubc95\uc73c\ub85c \uc5d0\ub7ec\ub97c \ud574\uc18c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \"container_settings\": {\"allow_ip_forwarding\": true}, Add-on \u00b6 # kubectl Bash Auto-Completion yum -y install bash-completion apt -y install bash-completion source <(kubectl completion bash) echo \"source <(kubectl completion bash)\" >> ~/.bashrc NGINX Ingress Controller \u00b6 NGINX Ingress Controller curl -O https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.3.0/deploy/static/provider/cloud/deploy.yaml mv deploy.yaml nginx-ingress-deploy.yaml kubectl apply -f nginx-ingress-deploy.yaml Cert Manager Installation \u00b6 Cert-Manager \ub294 Ingress Resource\uc758 Annotation\uc744 \ud655\uc778\ud574 \uc778\uc99d\uacfc\uc815\uc744 \uc790\ub3d9\uc73c\ub85c \uc218\ud589\ud569\ub2c8\ub2e4. \uc0d8\ud50c Yaml \ud30c\uc77c\uc744 \uc124\uce58 \uacfc\uc815 \uc544\ub798 \ucca8\ubd80\ud569\ub2c8\ub2e4. curl -LO https://github.com/cert-manager/cert-manager/releases/download/v1.9.1/cert-manager.yaml curl -LO https://github.com/cert-manager/cert-manager/releases/download/v1.9.1/cert-manager.crds.yaml kubectl apply -f cert-manager.yaml kubectl apply -f cert-manager.crds.yaml cat <<EOF > cert-manager-issuer.yaml apiVersion: cert-manager.io/v1 kind: Issuer metadata: name: letsencrypt-staging spec: acme: # The ACME server URL server: https://acme-staging-v02.api.letsencrypt.org/directory # Email address used for ACME registration email: <EMAIL-ADDRESS> # Name of a secret used to store the ACME account private key privateKeySecretRef: name: letsencrypt-staging # Enable the HTTP-01 challenge provider solvers: - http01: ingress: class: nginx --- apiVersion: cert-manager.io/v1 kind: Issuer metadata: name: letsencrypt-prod spec: acme: # The ACME server URL server: https://acme-v02.api.letsencrypt.org/directory # Email address used for ACME registration email: <EMAIL-ADDRESS> # Name of a secret used to store the ACME account private key privateKeySecretRef: name: letsencrypt-prod # Enable the HTTP-01 challenge provider solvers: - http01: ingress: class: nginx EOF kubectl apply -f cert-manager-issuer.yaml \uc544\ub798 Ingress Sample YAML\uc744 \ucc38\uc870\ud558\uc5ec Ingress\ub97c \ucd94\uac00\ud558\uba74 \ud3b8\ub9ac\ud569\ub2c8\ub2e4. Annotation \uc911 cert-manager.io/cluster-issuer \uac12\uc774 letsencrypt-staging\uc774\uba74 \uc778\uc99d \uacfc\uc815\uc5c6\uc774 Fake \uc778\uc99d\uc11c\ub97c \uc0dd\uc131\ud574\uc8fc\uace0, letsencrypt-staging\uc774\uba74 \uc778\uc99d \uacfc\uc815\uc744 \uac70\uccd0 \uc815\uc2dd\uc778\uc99d\uc11c\ub97c \ubc1c\uae09\ud574\uc90d\ub2c8\ub2e4. apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: <INGRESS-NAME> annotations: cert-manager.io/cluster-issuer: \"letsencrypt-prod\" #cert-manager.io/cluster-issuer: \"letsencrypt-staging\" nginx.ingress.kubernetes.io/backend-protocol: HTTP nginx.ingress.kubernetes.io/ssl-redirect: \"true\" spec: ingressClassName: nginx tls: - hosts: - <HOSTNAME> secretName: <SECRET-NAME-TOBE-CREATED>tls-prod rules: - host: <HOSTNAME> http: paths: - path: / pathType: Prefix backend: service: name: <SERVICE-NAME> port: number: 80","title":"K3S Installation for SingleNode Cluster Guide"},{"location":"K3s/01-K3S-Installation/#k3s-installation-guide","text":"K3S\ub294 K3S \ud648\ud398\uc774\uc9c0\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 Script\ub97c \uc2e4\ud589\ud558\ub294 \ubc29\ubc95\uc73c\ub85c \uac04\ub2e8\ud558\uac8c \uad6c\ucd95\uc774 \uc644\ub8cc\ub429\ub2c8\ub2e4. \ub2e4\ub9cc, \uc774 Script\ub97c \ud1b5\ud574 \uc124\uce58\ub97c \uc218\ud589\ud558\uba74, \uc790\ub3d9\uc73c\ub85c Flannel CNI\ub97c \uc0ac\uc6a9\ud558\uac70\ub098, Ingress Controller\ub85c Traefik\uc774 \uc124\uce58 \ub418\ub294 \ub4f1, \uc775\uc219\ud558\uc9c0 \uc54a\uc740 Default Option\uc774 \uc124\uc815\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uadf8\ub798\uc11c Default Option\uc744 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0, \uc544\ub798\uc640 \uac19\uc774 \ubcc0\uacbd\ud558\uc5ec \uc124\uce58\ud558\ub824\uace0 \ud569\ub2c8\ub2e4. Use Docker as CRI Disable Flannel CNI / Configure Calico CNI Disable Traefik Ingress Controller \ud3b8\uc758\ub97c \uc704\ud574 \uc544\ub798 \uc11c\ube44\uc2a4\ub97c \uc124\uce58 \ucd94\uac00\ub85c \uc124\uce58\ud569\ub2c8\ub2e4. Cert-manager (Let's Encrypt - \ubb34\ub8cc SSL Cert \ubc1c\uae09) NGINX Ingress Controller","title":"K3S Installation Guide"},{"location":"K3s/01-K3S-Installation/#k3s-installation-with-docker","text":"","title":"K3s Installation with docker"},{"location":"K3s/01-K3S-Installation/#_1","text":"SVRNAME=\"itian.ddaong.ga\" sudo hostnamectl set-hostname ${SVRNAME}","title":"\uc0ac\uc804 \uc791\uc5c5"},{"location":"K3s/01-K3S-Installation/#docker-k3s-calico-cni","text":"# Install Docker 19.03 for k3s curl https://releases.rancher.com/install-docker/19.03.sh | sh sudo usermod -aG docker root ### K3s Install # rootless / no CNI / cidr \ubcc0\uacbd / no Traefik / Use Docker curl -sfL https://get.k3s.io | K3S_KUBECONFIG_MODE=\"644\" INSTALL_K3S_EXEC=\"--flannel-backend=none --disable-network-policy --cluster-cidr='10.10.0.0/16' --service-cidr='10.20.0.0/16' --disable=traefik --docker\" sh - # Calico CNI Install curl -O https://raw.githubusercontent.com/projectcalico/calico/master/manifests/calico.yaml ## Modify POD IPV4 POOL CIDR sed -i 's/\\#\\ \\-\\ name\\:\\ CALICO_IPV4POOL_CIDR/\\-\\ name\\:\\ CALICO_IPV4POOL_CIDR/g' calico.yaml sed -i 's/\\#\\ \\ \\ value\\:\\ \\\"192.168.0.0\\/16\\\"/\\ \\ value\\:\\ \\\"10.10.0.0\\/16\\\"/g' ## Enable IP Forwarding to avoid Klipper SVCLB CrashLoopback Error addlinehere=$(grep -En '\\\"policy\\\"\\:\\ \\{' calico.yaml | cut -d ':' -f 1) sed -i \"${addlinehere}i \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\\"container_settings\\\"\\: \\{\\\"allow_ip_forwarding\\\"\\:\\ true\\}\\,\" calico.yaml kubectl apply -f calico.yaml \uc124\uce58 \uc2a4\ud06c\ub9bd\ud2b8\uc758 --cluster-cidr='10.10.0.0/16' \uc635\uc158\uc740 Flannel CNI\uc5d0 \uc801\uc6a9\ub418\ub294 \ubd80\ubd84\uc73c\ub85c, \uc774\uac83\ub9cc\uc73c\ub85c\ub294 \ud6a8\uacfc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4. Calico\ub97c \uc0ac\uc6a9\ud558\ub294 \ud658\uacbd\uc5d0\uc11c\ub294 Calico YAML \ud30c\uc77c\uc5d0\uc11c \uc635\uc158\uc744 \uc218\uc815\ud574 \uc918\uc57c \ud569\ub2c8\ub2e4. LoadBalancer Type Service\ub97c \uc124\uc815\ud558\uac8c \ub418\uba74 Klipper \uc11c\ube44\uc2a4\uc5d0\uc11c\ub3c4 \uc544\ub798\uc758 \ub85c\uadf8\uc640 \ud568\uaed8 CrashLoopback Error\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. + cat /proc/sys/net/ipv4/ip_forward + '[' 1 '!=' 1 ] \uc544\ub798 \ub77c\uc778\uc744 calico.yaml \ub0b4\uc5d0 \ubbf8\ub9ac \ucd94\uac00\ud574\uc8fc\ub294 \ubc29\ubc95\uc73c\ub85c \uc5d0\ub7ec\ub97c \ud574\uc18c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \"container_settings\": {\"allow_ip_forwarding\": true},","title":"Docker, K3S \uc124\uce58 + Calico CNI"},{"location":"K3s/01-K3S-Installation/#add-on","text":"# kubectl Bash Auto-Completion yum -y install bash-completion apt -y install bash-completion source <(kubectl completion bash) echo \"source <(kubectl completion bash)\" >> ~/.bashrc","title":"Add-on"},{"location":"K3s/01-K3S-Installation/#nginx-ingress-controller","text":"NGINX Ingress Controller curl -O https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.3.0/deploy/static/provider/cloud/deploy.yaml mv deploy.yaml nginx-ingress-deploy.yaml kubectl apply -f nginx-ingress-deploy.yaml","title":"NGINX Ingress Controller"},{"location":"K3s/01-K3S-Installation/#cert-manager-installation","text":"Cert-Manager \ub294 Ingress Resource\uc758 Annotation\uc744 \ud655\uc778\ud574 \uc778\uc99d\uacfc\uc815\uc744 \uc790\ub3d9\uc73c\ub85c \uc218\ud589\ud569\ub2c8\ub2e4. \uc0d8\ud50c Yaml \ud30c\uc77c\uc744 \uc124\uce58 \uacfc\uc815 \uc544\ub798 \ucca8\ubd80\ud569\ub2c8\ub2e4. curl -LO https://github.com/cert-manager/cert-manager/releases/download/v1.9.1/cert-manager.yaml curl -LO https://github.com/cert-manager/cert-manager/releases/download/v1.9.1/cert-manager.crds.yaml kubectl apply -f cert-manager.yaml kubectl apply -f cert-manager.crds.yaml cat <<EOF > cert-manager-issuer.yaml apiVersion: cert-manager.io/v1 kind: Issuer metadata: name: letsencrypt-staging spec: acme: # The ACME server URL server: https://acme-staging-v02.api.letsencrypt.org/directory # Email address used for ACME registration email: <EMAIL-ADDRESS> # Name of a secret used to store the ACME account private key privateKeySecretRef: name: letsencrypt-staging # Enable the HTTP-01 challenge provider solvers: - http01: ingress: class: nginx --- apiVersion: cert-manager.io/v1 kind: Issuer metadata: name: letsencrypt-prod spec: acme: # The ACME server URL server: https://acme-v02.api.letsencrypt.org/directory # Email address used for ACME registration email: <EMAIL-ADDRESS> # Name of a secret used to store the ACME account private key privateKeySecretRef: name: letsencrypt-prod # Enable the HTTP-01 challenge provider solvers: - http01: ingress: class: nginx EOF kubectl apply -f cert-manager-issuer.yaml \uc544\ub798 Ingress Sample YAML\uc744 \ucc38\uc870\ud558\uc5ec Ingress\ub97c \ucd94\uac00\ud558\uba74 \ud3b8\ub9ac\ud569\ub2c8\ub2e4. Annotation \uc911 cert-manager.io/cluster-issuer \uac12\uc774 letsencrypt-staging\uc774\uba74 \uc778\uc99d \uacfc\uc815\uc5c6\uc774 Fake \uc778\uc99d\uc11c\ub97c \uc0dd\uc131\ud574\uc8fc\uace0, letsencrypt-staging\uc774\uba74 \uc778\uc99d \uacfc\uc815\uc744 \uac70\uccd0 \uc815\uc2dd\uc778\uc99d\uc11c\ub97c \ubc1c\uae09\ud574\uc90d\ub2c8\ub2e4. apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: <INGRESS-NAME> annotations: cert-manager.io/cluster-issuer: \"letsencrypt-prod\" #cert-manager.io/cluster-issuer: \"letsencrypt-staging\" nginx.ingress.kubernetes.io/backend-protocol: HTTP nginx.ingress.kubernetes.io/ssl-redirect: \"true\" spec: ingressClassName: nginx tls: - hosts: - <HOSTNAME> secretName: <SECRET-NAME-TOBE-CREATED>tls-prod rules: - host: <HOSTNAME> http: paths: - path: / pathType: Prefix backend: service: name: <SERVICE-NAME> port: number: 80","title":"Cert Manager Installation"},{"location":"K3s/UsePrivateRegistryAsKubeService-in-K3S/","text":"K3s Installation with Private Registry \u00b6 This is For Multi Node Cluster \u00b6 SVRNAME=\"itian.ddaong.ga\" sudo hostnamectl set-hostname ${SVRNAME} # Install Docker for k3s curl https://releases.rancher.com/install-docker/19.03.sh | sh sudo usermod -aG docker root # Preparation for Private Registry So K3S referring to this conf file ## Run before K3S Installation cat << EOF>/etc/rancher/k3s/registries.yaml mirrors: \"${SVRNAME}\": endpoint: - \"http://${SVRNAME}\" EOF K3S \uc124\uce58 \uc218\ud589 ### K3s Install # rootless / no CNI / Change Cluster, Service cidr / no Traefik / Use Docker curl -sfL https://get.k3s.io | K3S_KUBECONFIG_MODE=\"644\" INSTALL_K3S_EXEC=\"--flannel-backend=none --disable-network-policy --cluster-cidr=10.10.0.0/16 --service-cidr=10.20.0.0/16 --disable=traefik --docker\" sh - # kubectl \uc790\ub3d9\uc644\uc131 yum -y install bash-completion source <(kubectl completion bash) echo \"source <(kubectl completion bash)\" >> ~/.bashrc # Calico CNI Install curl -O https://raw.githubusercontent.com/projectcalico/calico/master/manifests/calico.yaml kubectl apply -f calico.yaml PRIVREGDOMAIN=\"reg.itian.ddaong.ga\" ## Private Registry on Kubernetes mkdir -p /k3s/registry/ && cd /k3s/registry/ cat <<EOF>kube-registry.yaml apiVersion: v1 kind: ReplicationController metadata: name: kube-registry-v0 namespace: kube-system labels: k8s-app: kube-registry version: v0 spec: replicas: 1 selector: k8s-app: kube-registry version: v0 template: metadata: labels: k8s-app: kube-registry version: v0 spec: containers: - name: registry image: registry:2 resources: limits: cpu: 100m memory: 200Mi env: - name: REGISTRY_HTTP_ADDR value: :5000 - name: REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY value: /var/lib/registry volumeMounts: - name: image-store mountPath: /var/lib/registry ports: - containerPort: 5000 name: registry protocol: TCP volumes: - name: image-store hostPath: path: /var/lib/registry-storage #emptyDir: {} --- apiVersion: v1 kind: Service metadata: name: kube-registry namespace: kube-system labels: k8s-app: kube-registry kubernetes.io/name: \"KubeRegistry\" spec: selector: k8s-app: kube-registry ports: - name: registry port: 5000 targetPort: 5000 protocol: TCP type: LoadBalancer --- apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: docker-registry-ingress annotations: kubernetes.io/ingress.class: \"traefik\" spec: rules: - host: ${PRIVREGDOMAIN} http: paths: - path: / backend: serviceName: docker-registry-service servicePort: 5000 --- EOF kubectl apply -f kube-registry.yaml","title":"K3s Installation with Private Registry"},{"location":"K3s/UsePrivateRegistryAsKubeService-in-K3S/#k3s-installation-with-private-registry","text":"","title":"K3s Installation with Private Registry"},{"location":"K3s/UsePrivateRegistryAsKubeService-in-K3S/#this-is-for-multi-node-cluster","text":"SVRNAME=\"itian.ddaong.ga\" sudo hostnamectl set-hostname ${SVRNAME} # Install Docker for k3s curl https://releases.rancher.com/install-docker/19.03.sh | sh sudo usermod -aG docker root # Preparation for Private Registry So K3S referring to this conf file ## Run before K3S Installation cat << EOF>/etc/rancher/k3s/registries.yaml mirrors: \"${SVRNAME}\": endpoint: - \"http://${SVRNAME}\" EOF K3S \uc124\uce58 \uc218\ud589 ### K3s Install # rootless / no CNI / Change Cluster, Service cidr / no Traefik / Use Docker curl -sfL https://get.k3s.io | K3S_KUBECONFIG_MODE=\"644\" INSTALL_K3S_EXEC=\"--flannel-backend=none --disable-network-policy --cluster-cidr=10.10.0.0/16 --service-cidr=10.20.0.0/16 --disable=traefik --docker\" sh - # kubectl \uc790\ub3d9\uc644\uc131 yum -y install bash-completion source <(kubectl completion bash) echo \"source <(kubectl completion bash)\" >> ~/.bashrc # Calico CNI Install curl -O https://raw.githubusercontent.com/projectcalico/calico/master/manifests/calico.yaml kubectl apply -f calico.yaml PRIVREGDOMAIN=\"reg.itian.ddaong.ga\" ## Private Registry on Kubernetes mkdir -p /k3s/registry/ && cd /k3s/registry/ cat <<EOF>kube-registry.yaml apiVersion: v1 kind: ReplicationController metadata: name: kube-registry-v0 namespace: kube-system labels: k8s-app: kube-registry version: v0 spec: replicas: 1 selector: k8s-app: kube-registry version: v0 template: metadata: labels: k8s-app: kube-registry version: v0 spec: containers: - name: registry image: registry:2 resources: limits: cpu: 100m memory: 200Mi env: - name: REGISTRY_HTTP_ADDR value: :5000 - name: REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY value: /var/lib/registry volumeMounts: - name: image-store mountPath: /var/lib/registry ports: - containerPort: 5000 name: registry protocol: TCP volumes: - name: image-store hostPath: path: /var/lib/registry-storage #emptyDir: {} --- apiVersion: v1 kind: Service metadata: name: kube-registry namespace: kube-system labels: k8s-app: kube-registry kubernetes.io/name: \"KubeRegistry\" spec: selector: k8s-app: kube-registry ports: - name: registry port: 5000 targetPort: 5000 protocol: TCP type: LoadBalancer --- apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: docker-registry-ingress annotations: kubernetes.io/ingress.class: \"traefik\" spec: rules: - host: ${PRIVREGDOMAIN} http: paths: - path: / backend: serviceName: docker-registry-service servicePort: 5000 --- EOF kubectl apply -f kube-registry.yaml","title":"This is For Multi Node Cluster"},{"location":"Kubernetes/Kube-kubeadm-install/","text":"Kubernetes Installation via Kubeadm - bash script for Centos7 \u00b6 CentOS \ubcf4\uc548 \uc124\uc815 \u00b6 sed -i -re 's/SELINUX=enforcing/SELINUX=permissive/g' /etc/sysconfig/selinux; sed -i -re 's/SELINUX=enforcing/SELINUX=permissive/g' /etc/selinux/config; setenforce 0; #sestatus systemctl disable firewalld; systemctl stop firewalld; #systemctl status firewalld swapoff -a && sed -i '/ swap / s/^/#/' /etc/fstab; #swapon modprobe overlay modprobe br_netfilter cat <<EOF | sudo tee /etc/modules-load.d/containerd.conf overlay br_netfilter EOF tee -a /etc/sysctl.d/k8s.conf <<EOF 1>/dev/null net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 net.ipv4.ip_forward = 1 EOF sysctl --system; CRI Containerd Install \u00b6 yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo yum -y install containerd.io ### containerd config sudo mkdir -p /etc/containerd cat > /etc/containerd/config.toml <<EOF disabled_plugins = [] imports = [] oom_score = 0 plugin_dir = \"\" required_plugins = [] root = \"/var/lib/containerd\" state = \"/run/containerd\" version = 2 EOF systemctl daemon-reload systemctl enable containerd --now Kubernetes Installation \u00b6 cat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\\$basearch enabled=1 gpgcheck=1 gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg exclude=kubelet kubeadm kubectl EOF sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes systemctl enable --now kubelet kubeadm config images pull kubeadm init --pod-network-cidr 10.224.0.0/16 Kubernetes Post-Installation \uc791\uc5c5 \u00b6 mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config yum -y install bash-completion source <(kubectl completion bash) echo \"source <(kubectl completion bash)\" >> ~/.bashrc Kubernetes CNI Calico Installation \u00b6 # Calico curl https://projectcalico.docs.tigera.io/manifests/calico.yaml -O curl https://projectcalico.docs.tigera.io/manifests/calico-etcd.yaml -o calico.yaml kubectl apply -f calico.yaml","title":"K8s Installation script for Centos7"},{"location":"Kubernetes/Kube-kubeadm-install/#kubernetes-installation-via-kubeadm-bash-script-for-centos7","text":"","title":"Kubernetes Installation via Kubeadm - bash script for Centos7"},{"location":"Kubernetes/Kube-kubeadm-install/#centos","text":"sed -i -re 's/SELINUX=enforcing/SELINUX=permissive/g' /etc/sysconfig/selinux; sed -i -re 's/SELINUX=enforcing/SELINUX=permissive/g' /etc/selinux/config; setenforce 0; #sestatus systemctl disable firewalld; systemctl stop firewalld; #systemctl status firewalld swapoff -a && sed -i '/ swap / s/^/#/' /etc/fstab; #swapon modprobe overlay modprobe br_netfilter cat <<EOF | sudo tee /etc/modules-load.d/containerd.conf overlay br_netfilter EOF tee -a /etc/sysctl.d/k8s.conf <<EOF 1>/dev/null net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 net.ipv4.ip_forward = 1 EOF sysctl --system;","title":"CentOS \ubcf4\uc548 \uc124\uc815"},{"location":"Kubernetes/Kube-kubeadm-install/#cri-containerd-install","text":"yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo yum -y install containerd.io ### containerd config sudo mkdir -p /etc/containerd cat > /etc/containerd/config.toml <<EOF disabled_plugins = [] imports = [] oom_score = 0 plugin_dir = \"\" required_plugins = [] root = \"/var/lib/containerd\" state = \"/run/containerd\" version = 2 EOF systemctl daemon-reload systemctl enable containerd --now","title":"CRI Containerd Install"},{"location":"Kubernetes/Kube-kubeadm-install/#kubernetes-installation","text":"cat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\\$basearch enabled=1 gpgcheck=1 gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg exclude=kubelet kubeadm kubectl EOF sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes systemctl enable --now kubelet kubeadm config images pull kubeadm init --pod-network-cidr 10.224.0.0/16","title":"Kubernetes Installation"},{"location":"Kubernetes/Kube-kubeadm-install/#kubernetes-post-installation","text":"mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config yum -y install bash-completion source <(kubectl completion bash) echo \"source <(kubectl completion bash)\" >> ~/.bashrc","title":"Kubernetes Post-Installation \uc791\uc5c5"},{"location":"Kubernetes/Kube-kubeadm-install/#kubernetes-cni-calico-installation","text":"# Calico curl https://projectcalico.docs.tigera.io/manifests/calico.yaml -O curl https://projectcalico.docs.tigera.io/manifests/calico-etcd.yaml -o calico.yaml kubectl apply -f calico.yaml","title":"Kubernetes CNI Calico Installation"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/","text":"NGINX Product Install Guides \u00b6 NGINX Plus \u00b6 NGINX Plus \uc124\uce58\ub294 \ud06c\uac8c License \uc5c5\ub85c\ub4dc, Repository \ub4f1\ub85d, Installation \uacfc\uc815\uc73c\ub85c \ub098\ub269\ub2c8\ub2e4. License\ub294 nginx-repo.crt , nginx-repo.key \ub97c \ub9d0\ud558\uba70, /var/tmp \uc704\uce58\uc5d0 \uc5c5\ub85c\ub4dc\ub418\uc5b4 \uc788\ub2e4\uace0 \uac00\uc815\ud569\ub2c8\ub2e4. yum(Centos, RHEL) \u00b6 License \uc5c5\ub85c\ub4dc \u00b6 sudo mkdir -p /etc/ssl/nginx && cp /var/tmp/nginx-repo.* /etc/ssl/nginx/ Repository \ub4f1\ub85d \u00b6 sudo curl -sL https://cs.nginx.com/static/files/nginx-plus-7.repo \\ -o /etc/yum.repos.d/nginx-plus-7.repo sudo yum makecache fast Installation \u00b6 sudo yum install -y nginx-plus ca-certificates sudo systemctl enable --now nginx apt-get(Ubuntu, Debian) \u00b6 License \uc5c5\ub85c\ub4dc \u00b6 sudo mkdir -p /etc/ssl/nginx && cp /var/tmp/nginx-repo.* /etc/ssl/nginx/ Repository \ub4f1\ub85d \u00b6 sudo wget https://cs.nginx.com/static/keys/nginx_signing.key sudo apt-key add nginx_signing.key sudo apt-get install apt-transport-https lsb-release ca-certificates printf \"deb https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-plus.list sudo wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx sudo apt-get update Installation \u00b6 sudo apt-get install -y nginx-plus sudo systemctl enable --now nginx NGINX Plus + App Protect \u00b6 NGINX Plus \uc124\uce58\ub294 \ud06c\uac8c License \uc5c5\ub85c\ub4dc, Repository \ub4f1\ub85d, Installation \uacfc\uc815\uc73c\ub85c \ub098\ub269\ub2c8\ub2e4. License\ub294 nginx-repo.crt , nginx-repo.key \ub97c \ub9d0\ud558\uba70, /var/tmp \uc704\uce58\uc5d0 \uc5c5\ub85c\ub4dc\ub418\uc5b4 \uc788\ub2e4\uace0 \uac00\uc815\ud569\ub2c8\ub2e4. yum(Centos 7.4+, RHEL 7.4+) \u00b6 License \uc5c5\ub85c\ub4dc \u00b6 sudo mkdir -p /etc/ssl/nginx && cp /var/tmp/nginx-repo.* /etc/ssl/nginx/ Repository \ub4f1\ub85d \u00b6 sudo yum install wget epel-release sudo curl -sL https://cs.nginx.com/static/files/nginx-plus-7.repo -o /etc/yum.repos.d/nginx-plus-7.repo sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-7.repo sudo yum makecache fast Installation \u00b6 sudo yum install -y nginx-plus ca-certificates sudo yum install -y app-protect app-protect-attack-signatures sudo systemctl enable --now nginx apt-get(Ubuntu, Debian) \u00b6 License \uc5c5\ub85c\ub4dc \u00b6 sudo mkdir -p /etc/ssl/nginx && cp /var/tmp/nginx-repo.* /etc/ssl/nginx/ Repository \ub4f1\ub85d \u00b6 sudo wget https://cs.nginx.com/static/keys/nginx_signing.key sudo apt-key add nginx_signing.key sudo wget https://cs.nginx.com/static/keys/app-protect-security-updates.key sudo apt-key add app-protect-security-updates.key sudo apt-get install apt-transport-https lsb-release ca-certificates printf \"deb https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-plus.list printf \"deb https://pkgs.nginx.com/app-protect/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-app-protect.list printf \"deb https://pkgs.nginx.com/app-protect-security-updates/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee -a /etc/apt/sources.list.d/nginx-app-protect.list sudo wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx sudo apt-get update Installation \u00b6 sudo apt-get install -y nginx-plus sudo apt-get install app-protect app-protect-attack-signatures sudo systemctl enable --now nginx NGINX Plus + App-Protect \uc801\uc6a9 \u00b6 NGINX Config File\uc5d0\uc11c \uc801\uc6a9\ud569\ub2c8\ub2e4. \uc544\ub798\ub294 nginx.conf \uc5d0\uc11c NGINX \uc804\uccb4\uc5d0 App Protect\ub97c \uc801\uc6a9\ud558\ub294 \uc608\uc2dc\uc785\ub2c8\ub2e4. Load module \u00b6 user nginx; worker_processes auto; error_log /var/log/nginx/error.log notice; pid /var/run/nginx.pid; load_module modules/ngx_http_app_protect_module.so; events { worker_connections 1024; } http { app_protect_enable on; ## App Protect Enable ## include /etc/nginx/mime.types; default_type application/octet-stream; \u2026\u2026[\ud6c4\ub7b5] Nginx Reload And App Protect Apply \u00b6 sudo nginx -t && sudo nginx -s reload App Protect \uc801\uc6a9 \uc5ec\ubd80 \ud655\uc778 \u00b6 \uc544\ub798 \uba85\ub839\uc5b4\ub85c NGINX Master/Worker \ud504\ub85c\uc138\uc2a4\uc640 App Protect\uac00 \uc0ac\uc6a9\ud558\ub294 bd_agent , bd-socket-plugin \ud504\ub85c\uc138\uc2a4\uac00 \ub3d9\uc791 \uc911\uc778\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4. sudo ps aux | grep -e \"bd_agent\" -e \"bd-socket-plugin\" -e \"nginx\" NGINX Controller \u00b6 \ubcf8 \uac00\uc774\ub4dc\uc5d0\uc11c\ub294 \uc774\uc911\ud654 \ub4f1\uc774 \uc5c6\ub294 \uc2f1\uae00 \ub178\ub4dc NGINX Controller\uc758 \uc124\uce58\ub97c \ub2e4\ub8f9\ub2c8\ub2e4. \ub2e8, Online Install\uc774 \uac00\ub2a5\ud55c \ud658\uacbd, Offline Install\uc774 \ud544\uc694\ud55c \ud658\uacbd\uc73c\ub85c \uad6c\ubd84\ud574 \uac01\uac01 \uc18c\uac1c\ud569\ub2c8\ub2e4. \uac00\uc774\ub4dc\uc5d0\uc11c\ub294 CentOS 7.4+ \ud658\uacbd\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. controller-installer-<version>.tar.gz \ud328\ud0a4\uc9c0\uc640 controller_license.txt \ub77c\uc774\uc120\uc2a4 \ud30c\uc77c\uc774 \ud544\uc694\ud558\uba70, controller-installer-<version>.tar.gz \ud30c\uc77c\uc774 /var/tmp \uc5d0 \uc5c5\ub85c\ub4dc \ub418\uc5b4\uc788\ub2e4\uace0 \uac00\uc815\ud569\ub2c8\ub2e4. Embedded Config DB\ub97c \uc0ac\uc6a9\ud560 \uc218\ub3c4 \uc788\uc73c\ub098 \uac00\uc774\ub4dc\ub97c \uc704\ud574 PostgreSQL\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. NFS \uc0ac\uc6a9\ubc95\ub3c4 \uacfc\uc815 \uc911\uc5d0 \uac04\ub7b5\ud788 \uc18c\uac1c\ud569\ub2c8\ub2e4. User \uc8fc\uc758\uc0ac\ud56d \u00b6 3.12.0 \uc774\uc0c1\uc758 \ubc84\uc804\uc740 root \uacc4\uc815\uc73c\ub85c NGINX Controller \ub97c \uc124\uce58\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. Clustering \uc8fc\uc758 \uc0ac\ud56d \u00b6 Controller Clustering\uc744 \uc704\ud574\uc11c\ub294 ConfigDB, TimeSeriesDB \ubaa8\ub450 Local\ub97c \uc0ac\uc6a9\ud574\uc120 \uc548\ub429\ub2c8\ub2e4. Configdb, tsdb \ub458 \ub2e4 Controller\uac00 \uc124\uce58\ub418\ub294 \ub178\ub4dc\uac00 \uc544\ub2cc \ubcc4\ub3c4\uc758 \ub178\ub4dc\uc5d0 \uc124\uce58\ub418\uc5b4\uc57c \ud558\uba70, configdb\ub294 \ubcc4\ub3c4 \ud638\uc2a4\ud2b8\uc5d0 postgresql\uc744 \uc124\uce58, tsdb\ub294 \ubcc4\ub3c4 \ud638\uc2a4\ud2b8\uc5d0 nfs\ub97c \uc124\uce58 \uc0ac\uc6a9\ud558\ub294 \ubc29\uc2dd\uc73c\ub85c DB\ub97c \ubd84\ub9ac\ud574\uc57c \ud569\ub2c8\ub2e4. \uc0ac\uc6a9\ud55c\ub2e4. \ub610\ud55c \uc628\uc804\ud55c Quorum \ubc0f Resilient Cluster \uad6c\uc131\uc744 \uc704\ud574\uc120 3\ub300\uc758 \ub178\ub4dc\uac00 \ud544\uc694\ud569\ub2c8\ub2e4. \ub530\ub77c\uc11c \uc628\uc804\ud55c Resilient Cluster \uad6c\uc131\uc744 \uc704\ud574\uc120 \ucd5c\uc18c 4 \ub300\uc758 \ub178\ub4dc\uac00 \ud544\uc694 \ud569\ub2c8\ub2e4. NGINX Controller Online Install \u00b6 Repository Set-up \u00b6 #hostname and DNS Set hostnamectl set-hostname ngxctlr.itian.ml echo 'nameserver 8.8.8.8' >> /etc/resolv.conf #CentOS Repository (kakao mirror) Set tee -a /etc/yum.repos.d/centos-kakao.repo <<EOF 1>/dev/null [base] name=CentOS-7 - Base baseurl=http://mirror.kakao.com/centos/7/os/x86_64/ gpgcheck=0 [updates] name=CentOS-7 - Updates baseurl=http://mirror.kakao.com/centos/7/updates/x86_64/ gpgcheck=0 [extras] name=CentOS-$releasever - Extras baseurl=http://mirror.kakao.com/centos/7/extras/x86_64/ gpgcheck=0 EOF #Docker, PostgreSQL, EPEL Repository Set sudo yum install -y yum-utils sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo sudo yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm sudo yum install -y epel-release #Google kubernetes Repository Set cat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\\$basearch enabled=1 gpgcheck=1 repo_gpgcheck=1 gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg exclude=kubelet kubeadm kubectl EOF sudo yum makecache fast \ub9cc\uc77c Repo file\uc5d0\uc11c $basearch , $releasever \ubcc0\uc218 \uc801\uc6a9\uc774 \uc548 \ub418\uc5b4 yum \uba85\ub839\uc5d0 \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\ub294 \uacbd\uc6b0, \uc544\ub798 Command Set\uc744 \uc2e4\ud589\ud558\uba74 \ubcc0\uc218\ub97c Static\ud558\uac8c \ubcc0\uacbd\ud569\ub2c8\ub2e4. bash export repolist=\"$(ls -p /etc/yum.repos.d/ | grep -v '/$')\" export rel=\"$(rpm --query --file --queryformat '%{VERSION}\\n' /etc/system-release | cut -c1 )\" export barch=\"$(rpm --query --queryformat '%{ARCH}\\n' \"kernel-$(uname --kernel-release)\")\"; for repos in $repolist;do sed -i s/\\$releasever/${rel}/g /etc/yum.repos.d/$repos && sed -i s/\\$basearch/${barch}/g /etc/yum.repos.d/$repos; done PostgreSQL Install \u00b6 Embedded ConfigDB\ub97c \uc0ac\uc6a9\ud558\ub824\uba74 \uc774 \uacfc\uc815\uc744 \ub118\uc5b4\uac00\uc2dc\uba74 \ub429\ub2c8\ub2e4. 3.9.0 \uc774\uc0c1\uc758 \ubc84\uc804\uc5d0\uc11c\ub294 PostgreSQL12\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uadf8 \uc774\uc804\uc758 \ubc84\uc804\uc5d0\uc11c\ub294 PostgreSQL9\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. #Postgresql12 Install sudo yum -y install postgresql12 postgresql12-server #DB Initialize /usr/pgsql-12/bin/postgresql-12-setup initdb # DB Listener Configure sudo vi /var/lib/pgsql/12/data/postgresql.conf \uae30\ubcf8\uac12\uc73c\ub85c \uc8fc\uc11d\ucc98\ub9ac \ub418\uc5b4 \uc788\ub294 \uc544\ub798 \ub77c\uc778\uc744 #listen_addresses = 'localhost' #port = 5432 \uc6d0\ud558\ub294 IP Address \uc640 \ud568\uaed8 \uc8fc\uc11d \ud574\uc81c \ud569\ub2c8\ub2e4. listen_addresses = '<IP Address>' port = 5432 # DB Access Control Configure sudo vi /var/lib/pgsql/12/data/pg_hba.conf pg_hba.conf \ubb38\uc11c \ud558\ub2e8\uc758 Access Control \uae30\ubcf8\uac12\uc740 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. # TYPE DATABASE USER ADDRESS METHOD #\"local\" is for Unix domain socket connections only local all all peer #IPv4 local connections: host all all 127.0.0.1/32 ident .. \uc544\ub798\uc640 \uac19\uc774 \uc218\uc815\ud569\ub2c8\ub2e4. # \"local\" is for Unix domain socket connections only local all all peer local all nginxc trust local all postgres peer # IPv4 local connections: host all all 127.0.0.1/32 ident host all all 0.0.0.0/0 trust [\ucc38\uace0] Public IP\ub97c \uc0ac\uc6a9\ud558\uac8c \ub418\uba74 PostgresSQL \ucde8\uc57d\uc810 \uacf5\uaca9\uc774 \uc790\uc8fc \ub4e4\uc5b4\uc624\uae30 \ub54c\ubb38\uc5d0, \ubcf4\uc548 \uc0c1\uc758 \uc774\uc720\ub85c \uc544\ub798\uc640 \uac19\uc774 \uc81c\ud55c\ud574\uc8fc\ub294 \uac83\ub3c4 \uc88b\uc2b5\ub2c8\ub2e4. # \"local\" is for Unix domain socket connections only local all all peer local all nginxc trust local all postgres peer # IPv4 local connections: host all all 127.0.0.1/32 ident host all all 172.0.0.0/8 trust host all all 10.0.0.0/8 trust \ucc38\uace0\ub85c 10.0.0.0/8 \uacfc 172.0.0.0/8 \uc740 NGINX Controller\uc758 Kubernetes Pod Network Range \uc785\ub2c8\ub2e4. #PostgreSQL12 Enable and Start systemctl enable --now postgresql-12 #Set up Database, User, User Role and Authority su - postgres createuser nginxc; createdb nginxc; psql; alter user nginxc with superuser createrole createdb replication bypassrls; alter user nginxc with encrypted password 'nginxc'; alter database nginxc owner to nginxc; \\q exit NFS \uc124\uc815 (for External tsdb, Optional for Clustering) \u00b6 Clustering\uc744 \uc704\ud574 \ubcc4\ub3c4 \ud638\uc2a4\ud2b8\uc5d0 tsdb\ub97c NFS\ub85c \uc0ac\uc6a9\ud558\ub294 \ubc29\ubc95\uc73c\ub85c, \ucc38\uace0\ub97c \uc704\ud574 \uc791\uc131\ud55c \ub0b4\uc6a9\uc785\ub2c8\ub2e4. \ubcf8 \uac00\uc774\ub4dc\uc758 \uc2f1\uae00 \ub178\ub4dc NGINX Controller \uc124\uce58\ub97c \ub530\ub77c\uac00\ub294 \uc911\uc774\ub77c\uba74 \ub2e4\uc74c\uc73c\ub85c \ub118\uc5b4\uac00\uc2dc\uba74 \ub429\ub2c8\ub2e4. @DB Host yum install -y portmap nfs-utils* libgssapi vi /etc/exports ## /var/ngxtsdb *(rw,sync) systemctl enable --now rpcbind; systemctl enable --now portmap; systemctl enable --now rpcidmapd; systemctl enable --now nfs; @Controller Node yum install nfs-utils #or ./opt/controller-installer/helper.sh prereqs nfs systemctl enable --now rpcbind; systemctl enable --now rpcidmapd; #\ud544\uc694\uc2dc mount -t nfs 175.196.235.25:/var/ngxtsdb/ / NGINX Controller Install \u00b6 ### Hostname, DNS Set hostnamectl set-hostname ngxctlr.itian.ml echo 'nameserver 8.8.8.8' >> /etc/resolv.conf ### Kubernetes Node Initial Tweak #Set Selinux status to Permissive sed -i -re 's/SELINUX=enforcing/SELINUX=permissive/g' /etc/sysconfig/selinux; sed -i -re 's/SELINUX=enforcing/SELINUX=permissive/g' /etc/selinux/config; setenforce 0; #sestatus ## Firewall Stop and Diable systemctl disable firewalld; systemctl stop firewalld; #systemctl status firewalld ## Swap Disable swapoff -a && sed -i '/ swap / s/^/#/' /etc/fstab; #swapon ## Linux Network and Docker Cgroup Driver echo \"net.ipv4.ip_forward = 1\" >> /etc/sysctl.conf sysctl -p; #sysctl net.ipv4.ip_forward; tee -a /etc/sysctl.d/k8s.conf <<EOF 1>/dev/null net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF sysctl --system; mkdir -p /etc/docker tee -a /etc/docker/daemon.json <<EOF 1>/dev/null { \"exec-opts\": [\"native.cgroupdriver=systemd\"], \"log-driver\": \"json-file\", \"log-opts\": { \"max-size\": \"10m\", \"max-file\": \"10\" } } EOF Install Docker 18.09.9 and NGINX Controller Requires \u00b6 yum -y install docker-ce-18.09.1 docker-ce-cli-18.09.1 device-mapper-persistent-data lvm2 jq oniguruma socat conntrack yum-versionlock systemctl enable --now docker","title":"NGINX Product Install Guides"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#nginx-product-install-guides","text":"","title":"NGINX Product Install Guides"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#nginx-plus","text":"NGINX Plus \uc124\uce58\ub294 \ud06c\uac8c License \uc5c5\ub85c\ub4dc, Repository \ub4f1\ub85d, Installation \uacfc\uc815\uc73c\ub85c \ub098\ub269\ub2c8\ub2e4. License\ub294 nginx-repo.crt , nginx-repo.key \ub97c \ub9d0\ud558\uba70, /var/tmp \uc704\uce58\uc5d0 \uc5c5\ub85c\ub4dc\ub418\uc5b4 \uc788\ub2e4\uace0 \uac00\uc815\ud569\ub2c8\ub2e4.","title":"NGINX Plus"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#yumcentos-rhel","text":"","title":"yum(Centos, RHEL)"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#license","text":"sudo mkdir -p /etc/ssl/nginx && cp /var/tmp/nginx-repo.* /etc/ssl/nginx/","title":"License \uc5c5\ub85c\ub4dc"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#repository","text":"sudo curl -sL https://cs.nginx.com/static/files/nginx-plus-7.repo \\ -o /etc/yum.repos.d/nginx-plus-7.repo sudo yum makecache fast","title":"Repository \ub4f1\ub85d"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#installation","text":"sudo yum install -y nginx-plus ca-certificates sudo systemctl enable --now nginx","title":"Installation"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#apt-getubuntu-debian","text":"","title":"apt-get(Ubuntu, Debian)"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#license_1","text":"sudo mkdir -p /etc/ssl/nginx && cp /var/tmp/nginx-repo.* /etc/ssl/nginx/","title":"License \uc5c5\ub85c\ub4dc"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#repository_1","text":"sudo wget https://cs.nginx.com/static/keys/nginx_signing.key sudo apt-key add nginx_signing.key sudo apt-get install apt-transport-https lsb-release ca-certificates printf \"deb https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-plus.list sudo wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx sudo apt-get update","title":"Repository \ub4f1\ub85d"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#installation_1","text":"sudo apt-get install -y nginx-plus sudo systemctl enable --now nginx","title":"Installation"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#nginx-plus-app-protect","text":"NGINX Plus \uc124\uce58\ub294 \ud06c\uac8c License \uc5c5\ub85c\ub4dc, Repository \ub4f1\ub85d, Installation \uacfc\uc815\uc73c\ub85c \ub098\ub269\ub2c8\ub2e4. License\ub294 nginx-repo.crt , nginx-repo.key \ub97c \ub9d0\ud558\uba70, /var/tmp \uc704\uce58\uc5d0 \uc5c5\ub85c\ub4dc\ub418\uc5b4 \uc788\ub2e4\uace0 \uac00\uc815\ud569\ub2c8\ub2e4.","title":"NGINX Plus + App Protect"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#yumcentos-74-rhel-74","text":"","title":"yum(Centos 7.4+, RHEL 7.4+)"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#license_2","text":"sudo mkdir -p /etc/ssl/nginx && cp /var/tmp/nginx-repo.* /etc/ssl/nginx/","title":"License \uc5c5\ub85c\ub4dc"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#repository_2","text":"sudo yum install wget epel-release sudo curl -sL https://cs.nginx.com/static/files/nginx-plus-7.repo -o /etc/yum.repos.d/nginx-plus-7.repo sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-7.repo sudo yum makecache fast","title":"Repository \ub4f1\ub85d"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#installation_2","text":"sudo yum install -y nginx-plus ca-certificates sudo yum install -y app-protect app-protect-attack-signatures sudo systemctl enable --now nginx","title":"Installation"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#apt-getubuntu-debian_1","text":"","title":"apt-get(Ubuntu, Debian)"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#license_3","text":"sudo mkdir -p /etc/ssl/nginx && cp /var/tmp/nginx-repo.* /etc/ssl/nginx/","title":"License \uc5c5\ub85c\ub4dc"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#repository_3","text":"sudo wget https://cs.nginx.com/static/keys/nginx_signing.key sudo apt-key add nginx_signing.key sudo wget https://cs.nginx.com/static/keys/app-protect-security-updates.key sudo apt-key add app-protect-security-updates.key sudo apt-get install apt-transport-https lsb-release ca-certificates printf \"deb https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-plus.list printf \"deb https://pkgs.nginx.com/app-protect/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-app-protect.list printf \"deb https://pkgs.nginx.com/app-protect-security-updates/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee -a /etc/apt/sources.list.d/nginx-app-protect.list sudo wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx sudo apt-get update","title":"Repository \ub4f1\ub85d"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#installation_3","text":"sudo apt-get install -y nginx-plus sudo apt-get install app-protect app-protect-attack-signatures sudo systemctl enable --now nginx","title":"Installation"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#nginx-plus-app-protect_1","text":"NGINX Config File\uc5d0\uc11c \uc801\uc6a9\ud569\ub2c8\ub2e4. \uc544\ub798\ub294 nginx.conf \uc5d0\uc11c NGINX \uc804\uccb4\uc5d0 App Protect\ub97c \uc801\uc6a9\ud558\ub294 \uc608\uc2dc\uc785\ub2c8\ub2e4.","title":"NGINX Plus + App-Protect \uc801\uc6a9"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#load-module","text":"user nginx; worker_processes auto; error_log /var/log/nginx/error.log notice; pid /var/run/nginx.pid; load_module modules/ngx_http_app_protect_module.so; events { worker_connections 1024; } http { app_protect_enable on; ## App Protect Enable ## include /etc/nginx/mime.types; default_type application/octet-stream; \u2026\u2026[\ud6c4\ub7b5]","title":"Load module"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#nginx-reload-and-app-protect-apply","text":"sudo nginx -t && sudo nginx -s reload","title":"Nginx Reload And App Protect Apply"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#app-protect","text":"\uc544\ub798 \uba85\ub839\uc5b4\ub85c NGINX Master/Worker \ud504\ub85c\uc138\uc2a4\uc640 App Protect\uac00 \uc0ac\uc6a9\ud558\ub294 bd_agent , bd-socket-plugin \ud504\ub85c\uc138\uc2a4\uac00 \ub3d9\uc791 \uc911\uc778\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4. sudo ps aux | grep -e \"bd_agent\" -e \"bd-socket-plugin\" -e \"nginx\"","title":"App Protect \uc801\uc6a9 \uc5ec\ubd80 \ud655\uc778"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#nginx-controller","text":"\ubcf8 \uac00\uc774\ub4dc\uc5d0\uc11c\ub294 \uc774\uc911\ud654 \ub4f1\uc774 \uc5c6\ub294 \uc2f1\uae00 \ub178\ub4dc NGINX Controller\uc758 \uc124\uce58\ub97c \ub2e4\ub8f9\ub2c8\ub2e4. \ub2e8, Online Install\uc774 \uac00\ub2a5\ud55c \ud658\uacbd, Offline Install\uc774 \ud544\uc694\ud55c \ud658\uacbd\uc73c\ub85c \uad6c\ubd84\ud574 \uac01\uac01 \uc18c\uac1c\ud569\ub2c8\ub2e4. \uac00\uc774\ub4dc\uc5d0\uc11c\ub294 CentOS 7.4+ \ud658\uacbd\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. controller-installer-<version>.tar.gz \ud328\ud0a4\uc9c0\uc640 controller_license.txt \ub77c\uc774\uc120\uc2a4 \ud30c\uc77c\uc774 \ud544\uc694\ud558\uba70, controller-installer-<version>.tar.gz \ud30c\uc77c\uc774 /var/tmp \uc5d0 \uc5c5\ub85c\ub4dc \ub418\uc5b4\uc788\ub2e4\uace0 \uac00\uc815\ud569\ub2c8\ub2e4. Embedded Config DB\ub97c \uc0ac\uc6a9\ud560 \uc218\ub3c4 \uc788\uc73c\ub098 \uac00\uc774\ub4dc\ub97c \uc704\ud574 PostgreSQL\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. NFS \uc0ac\uc6a9\ubc95\ub3c4 \uacfc\uc815 \uc911\uc5d0 \uac04\ub7b5\ud788 \uc18c\uac1c\ud569\ub2c8\ub2e4.","title":"NGINX Controller"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#user","text":"3.12.0 \uc774\uc0c1\uc758 \ubc84\uc804\uc740 root \uacc4\uc815\uc73c\ub85c NGINX Controller \ub97c \uc124\uce58\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.","title":"User \uc8fc\uc758\uc0ac\ud56d"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#clustering","text":"Controller Clustering\uc744 \uc704\ud574\uc11c\ub294 ConfigDB, TimeSeriesDB \ubaa8\ub450 Local\ub97c \uc0ac\uc6a9\ud574\uc120 \uc548\ub429\ub2c8\ub2e4. Configdb, tsdb \ub458 \ub2e4 Controller\uac00 \uc124\uce58\ub418\ub294 \ub178\ub4dc\uac00 \uc544\ub2cc \ubcc4\ub3c4\uc758 \ub178\ub4dc\uc5d0 \uc124\uce58\ub418\uc5b4\uc57c \ud558\uba70, configdb\ub294 \ubcc4\ub3c4 \ud638\uc2a4\ud2b8\uc5d0 postgresql\uc744 \uc124\uce58, tsdb\ub294 \ubcc4\ub3c4 \ud638\uc2a4\ud2b8\uc5d0 nfs\ub97c \uc124\uce58 \uc0ac\uc6a9\ud558\ub294 \ubc29\uc2dd\uc73c\ub85c DB\ub97c \ubd84\ub9ac\ud574\uc57c \ud569\ub2c8\ub2e4. \uc0ac\uc6a9\ud55c\ub2e4. \ub610\ud55c \uc628\uc804\ud55c Quorum \ubc0f Resilient Cluster \uad6c\uc131\uc744 \uc704\ud574\uc120 3\ub300\uc758 \ub178\ub4dc\uac00 \ud544\uc694\ud569\ub2c8\ub2e4. \ub530\ub77c\uc11c \uc628\uc804\ud55c Resilient Cluster \uad6c\uc131\uc744 \uc704\ud574\uc120 \ucd5c\uc18c 4 \ub300\uc758 \ub178\ub4dc\uac00 \ud544\uc694 \ud569\ub2c8\ub2e4.","title":"Clustering \uc8fc\uc758 \uc0ac\ud56d"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#nginx-controller-online-install","text":"","title":"NGINX Controller Online Install"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#repository-set-up","text":"#hostname and DNS Set hostnamectl set-hostname ngxctlr.itian.ml echo 'nameserver 8.8.8.8' >> /etc/resolv.conf #CentOS Repository (kakao mirror) Set tee -a /etc/yum.repos.d/centos-kakao.repo <<EOF 1>/dev/null [base] name=CentOS-7 - Base baseurl=http://mirror.kakao.com/centos/7/os/x86_64/ gpgcheck=0 [updates] name=CentOS-7 - Updates baseurl=http://mirror.kakao.com/centos/7/updates/x86_64/ gpgcheck=0 [extras] name=CentOS-$releasever - Extras baseurl=http://mirror.kakao.com/centos/7/extras/x86_64/ gpgcheck=0 EOF #Docker, PostgreSQL, EPEL Repository Set sudo yum install -y yum-utils sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo sudo yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm sudo yum install -y epel-release #Google kubernetes Repository Set cat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\\$basearch enabled=1 gpgcheck=1 repo_gpgcheck=1 gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg exclude=kubelet kubeadm kubectl EOF sudo yum makecache fast \ub9cc\uc77c Repo file\uc5d0\uc11c $basearch , $releasever \ubcc0\uc218 \uc801\uc6a9\uc774 \uc548 \ub418\uc5b4 yum \uba85\ub839\uc5d0 \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\ub294 \uacbd\uc6b0, \uc544\ub798 Command Set\uc744 \uc2e4\ud589\ud558\uba74 \ubcc0\uc218\ub97c Static\ud558\uac8c \ubcc0\uacbd\ud569\ub2c8\ub2e4. bash export repolist=\"$(ls -p /etc/yum.repos.d/ | grep -v '/$')\" export rel=\"$(rpm --query --file --queryformat '%{VERSION}\\n' /etc/system-release | cut -c1 )\" export barch=\"$(rpm --query --queryformat '%{ARCH}\\n' \"kernel-$(uname --kernel-release)\")\"; for repos in $repolist;do sed -i s/\\$releasever/${rel}/g /etc/yum.repos.d/$repos && sed -i s/\\$basearch/${barch}/g /etc/yum.repos.d/$repos; done","title":"Repository Set-up"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#postgresql-install","text":"Embedded ConfigDB\ub97c \uc0ac\uc6a9\ud558\ub824\uba74 \uc774 \uacfc\uc815\uc744 \ub118\uc5b4\uac00\uc2dc\uba74 \ub429\ub2c8\ub2e4. 3.9.0 \uc774\uc0c1\uc758 \ubc84\uc804\uc5d0\uc11c\ub294 PostgreSQL12\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uadf8 \uc774\uc804\uc758 \ubc84\uc804\uc5d0\uc11c\ub294 PostgreSQL9\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. #Postgresql12 Install sudo yum -y install postgresql12 postgresql12-server #DB Initialize /usr/pgsql-12/bin/postgresql-12-setup initdb # DB Listener Configure sudo vi /var/lib/pgsql/12/data/postgresql.conf \uae30\ubcf8\uac12\uc73c\ub85c \uc8fc\uc11d\ucc98\ub9ac \ub418\uc5b4 \uc788\ub294 \uc544\ub798 \ub77c\uc778\uc744 #listen_addresses = 'localhost' #port = 5432 \uc6d0\ud558\ub294 IP Address \uc640 \ud568\uaed8 \uc8fc\uc11d \ud574\uc81c \ud569\ub2c8\ub2e4. listen_addresses = '<IP Address>' port = 5432 # DB Access Control Configure sudo vi /var/lib/pgsql/12/data/pg_hba.conf pg_hba.conf \ubb38\uc11c \ud558\ub2e8\uc758 Access Control \uae30\ubcf8\uac12\uc740 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. # TYPE DATABASE USER ADDRESS METHOD #\"local\" is for Unix domain socket connections only local all all peer #IPv4 local connections: host all all 127.0.0.1/32 ident .. \uc544\ub798\uc640 \uac19\uc774 \uc218\uc815\ud569\ub2c8\ub2e4. # \"local\" is for Unix domain socket connections only local all all peer local all nginxc trust local all postgres peer # IPv4 local connections: host all all 127.0.0.1/32 ident host all all 0.0.0.0/0 trust [\ucc38\uace0] Public IP\ub97c \uc0ac\uc6a9\ud558\uac8c \ub418\uba74 PostgresSQL \ucde8\uc57d\uc810 \uacf5\uaca9\uc774 \uc790\uc8fc \ub4e4\uc5b4\uc624\uae30 \ub54c\ubb38\uc5d0, \ubcf4\uc548 \uc0c1\uc758 \uc774\uc720\ub85c \uc544\ub798\uc640 \uac19\uc774 \uc81c\ud55c\ud574\uc8fc\ub294 \uac83\ub3c4 \uc88b\uc2b5\ub2c8\ub2e4. # \"local\" is for Unix domain socket connections only local all all peer local all nginxc trust local all postgres peer # IPv4 local connections: host all all 127.0.0.1/32 ident host all all 172.0.0.0/8 trust host all all 10.0.0.0/8 trust \ucc38\uace0\ub85c 10.0.0.0/8 \uacfc 172.0.0.0/8 \uc740 NGINX Controller\uc758 Kubernetes Pod Network Range \uc785\ub2c8\ub2e4. #PostgreSQL12 Enable and Start systemctl enable --now postgresql-12 #Set up Database, User, User Role and Authority su - postgres createuser nginxc; createdb nginxc; psql; alter user nginxc with superuser createrole createdb replication bypassrls; alter user nginxc with encrypted password 'nginxc'; alter database nginxc owner to nginxc; \\q exit","title":"PostgreSQL Install"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#nfs-for-external-tsdb-optional-for-clustering","text":"Clustering\uc744 \uc704\ud574 \ubcc4\ub3c4 \ud638\uc2a4\ud2b8\uc5d0 tsdb\ub97c NFS\ub85c \uc0ac\uc6a9\ud558\ub294 \ubc29\ubc95\uc73c\ub85c, \ucc38\uace0\ub97c \uc704\ud574 \uc791\uc131\ud55c \ub0b4\uc6a9\uc785\ub2c8\ub2e4. \ubcf8 \uac00\uc774\ub4dc\uc758 \uc2f1\uae00 \ub178\ub4dc NGINX Controller \uc124\uce58\ub97c \ub530\ub77c\uac00\ub294 \uc911\uc774\ub77c\uba74 \ub2e4\uc74c\uc73c\ub85c \ub118\uc5b4\uac00\uc2dc\uba74 \ub429\ub2c8\ub2e4. @DB Host yum install -y portmap nfs-utils* libgssapi vi /etc/exports ## /var/ngxtsdb *(rw,sync) systemctl enable --now rpcbind; systemctl enable --now portmap; systemctl enable --now rpcidmapd; systemctl enable --now nfs; @Controller Node yum install nfs-utils #or ./opt/controller-installer/helper.sh prereqs nfs systemctl enable --now rpcbind; systemctl enable --now rpcidmapd; #\ud544\uc694\uc2dc mount -t nfs 175.196.235.25:/var/ngxtsdb/ /","title":"NFS \uc124\uc815 (for External tsdb, Optional for Clustering)"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#nginx-controller-install","text":"### Hostname, DNS Set hostnamectl set-hostname ngxctlr.itian.ml echo 'nameserver 8.8.8.8' >> /etc/resolv.conf ### Kubernetes Node Initial Tweak #Set Selinux status to Permissive sed -i -re 's/SELINUX=enforcing/SELINUX=permissive/g' /etc/sysconfig/selinux; sed -i -re 's/SELINUX=enforcing/SELINUX=permissive/g' /etc/selinux/config; setenforce 0; #sestatus ## Firewall Stop and Diable systemctl disable firewalld; systemctl stop firewalld; #systemctl status firewalld ## Swap Disable swapoff -a && sed -i '/ swap / s/^/#/' /etc/fstab; #swapon ## Linux Network and Docker Cgroup Driver echo \"net.ipv4.ip_forward = 1\" >> /etc/sysctl.conf sysctl -p; #sysctl net.ipv4.ip_forward; tee -a /etc/sysctl.d/k8s.conf <<EOF 1>/dev/null net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF sysctl --system; mkdir -p /etc/docker tee -a /etc/docker/daemon.json <<EOF 1>/dev/null { \"exec-opts\": [\"native.cgroupdriver=systemd\"], \"log-driver\": \"json-file\", \"log-opts\": { \"max-size\": \"10m\", \"max-file\": \"10\" } } EOF","title":"NGINX Controller Install"},{"location":"NGINX-Plus/NGINX-Plus-Product-Install-guide/#install-docker-18099-and-nginx-controller-requires","text":"yum -y install docker-ce-18.09.1 docker-ce-cli-18.09.1 device-mapper-persistent-data lvm2 jq oniguruma socat conntrack yum-versionlock systemctl enable --now docker","title":"Install Docker 18.09.9 and NGINX Controller Requires"},{"location":"NGINX-Plus/NGINX-Controller/API-GW-Image-build-NAP/","text":"NGINX Controller-Enabled NGINX Plus Container Image build \u00b6 Kubernetes / Openshift\uc5d0\uc11c \uc0ac\uc6a9\ud560 NGINX Controller \uc5f0\ub3d9 NGINX Plus + App Protect Instance \uc758 \uc774\ubbf8\uc9c0 \ube4c\ub4dc \uacfc\uc815\uc744 \uc124\uba85\ud55c \ubb38\uc11c\uc785\ub2c8\ub2e4. NGINX Controller\ub294 Control-plane\uc73c\ub85c\uc11c, NGINX+ Instance\ub97c Dataplane\uc744 \ub2f4\ub2f9\ud558\ub294 API Gateway\ub85c\uc11c \uad00\ub9ac\ud569\ub2c8\ub2e4. N+ API Gateway\ub294 \uc2e4\uc81c \ud2b8\ub798\ud53d\uc744 \ucc98\ub9ac\ud558\ub294 NGINX Plus\uc640 \uc774 NGINX Plus\uc640 NGINX Controller\uc640 \uc5f0\ub3d9\uc744 \uc704\ud55c Controller-agent\uac00 \ubc18\ub4dc\uc2dc \ud544\uc694\ud569\ub2c8\ub2e4. \ucd08\uae30\uc758 API GW \uc774\ubbf8\uc9c0\uc5d0\uc11c\ub294 NGINX Plus\ub97c \uc124\uce58\ud558\uace0, Controller-agent\ub97c Entrypoint \uc2a4\ud06c\ub9bd\ud2b8\uc5d0\uc11c \uc124\uce58\ud558\ub3c4\ub85d \uc124\uacc4\ub410\uc5c8\uc2b5\ub2c8\ub2e4. \uc774 \ubb38\uc11c\uc5d0\uc11c \uc18c\uac1c\ud558\ub294 \ubc29\ubc95\uc740 \uc5c5\ub370\uc774\ud2b8\ub41c \ubc29\uc2dd\uc73c\ub85c, Controller-agent\ub97c \uc774\ubbf8\uc9c0\uc5d0 \ud1b5\ud569 \uc124\uce58\ud558\uc5ec Image Build\ub97c \uc218\ud589\ud558\uace0, Entrypoint \uc2a4\ud06c\ub9bd\ud2b8\uc5d0\uc11c \uc0ac\uc6a9 \ud658\uacbd\uc5d0 \ub9de\ub3c4\ub85d Config Update\ub97c \uc218\ud589\ud558\ub3c4\ub85d \ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ubc29\ubc95\uc740 Kubernetes \ud658\uacbd\uc758 API GW deploy \uacfc\uc815\uc5d0\uc11c Controller agent \uc124\uce58 \uacfc\uc815\uc774 \uc0dd\ub7b5\ub418\uc5b4 \uc989\uac01\uc801\uc778 \uc0ac\uc6a9\uc774 \uac00\ub2a5\ud558\uba70, \ud639\uc2dc \ubaa8\ub97c \uc774\uc288 \uc0c1\ud669\uc5d0\uc11c Downtime\uc774 \ud6e8\uc52c \uc904\uc5b4\ub4dc\ub294 \uacb0\uacfc\ub97c \ubcfc \uc218 \uc788\uc5c8\uc2b5\ub2c8\ub2e4. NGINX Plus Controller-agent \ud1b5\ud569 \uc774\ubbf8\uc9c0 \ube4c\ub4dc \u00b6 Requirements \u00b6 NGINX Plus \uc124\uce58\ub97c \uc704\ud55c NGINX Plus License \ud30c\uc77c nginx-repo.crt, nginx-repo.key Docker Image Build\ub97c \uc704\ud55c dockerfile, entrypoint.sh, nginx-plus-api.conf (\uc544\ub798 \uc608\uc2dc \ubb38\uc11c \ucc38\uc870: \uc608\uc2dc \ubb38\uc11c\ub294 \ubaa8\ub450 NGINX Inc Github \uc5d0\uc11c \uac00\uc838\uc654\uc2b5\ub2c8\ub2e4.) Controller-agent \uc124\uce58\ub97c \uc704\ud55c NGINX Controller dockerfile FROM debian:stretch-slim LABEL maintainer=\"NGINX Controller Engineering\" # e.g '1234567890' ARG API_KEY ENV ENV_CONTROLLER_API_KEY=$API_KEY # e.g https://<fqdn>/install/controller-agent ARG CONTROLLER_URL ENV ENV_CONTROLLER_URL=$CONTROLLER_URL # e.g True or False ARG STORE_UUID=False ENV ENV_CONTROLLER_STORE_UUID=$STORE_UUID # e.g Instance location already defined in Controller ARG LOCATION ENV ENV_CONTROLLER_LOCATION=$LOCATION # e.g Instance group already defined in Controller ARG INSTANCE_GROUP ENV ENV_CONTROLLER_INSTANCE_GROUP=$INSTANCE_GROUP # NGXIN Plus release e.g 23 ARG NGINX_PLUS_VERSION=23 # Download certificate (nginx-repo.crt) and key (nginx-repo.key) from the customer portal (https://cs.nginx.com) # and copy to the build context COPY nginx-repo.* /etc/ssl/nginx/ COPY nginx-plus-api.conf /etc/nginx/conf.d/ COPY entrypoint.sh / # Install NGINX Plus RUN set -ex \\ && apt-get update && apt-get upgrade -y \\ && apt-get install --no-install-recommends --no-install-suggests -y curl sudo procps apt-utils apt-transport-https ca-certificates gnupg1 distro-info-data libmpdec2 \\ lsb-release python python-minimal binutils net-tools \\ && \\ NGINX_GPGKEY=573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62; \\ found=''; \\ for server in \\ ha.pool.sks-keyservers.net \\ hkp://keyserver.ubuntu.com:80 \\ hkp://p80.pool.sks-keyservers.net:80 \\ pgp.mit.edu \\ ; do \\ echo \"Fetching GPG key $NGINX_GPGKEY from $server\"; \\ apt-key adv --keyserver \"$server\" --keyserver-options timeout=10 --recv-keys \"$NGINX_GPGKEY\" && found=yes && break; \\ done; \\ test -z \"$found\" && echo >&2 \"error: failed to fetch GPG key $NGINX_GPGKEY\" && exit 1; \\ echo \"Acquire::https::plus-pkgs.nginx.com::Verify-Peer \\\"true\\\";\" >> /etc/apt/apt.conf.d/90nginx \\ && echo \"Acquire::https::plus-pkgs.nginx.com::Verify-Host \\\"true\\\";\" >> /etc/apt/apt.conf.d/90nginx \\ && echo \"Acquire::https::plus-pkgs.nginx.com::SslCert \\\"/etc/ssl/nginx/nginx-repo.crt\\\";\" >> /etc/apt/apt.conf.d/90nginx \\ && echo \"Acquire::https::plus-pkgs.nginx.com::SslKey \\\"/etc/ssl/nginx/nginx-repo.key\\\";\" >> /etc/apt/apt.conf.d/90nginx \\ && printf \"deb https://plus-pkgs.nginx.com/debian stretch nginx-plus\\n\" > /etc/apt/sources.list.d/nginx-plus.list \\ # NGINX Javascript module needed for APIM && apt-get update && apt-get install -y nginx-plus=${NGINX_PLUS_VERSION}* nginx-plus-module-njs=${NGINX_PLUS_VERSION}* \\ && rm -rf /var/lib/apt/lists/* \\ # Install Controller Agent && curl -k -sS -L ${CONTROLLER_URL} > install.sh \\ && sed -i 's/^assume_yes=\"\"/assume_yes=\"-y\"/' install.sh \\ && sed -i 's,-n \"${NGINX_GPGKEY}\",true,' install.sh \\ && sh ./install.sh -y \\ # cleanup sensitive nginx-plus data && rm /etc/ssl/nginx/nginx-repo.* \\ && rm /etc/apt/sources.list.d/nginx-plus.list \\ && rm /etc/apt/apt.conf.d/90nginx \\ && apt-key del \"$NGINX_GPGKEY\" # Forward request logs to Docker log collector RUN ln -sf /proc/1/fd/1 /var/log/nginx-controller/agent.log \\ && ln -sf /proc/1/fd/2 /var/log/nginx/error.log EXPOSE 80 STOPSIGNAL SIGTERM ENTRYPOINT [\"sh\", \"/entrypoint.sh\"] dockerfile\ub97c \ud070 \ubd80\ubd84\uc73c\ub85c \uad6c\ubd84\ud558\uba74, dockerfile \uad6c\uc131 \uc21c\uc11c\uc5d0 \ub530\ub77c \uc544\ub798\uc640 \uac19\uc774 \uad6c\ubd84\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ubcc0\uc218 \uc124\uc815 \ud30c\ud2b8 N+ \ub77c\uc774\uc120\uc2a4 \ubc0f Repo \uc124\uc815 \ud30c\ud2b8 NGINX Plus \uc124\uce58 \ud30c\ud2b8 NGINX Controller-agent \uc124\uce58 \ud30c\ud2b8 \ubbfc\uac10\uc131/\ubd88\ud544\uc694 \uc815\ubcf4 \uc81c\uac70 \ud30c\ud2b8 Log \uc5f0\uacb0 \ubc0f \uae30\ud0c0 \uc124\uc815 \ubc0f Entrypoint \uc9c0\uc815 \ud30c\ud2b8\uc785\ub2c8\ub2e4. entrypoint.sh #!/bin/sh # # This script launches nginx and the NGINX Controller Agent. # # Variables agent_conf_file=\"/etc/controller-agent/agent.conf\" agent_log_file=\"/var/log/nginx-controller/agent.log\" nginx_status_conf=\"/etc/nginx/conf.d/stub_status.conf\" api_key=\"\" instance_name=\"$(hostname -f)\" controller_api_url=\"\" location=\"\" handle_term() { echo \"received TERM signal\" echo \"stopping controller-agent ...\" kill -TERM \"${agent_pid}\" 2>/dev/null echo \"stopping nginx ...\" kill -TERM \"${nginx_pid}\" 2>/dev/null } trap 'handle_term' TERM # Launch nginx echo \"starting nginx ...\" nginx -g \"daemon off;\" & nginx_pid=$! wait_workers() { while ! pgrep -f 'nginx: worker process' >/dev/null 2>&1; do echo \"waiting for nginx workers ...\" sleep 2 done } wait_workers test -n \"${ENV_CONTROLLER_API_KEY}\" && \\ api_key=${ENV_CONTROLLER_API_KEY} # if instance_name is defined in the env vars, use it test -n \"${ENV_CONTROLLER_INSTANCE_NAME}\" && \\ instance_name=${ENV_CONTROLLER_INSTANCE_NAME} test -n \"${ENV_CONTROLLER_API_URL}\" && \\ controller_api_url=${ENV_CONTROLLER_API_URL} test -n \"${ENV_CONTROLLER_LOCATION}\" && \\ location=${ENV_CONTROLLER_LOCATION} test -n \"${ENV_CONTROLLER_INSTANCE_GROUP}\" && \\ instance_group=${ENV_CONTROLLER_INSTANCE_GROUP} if [ -n \"${api_key}\" -o -n \"${instance_name}\" -o -n \"${controller_api_url}\" -o -n \"${location}\" -o -n \"${instance_group}\" ]; then echo \"updating ${agent_conf_file} ...\" if [ ! -f \"${agent_conf_file}\" ]; then test -f \"${agent_conf_file}.default\" && \\ cp -p \"${agent_conf_file}.default\" \"${agent_conf_file}\" || \\ { echo \"no ${agent_conf_file}.default found! exiting.\"; exit 1; } fi test -n \"${api_key}\" && \\ echo \" ---> using api_key = ${api_key}\" && \\ sh -c \"sed -i.old -e 's/api_key.*$/api_key = $api_key/' \\ ${agent_conf_file}\" test -n \"${controller_api_url}\" && \\ echo \" ---> using controller api url = ${controller_api_url}\" && \\ sh -c \"sed -i.old -e 's@^api_url.*@api_url = $controller_api_url@' \\ ${agent_conf_file}\" test -n \"${instance_name}\" && \\ echo \" ---> using instance_name = ${instance_name}\" && \\ sh -c \"sed -i.old -e 's/instance_name.*$/instance_name = $instance_name/' \\ ${agent_conf_file}\" test -n \"${location}\" && \\ echo \" ---> using location = ${location}\" && \\ sh -c \"sed -i.old -e 's/location_name.*$/location_name = $location/' \\ ${agent_conf_file}\" test -n \"${instance_group}\" && \\ echo \" ---> using instance group = ${instance_group}\" && \\ sh -c \"sed -i.old -e 's/instance_group.*$/instance_group = $instance_group/' \\ ${agent_conf_file}\" test -f \"${agent_conf_file}\" && \\ chmod 644 ${agent_conf_file} && \\ chown nginx ${agent_conf_file} > /dev/null 2>&1 test -f \"${nginx_status_conf}\" && \\ chmod 644 ${nginx_status_conf} && \\ chown nginx ${nginx_status_conf} > /dev/null 2>&1 fi if ! grep '^api_key.*=[ ]*[[:alnum:]].*' ${agent_conf_file} > /dev/null 2>&1; then echo \"no api_key found in ${agent_conf_file}! exiting.\" exit 1 fi echo \"starting controller-agent ...\" /usr/bin/nginx-controller-agent > /dev/null 2>&1 < /dev/null & agent_pid=$! if [ $? != 0 ]; then echo \"couldn't start the agent, please check ${agent_log_file}\" exit 1 fi wait_term() { wait ${agent_pid} trap - TERM kill -QUIT \"${nginx_pid}\" 2>/dev/null echo \"waiting for nginx to stop...\" wait ${nginx_pid} } wait_term echo \"controller-agent process has stopped, exiting.\" entrypoint.sh\ud30c\uc77c\uc740 \ud06c\uac8c \ub450 \ubd80\ubd84\uc73c\ub85c \uad6c\ubd84\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. API GW \uc774\ubbf8\uc9c0 \ub0b4\uc758 agent.conf \ud30c\uc77c \uc218\uc815 (\ubcc0\uc218 Override) conf \uc218\uc815\uc5d0 \ub530\ub978 NGINX\uc640 Controller-agent\uc758 \uc7ac\uc2dc\uc791 Controller \uc124\uce58 \uacfc\uc815\uc5d0\uc11c \uc0dd\uc131\ub41c api_key, controller_api_url, location \ub4f1\uc758 \uc124\uc815 \uac12\uc744 Entrypoint.sh\ub97c \ud1b5\ud574, ENV\uc5d0\uc11c \uc124\uc815\ud55c \uac12\uc73c\ub85c \uc7ac\ubc18\uc601\ud558\ub3c4\ub85d \uc791\uc131\ud55c \uac83\uc73c\ub85c \ubcf4\uc785\ub2c8\ub2e4. \ub530\ub77c\uc11c, Kubernetes Deployment YAML \ud30c\uc77c\uc744 \ud1b5\ud574 API Key, Location, \uadf8\ub9ac\uace0 5\uc6d4 \ub9d0 \uae30\uc900 \uc544\uc9c1 \ubca0\ud0c0 \uae30\ub2a5\uc778 instance group\uae4c\uc9c0 \ubcc0\uc218\ub97c override\ud558\uc5ec \uc0ac\uc6a9\ud560 \uc218 \uc788\uaca0\uc2b5\ub2c8\ub2e4. Override\ud574\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ubcc0\uc218\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. ENV_CONTROLLER_API_KEY ENV_CONTROLLER_API_URL ENV_CONTROLLER_INSTANCE_NAME ENV_CONTROLLER_LOCATION ENV_CONTROLLER_INSTANCE_GROUP nginx-plus-api.conf server { listen 8080; location /api/ { api write=on; } location = /dashboard.html { root /usr/share/nginx/html; } # Redirect requests for \"/\" to \"/dashboard.html\" location / { return 301 /dashboard.html; } # Redirect requests for pre-R14 dashboard location /status.html { return 301 /dashboard.html; } } # vim: syntax=nginx Controller-agent\ub294 \uac01 API Gateway\uc758 Metric \uac12\uc744 API \uc870\ud68c\ub97c \ud1b5\ud574 \uac00\uc838\uc635\ub2c8\ub2e4. \uc774\ub97c \uc704\ud55c NGINX Server Context config\uc785\ub2c8\ub2e4. Docker Build \u00b6 Build \uba85\ub839\uc5b4\ub294 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4. sudo docker build --build-arg CONTROLLER_URL=https://<fqdn>/install/controller-agent --build-arg API_KEY='abcdefxxxxxx' -t nginx-agent . Build-argument\uc778 CONTROLLER_URL\uc740 Controller \ubc84\uc804\uc5d0 \ub530\ub77c \ub2e4\ub97c \uc218 \uc788\uc2b5\ub2c8\ub2e4. NGINX Controller v3.10 \uc774\uc804 CONTROLLER_URL=https://<fqdn>:8443/1.4/install/controller NGINX Controller v3.11 \uc774\ud6c4 CONTROLLER_URL=https://<fqdn>/install/controller-agent","title":"NGINX Controller - NAP Container Image build"},{"location":"NGINX-Plus/NGINX-Controller/API-GW-Image-build-NAP/#nginx-controller-enabled-nginx-plus-container-image-build","text":"Kubernetes / Openshift\uc5d0\uc11c \uc0ac\uc6a9\ud560 NGINX Controller \uc5f0\ub3d9 NGINX Plus + App Protect Instance \uc758 \uc774\ubbf8\uc9c0 \ube4c\ub4dc \uacfc\uc815\uc744 \uc124\uba85\ud55c \ubb38\uc11c\uc785\ub2c8\ub2e4. NGINX Controller\ub294 Control-plane\uc73c\ub85c\uc11c, NGINX+ Instance\ub97c Dataplane\uc744 \ub2f4\ub2f9\ud558\ub294 API Gateway\ub85c\uc11c \uad00\ub9ac\ud569\ub2c8\ub2e4. N+ API Gateway\ub294 \uc2e4\uc81c \ud2b8\ub798\ud53d\uc744 \ucc98\ub9ac\ud558\ub294 NGINX Plus\uc640 \uc774 NGINX Plus\uc640 NGINX Controller\uc640 \uc5f0\ub3d9\uc744 \uc704\ud55c Controller-agent\uac00 \ubc18\ub4dc\uc2dc \ud544\uc694\ud569\ub2c8\ub2e4. \ucd08\uae30\uc758 API GW \uc774\ubbf8\uc9c0\uc5d0\uc11c\ub294 NGINX Plus\ub97c \uc124\uce58\ud558\uace0, Controller-agent\ub97c Entrypoint \uc2a4\ud06c\ub9bd\ud2b8\uc5d0\uc11c \uc124\uce58\ud558\ub3c4\ub85d \uc124\uacc4\ub410\uc5c8\uc2b5\ub2c8\ub2e4. \uc774 \ubb38\uc11c\uc5d0\uc11c \uc18c\uac1c\ud558\ub294 \ubc29\ubc95\uc740 \uc5c5\ub370\uc774\ud2b8\ub41c \ubc29\uc2dd\uc73c\ub85c, Controller-agent\ub97c \uc774\ubbf8\uc9c0\uc5d0 \ud1b5\ud569 \uc124\uce58\ud558\uc5ec Image Build\ub97c \uc218\ud589\ud558\uace0, Entrypoint \uc2a4\ud06c\ub9bd\ud2b8\uc5d0\uc11c \uc0ac\uc6a9 \ud658\uacbd\uc5d0 \ub9de\ub3c4\ub85d Config Update\ub97c \uc218\ud589\ud558\ub3c4\ub85d \ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ubc29\ubc95\uc740 Kubernetes \ud658\uacbd\uc758 API GW deploy \uacfc\uc815\uc5d0\uc11c Controller agent \uc124\uce58 \uacfc\uc815\uc774 \uc0dd\ub7b5\ub418\uc5b4 \uc989\uac01\uc801\uc778 \uc0ac\uc6a9\uc774 \uac00\ub2a5\ud558\uba70, \ud639\uc2dc \ubaa8\ub97c \uc774\uc288 \uc0c1\ud669\uc5d0\uc11c Downtime\uc774 \ud6e8\uc52c \uc904\uc5b4\ub4dc\ub294 \uacb0\uacfc\ub97c \ubcfc \uc218 \uc788\uc5c8\uc2b5\ub2c8\ub2e4.","title":"NGINX Controller-Enabled NGINX Plus Container Image build"},{"location":"NGINX-Plus/NGINX-Controller/API-GW-Image-build-NAP/#nginx-plus-controller-agent","text":"","title":"NGINX Plus Controller-agent \ud1b5\ud569 \uc774\ubbf8\uc9c0 \ube4c\ub4dc"},{"location":"NGINX-Plus/NGINX-Controller/API-GW-Image-build-NAP/#requirements","text":"NGINX Plus \uc124\uce58\ub97c \uc704\ud55c NGINX Plus License \ud30c\uc77c nginx-repo.crt, nginx-repo.key Docker Image Build\ub97c \uc704\ud55c dockerfile, entrypoint.sh, nginx-plus-api.conf (\uc544\ub798 \uc608\uc2dc \ubb38\uc11c \ucc38\uc870: \uc608\uc2dc \ubb38\uc11c\ub294 \ubaa8\ub450 NGINX Inc Github \uc5d0\uc11c \uac00\uc838\uc654\uc2b5\ub2c8\ub2e4.) Controller-agent \uc124\uce58\ub97c \uc704\ud55c NGINX Controller dockerfile FROM debian:stretch-slim LABEL maintainer=\"NGINX Controller Engineering\" # e.g '1234567890' ARG API_KEY ENV ENV_CONTROLLER_API_KEY=$API_KEY # e.g https://<fqdn>/install/controller-agent ARG CONTROLLER_URL ENV ENV_CONTROLLER_URL=$CONTROLLER_URL # e.g True or False ARG STORE_UUID=False ENV ENV_CONTROLLER_STORE_UUID=$STORE_UUID # e.g Instance location already defined in Controller ARG LOCATION ENV ENV_CONTROLLER_LOCATION=$LOCATION # e.g Instance group already defined in Controller ARG INSTANCE_GROUP ENV ENV_CONTROLLER_INSTANCE_GROUP=$INSTANCE_GROUP # NGXIN Plus release e.g 23 ARG NGINX_PLUS_VERSION=23 # Download certificate (nginx-repo.crt) and key (nginx-repo.key) from the customer portal (https://cs.nginx.com) # and copy to the build context COPY nginx-repo.* /etc/ssl/nginx/ COPY nginx-plus-api.conf /etc/nginx/conf.d/ COPY entrypoint.sh / # Install NGINX Plus RUN set -ex \\ && apt-get update && apt-get upgrade -y \\ && apt-get install --no-install-recommends --no-install-suggests -y curl sudo procps apt-utils apt-transport-https ca-certificates gnupg1 distro-info-data libmpdec2 \\ lsb-release python python-minimal binutils net-tools \\ && \\ NGINX_GPGKEY=573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62; \\ found=''; \\ for server in \\ ha.pool.sks-keyservers.net \\ hkp://keyserver.ubuntu.com:80 \\ hkp://p80.pool.sks-keyservers.net:80 \\ pgp.mit.edu \\ ; do \\ echo \"Fetching GPG key $NGINX_GPGKEY from $server\"; \\ apt-key adv --keyserver \"$server\" --keyserver-options timeout=10 --recv-keys \"$NGINX_GPGKEY\" && found=yes && break; \\ done; \\ test -z \"$found\" && echo >&2 \"error: failed to fetch GPG key $NGINX_GPGKEY\" && exit 1; \\ echo \"Acquire::https::plus-pkgs.nginx.com::Verify-Peer \\\"true\\\";\" >> /etc/apt/apt.conf.d/90nginx \\ && echo \"Acquire::https::plus-pkgs.nginx.com::Verify-Host \\\"true\\\";\" >> /etc/apt/apt.conf.d/90nginx \\ && echo \"Acquire::https::plus-pkgs.nginx.com::SslCert \\\"/etc/ssl/nginx/nginx-repo.crt\\\";\" >> /etc/apt/apt.conf.d/90nginx \\ && echo \"Acquire::https::plus-pkgs.nginx.com::SslKey \\\"/etc/ssl/nginx/nginx-repo.key\\\";\" >> /etc/apt/apt.conf.d/90nginx \\ && printf \"deb https://plus-pkgs.nginx.com/debian stretch nginx-plus\\n\" > /etc/apt/sources.list.d/nginx-plus.list \\ # NGINX Javascript module needed for APIM && apt-get update && apt-get install -y nginx-plus=${NGINX_PLUS_VERSION}* nginx-plus-module-njs=${NGINX_PLUS_VERSION}* \\ && rm -rf /var/lib/apt/lists/* \\ # Install Controller Agent && curl -k -sS -L ${CONTROLLER_URL} > install.sh \\ && sed -i 's/^assume_yes=\"\"/assume_yes=\"-y\"/' install.sh \\ && sed -i 's,-n \"${NGINX_GPGKEY}\",true,' install.sh \\ && sh ./install.sh -y \\ # cleanup sensitive nginx-plus data && rm /etc/ssl/nginx/nginx-repo.* \\ && rm /etc/apt/sources.list.d/nginx-plus.list \\ && rm /etc/apt/apt.conf.d/90nginx \\ && apt-key del \"$NGINX_GPGKEY\" # Forward request logs to Docker log collector RUN ln -sf /proc/1/fd/1 /var/log/nginx-controller/agent.log \\ && ln -sf /proc/1/fd/2 /var/log/nginx/error.log EXPOSE 80 STOPSIGNAL SIGTERM ENTRYPOINT [\"sh\", \"/entrypoint.sh\"] dockerfile\ub97c \ud070 \ubd80\ubd84\uc73c\ub85c \uad6c\ubd84\ud558\uba74, dockerfile \uad6c\uc131 \uc21c\uc11c\uc5d0 \ub530\ub77c \uc544\ub798\uc640 \uac19\uc774 \uad6c\ubd84\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ubcc0\uc218 \uc124\uc815 \ud30c\ud2b8 N+ \ub77c\uc774\uc120\uc2a4 \ubc0f Repo \uc124\uc815 \ud30c\ud2b8 NGINX Plus \uc124\uce58 \ud30c\ud2b8 NGINX Controller-agent \uc124\uce58 \ud30c\ud2b8 \ubbfc\uac10\uc131/\ubd88\ud544\uc694 \uc815\ubcf4 \uc81c\uac70 \ud30c\ud2b8 Log \uc5f0\uacb0 \ubc0f \uae30\ud0c0 \uc124\uc815 \ubc0f Entrypoint \uc9c0\uc815 \ud30c\ud2b8\uc785\ub2c8\ub2e4. entrypoint.sh #!/bin/sh # # This script launches nginx and the NGINX Controller Agent. # # Variables agent_conf_file=\"/etc/controller-agent/agent.conf\" agent_log_file=\"/var/log/nginx-controller/agent.log\" nginx_status_conf=\"/etc/nginx/conf.d/stub_status.conf\" api_key=\"\" instance_name=\"$(hostname -f)\" controller_api_url=\"\" location=\"\" handle_term() { echo \"received TERM signal\" echo \"stopping controller-agent ...\" kill -TERM \"${agent_pid}\" 2>/dev/null echo \"stopping nginx ...\" kill -TERM \"${nginx_pid}\" 2>/dev/null } trap 'handle_term' TERM # Launch nginx echo \"starting nginx ...\" nginx -g \"daemon off;\" & nginx_pid=$! wait_workers() { while ! pgrep -f 'nginx: worker process' >/dev/null 2>&1; do echo \"waiting for nginx workers ...\" sleep 2 done } wait_workers test -n \"${ENV_CONTROLLER_API_KEY}\" && \\ api_key=${ENV_CONTROLLER_API_KEY} # if instance_name is defined in the env vars, use it test -n \"${ENV_CONTROLLER_INSTANCE_NAME}\" && \\ instance_name=${ENV_CONTROLLER_INSTANCE_NAME} test -n \"${ENV_CONTROLLER_API_URL}\" && \\ controller_api_url=${ENV_CONTROLLER_API_URL} test -n \"${ENV_CONTROLLER_LOCATION}\" && \\ location=${ENV_CONTROLLER_LOCATION} test -n \"${ENV_CONTROLLER_INSTANCE_GROUP}\" && \\ instance_group=${ENV_CONTROLLER_INSTANCE_GROUP} if [ -n \"${api_key}\" -o -n \"${instance_name}\" -o -n \"${controller_api_url}\" -o -n \"${location}\" -o -n \"${instance_group}\" ]; then echo \"updating ${agent_conf_file} ...\" if [ ! -f \"${agent_conf_file}\" ]; then test -f \"${agent_conf_file}.default\" && \\ cp -p \"${agent_conf_file}.default\" \"${agent_conf_file}\" || \\ { echo \"no ${agent_conf_file}.default found! exiting.\"; exit 1; } fi test -n \"${api_key}\" && \\ echo \" ---> using api_key = ${api_key}\" && \\ sh -c \"sed -i.old -e 's/api_key.*$/api_key = $api_key/' \\ ${agent_conf_file}\" test -n \"${controller_api_url}\" && \\ echo \" ---> using controller api url = ${controller_api_url}\" && \\ sh -c \"sed -i.old -e 's@^api_url.*@api_url = $controller_api_url@' \\ ${agent_conf_file}\" test -n \"${instance_name}\" && \\ echo \" ---> using instance_name = ${instance_name}\" && \\ sh -c \"sed -i.old -e 's/instance_name.*$/instance_name = $instance_name/' \\ ${agent_conf_file}\" test -n \"${location}\" && \\ echo \" ---> using location = ${location}\" && \\ sh -c \"sed -i.old -e 's/location_name.*$/location_name = $location/' \\ ${agent_conf_file}\" test -n \"${instance_group}\" && \\ echo \" ---> using instance group = ${instance_group}\" && \\ sh -c \"sed -i.old -e 's/instance_group.*$/instance_group = $instance_group/' \\ ${agent_conf_file}\" test -f \"${agent_conf_file}\" && \\ chmod 644 ${agent_conf_file} && \\ chown nginx ${agent_conf_file} > /dev/null 2>&1 test -f \"${nginx_status_conf}\" && \\ chmod 644 ${nginx_status_conf} && \\ chown nginx ${nginx_status_conf} > /dev/null 2>&1 fi if ! grep '^api_key.*=[ ]*[[:alnum:]].*' ${agent_conf_file} > /dev/null 2>&1; then echo \"no api_key found in ${agent_conf_file}! exiting.\" exit 1 fi echo \"starting controller-agent ...\" /usr/bin/nginx-controller-agent > /dev/null 2>&1 < /dev/null & agent_pid=$! if [ $? != 0 ]; then echo \"couldn't start the agent, please check ${agent_log_file}\" exit 1 fi wait_term() { wait ${agent_pid} trap - TERM kill -QUIT \"${nginx_pid}\" 2>/dev/null echo \"waiting for nginx to stop...\" wait ${nginx_pid} } wait_term echo \"controller-agent process has stopped, exiting.\" entrypoint.sh\ud30c\uc77c\uc740 \ud06c\uac8c \ub450 \ubd80\ubd84\uc73c\ub85c \uad6c\ubd84\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. API GW \uc774\ubbf8\uc9c0 \ub0b4\uc758 agent.conf \ud30c\uc77c \uc218\uc815 (\ubcc0\uc218 Override) conf \uc218\uc815\uc5d0 \ub530\ub978 NGINX\uc640 Controller-agent\uc758 \uc7ac\uc2dc\uc791 Controller \uc124\uce58 \uacfc\uc815\uc5d0\uc11c \uc0dd\uc131\ub41c api_key, controller_api_url, location \ub4f1\uc758 \uc124\uc815 \uac12\uc744 Entrypoint.sh\ub97c \ud1b5\ud574, ENV\uc5d0\uc11c \uc124\uc815\ud55c \uac12\uc73c\ub85c \uc7ac\ubc18\uc601\ud558\ub3c4\ub85d \uc791\uc131\ud55c \uac83\uc73c\ub85c \ubcf4\uc785\ub2c8\ub2e4. \ub530\ub77c\uc11c, Kubernetes Deployment YAML \ud30c\uc77c\uc744 \ud1b5\ud574 API Key, Location, \uadf8\ub9ac\uace0 5\uc6d4 \ub9d0 \uae30\uc900 \uc544\uc9c1 \ubca0\ud0c0 \uae30\ub2a5\uc778 instance group\uae4c\uc9c0 \ubcc0\uc218\ub97c override\ud558\uc5ec \uc0ac\uc6a9\ud560 \uc218 \uc788\uaca0\uc2b5\ub2c8\ub2e4. Override\ud574\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ubcc0\uc218\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. ENV_CONTROLLER_API_KEY ENV_CONTROLLER_API_URL ENV_CONTROLLER_INSTANCE_NAME ENV_CONTROLLER_LOCATION ENV_CONTROLLER_INSTANCE_GROUP nginx-plus-api.conf server { listen 8080; location /api/ { api write=on; } location = /dashboard.html { root /usr/share/nginx/html; } # Redirect requests for \"/\" to \"/dashboard.html\" location / { return 301 /dashboard.html; } # Redirect requests for pre-R14 dashboard location /status.html { return 301 /dashboard.html; } } # vim: syntax=nginx Controller-agent\ub294 \uac01 API Gateway\uc758 Metric \uac12\uc744 API \uc870\ud68c\ub97c \ud1b5\ud574 \uac00\uc838\uc635\ub2c8\ub2e4. \uc774\ub97c \uc704\ud55c NGINX Server Context config\uc785\ub2c8\ub2e4.","title":"Requirements"},{"location":"NGINX-Plus/NGINX-Controller/API-GW-Image-build-NAP/#docker-build","text":"Build \uba85\ub839\uc5b4\ub294 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4. sudo docker build --build-arg CONTROLLER_URL=https://<fqdn>/install/controller-agent --build-arg API_KEY='abcdefxxxxxx' -t nginx-agent . Build-argument\uc778 CONTROLLER_URL\uc740 Controller \ubc84\uc804\uc5d0 \ub530\ub77c \ub2e4\ub97c \uc218 \uc788\uc2b5\ub2c8\ub2e4. NGINX Controller v3.10 \uc774\uc804 CONTROLLER_URL=https://<fqdn>:8443/1.4/install/controller NGINX Controller v3.11 \uc774\ud6c4 CONTROLLER_URL=https://<fqdn>/install/controller-agent","title":"Docker Build"},{"location":"NGINX-Plus/NGINX-Controller/Arcadia-and-NGINX-Controller-Configuration-Hands-on/","text":"Arcadia and NGINX Controller Configuration \u00b6 Arcadia Finance Application \uc124\uce58 \ubc0f NGINX Controller ADC, APIM Config Hands-on \uc608\uc81c\uc785\ub2c8\ub2e4. Test Application\uc778 Arcadia Finance\ub294 Docker \uc124\uce58\uc640 Kubernetes \uc124\uce58\ub97c \uac01\uac01 \uc548\ub0b4\ud558\uba70, Docker, Kubernetes \ud658\uacbd \uc790\uccb4\uc758 \uad6c\uc131 \ubc29\ubc95\uc740 \uc774 \ubb38\uc11c\uc5d0\uc11c \ub2e4\ub8e8\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc774 \ubb38\uc11c\uc5d0\ub294 NGINX Controller\uc758 Service Config\uc5d0 \ub300\ud574 \uc548\ub0b4\ud558\uba70, Instance \ucd94\uac00 \uac19\uc740 Infrastructure \uba54\ub274\uc5d0 \ub300\ud574\uc11c\ub294 \ub2e4\ub8e8\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. NGINX Controller\ub294 \ubc84\uc804\uc5d0 \ud070 \uad00\uacc4\uac00 \uc5c6\uc73c\ub098 \uc774 \ubb38\uc11c\uc5d0\uc11c\ub294 3.18\ubc84\uc804\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \ub9ac\ub205\uc2a4\ub294 CentOS 7\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. Arcadia Deployment \u00b6 Arcadia Finance application\uc740 Stock Budget, Money Transfer, Refer Friend \ub4f1\uc758 \uae30\ub2a5\uc744 4 \uac1c\uc758 Micro Service \ud615\uc2dd\uc73c\ub85c \uad6c\ud604\ud574\ub193\uc740 Lab \ud658\uacbd \uad6c\ucd95\uc6a9 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc785\ub2c8\ub2e4. \uc544\ub798 \ub9c1\ud06c\uc5d0\uc11c \ub514\ud14c\uc77c\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Arcadia Finance Application Gitlab - Arcadia Gitlab f5 NGINX Controller 3.x with BIG-IP Lab - BIG-IP\uc640 NGINX Controller\uc758 \uc5f0\ub3d9 (Arcadia App \uc608\uc2dc) \uac01 \ub9c8\uc774\ud06c\ub85c\uc11c\ube44\uc2a4\uc758 \uc0c1\uc138\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. App URI Container Port : Host Port Main / 80 : 30511 Backend /files 80 : 31584 App2 /api 80 : 30362 App3 /app3 80 : 31662 Host Port\ub294 \ubcc0\uacbd\ub418\uc5b4\ub3c4 \ubb34\ubc29\ud558\uc9c0\ub9cc, Gitlab\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 Kubernetes Material YAML\uacfc \ub3d9\uc77c\ud558\ub3c4\ub85d \uc791\uc131\ud588\uc2b5\ub2c8\ub2e4. Arcadia (Docker) \u00b6 Arcadia Gitlab\uc5d0\uc11c\ub294 NGINX OSS\uae4c\uc9c0 \uc124\uce58\ud558\ub3c4\ub85d \uc548\ub0b4\ud558\uace0 \uc788\uc9c0\ub9cc, NGINX Controller \ubc0f NGINX API Gateway\uac00 \uadf8 \ubd80\ubd84\uc744 \ub300\uccb4\ud558\ub3c4\ub85d \ud558\uae30 \uc704\ud574 NGINX OSS\ub294 \uc124\uce58\ud558\uc9c0 \uc54a\uc73c\uba70, \uac01\uac01\uc758 \ub9c8\uc774\ud06c\ub85c \uc11c\ube44\uc2a4\uac00 \ubcc4\ub3c4 \ud3ec\ud2b8\ub85c \ub3d9\uc791\ud558\ub3c4\ub85d \ud569\ub2c8\ub2e4. docker network create internal docker run -dit --net=internal -h mainapp --name=mainapp -p 30511:80 \\ registry.gitlab.com/arcadia-application/main-app/mainapp:latest docker run -dit --net=internal -h backend --name=backend -p 31584:80 \\ registry.gitlab.com/arcadia-application/back-end/backend:latest docker run -dit --net=internal -h app2 --name=app2 -p 30362:80 \\ registry.gitlab.com/arcadia-application/app2/app2:latest docker run -dit --net=internal -h app3 --name=app3 -p 31662:80 \\ registry.gitlab.com/arcadia-application/app3/app3:latest Docker\ub294 Service Discovery\ub97c \uc704\ud55c Embedded DNS(127.0.0.11)\uc744 \uac16\uace0 \uc788\uc73c\uba70, Arcadia \uac01 Container Image \ub0b4\ubd80\uc758 php \uc2a4\ud06c\ub9bd\ud2b8\uac00 Embedded DNS\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uc544\ub798 \uba85\ub839\uc5b4\ub85c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. bash docker exec mainapp ping app3 \uc989, Container\uc758 name\uc744 \uae30\uc900\uc73c\ub85c \ucc38\uc870 \ubc0f API Query \ud558\uae30 \ub54c\ubb38\uc5d0 Network \uc0dd\uc131 \ubc0f --net=internal \ud50c\ub798\uadf8 \uc9c0\uc815\uc774 \ubc18\ub4dc\uc2dc \ud544\uc694\ud569\ub2c8\ub2e4. \uc624\ub958\uac00 \uc788\uac70\ub098 \uae30\ud0c0 Container \uc7ac\uc2dc\uc791\uc774 \ud544\uc694\ud55c \uacbd\uc6b0 \uc544\ub798 \ucee4\ub9e8\ub4dc\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. bash docker stop `docker ps -a | grep -i gitlab | gawk '{ print $1 }'` docker rm `docker ps -a | grep -i gitlab | gawk '{ print $1 }'` Arcadia (Kubernetes) \u00b6 Kubernetes\uc5d0 Arcadia\ub97c \ubc30\ud3ec\ud558\ub294 \ubc29\ubc95\uc740 \uac04\ub2e8\ud569\ub2c8\ub2e4. \uc544\ub798 \uba85\ub839\uc5b4\ub85c yaml \ud30c\uc77c \uc790\uccb4\ub97c Gitlab\uc5d0\uc11c \uadf8\ub300\ub85c \ub530\uc62c \uc218 \uc788\uc2b5\ub2c8\ub2e4. kubectl apply -f https://gitlab.com/arcadia-application/kubernetes-materials/-/blob/master/kubernetes_deployments/arcadia-all.yaml \ucc38\uace0\ub85c YAML \ud30c\uc77c\uc758 \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. ######################################################################################### # FILES - BACKEND ######################################################################################### apiVersion: v1 kind: Service metadata: name: backend labels: app: backend service: backend spec: type: NodePort ports: - port: 80 nodePort: 31584 name: backend-80 selector: app: backend --- apiVersion: apps/v1 kind: Deployment metadata: name: backend namespace: default labels: app: backend version: v1 spec: replicas: 1 selector: matchLabels: app: backend version: v1 template: metadata: labels: app: backend version: v1 spec: containers: - env: - name: service_name value: backend image: registry.gitlab.com/arcadia-application/back-end/backend:latest imagePullPolicy: IfNotPresent name: backend ports: - containerPort: 80 protocol: TCP --- ######################################################################################### # MAIN ######################################################################################### apiVersion: v1 kind: Service metadata: name: main namespace: default labels: app: main service: main spec: type: NodePort ports: - name: main-80 nodePort: 30511 port: 80 protocol: TCP targetPort: 80 selector: app: main --- apiVersion: apps/v1 kind: Deployment metadata: name: main namespace: default labels: app: main version: v1 spec: replicas: 1 selector: matchLabels: app: main version: v1 template: metadata: labels: app: main version: v1 spec: containers: - env: - name: service_name value: main image: registry.gitlab.com/arcadia-application/main-app/mainapp:latest imagePullPolicy: IfNotPresent name: main ports: - containerPort: 80 protocol: TCP --- ######################################################################################### # APP2 ######################################################################################### apiVersion: v1 kind: Service metadata: name: app2 namespace: default labels: app: app2 service: app2 spec: type: NodePort ports: - port: 80 name: app2-80 nodePort: 30362 selector: app: app2 --- apiVersion: apps/v1 kind: Deployment metadata: name: app2 namespace: default labels: app: app2 version: v1 spec: replicas: 1 selector: matchLabels: app: app2 version: v1 template: metadata: labels: app: app2 version: v1 spec: containers: - env: - name: service_name value: app2 image: registry.gitlab.com/arcadia-application/app2/app2:latest imagePullPolicy: IfNotPresent name: app2 ports: - containerPort: 80 protocol: TCP --- ######################################################################################### # APP3 ######################################################################################### apiVersion: v1 kind: Service metadata: name: app3 namespace: default labels: app: app3 service: app3 spec: type: NodePort ports: - port: 80 name: app3-80 nodePort: 31662 selector: app: app3 --- apiVersion: apps/v1 kind: Deployment metadata: name: app3 namespace: default labels: app: app3 version: v1 spec: replicas: 1 selector: matchLabels: app: app3 version: v1 template: metadata: labels: app: app3 version: v1 spec: containers: - env: - name: service_name value: app3 image: registry.gitlab.com/arcadia-application/app3/app3:latest imagePullPolicy: IfNotPresent name: app3 ports: - containerPort: 80 protocol: TCP --- NGINX Controller ADC Configuration \u00b6 \uc774\ubc88 \ub2e8\uacc4\uc5d0\uc11c\ub294 NGINX Controller \uc124\uc815\uc744 \ud1b5\ud574 API GW\ub85c \uc544\ub798\uc640 \uac19\uc774 Config\ub97c \uc218\ud589\ud569\ub2c8\ub2e4. Main App\uacfc Backend\ub294 PHP \uc2a4\ud06c\ub9bd\ud2b8 \uc0c1, Embedded DNS\ub97c \uc0ac\uc6a9\ud558\ub3c4\ub85d URI\uac00 \uad6c\uc131\ub418\uc5b4, \uc9c1\uc811 \ud1b5\uc2e0\ub418\uc5b4\uc57c \ud558\ubbc0\ub85c, \uc2e4\uc81c NGINX Controller\uc5d0\uc11c Config\ub97c \uc218\ud589\ud560 \ub0b4\uc6a9\uc740, App2\uc640 App3\uc785\ub2c8\ub2e4. 1. Environment \u00b6 \uac00\uc7a5 \uba3c\uc800 Environment\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4. NGINX Controller\uc758 Environment\ub294 Kubernetes\uc758 Namespace\uc640 \uc720\uc0ac\ud55c \uac1c\ub150\uc73c\ub85c, \uc11c\ub85c \ub2e4\ub978 Environment\uc5d0 \uc18d\ud55c \uc694\uc18c\ub4e4\uc740 \uc11c\ub85c\ub97c \ucc38\uc870\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. 2. Gateway \u00b6 \ub2e4\uc74c\uc73c\ub85c\ub294 Gateway\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4. Instance\ub97c \uc9c1\uc811 \ucc38\uc870\ud558\ub294 Static\ud55c \ubc29\uc2dd\uacfc, Instance Group\uc744 \ucc38\uc870\ud558\uc5ec \ud574\ub2f9 Instance Group\uc5d0 \uc18d\ud558\ub294 \ubaa8\ub4e0 Instance\uc5d0 \uac19\uc740 Config\ub97c Push\ud558\ub294 Dynamic\ud55c \ubc29\uc2dd\uc744 \uc120\ud0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ud14c\uc2a4\ud2b8\uc5d0\uc11c\ub294 Static\ud558\uac8c Instance\ub97c \uc120\ud0dd\ud569\ub2c8\ub2e4. Gateway\uc5d0\ub294 \uc811\uadfc \uac00\ub2a5\ud55c FQDN\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \uc774 Config\ub294 NGINX Config\uc5d0\uc11c server_name Directive\ub85c \uc9c0\uc815\ub429\ub2c8\ub2e4. 3. App \u00b6 \ub2e4\uc74c\uc73c\ub85c\ub294 Component\uac00 \uc18d\ud558\uac8c \ub420 App\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4. Service \uad6c\uc131 \uc694\uc18c \uc911, \uc9c0\uae08 \uc0dd\uc131\ud55c App\uc740 Components\uc758 \ucee8\ud14c\uc774\ub108 \uc5ed\ud560\uc744 \uc218\ud589\ud558\uba70, App\uc758 \uc0dd\uc131 \uc790\uccb4\ub9cc\uc73c\ub85c\ub294 \uc544\ubb34\ub7f0 \ud2b8\ub798\ud53d \uc81c\uc5b4 \ud6a8\uacfc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4. \uc2e4\uc81c \ud2b8\ub798\ud53d \uc81c\uc5b4 \ubc0f \uac01\uc885 Config\ub294 Component\uc5d0\uc11c \uc218\ud589\ud558\uac8c \ub429\ub2c8\ub2e4. 4. App - Component ( Main app, /) \u00b6 URI\ub294 \uc0c1\ub300\uacbd\ub85cRelative Path, \uc808\ub300\uacbd\ub85cAbsolute Path \uc911 \ubb34\uc5c7\uc744 \uc0ac\uc6a9\ud574\ub3c4 \uad1c\ucc2e\uc2b5\ub2c8\ub2e4. \ud14c\uc2a4\ud2b8\uc5d0\uc11c\ub294 \uc0c1\ub300 \uacbd\ub85c\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uc774 Config\ub294 NGINX Config\uc5d0\uc11c Location Directive\ub85c \uc9c0\uc815\ub429\ub2c8\ub2e4. 5. App - Component ( App2, /api ) \u00b6 6. App - Component ( App3, /app3 ) \u00b6 NGINX Controller APIM Configuration \u00b6 NGINX Controller\uc758 Component\ub294 App Component, API Component\ub85c \uad6c\ubd84\ub429\ub2c8\ub2e4. Arcadia Finance Application\uc740 OAS3 \ud3ec\ub9f7\uc73c\ub85c API Spec\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \uc6d0\ubb38 OAS3 \ud3ec\ub9f7\uc758 YAML \ud30c\uc77c\uc740 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. \ucd9c\ucc98\ub294 Swagger App - Arcadia-OAS3 Schema \uc785\ub2c8\ub2e4. Arcadia API Specification - OAS3 openapi: 3.0.3 info: description: Arcadia OpenAPI title: API Arcadia Finance version: 2.0.1-schema paths: /trading/rest/buy_stocks.php: post: summary: Add stocks to your portfolio requestBody: required: true content: application/json: schema: $ref: '#/components/schemas/buy' example: trans_value: '312' qty: '16' company: MSFT action: buy stock_price: '198' responses: '200': description: 200 response content: application/json: example: status: success name: Microsoft qty: '16' amount: '312' transid: '855415223' /trading/rest/sell_stocks.php: post: summary: Sell stocks that you own requestBody: required: true content: application/json: schema: $ref: '#/components/schemas/sell' example: trans_value: '212' qty: '16' company: MSFT action: sell stock_price: '158' responses: '200': description: 200 response content: application/json: example: status: success name: Microsoft qty: '16' amount: '212' transid: '658854124' /trading/transactions.php: get: summary: Get the latests transactions that have happened responses: '200': description: 200 response content: application/json: example: YourLastTransaction: MFST 2000 /api/rest/execute_money_transfer.php: post: summary: Transfer money to a friend requestBody: required: true content: application/json: schema: $ref: '#/components/schemas/money_transfer' example: amount: '92' account: '2075894' currency: GBP friend: Vincent responses: '200': description: 200 response content: application/json: example: name: Vincent status: success currency: GBP transid: '524569855' msg: The money transfer has been successfully completed components: schemas: buy: type: object required: - trans_value - qty - company - action - stock_price properties: trans_value: type: integer format: int64 qty: type: integer format: int64 company: type: string action: type: string stock_price: type: integer format: int64 sell: type: object required: - trans_value - qty - company - action - stock_price properties: trans_value: type: integer format: int64 qty: type: integer format: int64 company: type: string action: type: string stock_price: type: integer format: int64 money_transfer: type: object required: - amount - account - currency - friend properties: amount: type: integer format: int64 account: type: integer format: int64 currency: type: string friend: type: string API Definition \u00b6 API Definition\uc740 NGINX Controller ADC \ubd80\ubd84\uc5d0\uc11c App\uc774 Component\ub4e4\uc758 \ucee8\ud14c\uc774\ub108 \uc5ed\ud560\uc744 \ud55c \uac83\ucc98\ub7fc, API Version\uc744 \ub2f4\ub294 Container\ub77c\uace0 \uc0dd\uac01\ud558\uba74 \ub418\uaca0\uc2b5\ub2c8\ub2e4. API Definition\uc740 Environment\uc5d0 \uc885\uc18d\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc774\ub294 MSA\ub97c \uac00\uc815\ud588\uc744 \ub54c, \uc11c\ub85c \ub2e4\ub978 \uc571\uc5d0\uc11c \ud544\uc694\ud55c \uc720\uc0ac\ud55c \uae30\ub2a5\uc744 \ub3d9\uc77c\ud55c API\ub85c \uad6c\ud604\ud560 \uc218 \uc788\ub3c4\ub85d \ud558\uae30 \uc704\ud55c \ubd80\ubd84\uc73c\ub85c \ubcf4\uc785\ub2c8\ub2e4. API Version \u00b6 API Version\uc740 \ub9d0\uadf8\ub300\ub85c \ud2b9\uc815 API Definition\uc758 Version\uc5d0 \ub300\ud55c \uc0c1\uc138\ub97c \uc791\uc131\ud558\ub294 \ubd80\ubd84\uc73c\ub85c \uc774\ud574\ud558\uba74 \ub418\uaca0\uc2b5\ub2c8\ub2e4. OAS3 \ud3ec\ub9f7\uc73c\ub85c \uc81c\uacf5\ud55c YAML \ud30c\uc77c\ub3c4 \uc774 API Version \uc0dd\uc131 \uacfc\uc815\uc5d0\uc11c \ubc18\uc601\ud558\uac8c \ub429\ub2c8\ub2e4. \ub9cc\uc77c API Version\uc758 \uc0c1\uc138\uc5d0 \ub300\ud55c YAML \ud30c\uc77c\uc774 \uc5c6\ub2e4\uba74, \uc9c1\uc811 \uc791\uc131(Configure Manually)\ud574\ub3c4 \ubb34\ubc29\ud569\ub2c8\ub2e4. API Version\uc740 API Definition\uc5d0 \uc18d\ud558\ub294 \uc694\uc18c\ub85c\uc11c, API Definition\uc758 \ud2b9\uc9d5\uacfc \ube44\uc2b7\ud558\uac8c Environment\uc5d0 \uc18d\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc55e\uc11c API Definition\uc744 App - Component \uad00\uacc4\uc640 \ube44\uad50\ud574 \uc124\uba85\ud588\uc9c0\ub9cc, \uadf8\uc640\ub294 \uc870\uae08 \ub2e4\ub974\uac8c API Version\uc740 \uc2e4\uc81c \ud2b8\ub798\ud53d\uc744 \uc81c\uc5b4\ud558\ub294 Config\uc5d0 \uc9c1\uc811\uc801\uc778 \uc601\ud5a5\uc744 \uc8fc\uc9c0 \uc54a\uace0 \ud55c \ub2e8\uacc4\uac00 \ub354 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ub2e4\uc74c \uacfc\uc815\uc5d0\uc11c \uc0dd\uc131\ud560 Published API \ubd80\ubd84\uc5d0\uc11c, \ud2b9\uc815 API Version\uc744 Publish\ud558\ub294 \uacfc\uc815\uc744 \uac70\uccd0 Component\ub97c \uc5f0\uacb0\ud558\uac8c \ub418\uba74 \uadf8\uc81c\uc11c\uc57c NGINX Config\ub85c\uc11c \uc2e4\uc81c \ud2b8\ub798\ud53d \uc81c\uc5b4\uc5d0 \uad00\uc5ec\ud558\uac8c \ub429\ub2c8\ub2e4. Published API \u00b6 Published API\ub294 \uc55e\uc120 \uacfc\uc815\uc5d0\uc11c \uc791\uc131\ud55c API Definition\uc758 \ud2b9\uc815 Version\uc744 \uc2e4\uc81c Component\uc640 \uc5f0\uacb0\ud558\ub294 \uc791\uc5c5\uc73c\ub85c \uc2e4\uc81c \ud2b8\ub798\ud53d Config\uc640 \uc9c1\uc811\uc801\uc778 \uad00\uacc4\uac00 \uc788\ub294 \ubd80\ubd84\uc785\ub2c8\ub2e4.","title":"Arcadia and NGINX Controller Configuration"},{"location":"NGINX-Plus/NGINX-Controller/Arcadia-and-NGINX-Controller-Configuration-Hands-on/#arcadia-and-nginx-controller-configuration","text":"Arcadia Finance Application \uc124\uce58 \ubc0f NGINX Controller ADC, APIM Config Hands-on \uc608\uc81c\uc785\ub2c8\ub2e4. Test Application\uc778 Arcadia Finance\ub294 Docker \uc124\uce58\uc640 Kubernetes \uc124\uce58\ub97c \uac01\uac01 \uc548\ub0b4\ud558\uba70, Docker, Kubernetes \ud658\uacbd \uc790\uccb4\uc758 \uad6c\uc131 \ubc29\ubc95\uc740 \uc774 \ubb38\uc11c\uc5d0\uc11c \ub2e4\ub8e8\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc774 \ubb38\uc11c\uc5d0\ub294 NGINX Controller\uc758 Service Config\uc5d0 \ub300\ud574 \uc548\ub0b4\ud558\uba70, Instance \ucd94\uac00 \uac19\uc740 Infrastructure \uba54\ub274\uc5d0 \ub300\ud574\uc11c\ub294 \ub2e4\ub8e8\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. NGINX Controller\ub294 \ubc84\uc804\uc5d0 \ud070 \uad00\uacc4\uac00 \uc5c6\uc73c\ub098 \uc774 \ubb38\uc11c\uc5d0\uc11c\ub294 3.18\ubc84\uc804\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \ub9ac\ub205\uc2a4\ub294 CentOS 7\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4.","title":"Arcadia and NGINX Controller Configuration"},{"location":"NGINX-Plus/NGINX-Controller/Arcadia-and-NGINX-Controller-Configuration-Hands-on/#arcadia-deployment","text":"Arcadia Finance application\uc740 Stock Budget, Money Transfer, Refer Friend \ub4f1\uc758 \uae30\ub2a5\uc744 4 \uac1c\uc758 Micro Service \ud615\uc2dd\uc73c\ub85c \uad6c\ud604\ud574\ub193\uc740 Lab \ud658\uacbd \uad6c\ucd95\uc6a9 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc785\ub2c8\ub2e4. \uc544\ub798 \ub9c1\ud06c\uc5d0\uc11c \ub514\ud14c\uc77c\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Arcadia Finance Application Gitlab - Arcadia Gitlab f5 NGINX Controller 3.x with BIG-IP Lab - BIG-IP\uc640 NGINX Controller\uc758 \uc5f0\ub3d9 (Arcadia App \uc608\uc2dc) \uac01 \ub9c8\uc774\ud06c\ub85c\uc11c\ube44\uc2a4\uc758 \uc0c1\uc138\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. App URI Container Port : Host Port Main / 80 : 30511 Backend /files 80 : 31584 App2 /api 80 : 30362 App3 /app3 80 : 31662 Host Port\ub294 \ubcc0\uacbd\ub418\uc5b4\ub3c4 \ubb34\ubc29\ud558\uc9c0\ub9cc, Gitlab\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 Kubernetes Material YAML\uacfc \ub3d9\uc77c\ud558\ub3c4\ub85d \uc791\uc131\ud588\uc2b5\ub2c8\ub2e4.","title":"Arcadia Deployment"},{"location":"NGINX-Plus/NGINX-Controller/Arcadia-and-NGINX-Controller-Configuration-Hands-on/#arcadia-docker","text":"Arcadia Gitlab\uc5d0\uc11c\ub294 NGINX OSS\uae4c\uc9c0 \uc124\uce58\ud558\ub3c4\ub85d \uc548\ub0b4\ud558\uace0 \uc788\uc9c0\ub9cc, NGINX Controller \ubc0f NGINX API Gateway\uac00 \uadf8 \ubd80\ubd84\uc744 \ub300\uccb4\ud558\ub3c4\ub85d \ud558\uae30 \uc704\ud574 NGINX OSS\ub294 \uc124\uce58\ud558\uc9c0 \uc54a\uc73c\uba70, \uac01\uac01\uc758 \ub9c8\uc774\ud06c\ub85c \uc11c\ube44\uc2a4\uac00 \ubcc4\ub3c4 \ud3ec\ud2b8\ub85c \ub3d9\uc791\ud558\ub3c4\ub85d \ud569\ub2c8\ub2e4. docker network create internal docker run -dit --net=internal -h mainapp --name=mainapp -p 30511:80 \\ registry.gitlab.com/arcadia-application/main-app/mainapp:latest docker run -dit --net=internal -h backend --name=backend -p 31584:80 \\ registry.gitlab.com/arcadia-application/back-end/backend:latest docker run -dit --net=internal -h app2 --name=app2 -p 30362:80 \\ registry.gitlab.com/arcadia-application/app2/app2:latest docker run -dit --net=internal -h app3 --name=app3 -p 31662:80 \\ registry.gitlab.com/arcadia-application/app3/app3:latest Docker\ub294 Service Discovery\ub97c \uc704\ud55c Embedded DNS(127.0.0.11)\uc744 \uac16\uace0 \uc788\uc73c\uba70, Arcadia \uac01 Container Image \ub0b4\ubd80\uc758 php \uc2a4\ud06c\ub9bd\ud2b8\uac00 Embedded DNS\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uc544\ub798 \uba85\ub839\uc5b4\ub85c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. bash docker exec mainapp ping app3 \uc989, Container\uc758 name\uc744 \uae30\uc900\uc73c\ub85c \ucc38\uc870 \ubc0f API Query \ud558\uae30 \ub54c\ubb38\uc5d0 Network \uc0dd\uc131 \ubc0f --net=internal \ud50c\ub798\uadf8 \uc9c0\uc815\uc774 \ubc18\ub4dc\uc2dc \ud544\uc694\ud569\ub2c8\ub2e4. \uc624\ub958\uac00 \uc788\uac70\ub098 \uae30\ud0c0 Container \uc7ac\uc2dc\uc791\uc774 \ud544\uc694\ud55c \uacbd\uc6b0 \uc544\ub798 \ucee4\ub9e8\ub4dc\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. bash docker stop `docker ps -a | grep -i gitlab | gawk '{ print $1 }'` docker rm `docker ps -a | grep -i gitlab | gawk '{ print $1 }'`","title":"Arcadia (Docker)"},{"location":"NGINX-Plus/NGINX-Controller/Arcadia-and-NGINX-Controller-Configuration-Hands-on/#arcadia-kubernetes","text":"Kubernetes\uc5d0 Arcadia\ub97c \ubc30\ud3ec\ud558\ub294 \ubc29\ubc95\uc740 \uac04\ub2e8\ud569\ub2c8\ub2e4. \uc544\ub798 \uba85\ub839\uc5b4\ub85c yaml \ud30c\uc77c \uc790\uccb4\ub97c Gitlab\uc5d0\uc11c \uadf8\ub300\ub85c \ub530\uc62c \uc218 \uc788\uc2b5\ub2c8\ub2e4. kubectl apply -f https://gitlab.com/arcadia-application/kubernetes-materials/-/blob/master/kubernetes_deployments/arcadia-all.yaml \ucc38\uace0\ub85c YAML \ud30c\uc77c\uc758 \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. ######################################################################################### # FILES - BACKEND ######################################################################################### apiVersion: v1 kind: Service metadata: name: backend labels: app: backend service: backend spec: type: NodePort ports: - port: 80 nodePort: 31584 name: backend-80 selector: app: backend --- apiVersion: apps/v1 kind: Deployment metadata: name: backend namespace: default labels: app: backend version: v1 spec: replicas: 1 selector: matchLabels: app: backend version: v1 template: metadata: labels: app: backend version: v1 spec: containers: - env: - name: service_name value: backend image: registry.gitlab.com/arcadia-application/back-end/backend:latest imagePullPolicy: IfNotPresent name: backend ports: - containerPort: 80 protocol: TCP --- ######################################################################################### # MAIN ######################################################################################### apiVersion: v1 kind: Service metadata: name: main namespace: default labels: app: main service: main spec: type: NodePort ports: - name: main-80 nodePort: 30511 port: 80 protocol: TCP targetPort: 80 selector: app: main --- apiVersion: apps/v1 kind: Deployment metadata: name: main namespace: default labels: app: main version: v1 spec: replicas: 1 selector: matchLabels: app: main version: v1 template: metadata: labels: app: main version: v1 spec: containers: - env: - name: service_name value: main image: registry.gitlab.com/arcadia-application/main-app/mainapp:latest imagePullPolicy: IfNotPresent name: main ports: - containerPort: 80 protocol: TCP --- ######################################################################################### # APP2 ######################################################################################### apiVersion: v1 kind: Service metadata: name: app2 namespace: default labels: app: app2 service: app2 spec: type: NodePort ports: - port: 80 name: app2-80 nodePort: 30362 selector: app: app2 --- apiVersion: apps/v1 kind: Deployment metadata: name: app2 namespace: default labels: app: app2 version: v1 spec: replicas: 1 selector: matchLabels: app: app2 version: v1 template: metadata: labels: app: app2 version: v1 spec: containers: - env: - name: service_name value: app2 image: registry.gitlab.com/arcadia-application/app2/app2:latest imagePullPolicy: IfNotPresent name: app2 ports: - containerPort: 80 protocol: TCP --- ######################################################################################### # APP3 ######################################################################################### apiVersion: v1 kind: Service metadata: name: app3 namespace: default labels: app: app3 service: app3 spec: type: NodePort ports: - port: 80 name: app3-80 nodePort: 31662 selector: app: app3 --- apiVersion: apps/v1 kind: Deployment metadata: name: app3 namespace: default labels: app: app3 version: v1 spec: replicas: 1 selector: matchLabels: app: app3 version: v1 template: metadata: labels: app: app3 version: v1 spec: containers: - env: - name: service_name value: app3 image: registry.gitlab.com/arcadia-application/app3/app3:latest imagePullPolicy: IfNotPresent name: app3 ports: - containerPort: 80 protocol: TCP ---","title":"Arcadia (Kubernetes)"},{"location":"NGINX-Plus/NGINX-Controller/Arcadia-and-NGINX-Controller-Configuration-Hands-on/#nginx-controller-adc-configuration","text":"\uc774\ubc88 \ub2e8\uacc4\uc5d0\uc11c\ub294 NGINX Controller \uc124\uc815\uc744 \ud1b5\ud574 API GW\ub85c \uc544\ub798\uc640 \uac19\uc774 Config\ub97c \uc218\ud589\ud569\ub2c8\ub2e4. Main App\uacfc Backend\ub294 PHP \uc2a4\ud06c\ub9bd\ud2b8 \uc0c1, Embedded DNS\ub97c \uc0ac\uc6a9\ud558\ub3c4\ub85d URI\uac00 \uad6c\uc131\ub418\uc5b4, \uc9c1\uc811 \ud1b5\uc2e0\ub418\uc5b4\uc57c \ud558\ubbc0\ub85c, \uc2e4\uc81c NGINX Controller\uc5d0\uc11c Config\ub97c \uc218\ud589\ud560 \ub0b4\uc6a9\uc740, App2\uc640 App3\uc785\ub2c8\ub2e4.","title":"NGINX Controller ADC Configuration"},{"location":"NGINX-Plus/NGINX-Controller/Arcadia-and-NGINX-Controller-Configuration-Hands-on/#1-environment","text":"\uac00\uc7a5 \uba3c\uc800 Environment\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4. NGINX Controller\uc758 Environment\ub294 Kubernetes\uc758 Namespace\uc640 \uc720\uc0ac\ud55c \uac1c\ub150\uc73c\ub85c, \uc11c\ub85c \ub2e4\ub978 Environment\uc5d0 \uc18d\ud55c \uc694\uc18c\ub4e4\uc740 \uc11c\ub85c\ub97c \ucc38\uc870\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.","title":"1. Environment"},{"location":"NGINX-Plus/NGINX-Controller/Arcadia-and-NGINX-Controller-Configuration-Hands-on/#2-gateway","text":"\ub2e4\uc74c\uc73c\ub85c\ub294 Gateway\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4. Instance\ub97c \uc9c1\uc811 \ucc38\uc870\ud558\ub294 Static\ud55c \ubc29\uc2dd\uacfc, Instance Group\uc744 \ucc38\uc870\ud558\uc5ec \ud574\ub2f9 Instance Group\uc5d0 \uc18d\ud558\ub294 \ubaa8\ub4e0 Instance\uc5d0 \uac19\uc740 Config\ub97c Push\ud558\ub294 Dynamic\ud55c \ubc29\uc2dd\uc744 \uc120\ud0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ud14c\uc2a4\ud2b8\uc5d0\uc11c\ub294 Static\ud558\uac8c Instance\ub97c \uc120\ud0dd\ud569\ub2c8\ub2e4. Gateway\uc5d0\ub294 \uc811\uadfc \uac00\ub2a5\ud55c FQDN\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \uc774 Config\ub294 NGINX Config\uc5d0\uc11c server_name Directive\ub85c \uc9c0\uc815\ub429\ub2c8\ub2e4.","title":"2. Gateway"},{"location":"NGINX-Plus/NGINX-Controller/Arcadia-and-NGINX-Controller-Configuration-Hands-on/#3-app","text":"\ub2e4\uc74c\uc73c\ub85c\ub294 Component\uac00 \uc18d\ud558\uac8c \ub420 App\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4. Service \uad6c\uc131 \uc694\uc18c \uc911, \uc9c0\uae08 \uc0dd\uc131\ud55c App\uc740 Components\uc758 \ucee8\ud14c\uc774\ub108 \uc5ed\ud560\uc744 \uc218\ud589\ud558\uba70, App\uc758 \uc0dd\uc131 \uc790\uccb4\ub9cc\uc73c\ub85c\ub294 \uc544\ubb34\ub7f0 \ud2b8\ub798\ud53d \uc81c\uc5b4 \ud6a8\uacfc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4. \uc2e4\uc81c \ud2b8\ub798\ud53d \uc81c\uc5b4 \ubc0f \uac01\uc885 Config\ub294 Component\uc5d0\uc11c \uc218\ud589\ud558\uac8c \ub429\ub2c8\ub2e4.","title":"3. App"},{"location":"NGINX-Plus/NGINX-Controller/Arcadia-and-NGINX-Controller-Configuration-Hands-on/#4-app-component-main-app","text":"URI\ub294 \uc0c1\ub300\uacbd\ub85cRelative Path, \uc808\ub300\uacbd\ub85cAbsolute Path \uc911 \ubb34\uc5c7\uc744 \uc0ac\uc6a9\ud574\ub3c4 \uad1c\ucc2e\uc2b5\ub2c8\ub2e4. \ud14c\uc2a4\ud2b8\uc5d0\uc11c\ub294 \uc0c1\ub300 \uacbd\ub85c\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uc774 Config\ub294 NGINX Config\uc5d0\uc11c Location Directive\ub85c \uc9c0\uc815\ub429\ub2c8\ub2e4.","title":"4. App - Component ( Main app, /)"},{"location":"NGINX-Plus/NGINX-Controller/Arcadia-and-NGINX-Controller-Configuration-Hands-on/#5-app-component-app2-api","text":"","title":"5. App - Component ( App2, /api )"},{"location":"NGINX-Plus/NGINX-Controller/Arcadia-and-NGINX-Controller-Configuration-Hands-on/#6-app-component-app3-app3","text":"","title":"6. App - Component ( App3, /app3 )"},{"location":"NGINX-Plus/NGINX-Controller/Arcadia-and-NGINX-Controller-Configuration-Hands-on/#nginx-controller-apim-configuration","text":"NGINX Controller\uc758 Component\ub294 App Component, API Component\ub85c \uad6c\ubd84\ub429\ub2c8\ub2e4. Arcadia Finance Application\uc740 OAS3 \ud3ec\ub9f7\uc73c\ub85c API Spec\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \uc6d0\ubb38 OAS3 \ud3ec\ub9f7\uc758 YAML \ud30c\uc77c\uc740 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. \ucd9c\ucc98\ub294 Swagger App - Arcadia-OAS3 Schema \uc785\ub2c8\ub2e4. Arcadia API Specification - OAS3 openapi: 3.0.3 info: description: Arcadia OpenAPI title: API Arcadia Finance version: 2.0.1-schema paths: /trading/rest/buy_stocks.php: post: summary: Add stocks to your portfolio requestBody: required: true content: application/json: schema: $ref: '#/components/schemas/buy' example: trans_value: '312' qty: '16' company: MSFT action: buy stock_price: '198' responses: '200': description: 200 response content: application/json: example: status: success name: Microsoft qty: '16' amount: '312' transid: '855415223' /trading/rest/sell_stocks.php: post: summary: Sell stocks that you own requestBody: required: true content: application/json: schema: $ref: '#/components/schemas/sell' example: trans_value: '212' qty: '16' company: MSFT action: sell stock_price: '158' responses: '200': description: 200 response content: application/json: example: status: success name: Microsoft qty: '16' amount: '212' transid: '658854124' /trading/transactions.php: get: summary: Get the latests transactions that have happened responses: '200': description: 200 response content: application/json: example: YourLastTransaction: MFST 2000 /api/rest/execute_money_transfer.php: post: summary: Transfer money to a friend requestBody: required: true content: application/json: schema: $ref: '#/components/schemas/money_transfer' example: amount: '92' account: '2075894' currency: GBP friend: Vincent responses: '200': description: 200 response content: application/json: example: name: Vincent status: success currency: GBP transid: '524569855' msg: The money transfer has been successfully completed components: schemas: buy: type: object required: - trans_value - qty - company - action - stock_price properties: trans_value: type: integer format: int64 qty: type: integer format: int64 company: type: string action: type: string stock_price: type: integer format: int64 sell: type: object required: - trans_value - qty - company - action - stock_price properties: trans_value: type: integer format: int64 qty: type: integer format: int64 company: type: string action: type: string stock_price: type: integer format: int64 money_transfer: type: object required: - amount - account - currency - friend properties: amount: type: integer format: int64 account: type: integer format: int64 currency: type: string friend: type: string","title":"NGINX Controller APIM Configuration"},{"location":"NGINX-Plus/NGINX-Controller/Arcadia-and-NGINX-Controller-Configuration-Hands-on/#api-definition","text":"API Definition\uc740 NGINX Controller ADC \ubd80\ubd84\uc5d0\uc11c App\uc774 Component\ub4e4\uc758 \ucee8\ud14c\uc774\ub108 \uc5ed\ud560\uc744 \ud55c \uac83\ucc98\ub7fc, API Version\uc744 \ub2f4\ub294 Container\ub77c\uace0 \uc0dd\uac01\ud558\uba74 \ub418\uaca0\uc2b5\ub2c8\ub2e4. API Definition\uc740 Environment\uc5d0 \uc885\uc18d\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc774\ub294 MSA\ub97c \uac00\uc815\ud588\uc744 \ub54c, \uc11c\ub85c \ub2e4\ub978 \uc571\uc5d0\uc11c \ud544\uc694\ud55c \uc720\uc0ac\ud55c \uae30\ub2a5\uc744 \ub3d9\uc77c\ud55c API\ub85c \uad6c\ud604\ud560 \uc218 \uc788\ub3c4\ub85d \ud558\uae30 \uc704\ud55c \ubd80\ubd84\uc73c\ub85c \ubcf4\uc785\ub2c8\ub2e4.","title":"API Definition"},{"location":"NGINX-Plus/NGINX-Controller/Arcadia-and-NGINX-Controller-Configuration-Hands-on/#api-version","text":"API Version\uc740 \ub9d0\uadf8\ub300\ub85c \ud2b9\uc815 API Definition\uc758 Version\uc5d0 \ub300\ud55c \uc0c1\uc138\ub97c \uc791\uc131\ud558\ub294 \ubd80\ubd84\uc73c\ub85c \uc774\ud574\ud558\uba74 \ub418\uaca0\uc2b5\ub2c8\ub2e4. OAS3 \ud3ec\ub9f7\uc73c\ub85c \uc81c\uacf5\ud55c YAML \ud30c\uc77c\ub3c4 \uc774 API Version \uc0dd\uc131 \uacfc\uc815\uc5d0\uc11c \ubc18\uc601\ud558\uac8c \ub429\ub2c8\ub2e4. \ub9cc\uc77c API Version\uc758 \uc0c1\uc138\uc5d0 \ub300\ud55c YAML \ud30c\uc77c\uc774 \uc5c6\ub2e4\uba74, \uc9c1\uc811 \uc791\uc131(Configure Manually)\ud574\ub3c4 \ubb34\ubc29\ud569\ub2c8\ub2e4. API Version\uc740 API Definition\uc5d0 \uc18d\ud558\ub294 \uc694\uc18c\ub85c\uc11c, API Definition\uc758 \ud2b9\uc9d5\uacfc \ube44\uc2b7\ud558\uac8c Environment\uc5d0 \uc18d\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc55e\uc11c API Definition\uc744 App - Component \uad00\uacc4\uc640 \ube44\uad50\ud574 \uc124\uba85\ud588\uc9c0\ub9cc, \uadf8\uc640\ub294 \uc870\uae08 \ub2e4\ub974\uac8c API Version\uc740 \uc2e4\uc81c \ud2b8\ub798\ud53d\uc744 \uc81c\uc5b4\ud558\ub294 Config\uc5d0 \uc9c1\uc811\uc801\uc778 \uc601\ud5a5\uc744 \uc8fc\uc9c0 \uc54a\uace0 \ud55c \ub2e8\uacc4\uac00 \ub354 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ub2e4\uc74c \uacfc\uc815\uc5d0\uc11c \uc0dd\uc131\ud560 Published API \ubd80\ubd84\uc5d0\uc11c, \ud2b9\uc815 API Version\uc744 Publish\ud558\ub294 \uacfc\uc815\uc744 \uac70\uccd0 Component\ub97c \uc5f0\uacb0\ud558\uac8c \ub418\uba74 \uadf8\uc81c\uc11c\uc57c NGINX Config\ub85c\uc11c \uc2e4\uc81c \ud2b8\ub798\ud53d \uc81c\uc5b4\uc5d0 \uad00\uc5ec\ud558\uac8c \ub429\ub2c8\ub2e4.","title":"API Version"},{"location":"NGINX-Plus/NGINX-Controller/Arcadia-and-NGINX-Controller-Configuration-Hands-on/#published-api","text":"Published API\ub294 \uc55e\uc120 \uacfc\uc815\uc5d0\uc11c \uc791\uc131\ud55c API Definition\uc758 \ud2b9\uc815 Version\uc744 \uc2e4\uc81c Component\uc640 \uc5f0\uacb0\ud558\ub294 \uc791\uc5c5\uc73c\ub85c \uc2e4\uc81c \ud2b8\ub798\ud53d Config\uc640 \uc9c1\uc811\uc801\uc778 \uad00\uacc4\uac00 \uc788\ub294 \ubd80\ubd84\uc785\ub2c8\ub2e4.","title":"Published API"},{"location":"NGINX-Plus/NGINX-Controller/Build-NGINX-Plus-API-GW-container-image/","text":"NGINX Controller-Enabled NGINX Plus Container Image build \u00b6 Kubernetes / Openshift\uc5d0\uc11c \uc0ac\uc6a9\ud560 NGINX Controller \uc5f0\ub3d9 NGINX Plus Instance \uc758 \uc774\ubbf8\uc9c0 \ube4c\ub4dc \uacfc\uc815\uc744 \uc124\uba85\ud55c \ubb38\uc11c\uc785\ub2c8\ub2e4. NGINX Controller\ub294 Control-plane\uc73c\ub85c\uc11c, NGINX+ Instance\ub97c Dataplane\uc744 \ub2f4\ub2f9\ud558\ub294 API Gateway\ub85c\uc11c \uad00\ub9ac\ud569\ub2c8\ub2e4. N+ API Gateway\ub294 \uc2e4\uc81c \ud2b8\ub798\ud53d\uc744 \ucc98\ub9ac\ud558\ub294 NGINX Plus\uc640 \uc774 NGINX Plus\uc640 NGINX Controller\uc640 \uc5f0\ub3d9\uc744 \uc704\ud55c Controller-agent\uac00 \ubc18\ub4dc\uc2dc \ud544\uc694\ud569\ub2c8\ub2e4. \ucd08\uae30\uc758 API GW \uc774\ubbf8\uc9c0\uc5d0\uc11c\ub294 NGINX Plus\ub97c \uc124\uce58\ud558\uace0, Controller-agent\ub97c Entrypoint \uc2a4\ud06c\ub9bd\ud2b8\uc5d0\uc11c \uc124\uce58\ud558\ub3c4\ub85d \uc124\uacc4\ub410\uc5c8\uc2b5\ub2c8\ub2e4. \uc774 \ubb38\uc11c\uc5d0\uc11c \uc18c\uac1c\ud558\ub294 \ubc29\ubc95\uc740 \uc5c5\ub370\uc774\ud2b8\ub41c \ubc29\uc2dd\uc73c\ub85c, Controller-agent\ub97c \uc774\ubbf8\uc9c0\uc5d0 \ud1b5\ud569 \uc124\uce58\ud558\uc5ec Image Build\ub97c \uc218\ud589\ud558\uace0, Entrypoint \uc2a4\ud06c\ub9bd\ud2b8\uc5d0\uc11c \uc0ac\uc6a9 \ud658\uacbd\uc5d0 \ub9de\ub3c4\ub85d Config Update\ub97c \uc218\ud589\ud558\ub3c4\ub85d \ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ubc29\ubc95\uc740 Kubernetes \ud658\uacbd\uc758 API GW deploy \uacfc\uc815\uc5d0\uc11c Controller agent \uc124\uce58 \uacfc\uc815\uc774 \uc0dd\ub7b5\ub418\uc5b4 \uc989\uac01\uc801\uc778 \uc0ac\uc6a9\uc774 \uac00\ub2a5\ud558\uba70, \ud639\uc2dc \ubaa8\ub97c \uc774\uc288 \uc0c1\ud669\uc5d0\uc11c Downtime\uc774 \ud6e8\uc52c \uc904\uc5b4\ub4dc\ub294 \uacb0\uacfc\ub97c \ubcfc \uc218 \uc788\uc5c8\uc2b5\ub2c8\ub2e4. NGINX Plus Controller-agent \ud1b5\ud569 \uc774\ubbf8\uc9c0 \ube4c\ub4dc \u00b6 Requirements \u00b6 NGINX Plus \uc124\uce58\ub97c \uc704\ud55c NGINX Plus License \ud30c\uc77c nginx-repo.crt, nginx-repo.key Docker Image Build\ub97c \uc704\ud55c dockerfile, entrypoint.sh, nginx-plus-api.conf (\uc544\ub798 \uc608\uc2dc \ubb38\uc11c \ucc38\uc870: \uc608\uc2dc \ubb38\uc11c\ub294 \ubaa8\ub450 NGINX Inc Github \uc5d0\uc11c \uac00\uc838\uc654\uc2b5\ub2c8\ub2e4.) Controller-agent \uc124\uce58\ub97c \uc704\ud55c NGINX Controller dockerfile FROM debian:stretch-slim LABEL maintainer=\"NGINX Controller Engineering\" # e.g '1234567890' ARG API_KEY ENV ENV_CONTROLLER_API_KEY=$API_KEY # e.g https://<fqdn>/install/controller-agent ARG CONTROLLER_URL ENV ENV_CONTROLLER_URL=$CONTROLLER_URL # e.g True or False ARG STORE_UUID=False ENV ENV_CONTROLLER_STORE_UUID=$STORE_UUID # e.g Instance location already defined in Controller ARG LOCATION ENV ENV_CONTROLLER_LOCATION=$LOCATION # e.g Instance group already defined in Controller ARG INSTANCE_GROUP ENV ENV_CONTROLLER_INSTANCE_GROUP=$INSTANCE_GROUP # NGXIN Plus release e.g 23 ARG NGINX_PLUS_VERSION=23 # Download certificate (nginx-repo.crt) and key (nginx-repo.key) from the customer portal (https://cs.nginx.com) # and copy to the build context COPY nginx-repo.* /etc/ssl/nginx/ COPY nginx-plus-api.conf /etc/nginx/conf.d/ COPY entrypoint.sh / # Install NGINX Plus RUN set -ex \\ && apt-get update && apt-get upgrade -y \\ && apt-get install --no-install-recommends --no-install-suggests -y curl sudo procps apt-utils apt-transport-https ca-certificates gnupg1 distro-info-data libmpdec2 \\ lsb-release python python-minimal binutils net-tools \\ && \\ NGINX_GPGKEY=573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62; \\ found=''; \\ for server in \\ ha.pool.sks-keyservers.net \\ hkp://keyserver.ubuntu.com:80 \\ hkp://p80.pool.sks-keyservers.net:80 \\ pgp.mit.edu \\ ; do \\ echo \"Fetching GPG key $NGINX_GPGKEY from $server\"; \\ apt-key adv --keyserver \"$server\" --keyserver-options timeout=10 --recv-keys \"$NGINX_GPGKEY\" && found=yes && break; \\ done; \\ test -z \"$found\" && echo >&2 \"error: failed to fetch GPG key $NGINX_GPGKEY\" && exit 1; \\ echo \"Acquire::https::plus-pkgs.nginx.com::Verify-Peer \\\"true\\\";\" >> /etc/apt/apt.conf.d/90nginx \\ && echo \"Acquire::https::plus-pkgs.nginx.com::Verify-Host \\\"true\\\";\" >> /etc/apt/apt.conf.d/90nginx \\ && echo \"Acquire::https::plus-pkgs.nginx.com::SslCert \\\"/etc/ssl/nginx/nginx-repo.crt\\\";\" >> /etc/apt/apt.conf.d/90nginx \\ && echo \"Acquire::https::plus-pkgs.nginx.com::SslKey \\\"/etc/ssl/nginx/nginx-repo.key\\\";\" >> /etc/apt/apt.conf.d/90nginx \\ && printf \"deb https://plus-pkgs.nginx.com/debian stretch nginx-plus\\n\" > /etc/apt/sources.list.d/nginx-plus.list \\ # NGINX Javascript module needed for APIM && apt-get update && apt-get install -y nginx-plus=${NGINX_PLUS_VERSION}* nginx-plus-module-njs=${NGINX_PLUS_VERSION}* \\ && rm -rf /var/lib/apt/lists/* \\ # Install Controller Agent && curl -k -sS -L ${CONTROLLER_URL} > install.sh \\ && sed -i 's/^assume_yes=\"\"/assume_yes=\"-y\"/' install.sh \\ && sed -i 's,-n \"${NGINX_GPGKEY}\",true,' install.sh \\ && sh ./install.sh -y \\ # cleanup sensitive nginx-plus data && rm /etc/ssl/nginx/nginx-repo.* \\ && rm /etc/apt/sources.list.d/nginx-plus.list \\ && rm /etc/apt/apt.conf.d/90nginx \\ && apt-key del \"$NGINX_GPGKEY\" # Forward request logs to Docker log collector RUN ln -sf /proc/1/fd/1 /var/log/nginx-controller/agent.log \\ && ln -sf /proc/1/fd/2 /var/log/nginx/error.log EXPOSE 80 STOPSIGNAL SIGTERM ENTRYPOINT [\"sh\", \"/entrypoint.sh\"] dockerfile\ub97c \ud070 \ubd80\ubd84\uc73c\ub85c \uad6c\ubd84\ud558\uba74, dockerfile \uad6c\uc131 \uc21c\uc11c\uc5d0 \ub530\ub77c \uc544\ub798\uc640 \uac19\uc774 \uad6c\ubd84\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ubcc0\uc218 \uc124\uc815 \ud30c\ud2b8 N+ \ub77c\uc774\uc120\uc2a4 \ubc0f Repo \uc124\uc815 \ud30c\ud2b8 NGINX Plus \uc124\uce58 \ud30c\ud2b8 NGINX Controller-agent \uc124\uce58 \ud30c\ud2b8 \ubbfc\uac10\uc131/\ubd88\ud544\uc694 \uc815\ubcf4 \uc81c\uac70 \ud30c\ud2b8 Log \uc5f0\uacb0 \ubc0f \uae30\ud0c0 \uc124\uc815 \ubc0f Entrypoint \uc9c0\uc815 \ud30c\ud2b8\uc785\ub2c8\ub2e4. entrypoint.sh #!/bin/sh # # This script launches nginx and the NGINX Controller Agent. # # Variables agent_conf_file=\"/etc/controller-agent/agent.conf\" agent_log_file=\"/var/log/nginx-controller/agent.log\" nginx_status_conf=\"/etc/nginx/conf.d/stub_status.conf\" api_key=\"\" instance_name=\"$(hostname -f)\" controller_api_url=\"\" location=\"\" handle_term() { echo \"received TERM signal\" echo \"stopping controller-agent ...\" kill -TERM \"${agent_pid}\" 2>/dev/null echo \"stopping nginx ...\" kill -TERM \"${nginx_pid}\" 2>/dev/null } trap 'handle_term' TERM # Launch nginx echo \"starting nginx ...\" nginx -g \"daemon off;\" & nginx_pid=$! wait_workers() { while ! pgrep -f 'nginx: worker process' >/dev/null 2>&1; do echo \"waiting for nginx workers ...\" sleep 2 done } wait_workers test -n \"${ENV_CONTROLLER_API_KEY}\" && \\ api_key=${ENV_CONTROLLER_API_KEY} # if instance_name is defined in the env vars, use it test -n \"${ENV_CONTROLLER_INSTANCE_NAME}\" && \\ instance_name=${ENV_CONTROLLER_INSTANCE_NAME} test -n \"${ENV_CONTROLLER_API_URL}\" && \\ controller_api_url=${ENV_CONTROLLER_API_URL} test -n \"${ENV_CONTROLLER_LOCATION}\" && \\ location=${ENV_CONTROLLER_LOCATION} test -n \"${ENV_CONTROLLER_INSTANCE_GROUP}\" && \\ instance_group=${ENV_CONTROLLER_INSTANCE_GROUP} if [ -n \"${api_key}\" -o -n \"${instance_name}\" -o -n \"${controller_api_url}\" -o -n \"${location}\" -o -n \"${instance_group}\" ]; then echo \"updating ${agent_conf_file} ...\" if [ ! -f \"${agent_conf_file}\" ]; then test -f \"${agent_conf_file}.default\" && \\ cp -p \"${agent_conf_file}.default\" \"${agent_conf_file}\" || \\ { echo \"no ${agent_conf_file}.default found! exiting.\"; exit 1; } fi test -n \"${api_key}\" && \\ echo \" ---> using api_key = ${api_key}\" && \\ sh -c \"sed -i.old -e 's/api_key.*$/api_key = $api_key/' \\ ${agent_conf_file}\" test -n \"${controller_api_url}\" && \\ echo \" ---> using controller api url = ${controller_api_url}\" && \\ sh -c \"sed -i.old -e 's@^api_url.*@api_url = $controller_api_url@' \\ ${agent_conf_file}\" test -n \"${instance_name}\" && \\ echo \" ---> using instance_name = ${instance_name}\" && \\ sh -c \"sed -i.old -e 's/instance_name.*$/instance_name = $instance_name/' \\ ${agent_conf_file}\" test -n \"${location}\" && \\ echo \" ---> using location = ${location}\" && \\ sh -c \"sed -i.old -e 's/location_name.*$/location_name = $location/' \\ ${agent_conf_file}\" test -n \"${instance_group}\" && \\ echo \" ---> using instance group = ${instance_group}\" && \\ sh -c \"sed -i.old -e 's/instance_group.*$/instance_group = $instance_group/' \\ ${agent_conf_file}\" test -f \"${agent_conf_file}\" && \\ chmod 644 ${agent_conf_file} && \\ chown nginx ${agent_conf_file} > /dev/null 2>&1 test -f \"${nginx_status_conf}\" && \\ chmod 644 ${nginx_status_conf} && \\ chown nginx ${nginx_status_conf} > /dev/null 2>&1 fi if ! grep '^api_key.*=[ ]*[[:alnum:]].*' ${agent_conf_file} > /dev/null 2>&1; then echo \"no api_key found in ${agent_conf_file}! exiting.\" exit 1 fi echo \"starting controller-agent ...\" /usr/bin/nginx-controller-agent > /dev/null 2>&1 < /dev/null & agent_pid=$! if [ $? != 0 ]; then echo \"couldn't start the agent, please check ${agent_log_file}\" exit 1 fi wait_term() { wait ${agent_pid} trap - TERM kill -QUIT \"${nginx_pid}\" 2>/dev/null echo \"waiting for nginx to stop...\" wait ${nginx_pid} } wait_term echo \"controller-agent process has stopped, exiting.\" entrypoint.sh\ud30c\uc77c\uc740 \ud06c\uac8c \ub450 \ubd80\ubd84\uc73c\ub85c \uad6c\ubd84\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. API GW \uc774\ubbf8\uc9c0 \ub0b4\uc758 agent.conf \ud30c\uc77c \uc218\uc815 (\ubcc0\uc218 Override) conf \uc218\uc815\uc5d0 \ub530\ub978 NGINX\uc640 Controller-agent\uc758 \uc7ac\uc2dc\uc791 Controller \uc124\uce58 \uacfc\uc815\uc5d0\uc11c \uc0dd\uc131\ub41c api_key, controller_api_url, location \ub4f1\uc758 \uc124\uc815 \uac12\uc744 Entrypoint.sh\ub97c \ud1b5\ud574, ENV\uc5d0\uc11c \uc124\uc815\ud55c \uac12\uc73c\ub85c \uc7ac\ubc18\uc601\ud558\ub3c4\ub85d \uc791\uc131\ud55c \uac83\uc73c\ub85c \ubcf4\uc785\ub2c8\ub2e4. \ub530\ub77c\uc11c, Kubernetes Deployment YAML \ud30c\uc77c\uc744 \ud1b5\ud574 API Key, Location, \uadf8\ub9ac\uace0 5\uc6d4 \ub9d0 \uae30\uc900 \uc544\uc9c1 \ubca0\ud0c0 \uae30\ub2a5\uc778 instance group\uae4c\uc9c0 \ubcc0\uc218\ub97c override\ud558\uc5ec \uc0ac\uc6a9\ud560 \uc218 \uc788\uaca0\uc2b5\ub2c8\ub2e4. Override\ud574\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ubcc0\uc218\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. ENV_CONTROLLER_API_KEY ENV_CONTROLLER_API_URL ENV_CONTROLLER_INSTANCE_NAME ENV_CONTROLLER_LOCATION ENV_CONTROLLER_INSTANCE_GROUP nginx-plus-api.conf server { listen 8080; location /api/ { api write=on; } location = /dashboard.html { root /usr/share/nginx/html; } # Redirect requests for \"/\" to \"/dashboard.html\" location / { return 301 /dashboard.html; } # Redirect requests for pre-R14 dashboard location /status.html { return 301 /dashboard.html; } } # vim: syntax=nginx Controller-agent\ub294 \uac01 API Gateway\uc758 Metric \uac12\uc744 API \uc870\ud68c\ub97c \ud1b5\ud574 \uac00\uc838\uc635\ub2c8\ub2e4. \uc774\ub97c \uc704\ud55c NGINX Server Context config\uc785\ub2c8\ub2e4. Docker Build \u00b6 Build \uba85\ub839\uc5b4\ub294 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4. sudo docker build --build-arg CONTROLLER_URL=https://<fqdn>/install/controller-agent --build-arg API_KEY='abcdefxxxxxx' -t nginx-agent . Build-argument\uc778 CONTROLLER_URL\uc740 Controller \ubc84\uc804\uc5d0 \ub530\ub77c \ub2e4\ub97c \uc218 \uc788\uc2b5\ub2c8\ub2e4. NGINX Controller v3.10 \uc774\uc804 CONTROLLER_URL=https://<fqdn>:8443/1.4/install/controller NGINX Controller v3.11 \uc774\ud6c4 CONTROLLER_URL=https://<fqdn>/install/controller-agent","title":"NGINX Controller - NGINX Plus Container Image build"},{"location":"NGINX-Plus/NGINX-Controller/Build-NGINX-Plus-API-GW-container-image/#nginx-controller-enabled-nginx-plus-container-image-build","text":"Kubernetes / Openshift\uc5d0\uc11c \uc0ac\uc6a9\ud560 NGINX Controller \uc5f0\ub3d9 NGINX Plus Instance \uc758 \uc774\ubbf8\uc9c0 \ube4c\ub4dc \uacfc\uc815\uc744 \uc124\uba85\ud55c \ubb38\uc11c\uc785\ub2c8\ub2e4. NGINX Controller\ub294 Control-plane\uc73c\ub85c\uc11c, NGINX+ Instance\ub97c Dataplane\uc744 \ub2f4\ub2f9\ud558\ub294 API Gateway\ub85c\uc11c \uad00\ub9ac\ud569\ub2c8\ub2e4. N+ API Gateway\ub294 \uc2e4\uc81c \ud2b8\ub798\ud53d\uc744 \ucc98\ub9ac\ud558\ub294 NGINX Plus\uc640 \uc774 NGINX Plus\uc640 NGINX Controller\uc640 \uc5f0\ub3d9\uc744 \uc704\ud55c Controller-agent\uac00 \ubc18\ub4dc\uc2dc \ud544\uc694\ud569\ub2c8\ub2e4. \ucd08\uae30\uc758 API GW \uc774\ubbf8\uc9c0\uc5d0\uc11c\ub294 NGINX Plus\ub97c \uc124\uce58\ud558\uace0, Controller-agent\ub97c Entrypoint \uc2a4\ud06c\ub9bd\ud2b8\uc5d0\uc11c \uc124\uce58\ud558\ub3c4\ub85d \uc124\uacc4\ub410\uc5c8\uc2b5\ub2c8\ub2e4. \uc774 \ubb38\uc11c\uc5d0\uc11c \uc18c\uac1c\ud558\ub294 \ubc29\ubc95\uc740 \uc5c5\ub370\uc774\ud2b8\ub41c \ubc29\uc2dd\uc73c\ub85c, Controller-agent\ub97c \uc774\ubbf8\uc9c0\uc5d0 \ud1b5\ud569 \uc124\uce58\ud558\uc5ec Image Build\ub97c \uc218\ud589\ud558\uace0, Entrypoint \uc2a4\ud06c\ub9bd\ud2b8\uc5d0\uc11c \uc0ac\uc6a9 \ud658\uacbd\uc5d0 \ub9de\ub3c4\ub85d Config Update\ub97c \uc218\ud589\ud558\ub3c4\ub85d \ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ubc29\ubc95\uc740 Kubernetes \ud658\uacbd\uc758 API GW deploy \uacfc\uc815\uc5d0\uc11c Controller agent \uc124\uce58 \uacfc\uc815\uc774 \uc0dd\ub7b5\ub418\uc5b4 \uc989\uac01\uc801\uc778 \uc0ac\uc6a9\uc774 \uac00\ub2a5\ud558\uba70, \ud639\uc2dc \ubaa8\ub97c \uc774\uc288 \uc0c1\ud669\uc5d0\uc11c Downtime\uc774 \ud6e8\uc52c \uc904\uc5b4\ub4dc\ub294 \uacb0\uacfc\ub97c \ubcfc \uc218 \uc788\uc5c8\uc2b5\ub2c8\ub2e4.","title":"NGINX Controller-Enabled NGINX Plus Container Image build"},{"location":"NGINX-Plus/NGINX-Controller/Build-NGINX-Plus-API-GW-container-image/#nginx-plus-controller-agent","text":"","title":"NGINX Plus Controller-agent \ud1b5\ud569 \uc774\ubbf8\uc9c0 \ube4c\ub4dc"},{"location":"NGINX-Plus/NGINX-Controller/Build-NGINX-Plus-API-GW-container-image/#requirements","text":"NGINX Plus \uc124\uce58\ub97c \uc704\ud55c NGINX Plus License \ud30c\uc77c nginx-repo.crt, nginx-repo.key Docker Image Build\ub97c \uc704\ud55c dockerfile, entrypoint.sh, nginx-plus-api.conf (\uc544\ub798 \uc608\uc2dc \ubb38\uc11c \ucc38\uc870: \uc608\uc2dc \ubb38\uc11c\ub294 \ubaa8\ub450 NGINX Inc Github \uc5d0\uc11c \uac00\uc838\uc654\uc2b5\ub2c8\ub2e4.) Controller-agent \uc124\uce58\ub97c \uc704\ud55c NGINX Controller dockerfile FROM debian:stretch-slim LABEL maintainer=\"NGINX Controller Engineering\" # e.g '1234567890' ARG API_KEY ENV ENV_CONTROLLER_API_KEY=$API_KEY # e.g https://<fqdn>/install/controller-agent ARG CONTROLLER_URL ENV ENV_CONTROLLER_URL=$CONTROLLER_URL # e.g True or False ARG STORE_UUID=False ENV ENV_CONTROLLER_STORE_UUID=$STORE_UUID # e.g Instance location already defined in Controller ARG LOCATION ENV ENV_CONTROLLER_LOCATION=$LOCATION # e.g Instance group already defined in Controller ARG INSTANCE_GROUP ENV ENV_CONTROLLER_INSTANCE_GROUP=$INSTANCE_GROUP # NGXIN Plus release e.g 23 ARG NGINX_PLUS_VERSION=23 # Download certificate (nginx-repo.crt) and key (nginx-repo.key) from the customer portal (https://cs.nginx.com) # and copy to the build context COPY nginx-repo.* /etc/ssl/nginx/ COPY nginx-plus-api.conf /etc/nginx/conf.d/ COPY entrypoint.sh / # Install NGINX Plus RUN set -ex \\ && apt-get update && apt-get upgrade -y \\ && apt-get install --no-install-recommends --no-install-suggests -y curl sudo procps apt-utils apt-transport-https ca-certificates gnupg1 distro-info-data libmpdec2 \\ lsb-release python python-minimal binutils net-tools \\ && \\ NGINX_GPGKEY=573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62; \\ found=''; \\ for server in \\ ha.pool.sks-keyservers.net \\ hkp://keyserver.ubuntu.com:80 \\ hkp://p80.pool.sks-keyservers.net:80 \\ pgp.mit.edu \\ ; do \\ echo \"Fetching GPG key $NGINX_GPGKEY from $server\"; \\ apt-key adv --keyserver \"$server\" --keyserver-options timeout=10 --recv-keys \"$NGINX_GPGKEY\" && found=yes && break; \\ done; \\ test -z \"$found\" && echo >&2 \"error: failed to fetch GPG key $NGINX_GPGKEY\" && exit 1; \\ echo \"Acquire::https::plus-pkgs.nginx.com::Verify-Peer \\\"true\\\";\" >> /etc/apt/apt.conf.d/90nginx \\ && echo \"Acquire::https::plus-pkgs.nginx.com::Verify-Host \\\"true\\\";\" >> /etc/apt/apt.conf.d/90nginx \\ && echo \"Acquire::https::plus-pkgs.nginx.com::SslCert \\\"/etc/ssl/nginx/nginx-repo.crt\\\";\" >> /etc/apt/apt.conf.d/90nginx \\ && echo \"Acquire::https::plus-pkgs.nginx.com::SslKey \\\"/etc/ssl/nginx/nginx-repo.key\\\";\" >> /etc/apt/apt.conf.d/90nginx \\ && printf \"deb https://plus-pkgs.nginx.com/debian stretch nginx-plus\\n\" > /etc/apt/sources.list.d/nginx-plus.list \\ # NGINX Javascript module needed for APIM && apt-get update && apt-get install -y nginx-plus=${NGINX_PLUS_VERSION}* nginx-plus-module-njs=${NGINX_PLUS_VERSION}* \\ && rm -rf /var/lib/apt/lists/* \\ # Install Controller Agent && curl -k -sS -L ${CONTROLLER_URL} > install.sh \\ && sed -i 's/^assume_yes=\"\"/assume_yes=\"-y\"/' install.sh \\ && sed -i 's,-n \"${NGINX_GPGKEY}\",true,' install.sh \\ && sh ./install.sh -y \\ # cleanup sensitive nginx-plus data && rm /etc/ssl/nginx/nginx-repo.* \\ && rm /etc/apt/sources.list.d/nginx-plus.list \\ && rm /etc/apt/apt.conf.d/90nginx \\ && apt-key del \"$NGINX_GPGKEY\" # Forward request logs to Docker log collector RUN ln -sf /proc/1/fd/1 /var/log/nginx-controller/agent.log \\ && ln -sf /proc/1/fd/2 /var/log/nginx/error.log EXPOSE 80 STOPSIGNAL SIGTERM ENTRYPOINT [\"sh\", \"/entrypoint.sh\"] dockerfile\ub97c \ud070 \ubd80\ubd84\uc73c\ub85c \uad6c\ubd84\ud558\uba74, dockerfile \uad6c\uc131 \uc21c\uc11c\uc5d0 \ub530\ub77c \uc544\ub798\uc640 \uac19\uc774 \uad6c\ubd84\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ubcc0\uc218 \uc124\uc815 \ud30c\ud2b8 N+ \ub77c\uc774\uc120\uc2a4 \ubc0f Repo \uc124\uc815 \ud30c\ud2b8 NGINX Plus \uc124\uce58 \ud30c\ud2b8 NGINX Controller-agent \uc124\uce58 \ud30c\ud2b8 \ubbfc\uac10\uc131/\ubd88\ud544\uc694 \uc815\ubcf4 \uc81c\uac70 \ud30c\ud2b8 Log \uc5f0\uacb0 \ubc0f \uae30\ud0c0 \uc124\uc815 \ubc0f Entrypoint \uc9c0\uc815 \ud30c\ud2b8\uc785\ub2c8\ub2e4. entrypoint.sh #!/bin/sh # # This script launches nginx and the NGINX Controller Agent. # # Variables agent_conf_file=\"/etc/controller-agent/agent.conf\" agent_log_file=\"/var/log/nginx-controller/agent.log\" nginx_status_conf=\"/etc/nginx/conf.d/stub_status.conf\" api_key=\"\" instance_name=\"$(hostname -f)\" controller_api_url=\"\" location=\"\" handle_term() { echo \"received TERM signal\" echo \"stopping controller-agent ...\" kill -TERM \"${agent_pid}\" 2>/dev/null echo \"stopping nginx ...\" kill -TERM \"${nginx_pid}\" 2>/dev/null } trap 'handle_term' TERM # Launch nginx echo \"starting nginx ...\" nginx -g \"daemon off;\" & nginx_pid=$! wait_workers() { while ! pgrep -f 'nginx: worker process' >/dev/null 2>&1; do echo \"waiting for nginx workers ...\" sleep 2 done } wait_workers test -n \"${ENV_CONTROLLER_API_KEY}\" && \\ api_key=${ENV_CONTROLLER_API_KEY} # if instance_name is defined in the env vars, use it test -n \"${ENV_CONTROLLER_INSTANCE_NAME}\" && \\ instance_name=${ENV_CONTROLLER_INSTANCE_NAME} test -n \"${ENV_CONTROLLER_API_URL}\" && \\ controller_api_url=${ENV_CONTROLLER_API_URL} test -n \"${ENV_CONTROLLER_LOCATION}\" && \\ location=${ENV_CONTROLLER_LOCATION} test -n \"${ENV_CONTROLLER_INSTANCE_GROUP}\" && \\ instance_group=${ENV_CONTROLLER_INSTANCE_GROUP} if [ -n \"${api_key}\" -o -n \"${instance_name}\" -o -n \"${controller_api_url}\" -o -n \"${location}\" -o -n \"${instance_group}\" ]; then echo \"updating ${agent_conf_file} ...\" if [ ! -f \"${agent_conf_file}\" ]; then test -f \"${agent_conf_file}.default\" && \\ cp -p \"${agent_conf_file}.default\" \"${agent_conf_file}\" || \\ { echo \"no ${agent_conf_file}.default found! exiting.\"; exit 1; } fi test -n \"${api_key}\" && \\ echo \" ---> using api_key = ${api_key}\" && \\ sh -c \"sed -i.old -e 's/api_key.*$/api_key = $api_key/' \\ ${agent_conf_file}\" test -n \"${controller_api_url}\" && \\ echo \" ---> using controller api url = ${controller_api_url}\" && \\ sh -c \"sed -i.old -e 's@^api_url.*@api_url = $controller_api_url@' \\ ${agent_conf_file}\" test -n \"${instance_name}\" && \\ echo \" ---> using instance_name = ${instance_name}\" && \\ sh -c \"sed -i.old -e 's/instance_name.*$/instance_name = $instance_name/' \\ ${agent_conf_file}\" test -n \"${location}\" && \\ echo \" ---> using location = ${location}\" && \\ sh -c \"sed -i.old -e 's/location_name.*$/location_name = $location/' \\ ${agent_conf_file}\" test -n \"${instance_group}\" && \\ echo \" ---> using instance group = ${instance_group}\" && \\ sh -c \"sed -i.old -e 's/instance_group.*$/instance_group = $instance_group/' \\ ${agent_conf_file}\" test -f \"${agent_conf_file}\" && \\ chmod 644 ${agent_conf_file} && \\ chown nginx ${agent_conf_file} > /dev/null 2>&1 test -f \"${nginx_status_conf}\" && \\ chmod 644 ${nginx_status_conf} && \\ chown nginx ${nginx_status_conf} > /dev/null 2>&1 fi if ! grep '^api_key.*=[ ]*[[:alnum:]].*' ${agent_conf_file} > /dev/null 2>&1; then echo \"no api_key found in ${agent_conf_file}! exiting.\" exit 1 fi echo \"starting controller-agent ...\" /usr/bin/nginx-controller-agent > /dev/null 2>&1 < /dev/null & agent_pid=$! if [ $? != 0 ]; then echo \"couldn't start the agent, please check ${agent_log_file}\" exit 1 fi wait_term() { wait ${agent_pid} trap - TERM kill -QUIT \"${nginx_pid}\" 2>/dev/null echo \"waiting for nginx to stop...\" wait ${nginx_pid} } wait_term echo \"controller-agent process has stopped, exiting.\" entrypoint.sh\ud30c\uc77c\uc740 \ud06c\uac8c \ub450 \ubd80\ubd84\uc73c\ub85c \uad6c\ubd84\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. API GW \uc774\ubbf8\uc9c0 \ub0b4\uc758 agent.conf \ud30c\uc77c \uc218\uc815 (\ubcc0\uc218 Override) conf \uc218\uc815\uc5d0 \ub530\ub978 NGINX\uc640 Controller-agent\uc758 \uc7ac\uc2dc\uc791 Controller \uc124\uce58 \uacfc\uc815\uc5d0\uc11c \uc0dd\uc131\ub41c api_key, controller_api_url, location \ub4f1\uc758 \uc124\uc815 \uac12\uc744 Entrypoint.sh\ub97c \ud1b5\ud574, ENV\uc5d0\uc11c \uc124\uc815\ud55c \uac12\uc73c\ub85c \uc7ac\ubc18\uc601\ud558\ub3c4\ub85d \uc791\uc131\ud55c \uac83\uc73c\ub85c \ubcf4\uc785\ub2c8\ub2e4. \ub530\ub77c\uc11c, Kubernetes Deployment YAML \ud30c\uc77c\uc744 \ud1b5\ud574 API Key, Location, \uadf8\ub9ac\uace0 5\uc6d4 \ub9d0 \uae30\uc900 \uc544\uc9c1 \ubca0\ud0c0 \uae30\ub2a5\uc778 instance group\uae4c\uc9c0 \ubcc0\uc218\ub97c override\ud558\uc5ec \uc0ac\uc6a9\ud560 \uc218 \uc788\uaca0\uc2b5\ub2c8\ub2e4. Override\ud574\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ubcc0\uc218\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. ENV_CONTROLLER_API_KEY ENV_CONTROLLER_API_URL ENV_CONTROLLER_INSTANCE_NAME ENV_CONTROLLER_LOCATION ENV_CONTROLLER_INSTANCE_GROUP nginx-plus-api.conf server { listen 8080; location /api/ { api write=on; } location = /dashboard.html { root /usr/share/nginx/html; } # Redirect requests for \"/\" to \"/dashboard.html\" location / { return 301 /dashboard.html; } # Redirect requests for pre-R14 dashboard location /status.html { return 301 /dashboard.html; } } # vim: syntax=nginx Controller-agent\ub294 \uac01 API Gateway\uc758 Metric \uac12\uc744 API \uc870\ud68c\ub97c \ud1b5\ud574 \uac00\uc838\uc635\ub2c8\ub2e4. \uc774\ub97c \uc704\ud55c NGINX Server Context config\uc785\ub2c8\ub2e4.","title":"Requirements"},{"location":"NGINX-Plus/NGINX-Controller/Build-NGINX-Plus-API-GW-container-image/#docker-build","text":"Build \uba85\ub839\uc5b4\ub294 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4. sudo docker build --build-arg CONTROLLER_URL=https://<fqdn>/install/controller-agent --build-arg API_KEY='abcdefxxxxxx' -t nginx-agent . Build-argument\uc778 CONTROLLER_URL\uc740 Controller \ubc84\uc804\uc5d0 \ub530\ub77c \ub2e4\ub97c \uc218 \uc788\uc2b5\ub2c8\ub2e4. NGINX Controller v3.10 \uc774\uc804 CONTROLLER_URL=https://<fqdn>:8443/1.4/install/controller NGINX Controller v3.11 \uc774\ud6c4 CONTROLLER_URL=https://<fqdn>/install/controller-agent","title":"Docker Build"},{"location":"NGINX-Plus/NGINX-Controller/ConfigDB-Manual-Restore/","text":"Set Variables \u00b6 CTLRFQDN='nctest.itian.ml' CTLRAUTHCOOKIE='/var/tmp/cookie.txt' CTLRAUTHUSER='admin@nginx.com' CTLRAUTHPASS='1234qwer' Authentication \u00b6 # Client Authentication curl -sk -c ${CTLRAUTHCOOKIE} -X POST --url \"https://${CTLRFQDN}/api/v1/platform/login\" \\ --header 'Content-Type: application/json' \\ --data '{\"credentials\": {\"type\": \"BASIC\",\"username\": \"'\"${CTLRAUTHUSER}\"'\",\"password\": \"'\"${CTLRAUTHPASS}\"'\"}}' # Controller Authentication Check curl -sk -b ${CTLRAUTHCOOKIE} -c ${CTLRAUTHCOOKIE} \\ -X GET --url \"https://${CTLRFQDN}/api/v1/platform/login\" | jq TEST Configs POST API requests from KMA - LG CNS \u00b6 curl -sk -c ${CTLRAUTHCOOKIE} -X PUT \\ --url \"https://${CTLRFQDN}/api/v1/services/environments/hq-env\" \\ --header 'Content-Type: application/json' \\ --data '{ \"metadata\": { \"name\": \"hq-env\", \"displayName\": \"\", \"description\": \"\", \"tags\": [] }, \"desiredState\": {} }' curl -sk -c ${CTLRAUTHCOOKIE} -X PUT \\ --url \"https://${CTLRFQDN}/api/v1/services/environments/hq-env/gateways/hq-gw\" \\ --header 'Content-Type: application/json' \\ --data '{ \"metadata\": { \"name\": \"hq-gw\", \"tags\": [] }, \"desiredState\": { \"ingress\": { \"uris\": { \"http://apigw.comis5.kma.go.kr\": {} }, \"placement\": { \"instanceRefs\": [ { \"ref\": \"/infrastructure/locations/unspecified/instances/nginxgw-21-8vxcf\" }, { \"ref\": \"/infrastructure/locations/unspecified/instances/nginxgw-21-frqh6\" } ] } } } }' curl -sk -c ${CTLRAUTHCOOKIE} -X PUT \\ --url \"https://${CTLRFQDN}/api/v1/services/environments/hq-env/apps/aws-capi\" \\ --header 'Content-Type: application/json' \\ --data '{ \"metadata\": { \"name\": \"aws-capi\", \"displayName\": \"\", \"description\": \"\", \"tags\": [] }, \"desiredState\": {} }' curl -sk -c ${CTLRAUTHCOOKIE} -X PUT \\ --url \"https://${CTLRFQDN}/api/v1/services/environments/hq-env/apps/aws-capi/components/api.cgi-bin.aws3.nph-aws3_ana1\" \\ --header 'Content-Type: application/json' \\ --data '{ \"metadata\": { \"name\": \"api.cgi-bin.aws3.nph-aws3_ana1\", \"tags\": [] }, \"desiredState\": { \"ingress\": { \"gatewayRefs\": [ { \"ref\": \"/services/environments/hq-env/gateways/hq-gw\" } ], \"uris\": { \"/capi/cgi-bin/aws3/nph-aws3_ana1\": { \"matchMethod\": \"PREFIX\" } } }, \"backend\": { \"ntlmAuthentication\": \"DISABLED\", \"preserveHostHeader\": \"DISABLED\", \"workloadGroups\": { \"aws-capi-wg\": { \"loadBalancingMethod\": { \"type\": \"ROUND_ROBIN\" }, \"uris\": { \"http://aws-capi:8090\": { \"isBackup\": false, \"isDown\": false, \"isDrain\": false } } } } }, \"logging\": { \"errorLog\": \"DISABLED\", \"accessLog\": { \"state\": \"DISABLED\" } }, \"publishedApiRefs\": [ { \"links\": { \"rel\": \"\" }, \"ref\": \"/services/environments/hq-env/apps/aws-capi/published-apis/api.cgi-bin.aws3.nph-aws3_ana1\" } ], \"security\": { \"identityProviderRefs\": [] } } }' curl -sk -c ${CTLRAUTHCOOKIE} -X PUT \\ --url \"https://${CTLRFQDN}/api/v1/security/identity-providers/url_api\" \\ --header 'Content-Type: application/json' \\ --data '{ \"metadata\": { \"name\": \"url_api\", \"tags\": [] }, \"desiredState\": { \"environmentRefs\": [ { \"ref\": \"/services/environments/hq-afso-env\" } ], \"identityProvider\": { \"type\": \"API_KEY\" } } }' curl -sk -c ${CTLRAUTHCOOKIE} -X PUT \\ --url \"https://${CTLRFQDN}/api/v1/security/identity-providers/url_api/clients\" \\ --header 'Content-Type: application/json' \\ --data '{ \"items\": [ { \"metadata\": { \"name\": \"afsu00000042\" }, \"desiredState\": { \"credential\": { \"apiKey\": \"4cd9d2c1f739c5e2b3204fa56579377a95f81ac2aaf18d8bd5f47c8e414fcf8d9642574c2d64dcb3c9511d553e668ad3292a68e3e76e4b597f5bb9a0ee929bf8\", \"type\": \"API_KEY\" } } }, { \"metadata\": { \"name\": \"afsu00000046\" }, \"desiredState\": { \"credential\": { \"apiKey\": \"42c832cfd1a4098d1155bbc8262d6841f8085d7dbc0e2c08db9ad35541be96d187b894b0ac32373a484734f530a039552a5055b9730ce27fbd819b5522446de2\", \"type\": \"API_KEY\" } } }, { \"metadata\": { \"name\": \"afsu00000047\" }, \"desiredState\": { \"credential\": { \"apiKey\": \"7318c7026f474149282469a395622716e128f0ca5d84e9a689ecd4347d1131cb26c1e41a12d1c153235c61c4715c013972b9d1b5ee1a210ae27c2584ef0342c3\", \"type\": \"API_KEY\" } } }, { \"metadata\": { \"name\": \"test\" }, \"desiredState\": { \"credential\": { \"apiKey\": \"9d2c1f739c5e2b3204fa50bbc82626f4741492824684e9a62c08db9ad35541be96d187b894b0ac32373a484734f530a039552a5055b9730ce27fbd819b5522446de2o5o345f3434cr3434gh45gv34554\", \"type\": \"API_KEY\" } } } ] }'","title":"ConfigDB Manual Restore"},{"location":"NGINX-Plus/NGINX-Controller/ConfigDB-Manual-Restore/#set-variables","text":"CTLRFQDN='nctest.itian.ml' CTLRAUTHCOOKIE='/var/tmp/cookie.txt' CTLRAUTHUSER='admin@nginx.com' CTLRAUTHPASS='1234qwer'","title":"Set Variables"},{"location":"NGINX-Plus/NGINX-Controller/ConfigDB-Manual-Restore/#authentication","text":"# Client Authentication curl -sk -c ${CTLRAUTHCOOKIE} -X POST --url \"https://${CTLRFQDN}/api/v1/platform/login\" \\ --header 'Content-Type: application/json' \\ --data '{\"credentials\": {\"type\": \"BASIC\",\"username\": \"'\"${CTLRAUTHUSER}\"'\",\"password\": \"'\"${CTLRAUTHPASS}\"'\"}}' # Controller Authentication Check curl -sk -b ${CTLRAUTHCOOKIE} -c ${CTLRAUTHCOOKIE} \\ -X GET --url \"https://${CTLRFQDN}/api/v1/platform/login\" | jq","title":"Authentication"},{"location":"NGINX-Plus/NGINX-Controller/ConfigDB-Manual-Restore/#test-configs-post-api-requests-from-kma-lg-cns","text":"curl -sk -c ${CTLRAUTHCOOKIE} -X PUT \\ --url \"https://${CTLRFQDN}/api/v1/services/environments/hq-env\" \\ --header 'Content-Type: application/json' \\ --data '{ \"metadata\": { \"name\": \"hq-env\", \"displayName\": \"\", \"description\": \"\", \"tags\": [] }, \"desiredState\": {} }' curl -sk -c ${CTLRAUTHCOOKIE} -X PUT \\ --url \"https://${CTLRFQDN}/api/v1/services/environments/hq-env/gateways/hq-gw\" \\ --header 'Content-Type: application/json' \\ --data '{ \"metadata\": { \"name\": \"hq-gw\", \"tags\": [] }, \"desiredState\": { \"ingress\": { \"uris\": { \"http://apigw.comis5.kma.go.kr\": {} }, \"placement\": { \"instanceRefs\": [ { \"ref\": \"/infrastructure/locations/unspecified/instances/nginxgw-21-8vxcf\" }, { \"ref\": \"/infrastructure/locations/unspecified/instances/nginxgw-21-frqh6\" } ] } } } }' curl -sk -c ${CTLRAUTHCOOKIE} -X PUT \\ --url \"https://${CTLRFQDN}/api/v1/services/environments/hq-env/apps/aws-capi\" \\ --header 'Content-Type: application/json' \\ --data '{ \"metadata\": { \"name\": \"aws-capi\", \"displayName\": \"\", \"description\": \"\", \"tags\": [] }, \"desiredState\": {} }' curl -sk -c ${CTLRAUTHCOOKIE} -X PUT \\ --url \"https://${CTLRFQDN}/api/v1/services/environments/hq-env/apps/aws-capi/components/api.cgi-bin.aws3.nph-aws3_ana1\" \\ --header 'Content-Type: application/json' \\ --data '{ \"metadata\": { \"name\": \"api.cgi-bin.aws3.nph-aws3_ana1\", \"tags\": [] }, \"desiredState\": { \"ingress\": { \"gatewayRefs\": [ { \"ref\": \"/services/environments/hq-env/gateways/hq-gw\" } ], \"uris\": { \"/capi/cgi-bin/aws3/nph-aws3_ana1\": { \"matchMethod\": \"PREFIX\" } } }, \"backend\": { \"ntlmAuthentication\": \"DISABLED\", \"preserveHostHeader\": \"DISABLED\", \"workloadGroups\": { \"aws-capi-wg\": { \"loadBalancingMethod\": { \"type\": \"ROUND_ROBIN\" }, \"uris\": { \"http://aws-capi:8090\": { \"isBackup\": false, \"isDown\": false, \"isDrain\": false } } } } }, \"logging\": { \"errorLog\": \"DISABLED\", \"accessLog\": { \"state\": \"DISABLED\" } }, \"publishedApiRefs\": [ { \"links\": { \"rel\": \"\" }, \"ref\": \"/services/environments/hq-env/apps/aws-capi/published-apis/api.cgi-bin.aws3.nph-aws3_ana1\" } ], \"security\": { \"identityProviderRefs\": [] } } }' curl -sk -c ${CTLRAUTHCOOKIE} -X PUT \\ --url \"https://${CTLRFQDN}/api/v1/security/identity-providers/url_api\" \\ --header 'Content-Type: application/json' \\ --data '{ \"metadata\": { \"name\": \"url_api\", \"tags\": [] }, \"desiredState\": { \"environmentRefs\": [ { \"ref\": \"/services/environments/hq-afso-env\" } ], \"identityProvider\": { \"type\": \"API_KEY\" } } }' curl -sk -c ${CTLRAUTHCOOKIE} -X PUT \\ --url \"https://${CTLRFQDN}/api/v1/security/identity-providers/url_api/clients\" \\ --header 'Content-Type: application/json' \\ --data '{ \"items\": [ { \"metadata\": { \"name\": \"afsu00000042\" }, \"desiredState\": { \"credential\": { \"apiKey\": \"4cd9d2c1f739c5e2b3204fa56579377a95f81ac2aaf18d8bd5f47c8e414fcf8d9642574c2d64dcb3c9511d553e668ad3292a68e3e76e4b597f5bb9a0ee929bf8\", \"type\": \"API_KEY\" } } }, { \"metadata\": { \"name\": \"afsu00000046\" }, \"desiredState\": { \"credential\": { \"apiKey\": \"42c832cfd1a4098d1155bbc8262d6841f8085d7dbc0e2c08db9ad35541be96d187b894b0ac32373a484734f530a039552a5055b9730ce27fbd819b5522446de2\", \"type\": \"API_KEY\" } } }, { \"metadata\": { \"name\": \"afsu00000047\" }, \"desiredState\": { \"credential\": { \"apiKey\": \"7318c7026f474149282469a395622716e128f0ca5d84e9a689ecd4347d1131cb26c1e41a12d1c153235c61c4715c013972b9d1b5ee1a210ae27c2584ef0342c3\", \"type\": \"API_KEY\" } } }, { \"metadata\": { \"name\": \"test\" }, \"desiredState\": { \"credential\": { \"apiKey\": \"9d2c1f739c5e2b3204fa50bbc82626f4741492824684e9a62c08db9ad35541be96d187b894b0ac32373a484734f530a039552a5055b9730ce27fbd819b5522446de2o5o345f3434cr3434gh45gv34554\", \"type\": \"API_KEY\" } } } ] }'","title":"TEST Configs POST API requests from KMA - LG CNS"},{"location":"NGINX-Plus/NGINX-Controller/NGINX-Controller-Alert-%EB%A9%94%EC%9D%BC-%EC%84%A4%EC%A0%95/","text":"NGINX Controller - Alert \uba54\uc77c \uc124\uc815 \u00b6 NGINX Controller Alert mail\uc744 \uc704\ud55c Sendmail \uc124\uc815\uc785\ub2c8\ub2e4. NGINX Controller\uc758 Alert \uba54\ub274\uc5d0\uc11c\ub294 NGINX Controller\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 Alert, Notification \uae30\ub2a5\uc744 \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub97c \ud1b5\ud574 System, App Performance\uc758 \uc0c1\ud0dc\ub97c \ud30c\uc545\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub2e8, Alert Mail\uc740 Verified Address\ub85c\ub9cc \ubc1c\uc1a1\uc774 \ub418\uba70, \uc774\ub97c \uc704\ud55c \uac04\ub2e8\ud55c \uc124\uc815\uc744 \uc774 \ud3ec\uc2a4\ud2b8\uc5d0\uc11c \uc18c\uac1c\ud569\ub2c8\ub2e4. \ub367\ubd99\uc5ec, NGINX Controller \uc124\uce58 \uc911 \uc124\uc815\ud588\ub358 SMTP \uc815\ubcf4 \uc218\uc815\uc5d0 \ub300\ud55c \ub0b4\uc6a9\uc785\ub2c8\ub2e4. Sendmail \uc124\uce58 \ubc0f \uc124\uc815 \u00b6 Sendmail\uc740 Postfix\uc640 \ud568\uaed8, SMTP\ub97c \ud3ec\ud568\ud558\uc5ec \uc218\ub9ce\uc740 \uc885\ub958\uc758 \uba54\uc77c \uc804\uc1a1 \ubc0f \uc804\ub2ec \ubc29\uc2dd\uc744 \uc9c0\uc6d0\ud558\ub294 \ub9ac\ub205\uc2a4 \ubc94\uc6a9 \uba54\uc77c \uc804\uc1a1 \ud234\uc785\ub2c8\ub2e4. 1. sendmail \uc124\uce58 \u00b6 yum -y install sendmail sendmail-cf 2. /etc/mail/sendmail.mc \ud3b8\uc9d1 \u00b6 sendmail\uc740 \uae30\ubcf8\uac12\uc73c\ub85c Localhost[127.0.0.1]\uc758 \uba54\uc77c \ubc1c\uc1a1\ub9cc\uc744 \ud5c8\uc6a9\ud569\ub2c8\ub2e4. NGINX Controller\ub294 Single Node Kubernetes\uc758 \uad6c\uc870\ub85c\uc11c, Alert Mail \ub4f1\uc740 nats-streaming-worker \ud30c\ub4dc\ub85c\ubd80\ud130 \ubc1c\uc2e0\ub418\ubbc0\ub85c, Pod network \ub300\uc5ed\uc758 \uba54\uc77c \ubc1c\uc1a1 \ud5c8\uc6a9\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. sendmail.mc\ub97c \uc218\uc815\ud574 sendmail \uc678\ubd80 \uc811\uadfc\uc744 \ud5c8\uc6a9 \uc124\uc815\uc744 \uc218\ud589\ud569\ub2c8\ub2e4. vi /etc/mail/sendmail.mc \uc778\uc99d \uba54\ucee4\ub2c8\uc998\uc744 \uc120\uc5b8\ud558\ub294 \ubd80\ubd84\uc785\ub2c8\ub2e4. dnl # \uc740 \uc8fc\uc11d \uc5ed\ud560\uc744 \ud558\ub294 \uac83\uc73c\ub85c \ubcf4\uc774\uba70, \uc0ad\uc81c\ud558\uba74 \uc124\uc815\uc774 \uc801\uc6a9\ub429\ub2c8\ub2e4. dnl # TRUST_AUTH_MECH(`EXTERNAL DIGEST-MD5 CRAM-MD5 LOGIN PLAIN')dnl dnl # define(`confAUTH_MECHANISMS', `EXTERNAL GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN PLAIN')dnl > TRUST_AUTH_MECH(`EXTERNAL DIGEST-MD5 CRAM-MD5 LOGIN PLAIN')dnl > define(`confAUTH_MECHANISMS', `EXTERNAL GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN PLAIN')dnl \ub9c8\ucc2c\uac00\uc9c0\ub85c sendmail.mc \ud30c\uc77c\uc5d0\uc11c Listen IP\ub97c \ubcc0\uacbd\ud569\ub2c8\ub2e4. DAEMON_OPTIONS(`Port=smtp,Addr=127.0.0.1, Name=MTA')dnl > DAEMON_OPTIONS(`Port=smtp,Addr=0.0.0.0, Name=MTA')dnl \uc544\ub798 \uba85\ub839\uc5b4\ub85c cf \ud30c\uc77c\uc744 \ub36e\uc5b4\uc4f0\uae30 \ud569\ub2c8\ub2e4. m4 /etc/mail/sendmail.mc > /etc/mail/sendmail.cf 3. /etc/mail/access \ud3b8\uc9d1 \u00b6 \uc544\ub798 \uba85\ub839\uc5b4\ub85c Pod Network \ub300\uc5ed\uc744 Access \ud5c8\uc6a9 \uc124\uc815\ud574\uc90d\ub2c8\ub2e4. echo 'Connect:10.244.0 RELAY' >> /etc/mail/access 4. \uba54\uc77c \ubc1c\uc1a1 \ud14c\uc2a4\ud2b8 \u00b6 \uc544\ub798 Curl \uba85\ub839\uc73c\ub85c NGINX SMTP \uc124\uc815\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. NGINX_CTLR='xxx.xxx.xxx.xxx' NUSERNAME='' NPASSWORD='' # Authentication curl -sk -c cookie.txt -X POST --url \"https://$NGINX_CTLR/api/v1/platform/login\" --header 'Content-Type: application/json' --data '{\"credentials\": {\"type\": \"BASIC\",\"username\": \"'\"$NUSERNAME\"'\",\"password\": \"'\"$NPASSWORD\"'\"}}' # API Query - Global setting curl -sk -b cookie.txt -c cookie.txt -X GET --url \"https://$NGINX_CTLR/api/v1/platform/global\" --header 'Content-Type: application/json' /opt/nginx-controller \ub514\ub809\ud1a0\ub9ac\uc758 helper.sh \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc0ac\uc6a9\ud574 SMTP \uc815\ubcf4\ub97c \uc218\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc218\uc815\uc5d0\ub294 \ucd5c\ub300 2\ubd84\uae4c\uc9c0 \uc2dc\uac04\uc774 \uc18c\uc694\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. #Usage ./helper.sh configsmtp <address> <port> <tls> <from> [auth] [username] [password] # Plaintext, 25 Port, No Auth ./helper.sh configstmp $NGINX_CTLR 25 false noreply@itian.co.kr false NGINX Controller GUI\uc5d0\uc11c, Analytics - Alert Rules \uba54\ub274\ub85c \uc9c4\uc785\ud569\ub2c8\ub2e4. Alert Rules \uc0dd\uc131 \ud654\uba74\uc5d0\uc11c Manage E-mail Address\ub97c \uc120\ud0dd\ud574 E-mail Verification\uc744 \uc218\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Manage Email Addresses\uc5d0\uc11c Resend Verification Mail \ubc84\ud2bc\uc73c\ub85c Verification Mail\uc744 \ubc1c\uc1a1\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. [Notice] Alert Mail\uc740 Verified Email Address\ub85c\ub9cc \ubc1c\uc1a1\ud569\ub2c8\ub2e4. Verification\uc774 \uc644\ub8cc\ub418\uc9c0 \uc54a\uc73c\uba74 \ubc1c\uc1a1\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.","title":"NGINX Controller - Alert \uba54\uc77c \uc124\uc815"},{"location":"NGINX-Plus/NGINX-Controller/NGINX-Controller-Alert-%EB%A9%94%EC%9D%BC-%EC%84%A4%EC%A0%95/#nginx-controller-alert","text":"NGINX Controller Alert mail\uc744 \uc704\ud55c Sendmail \uc124\uc815\uc785\ub2c8\ub2e4. NGINX Controller\uc758 Alert \uba54\ub274\uc5d0\uc11c\ub294 NGINX Controller\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 Alert, Notification \uae30\ub2a5\uc744 \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub97c \ud1b5\ud574 System, App Performance\uc758 \uc0c1\ud0dc\ub97c \ud30c\uc545\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub2e8, Alert Mail\uc740 Verified Address\ub85c\ub9cc \ubc1c\uc1a1\uc774 \ub418\uba70, \uc774\ub97c \uc704\ud55c \uac04\ub2e8\ud55c \uc124\uc815\uc744 \uc774 \ud3ec\uc2a4\ud2b8\uc5d0\uc11c \uc18c\uac1c\ud569\ub2c8\ub2e4. \ub367\ubd99\uc5ec, NGINX Controller \uc124\uce58 \uc911 \uc124\uc815\ud588\ub358 SMTP \uc815\ubcf4 \uc218\uc815\uc5d0 \ub300\ud55c \ub0b4\uc6a9\uc785\ub2c8\ub2e4.","title":"NGINX Controller - Alert \uba54\uc77c \uc124\uc815"},{"location":"NGINX-Plus/NGINX-Controller/NGINX-Controller-Alert-%EB%A9%94%EC%9D%BC-%EC%84%A4%EC%A0%95/#sendmail","text":"Sendmail\uc740 Postfix\uc640 \ud568\uaed8, SMTP\ub97c \ud3ec\ud568\ud558\uc5ec \uc218\ub9ce\uc740 \uc885\ub958\uc758 \uba54\uc77c \uc804\uc1a1 \ubc0f \uc804\ub2ec \ubc29\uc2dd\uc744 \uc9c0\uc6d0\ud558\ub294 \ub9ac\ub205\uc2a4 \ubc94\uc6a9 \uba54\uc77c \uc804\uc1a1 \ud234\uc785\ub2c8\ub2e4.","title":"Sendmail \uc124\uce58 \ubc0f \uc124\uc815"},{"location":"NGINX-Plus/NGINX-Controller/NGINX-Controller-Alert-%EB%A9%94%EC%9D%BC-%EC%84%A4%EC%A0%95/#1-sendmail","text":"yum -y install sendmail sendmail-cf","title":"1. sendmail \uc124\uce58"},{"location":"NGINX-Plus/NGINX-Controller/NGINX-Controller-Alert-%EB%A9%94%EC%9D%BC-%EC%84%A4%EC%A0%95/#2-etcmailsendmailmc","text":"sendmail\uc740 \uae30\ubcf8\uac12\uc73c\ub85c Localhost[127.0.0.1]\uc758 \uba54\uc77c \ubc1c\uc1a1\ub9cc\uc744 \ud5c8\uc6a9\ud569\ub2c8\ub2e4. NGINX Controller\ub294 Single Node Kubernetes\uc758 \uad6c\uc870\ub85c\uc11c, Alert Mail \ub4f1\uc740 nats-streaming-worker \ud30c\ub4dc\ub85c\ubd80\ud130 \ubc1c\uc2e0\ub418\ubbc0\ub85c, Pod network \ub300\uc5ed\uc758 \uba54\uc77c \ubc1c\uc1a1 \ud5c8\uc6a9\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. sendmail.mc\ub97c \uc218\uc815\ud574 sendmail \uc678\ubd80 \uc811\uadfc\uc744 \ud5c8\uc6a9 \uc124\uc815\uc744 \uc218\ud589\ud569\ub2c8\ub2e4. vi /etc/mail/sendmail.mc \uc778\uc99d \uba54\ucee4\ub2c8\uc998\uc744 \uc120\uc5b8\ud558\ub294 \ubd80\ubd84\uc785\ub2c8\ub2e4. dnl # \uc740 \uc8fc\uc11d \uc5ed\ud560\uc744 \ud558\ub294 \uac83\uc73c\ub85c \ubcf4\uc774\uba70, \uc0ad\uc81c\ud558\uba74 \uc124\uc815\uc774 \uc801\uc6a9\ub429\ub2c8\ub2e4. dnl # TRUST_AUTH_MECH(`EXTERNAL DIGEST-MD5 CRAM-MD5 LOGIN PLAIN')dnl dnl # define(`confAUTH_MECHANISMS', `EXTERNAL GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN PLAIN')dnl > TRUST_AUTH_MECH(`EXTERNAL DIGEST-MD5 CRAM-MD5 LOGIN PLAIN')dnl > define(`confAUTH_MECHANISMS', `EXTERNAL GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN PLAIN')dnl \ub9c8\ucc2c\uac00\uc9c0\ub85c sendmail.mc \ud30c\uc77c\uc5d0\uc11c Listen IP\ub97c \ubcc0\uacbd\ud569\ub2c8\ub2e4. DAEMON_OPTIONS(`Port=smtp,Addr=127.0.0.1, Name=MTA')dnl > DAEMON_OPTIONS(`Port=smtp,Addr=0.0.0.0, Name=MTA')dnl \uc544\ub798 \uba85\ub839\uc5b4\ub85c cf \ud30c\uc77c\uc744 \ub36e\uc5b4\uc4f0\uae30 \ud569\ub2c8\ub2e4. m4 /etc/mail/sendmail.mc > /etc/mail/sendmail.cf","title":"2. /etc/mail/sendmail.mc  \ud3b8\uc9d1"},{"location":"NGINX-Plus/NGINX-Controller/NGINX-Controller-Alert-%EB%A9%94%EC%9D%BC-%EC%84%A4%EC%A0%95/#3-etcmailaccess","text":"\uc544\ub798 \uba85\ub839\uc5b4\ub85c Pod Network \ub300\uc5ed\uc744 Access \ud5c8\uc6a9 \uc124\uc815\ud574\uc90d\ub2c8\ub2e4. echo 'Connect:10.244.0 RELAY' >> /etc/mail/access","title":"3. /etc/mail/access \ud3b8\uc9d1"},{"location":"NGINX-Plus/NGINX-Controller/NGINX-Controller-Alert-%EB%A9%94%EC%9D%BC-%EC%84%A4%EC%A0%95/#4","text":"\uc544\ub798 Curl \uba85\ub839\uc73c\ub85c NGINX SMTP \uc124\uc815\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. NGINX_CTLR='xxx.xxx.xxx.xxx' NUSERNAME='' NPASSWORD='' # Authentication curl -sk -c cookie.txt -X POST --url \"https://$NGINX_CTLR/api/v1/platform/login\" --header 'Content-Type: application/json' --data '{\"credentials\": {\"type\": \"BASIC\",\"username\": \"'\"$NUSERNAME\"'\",\"password\": \"'\"$NPASSWORD\"'\"}}' # API Query - Global setting curl -sk -b cookie.txt -c cookie.txt -X GET --url \"https://$NGINX_CTLR/api/v1/platform/global\" --header 'Content-Type: application/json' /opt/nginx-controller \ub514\ub809\ud1a0\ub9ac\uc758 helper.sh \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc0ac\uc6a9\ud574 SMTP \uc815\ubcf4\ub97c \uc218\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc218\uc815\uc5d0\ub294 \ucd5c\ub300 2\ubd84\uae4c\uc9c0 \uc2dc\uac04\uc774 \uc18c\uc694\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. #Usage ./helper.sh configsmtp <address> <port> <tls> <from> [auth] [username] [password] # Plaintext, 25 Port, No Auth ./helper.sh configstmp $NGINX_CTLR 25 false noreply@itian.co.kr false NGINX Controller GUI\uc5d0\uc11c, Analytics - Alert Rules \uba54\ub274\ub85c \uc9c4\uc785\ud569\ub2c8\ub2e4. Alert Rules \uc0dd\uc131 \ud654\uba74\uc5d0\uc11c Manage E-mail Address\ub97c \uc120\ud0dd\ud574 E-mail Verification\uc744 \uc218\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Manage Email Addresses\uc5d0\uc11c Resend Verification Mail \ubc84\ud2bc\uc73c\ub85c Verification Mail\uc744 \ubc1c\uc1a1\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. [Notice] Alert Mail\uc740 Verified Email Address\ub85c\ub9cc \ubc1c\uc1a1\ud569\ub2c8\ub2e4. Verification\uc774 \uc644\ub8cc\ub418\uc9c0 \uc54a\uc73c\uba74 \ubc1c\uc1a1\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.","title":"4. \uba54\uc77c \ubc1c\uc1a1 \ud14c\uc2a4\ud2b8"},{"location":"NGINX-Plus/NGINX-Controller/NGINX-Controller-Deployment-Guide/","text":"NGINX Controller \uc124\uce58 \uac00\uc774\ub4dc NGINX Controller \u00b6 \ubcf8 \uac00\uc774\ub4dc\uc5d0\uc11c\ub294 \uc774\uc911\ud654 \ub4f1\uc774 \uc5c6\ub294 \uc2f1\uae00 \ub178\ub4dc NGINX Controller\uc758 \uc124\uce58\ub97c \ub2e4\ub8f9\ub2c8\ub2e4. \ub2e8, Online Install\uc774 \uac00\ub2a5\ud55c \ud658\uacbd, Offline Install\uc774 \ud544\uc694\ud55c \ud658\uacbd\uc73c\ub85c \uad6c\ubd84\ud574 \uac01\uac01 \uc18c\uac1c\ud569\ub2c8\ub2e4. \uac00\uc774\ub4dc\uc5d0\uc11c\ub294 CentOS 7.4+ \ud658\uacbd\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. controller-installer-<version>.tar.gz \ud328\ud0a4\uc9c0\uc640 controller_license.txt \ub77c\uc774\uc120\uc2a4 \ud30c\uc77c\uc774 \ud544\uc694\ud558\uba70, controller-installer-<version>.tar.gz \ud30c\uc77c\uc774 /var/tmp \uc5d0 \uc5c5\ub85c\ub4dc \ub418\uc5b4\uc788\ub2e4\uace0 \uac00\uc815\ud569\ub2c8\ub2e4. Embedded Config DB\ub97c \uc0ac\uc6a9\ud560 \uc218\ub3c4 \uc788\uc73c\ub098 \uac00\uc774\ub4dc\ub97c \uc704\ud574 PostgreSQL\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. NFS \uc0ac\uc6a9\ubc95\ub3c4 \uacfc\uc815 \uc911\uc5d0 \uac04\ub7b5\ud788 \uc18c\uac1c\ud569\ub2c8\ub2e4. User \uc8fc\uc758\uc0ac\ud56d \u00b6 3.12.0 \uc774\uc0c1\uc758 \ubc84\uc804\uc740 root \uacc4\uc815\uc73c\ub85c NGINX Controller \ub97c \uc124\uce58\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. Clustering \uc8fc\uc758 \uc0ac\ud56d \u00b6 Controller Clustering\uc744 \uc704\ud574\uc11c\ub294 ConfigDB, TimeSeriesDB \ubaa8\ub450 Local\ub97c \uc0ac\uc6a9\ud574\uc120 \uc548\ub429\ub2c8\ub2e4. Configdb, tsdb \ub458 \ub2e4 Controller\uac00 \uc124\uce58\ub418\ub294 \ub178\ub4dc\uac00 \uc544\ub2cc \ubcc4\ub3c4\uc758 \ub178\ub4dc\uc5d0 \uc124\uce58\ub418\uc5b4\uc57c \ud558\uba70, configdb\ub294 \ubcc4\ub3c4 \ud638\uc2a4\ud2b8\uc5d0 postgresql\uc744 \uc124\uce58, tsdb\ub294 \ubcc4\ub3c4 \ud638\uc2a4\ud2b8\uc5d0 nfs\ub97c \uc124\uce58 \uc0ac\uc6a9\ud558\ub294 \ubc29\uc2dd\uc73c\ub85c DB\ub97c \ubd84\ub9ac\ud574\uc57c \ud569\ub2c8\ub2e4. \uc0ac\uc6a9\ud55c\ub2e4. \ub610\ud55c \uc628\uc804\ud55c Quorum \ubc0f Resilient Cluster \uad6c\uc131\uc744 \uc704\ud574\uc120 3\ub300\uc758 \ub178\ub4dc\uac00 \ud544\uc694\ud569\ub2c8\ub2e4. \ub530\ub77c\uc11c \uc628\uc804\ud55c Resilient Cluster \uad6c\uc131\uc744 \uc704\ud574\uc120 \ucd5c\uc18c 4 \ub300\uc758 \ub178\ub4dc\uac00 \ud544\uc694 \ud569\ub2c8\ub2e4. NGINX Controller Online Install \u00b6 Node and Repository Set-up \u00b6 #hostname and DNS Set hostnamectl set-hostname ngxctlr.itian.ml echo 'nameserver 8.8.8.8' >> /etc/resolv.conf #CentOS Repository (kakao mirror) Set tee -a /etc/yum.repos.d/centos-kakao.repo <<EOF 1>/dev/null [base] name=CentOS-7 - Base baseurl=http://mirror.kakao.com/centos/7/os/x86_64/ gpgcheck=0 [updates] name=CentOS-7 - Updates baseurl=http://mirror.kakao.com/centos/7/updates/x86_64/ gpgcheck=0 [extras] name=CentOS-$releasever - Extras baseurl=http://mirror.kakao.com/centos/7/extras/x86_64/ gpgcheck=0 EOF #Docker, PostgreSQL, EPEL Repository Set sudo yum install -y yum-utils sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo sudo yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm sudo yum install -y epel-release #Google kubernetes Repository Set cat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\\$basearch enabled=1 gpgcheck=1 repo_gpgcheck=1 gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg exclude=kubelet kubeadm kubectl EOF sudo yum makecache fast \ub9cc\uc77c Repo file\uc5d0\uc11c $basearch , $releasever \ubcc0\uc218 \uc801\uc6a9\uc774 \uc548 \ub418\uc5b4 yum \uba85\ub839\uc5d0 \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\ub294 \uacbd\uc6b0, \uc544\ub798 Command Set\uc744 \uc2e4\ud589\ud558\uba74 \ubcc0\uc218\ub97c Static\ud558\uac8c \ubcc0\uacbd\ud569\ub2c8\ub2e4. bash export repolist=\"$(ls -p /etc/yum.repos.d/ | grep -v '/$')\" export rel=\"$(rpm --query --file --queryformat '%{VERSION}\\n' /etc/system-release | cut -c1 )\" export barch=\"$(rpm --query --queryformat '%{ARCH}\\n' \"kernel-$(uname --kernel-release)\")\"; for repos in $repolist;do sed -i s/\\$releasever/${rel}/g /etc/yum.repos.d/$repos && sed -i s/\\$basearch/${barch}/g /etc/yum.repos.d/$repos; done PostgreSQL Install \u00b6 Local External DB\ub97c \uc124\uce58\ud558\ub294 \uacfc\uc815\uc785\ub2c8\ub2e4. Embedded ConfigDB\ub97c \uc0ac\uc6a9\ud558\ub824\uba74 \uc774 \uacfc\uc815\uc744 \ub118\uc5b4\uac00\uc2dc\uba74 \ub429\ub2c8\ub2e4. 3.9.0 \uc774\uc0c1\uc758 \ubc84\uc804\uc5d0\uc11c\ub294 PostgreSQL12\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uadf8 \uc774\uc804\uc758 \ubc84\uc804\uc5d0\uc11c\ub294 PostgreSQL9\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. #Postgresql12 Install sudo yum -y install postgresql12 postgresql12-server #DB Initialize /usr/pgsql-12/bin/postgresql-12-setup initdb # DB Listener Configure sudo vi /var/lib/pgsql/12/data/postgresql.conf \uae30\ubcf8\uac12\uc73c\ub85c \uc8fc\uc11d\ucc98\ub9ac \ub418\uc5b4 \uc788\ub294 \uc544\ub798 \ub77c\uc778\uc744 ```bash listen_addresses = 'localhost' \u00b6 port = 5432 \u00b6 ``` \uc6d0\ud558\ub294 IP Address \uc640 \ud568\uaed8 \uc8fc\uc11d \ud574\uc81c \ud569\ub2c8\ub2e4. bash listen_addresses = '<IP Address>' port = 5432 # DB Access Control Configure sudo vi /var/lib/pgsql/12/data/pg_hba.conf pg_hba.conf \ubb38\uc11c \ud558\ub2e8\uc758 Access Control \uae30\ubcf8\uac12\uc740 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. bash # TYPE DATABASE USER ADDRESS METHOD #\"local\" is for Unix domain socket connections only local all all peer #IPv4 local connections: host all all 127.0.0.1/32 ident ... \uc544\ub798\uc640 \uac19\uc774 \uc218\uc815\ud569\ub2c8\ub2e4. bash # \"local\" is for Unix domain socket connections only local all all peer local all nginxc trust local all postgres peer # IPv4 local connections: host all all 127.0.0.1/32 ident host all all 0.0.0.0/0 trust [\ucc38\uace0] Public IP\ub97c \uc0ac\uc6a9\ud558\uac8c \ub418\uba74 PostgresSQL \ucde8\uc57d\uc810 \uacf5\uaca9\uc774 \uc790\uc8fc \ub4e4\uc5b4\uc624\uae30 \ub54c\ubb38\uc5d0, \ubcf4\uc548 \uc0c1\uc758 \uc774\uc720\ub85c \uc544\ub798\uc640 \uac19\uc774 \uc81c\ud55c\ud574\uc8fc\ub294 \uac83\ub3c4 \uc88b\uc2b5\ub2c8\ub2e4. bash # \"local\" is for Unix domain socket connections only local all all peer local all nginxc trust local all postgres peer # IPv4 local connections: host all all 127.0.0.1/32 ident host all all 172.0.0.0/8 trust host all all 10.0.0.0/8 trust \ucc38\uace0\ub85c 10.0.0.0/8 \uacfc 172.0.0.0/8 \uc740 NGINX Controller\uc758 Kubernetes Pod Network Range \uc785\ub2c8\ub2e4. #PostgreSQL12 Enable and Start systemctl enable --now postgresql-12 #Set up Database, User, User Role and Authority su - postgres createuser nginxc; createdb nginxc; psql; alter user nginxc with superuser createrole createdb replication bypassrls; alter user nginxc with encrypted password 'nginxc'; alter database nginxc owner to nginxc; \\q exit NFS \uc124\uc815 (for External tsdb, Optional for Clustering) \u00b6 Clustering\uc744 \uc704\ud574 \ubcc4\ub3c4 \ud638\uc2a4\ud2b8\uc5d0 tsdb\ub97c NFS\ub85c \uc0ac\uc6a9\ud558\ub294 \ubc29\ubc95\uc73c\ub85c, \ucc38\uace0\ub97c \uc704\ud574 \uc791\uc131\ud55c \ub0b4\uc6a9\uc785\ub2c8\ub2e4. \uc2f1\uae00 \ub178\ub4dc NGINX Controller \uc124\uce58\ub97c \uc9c4\ud589 \uc911\uc774\ub77c\uba74 \ub2e4\uc74c\uc73c\ub85c \ub118\uc5b4\uac00\uc2dc\uba74 \ub429\ub2c8\ub2e4. @DB Host yum install -y portmap nfs-utils* libgssapi vi /etc/exports ## /var/ngxtsdb *(rw,sync) systemctl enable --now rpcbind; systemctl enable --now portmap; systemctl enable --now rpcidmapd; systemctl enable --now nfs; @Controller Node yum install nfs-utils #or ./opt/controller-installer/helper.sh prereqs nfs systemctl enable --now rpcbind; systemctl enable --now rpcidmapd; #\ud544\uc694\uc2dc mount -t nfs <xxx.xxx.xxx.xxx>:/var/ngxtsdb/ / NGINX Controller Install \u00b6 ### Hostname, DNS Set hostnamectl set-hostname ngxctlr.itian.ml echo 'nameserver 8.8.8.8' >> /etc/resolv.conf ### Kubernetes Node Initial Tweak #Set Selinux status to Permissive sed -i -re 's/SELINUX=enforcing/SELINUX=permissive/g' /etc/sysconfig/selinux; sed -i -re 's/SELINUX=enforcing/SELINUX=permissive/g' /etc/selinux/config; setenforce 0; #sestatus ## Firewall Stop and Diable systemctl disable firewalld; systemctl stop firewalld; #systemctl status firewalld ## Swap Disable swapoff -a && sed -i '/ swap / s/^/#/' /etc/fstab; #swapon ## Linux Network and Docker Cgroup Driver echo \"net.ipv4.ip_forward = 1\" >> /etc/sysctl.conf sysctl -p; #sysctl net.ipv4.ip_forward; tee -a /etc/sysctl.d/k8s.conf <<EOF 1>/dev/null net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF sysctl --system; mkdir -p /etc/docker tee -a /etc/docker/daemon.json <<EOF 1>/dev/null { \"exec-opts\": [\"native.cgroupdriver=systemd\"], \"log-driver\": \"json-file\", \"log-opts\": { \"max-size\": \"10m\", \"max-file\": \"10\" } } EOF Install Docker 18.09.9 and NGINX Controller Requires \u00b6 yum -y install docker-ce-18.09.1 docker-ce-cli-18.09.1 device-mapper-persistent-data lvm2 jq oniguruma socat conntrack yum-versionlock systemctl enable --now docker NGINX Controller Install \u00b6 \ucee8\ud2b8\ub864\ub7ec \uc778\uc2a4\ud1a8\ub7ec \ud328\ud0a4\uc9c0\ub97c \uc555\ucd95 \ud574\uc81c\ud558\uace0, \uc0dd\uc131\ub41c \ud3f4\ub354\uc758 ./install.sh \ud30c\uc77c\uc744 \uc2e4\ud589\ud569\ub2c8\ub2e4. cd /var/tmp && tar zxvf controller-installer-<VERSION>.tar.gz cd controller-installer ./install.sh Command Argument\ub97c \uc0ac\uc6a9\ud574 \uc900\ube44\ub41c \ucee4\ub9e8\ub4dc\ub97c \uc785\ub825\ud558\uba74 \ucd94\uac00\uc801\uc778 \uc815\ubcf4 \uc785\ub825 \uc5c6\uc774 \uc124\uce58\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucee4\ub9e8\ub4dc \uc608\uc2dc\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. ### 3.10.0~ ./install.sh -y --self-signed-cert --fqdn <FQDN> / --configdb-host <DB HOST IP> --configdb-port 5432 --configdb-user <db-user> --configdb-pass <db-pass> --configdb-enable-ssl \"false\" \\ --tsdb-volume-type local \\ --smtp-host 127.0.0.1 --smtp-port 25 --smtp-authentication \"false\" --smtp-use-tls \"false\" --noreply-address noreply@itian.co.kr --admin-email <admin email> --admin-password <admin password> --organization-name itian --admin-firstname admin --admin-lastname admin ### 3.10.0~ (TSDB NFS \uc0ac\uc6a9 \uc2dc) ./install.sh -y --self-signed-cert --fqdn <FQDN> / --configdb-host <DB HOST IP> --configdb-port 5432 --configdb-user <db-user> --configdb-pass <db-pass> --configdb-enable-ssl \"false\" \\ --tsdb-volume-type nfs --tsdb-nfs-host 175.196.235.25 --tsdb-nfs-path /var/ngxtsdb \\ --smtp-host 127.0.0.1 --smtp-port 25 --smtp-authentication \"false\" --smtp-use-tls \"false\" --noreply-address noreply@itian.co.kr --admin-email <admin email> --admin-password <admin password> --organization-name itian --admin-firstname admin --admin-lastname admin ### ~3.9.0 ./install.sh -y --self-signed-cert --fqdn nc.itian.ml --db-host <DB HOST IP> --db-port 5432 --db-user <db-user> --db-pass <db-pass> --db-enable-ssl \"false\" --tsdb-volume-type local --smtp-host 127.0.0.1 --smtp-port 25 --smtp-authentication \"false\" --smtp-use-tls \"false\" --noreply-address noreply@itian.co.kr --admin-email <admin email> --admin-password <admin password> --organization-name itian --admin-firstname admin --admin-lastname admin","title":"NGINX Controller Deployment Guide"},{"location":"NGINX-Plus/NGINX-Controller/NGINX-Controller-Deployment-Guide/#nginx-controller","text":"\ubcf8 \uac00\uc774\ub4dc\uc5d0\uc11c\ub294 \uc774\uc911\ud654 \ub4f1\uc774 \uc5c6\ub294 \uc2f1\uae00 \ub178\ub4dc NGINX Controller\uc758 \uc124\uce58\ub97c \ub2e4\ub8f9\ub2c8\ub2e4. \ub2e8, Online Install\uc774 \uac00\ub2a5\ud55c \ud658\uacbd, Offline Install\uc774 \ud544\uc694\ud55c \ud658\uacbd\uc73c\ub85c \uad6c\ubd84\ud574 \uac01\uac01 \uc18c\uac1c\ud569\ub2c8\ub2e4. \uac00\uc774\ub4dc\uc5d0\uc11c\ub294 CentOS 7.4+ \ud658\uacbd\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. controller-installer-<version>.tar.gz \ud328\ud0a4\uc9c0\uc640 controller_license.txt \ub77c\uc774\uc120\uc2a4 \ud30c\uc77c\uc774 \ud544\uc694\ud558\uba70, controller-installer-<version>.tar.gz \ud30c\uc77c\uc774 /var/tmp \uc5d0 \uc5c5\ub85c\ub4dc \ub418\uc5b4\uc788\ub2e4\uace0 \uac00\uc815\ud569\ub2c8\ub2e4. Embedded Config DB\ub97c \uc0ac\uc6a9\ud560 \uc218\ub3c4 \uc788\uc73c\ub098 \uac00\uc774\ub4dc\ub97c \uc704\ud574 PostgreSQL\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. NFS \uc0ac\uc6a9\ubc95\ub3c4 \uacfc\uc815 \uc911\uc5d0 \uac04\ub7b5\ud788 \uc18c\uac1c\ud569\ub2c8\ub2e4.","title":"NGINX Controller"},{"location":"NGINX-Plus/NGINX-Controller/NGINX-Controller-Deployment-Guide/#user","text":"3.12.0 \uc774\uc0c1\uc758 \ubc84\uc804\uc740 root \uacc4\uc815\uc73c\ub85c NGINX Controller \ub97c \uc124\uce58\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.","title":"User \uc8fc\uc758\uc0ac\ud56d"},{"location":"NGINX-Plus/NGINX-Controller/NGINX-Controller-Deployment-Guide/#clustering","text":"Controller Clustering\uc744 \uc704\ud574\uc11c\ub294 ConfigDB, TimeSeriesDB \ubaa8\ub450 Local\ub97c \uc0ac\uc6a9\ud574\uc120 \uc548\ub429\ub2c8\ub2e4. Configdb, tsdb \ub458 \ub2e4 Controller\uac00 \uc124\uce58\ub418\ub294 \ub178\ub4dc\uac00 \uc544\ub2cc \ubcc4\ub3c4\uc758 \ub178\ub4dc\uc5d0 \uc124\uce58\ub418\uc5b4\uc57c \ud558\uba70, configdb\ub294 \ubcc4\ub3c4 \ud638\uc2a4\ud2b8\uc5d0 postgresql\uc744 \uc124\uce58, tsdb\ub294 \ubcc4\ub3c4 \ud638\uc2a4\ud2b8\uc5d0 nfs\ub97c \uc124\uce58 \uc0ac\uc6a9\ud558\ub294 \ubc29\uc2dd\uc73c\ub85c DB\ub97c \ubd84\ub9ac\ud574\uc57c \ud569\ub2c8\ub2e4. \uc0ac\uc6a9\ud55c\ub2e4. \ub610\ud55c \uc628\uc804\ud55c Quorum \ubc0f Resilient Cluster \uad6c\uc131\uc744 \uc704\ud574\uc120 3\ub300\uc758 \ub178\ub4dc\uac00 \ud544\uc694\ud569\ub2c8\ub2e4. \ub530\ub77c\uc11c \uc628\uc804\ud55c Resilient Cluster \uad6c\uc131\uc744 \uc704\ud574\uc120 \ucd5c\uc18c 4 \ub300\uc758 \ub178\ub4dc\uac00 \ud544\uc694 \ud569\ub2c8\ub2e4.","title":"Clustering \uc8fc\uc758 \uc0ac\ud56d"},{"location":"NGINX-Plus/NGINX-Controller/NGINX-Controller-Deployment-Guide/#nginx-controller-online-install","text":"","title":"NGINX Controller Online Install"},{"location":"NGINX-Plus/NGINX-Controller/NGINX-Controller-Deployment-Guide/#node-and-repository-set-up","text":"#hostname and DNS Set hostnamectl set-hostname ngxctlr.itian.ml echo 'nameserver 8.8.8.8' >> /etc/resolv.conf #CentOS Repository (kakao mirror) Set tee -a /etc/yum.repos.d/centos-kakao.repo <<EOF 1>/dev/null [base] name=CentOS-7 - Base baseurl=http://mirror.kakao.com/centos/7/os/x86_64/ gpgcheck=0 [updates] name=CentOS-7 - Updates baseurl=http://mirror.kakao.com/centos/7/updates/x86_64/ gpgcheck=0 [extras] name=CentOS-$releasever - Extras baseurl=http://mirror.kakao.com/centos/7/extras/x86_64/ gpgcheck=0 EOF #Docker, PostgreSQL, EPEL Repository Set sudo yum install -y yum-utils sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo sudo yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm sudo yum install -y epel-release #Google kubernetes Repository Set cat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\\$basearch enabled=1 gpgcheck=1 repo_gpgcheck=1 gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg exclude=kubelet kubeadm kubectl EOF sudo yum makecache fast \ub9cc\uc77c Repo file\uc5d0\uc11c $basearch , $releasever \ubcc0\uc218 \uc801\uc6a9\uc774 \uc548 \ub418\uc5b4 yum \uba85\ub839\uc5d0 \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\ub294 \uacbd\uc6b0, \uc544\ub798 Command Set\uc744 \uc2e4\ud589\ud558\uba74 \ubcc0\uc218\ub97c Static\ud558\uac8c \ubcc0\uacbd\ud569\ub2c8\ub2e4. bash export repolist=\"$(ls -p /etc/yum.repos.d/ | grep -v '/$')\" export rel=\"$(rpm --query --file --queryformat '%{VERSION}\\n' /etc/system-release | cut -c1 )\" export barch=\"$(rpm --query --queryformat '%{ARCH}\\n' \"kernel-$(uname --kernel-release)\")\"; for repos in $repolist;do sed -i s/\\$releasever/${rel}/g /etc/yum.repos.d/$repos && sed -i s/\\$basearch/${barch}/g /etc/yum.repos.d/$repos; done","title":"Node and Repository Set-up"},{"location":"NGINX-Plus/NGINX-Controller/NGINX-Controller-Deployment-Guide/#postgresql-install","text":"Local External DB\ub97c \uc124\uce58\ud558\ub294 \uacfc\uc815\uc785\ub2c8\ub2e4. Embedded ConfigDB\ub97c \uc0ac\uc6a9\ud558\ub824\uba74 \uc774 \uacfc\uc815\uc744 \ub118\uc5b4\uac00\uc2dc\uba74 \ub429\ub2c8\ub2e4. 3.9.0 \uc774\uc0c1\uc758 \ubc84\uc804\uc5d0\uc11c\ub294 PostgreSQL12\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uadf8 \uc774\uc804\uc758 \ubc84\uc804\uc5d0\uc11c\ub294 PostgreSQL9\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. #Postgresql12 Install sudo yum -y install postgresql12 postgresql12-server #DB Initialize /usr/pgsql-12/bin/postgresql-12-setup initdb # DB Listener Configure sudo vi /var/lib/pgsql/12/data/postgresql.conf \uae30\ubcf8\uac12\uc73c\ub85c \uc8fc\uc11d\ucc98\ub9ac \ub418\uc5b4 \uc788\ub294 \uc544\ub798 \ub77c\uc778\uc744 ```bash","title":"PostgreSQL Install"},{"location":"NGINX-Plus/NGINX-Controller/NGINX-Controller-Deployment-Guide/#listen_addresses-localhost","text":"","title":"listen_addresses = 'localhost'"},{"location":"NGINX-Plus/NGINX-Controller/NGINX-Controller-Deployment-Guide/#port-5432","text":"``` \uc6d0\ud558\ub294 IP Address \uc640 \ud568\uaed8 \uc8fc\uc11d \ud574\uc81c \ud569\ub2c8\ub2e4. bash listen_addresses = '<IP Address>' port = 5432 # DB Access Control Configure sudo vi /var/lib/pgsql/12/data/pg_hba.conf pg_hba.conf \ubb38\uc11c \ud558\ub2e8\uc758 Access Control \uae30\ubcf8\uac12\uc740 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. bash # TYPE DATABASE USER ADDRESS METHOD #\"local\" is for Unix domain socket connections only local all all peer #IPv4 local connections: host all all 127.0.0.1/32 ident ... \uc544\ub798\uc640 \uac19\uc774 \uc218\uc815\ud569\ub2c8\ub2e4. bash # \"local\" is for Unix domain socket connections only local all all peer local all nginxc trust local all postgres peer # IPv4 local connections: host all all 127.0.0.1/32 ident host all all 0.0.0.0/0 trust [\ucc38\uace0] Public IP\ub97c \uc0ac\uc6a9\ud558\uac8c \ub418\uba74 PostgresSQL \ucde8\uc57d\uc810 \uacf5\uaca9\uc774 \uc790\uc8fc \ub4e4\uc5b4\uc624\uae30 \ub54c\ubb38\uc5d0, \ubcf4\uc548 \uc0c1\uc758 \uc774\uc720\ub85c \uc544\ub798\uc640 \uac19\uc774 \uc81c\ud55c\ud574\uc8fc\ub294 \uac83\ub3c4 \uc88b\uc2b5\ub2c8\ub2e4. bash # \"local\" is for Unix domain socket connections only local all all peer local all nginxc trust local all postgres peer # IPv4 local connections: host all all 127.0.0.1/32 ident host all all 172.0.0.0/8 trust host all all 10.0.0.0/8 trust \ucc38\uace0\ub85c 10.0.0.0/8 \uacfc 172.0.0.0/8 \uc740 NGINX Controller\uc758 Kubernetes Pod Network Range \uc785\ub2c8\ub2e4. #PostgreSQL12 Enable and Start systemctl enable --now postgresql-12 #Set up Database, User, User Role and Authority su - postgres createuser nginxc; createdb nginxc; psql; alter user nginxc with superuser createrole createdb replication bypassrls; alter user nginxc with encrypted password 'nginxc'; alter database nginxc owner to nginxc; \\q exit","title":"port = 5432"},{"location":"NGINX-Plus/NGINX-Controller/NGINX-Controller-Deployment-Guide/#nfs-for-external-tsdb-optional-for-clustering","text":"Clustering\uc744 \uc704\ud574 \ubcc4\ub3c4 \ud638\uc2a4\ud2b8\uc5d0 tsdb\ub97c NFS\ub85c \uc0ac\uc6a9\ud558\ub294 \ubc29\ubc95\uc73c\ub85c, \ucc38\uace0\ub97c \uc704\ud574 \uc791\uc131\ud55c \ub0b4\uc6a9\uc785\ub2c8\ub2e4. \uc2f1\uae00 \ub178\ub4dc NGINX Controller \uc124\uce58\ub97c \uc9c4\ud589 \uc911\uc774\ub77c\uba74 \ub2e4\uc74c\uc73c\ub85c \ub118\uc5b4\uac00\uc2dc\uba74 \ub429\ub2c8\ub2e4. @DB Host yum install -y portmap nfs-utils* libgssapi vi /etc/exports ## /var/ngxtsdb *(rw,sync) systemctl enable --now rpcbind; systemctl enable --now portmap; systemctl enable --now rpcidmapd; systemctl enable --now nfs; @Controller Node yum install nfs-utils #or ./opt/controller-installer/helper.sh prereqs nfs systemctl enable --now rpcbind; systemctl enable --now rpcidmapd; #\ud544\uc694\uc2dc mount -t nfs <xxx.xxx.xxx.xxx>:/var/ngxtsdb/ /","title":"NFS \uc124\uc815 (for External tsdb, Optional for Clustering)"},{"location":"NGINX-Plus/NGINX-Controller/NGINX-Controller-Deployment-Guide/#nginx-controller-install","text":"### Hostname, DNS Set hostnamectl set-hostname ngxctlr.itian.ml echo 'nameserver 8.8.8.8' >> /etc/resolv.conf ### Kubernetes Node Initial Tweak #Set Selinux status to Permissive sed -i -re 's/SELINUX=enforcing/SELINUX=permissive/g' /etc/sysconfig/selinux; sed -i -re 's/SELINUX=enforcing/SELINUX=permissive/g' /etc/selinux/config; setenforce 0; #sestatus ## Firewall Stop and Diable systemctl disable firewalld; systemctl stop firewalld; #systemctl status firewalld ## Swap Disable swapoff -a && sed -i '/ swap / s/^/#/' /etc/fstab; #swapon ## Linux Network and Docker Cgroup Driver echo \"net.ipv4.ip_forward = 1\" >> /etc/sysctl.conf sysctl -p; #sysctl net.ipv4.ip_forward; tee -a /etc/sysctl.d/k8s.conf <<EOF 1>/dev/null net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF sysctl --system; mkdir -p /etc/docker tee -a /etc/docker/daemon.json <<EOF 1>/dev/null { \"exec-opts\": [\"native.cgroupdriver=systemd\"], \"log-driver\": \"json-file\", \"log-opts\": { \"max-size\": \"10m\", \"max-file\": \"10\" } } EOF","title":"NGINX Controller Install"},{"location":"NGINX-Plus/NGINX-Controller/NGINX-Controller-Deployment-Guide/#install-docker-18099-and-nginx-controller-requires","text":"yum -y install docker-ce-18.09.1 docker-ce-cli-18.09.1 device-mapper-persistent-data lvm2 jq oniguruma socat conntrack yum-versionlock systemctl enable --now docker","title":"Install Docker 18.09.9 and NGINX Controller Requires"},{"location":"NGINX-Plus/NGINX-Controller/NGINX-Controller-Deployment-Guide/#nginx-controller-install_1","text":"\ucee8\ud2b8\ub864\ub7ec \uc778\uc2a4\ud1a8\ub7ec \ud328\ud0a4\uc9c0\ub97c \uc555\ucd95 \ud574\uc81c\ud558\uace0, \uc0dd\uc131\ub41c \ud3f4\ub354\uc758 ./install.sh \ud30c\uc77c\uc744 \uc2e4\ud589\ud569\ub2c8\ub2e4. cd /var/tmp && tar zxvf controller-installer-<VERSION>.tar.gz cd controller-installer ./install.sh Command Argument\ub97c \uc0ac\uc6a9\ud574 \uc900\ube44\ub41c \ucee4\ub9e8\ub4dc\ub97c \uc785\ub825\ud558\uba74 \ucd94\uac00\uc801\uc778 \uc815\ubcf4 \uc785\ub825 \uc5c6\uc774 \uc124\uce58\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucee4\ub9e8\ub4dc \uc608\uc2dc\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. ### 3.10.0~ ./install.sh -y --self-signed-cert --fqdn <FQDN> / --configdb-host <DB HOST IP> --configdb-port 5432 --configdb-user <db-user> --configdb-pass <db-pass> --configdb-enable-ssl \"false\" \\ --tsdb-volume-type local \\ --smtp-host 127.0.0.1 --smtp-port 25 --smtp-authentication \"false\" --smtp-use-tls \"false\" --noreply-address noreply@itian.co.kr --admin-email <admin email> --admin-password <admin password> --organization-name itian --admin-firstname admin --admin-lastname admin ### 3.10.0~ (TSDB NFS \uc0ac\uc6a9 \uc2dc) ./install.sh -y --self-signed-cert --fqdn <FQDN> / --configdb-host <DB HOST IP> --configdb-port 5432 --configdb-user <db-user> --configdb-pass <db-pass> --configdb-enable-ssl \"false\" \\ --tsdb-volume-type nfs --tsdb-nfs-host 175.196.235.25 --tsdb-nfs-path /var/ngxtsdb \\ --smtp-host 127.0.0.1 --smtp-port 25 --smtp-authentication \"false\" --smtp-use-tls \"false\" --noreply-address noreply@itian.co.kr --admin-email <admin email> --admin-password <admin password> --organization-name itian --admin-firstname admin --admin-lastname admin ### ~3.9.0 ./install.sh -y --self-signed-cert --fqdn nc.itian.ml --db-host <DB HOST IP> --db-port 5432 --db-user <db-user> --db-pass <db-pass> --db-enable-ssl \"false\" --tsdb-volume-type local --smtp-host 127.0.0.1 --smtp-port 25 --smtp-authentication \"false\" --smtp-use-tls \"false\" --noreply-address noreply@itian.co.kr --admin-email <admin email> --admin-password <admin password> --organization-name itian --admin-firstname admin --admin-lastname admin","title":"NGINX Controller Install"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/Helm-Chart%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4-NPIC-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0/","text":"Helm \ucc28\ud2b8\ub97c \uc0ac\uc6a9\ud574 NGINX Plus Ingress Controller \ubc30\ud3ec \ud14c\uc2a4\ud2b8 Helm \ucc28\ud2b8\ub97c \uc0ac\uc6a9\ud574 NGINX Plus Ingress Controller \ubc30\ud3ec \u00b6 NGINX Plus Ingress Controller (NPIC)\uc758 \uc774\ubbf8\uc9c0 \ube4c\ub4dc\uc5d0\ub294 Docker, git, GNU Make, OpenSSL, \uadf8\ub9ac\uace0 NGINX-Plus \ub77c\uc774\uc120\uc2a4\uac00 \ud544\uc694\ud569\ub2c8\ub2e4. 1. Helm / git \uc124\uce58 \u00b6 Helm\uc740 Kubernetes\uc5d0\uc11c \ub9ac\ub205\uc2a4\uc758 YUM rpm, APT dpkg \uac19\uc774 \ud328\ud0a4\uc9c0\ub97c \uad00\ub9ac\ud574\uc8fc\ub294 \uc5ed\ud560\uc744 \uc218\ud589\ud569\ub2c8\ub2e4. Helm\uc758 \ud328\ud0a4\uc9c0\ub97c Chart\ub77c\uace0 \ud569\ub2c8\ub2e4. Helm 3.5.3\uc744 \ub2e4\uc6b4\ub85c\ub4dc \ud574 \uc555\ucd95\uc744 \ud480\uc5b4\uc8fc\uace0, \uadf8 PATH \uacbd\ub85c(/usr/local/sbin)\uc73c\ub85c \uc774\ub3d9\ud569\ub2c8\ub2e4. curl -L https://get.helm.sh/helm-v3.5.3-linux-amd64.tar.gz | tar zxf - mv linux-amd64/helm /usr/local/sbin git \ub3c4 \uc124\uce58\ud574\uc8fc\uaca0\uc2b5\ub2c8\ub2e4. yum -y install git 2. NGINX Plus Ingress Controller \uc774\ubbf8\uc9c0 \uc0dd\uc131 \u00b6 \uc774 \ubd80\ubd84\uc740 NPIC + NDK + Lua \ubaa8\ub4c8 \ud14c\uc2a4\ud2b8 \uc758 \uacfc\uc815\uacfc \uc720\uc0ac\ud569\ub2c8\ub2e4. (3\uc6d431\uc77c 1.11.0\ubc84\uc804\uc774 \ub9b4\ub9ac\uc988\ub418\uc5b4 1.11.0 \ubc84\uc804\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4.) mkdir -p /var/tmp/npic && cd /var/tmp/npic git clone https://github.com/nginxinc/kubernetes-ingress/ cd kubernetes-ingress git chechout v1.11.0 \uae30\uc874 Dockerfile \ubc31\uc5c5 v1.11.0\uc5d0\uc11c\ub294 Dockerfile\uc774 \ubcc0\uacbd\ub41c \uac83\uc73c\ub85c \ubcf4\uc785\ub2c8\ub2e4. v1.10.0\uacfc \ub2ec\ub9ac App protect for Plus\uac00 \ubcc4\ub3c4\ub85c \uc81c\uacf5\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. cp /var/tmp/npic/kubernetes-ingress/build/Dockerfile \\ /var/tmp/npic/kubernetes-ingress/build/Dockerfile.bak \uae30\uc874 Dockerfile \uc218\uc815 vi /var/tmp/npic/kubernetes-ingress/build/Dockerfile yum -y install nginx-plus \ucee4\ub9e8\ub4dc\uc5d0 \uc544\ub798 \ud328\ud0a4\uc9c0\ub97c \ucd94\uac00\ud574\uc90d\ub2c8\ub2e4. nginx-plus-module-ndk nginx-plus-module-lua nginx-plus-module-cookie-flag nginx-plus-module-encrypted-session nginx-plus-module-headers-more nginx-plus-module-set-misc \ucd94\uac00\ud55c Dockerfile\uc740 \uc544\ub798 \ud615\ud0dc\uac00 \ub429\ub2c8\ub2e4. (v1.11.0\uc758 Dockerfile \ud30c\uc77c\uc758 52\ubc88 \ub77c\uc778\uc744 \uc218\uc815\ud588\uc2b5\ub2c8\ub2e4.) ...[omitted] apt-transport-https libcap2-bin nginx-plus=${NGINX_PLUS_VERSION} nginx-plus-module-njs= ${NGINX_NJS_VERSION} nginx-plus-module-ndk nginx-plus-module-lua nginx-plus-module-cookie-flag nginx-plus-module-encrypted-session nginx-plus-module-headers-more nginx-plus-module-set-misc \\ ...[omitted] 3. NGINX+ \ub77c\uc774\uc120\uc2a4\ub97c Kubernetes-ingress \ub514\ub809\ud1a0\ub9ac\uc5d0 \ubcf5\uc0ac\ud558\uace0, \uc774\ubbf8\uc9c0 \ube4c\ub4dc\ub97c \uc2dc\uc791\ud569\ub2c8\ub2e4 \u00b6 NGINX+ \ud14c\uc2a4\ud2b8 \ub77c\uc774\uc120\uc2a4\ub97c \uc0ac\uc6a9\ud588\uc2b5\ub2c8\ub2e4. cp /var/tmp/nginx-repo* /var/tmp/npic/kubernetes-ingress/ \uc774\ubbf8\uc9c0 \ube4c\ub4dc\ub97c \uc2dc\uc791\ud569\ub2c8\ub2e4. (Dockerfile \ubcc0\uacbd\uc5d0 \ub530\ub77c make \uba85\ub839\uc5b4\ub3c4 v1.10.0\uc5d0 \ube44\ud574 \ub2ec\ub77c\uc84c\uc2b5\ub2c8\ub2e4.) make debian-image-plus PREFIX=dddaong/nginx-plus-ingress TARGET=container ~~\ube4c\ub4dc\uac00 \uc644\ub8cc\ub418\uba74 Repository\uc5d0 \uc5c5\ub85c\ub4dc\ub97c \uc2dc\ub3c4\ud558\uae30 \ub54c\ubb38\uc5d0 \uc544\ub798 \uc624\ub958 \uba54\uc2dc\uc9c0\ub294 \ubb34\uc2dc\ud558\uc154\ub3c4 \uc88b\uc2b5\ub2c8\ub2e4.~~ v1.11.0\ubd80\ud130\ub294 \ube4c\ub4dc\uac00 \uc644\ub8cc\ub418\uc5b4\ub3c4 Registry\uc5d0 \uc5c5\ub85c\ub4dc\ub97c \uc2dc\ub3c4\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ube4c\ub4dc\uacfc\uc815\uc774 \uc644\ub8cc\ub418\uba74 docker\uc5d0\uc11c \uc774\ubbf8\uc9c0\ub97c \ud655\uc778\ud569\ub2c8\ub2e4. Tag\uac00 edge\ub85c \uc9c0\uc815\ub418\uc5b4 \uc788\ub294 \uac83\uc774 \ubcf4\uc785\ub2c8\ub2e4. $ docker image ls REPOSITORY TAG IMAGE ID CREATED SIZE dddaong/nginx-plus-ingress edge ab47ffdd0e3a About a minute ago 136MB 4. \ud14c\uc2a4\ud2b8 \ud658\uacbd\uc5d0 Image repository\uac00 \uc5c6\uc73c\ubbc0\ub85c \uc218\ub3d9\uc73c\ub85c \ub178\ub4dc\uc5d0 \uc774\ubbf8\uc9c0\ub97c \ub85c\ub4dc\ud574\uc90d\ub2c8\ub2e4 \u00b6 save docker image docker save dddaong/nginx-plus-ingress:edge -o /var/tmp/npic/dddaong-npic-edge.tgz scp /var/tmp/npic/dddaong-npic-edge.tgz root@<workernode1>:/var/tmp scp /var/tmp/npic/dddaong-npic-edge.tgz root@<workernode2>:/var/tmp load docker image @each node docker load -i /var/tmp/dddaong-npic-edge.tgz 5-1. \uae30\uc874 NPIC \uc5d0 \uc0c8\ub85c \ube4c\ub4dc\ud55c \uc774\ubbf8\uc9c0 \uc801\uc6a9 \u00b6 Helm \ucc28\ud2b8\ub97c \uc0ac\uc6a9\ud55c NPIC \uad6c\ucd95\uc740 5-2\uc5d0\uc11c \uc218\ud589\ud569\ub2c8\ub2e4. \uae30\uc874\uc5d0 NPIC\ub97c \uc0ad\uc81c\ud558\uae30 \uc804\uc5d0, \uc0c8\ub85c \ube4c\ub4dc\ud55c \uc774\ubbf8\uc9c0\ub97c \uc801\uc6a9\ud558\ub294 \ud14c\uc2a4\ud2b8\ub97c \uc218\ud589 \ud588\uc2b5\ub2c8\ub2e4. \uc774\ubc88 \ud14c\uc2a4\ud2b8\uc5d0\uc11c\ub294 kubectl \ucee4\ub9e8\ub4dc\ub85c \ub864\uc544\uc6c3 \uc5c5\ub370\uc774\ud2b8\ub97c \ud574\ubcf4\uaca0\uc2b5\ub2c8\ub2e4. $ kubectl -n nginx-ingress get deployments.apps NAME READY UP-TO-DATE AVAILABLE AGE nginx-ingress 1/1 1 1 13d Deployment \ub9ac\uc18c\uc2a4\uc758 Containers\uc5d0\uc11c \ud56d\ubaa9\uba85\uc744 \ud655\uc778\ud569\ub2c8\ub2e4. \uc774 \ud14c\uc2a4\ud2b8\uc5d0\uc11c \uc774\ubbf8\uc9c0\ub97c \ubcc0\uacbd\ud560 Container \uc774\ub984\uc740 nginx-plus-ingress\ub85c \ud655\uc778\ub429\ub2c8\ub2e4. $ kubectl -n nginx-ingress describe deployments.apps nginx-ingress | grep -A 4 'Container' Containers: nginx-plus-ingress: Image: samsung/nginxplus-ingress:1.10.1 Ports: 80/TCP, 443/TCP, 8081/TCP Host Ports: 0/TCP, 0/TCP, 0/TCP \ud655\uc778\ud55c \ud56d\ubaa9\uc758 \uc774\ubbf8\uc9c0\ub97c kubectl \uba85\ub839\uc5b4\ub85c \ubcc0\uacbd\ud574\uc90d\ub2c8\ub2e4. \ucee4\ub9e8\ub4dc \uc218\ud589\uc2dc \uc989\uc2dc Rollout\uc774 \uc9c4\ud589\ub429\ub2c8\ub2e4!! $ kubectl -n nginx-ingress set image deployments/nginx-ingress nginx-plus-ingress=dddaong/nginx-plus-ingress:edge deployment.apps/nginx-ingress image updated Rollout \uacb0\uacfc\ub97c \ud655\uc778\ud569\ub2c8\ub2e4. $ kubectl -n nginx-ingress rollout status deployment nginx-ingress deployment \"nginx-ingress\" successfully rolled out \ud30c\ub4dc\uc640 Deployment \uc0c1\ud0dc\ub97c \ud655\uc778\ud569\ub2c8\ub2e4. $ kubectl -n nginx-ingress get pod NAME READY STATUS RESTARTS AGE nginx-ingress-6ff488c8c8-xtsn8 1/1 Running 0 34s $ kubectl -n nginx-ingress describe deployments.apps nginx-ingress | grep -A 4 'Container' Containers: nginx-plus-ingress: Image: dddaong/nginx-plus-ingress:edge Ports: 80/TCP, 443/TCP, 8081/TCP Host Ports: 0/TCP, 0/TCP, 0/TCP 5-2. Helm\uc744 \uc0ac\uc6a9\ud574 Kubernetes\uc5d0 NPIC \uc124\uce58 \u00b6 \uba3c\uc800 \uae30\uc874 NPIC\ub97c \uc81c\uac70\ud569\ub2c8\ub2e4 kubectl delete namespaces nginx-ingress kubectl delete ingressclasses nginx helm \ucc28\ud2b8 \ub9ac\uc18c\uc2a4\uac00 \uc788\ub294 \ub514\ub809\ud1a0\ub9ac\ub85c \ub4e4\uc5b4\uac11\ub2c8\ub2e4. cd /var/tmp/npic/kubernetes-ingress/deployments/helm-chart git checkout v1.11.0 values-plus.yaml \ud30c\uc77c\uc744 \ubc31\uc5c5\ud55c \ud6c4, \ud30c\uc77c \ub0b4 \uc774\ubbf8\uc9c0 \uacbd\ub85c\ub97c \uc218\uc815\ud569\ub2c8\ub2e4. cp values-plus.yaml values-plus.yaml.bak vi values-plus.yaml controller: nginxplus: true image: repository: <NPIC Repository/image name> tag: \"edge\" \uc774 \ud14c\uc2a4\ud2b8\uc758 \uacbd\uc6b0, dddaong/nginx-plus-ingress\ub85c \uc791\uc131\ud588\uc2b5\ub2c8\ub2e4. helm\uc744 \uc0ac\uc6a9\ud574 \uc778\uc2a4\ud1a8\uc744 \uc218\ud589\ud569\ub2c8\ub2e4. helm install dddaong -f values-plus.yaml . \"dddaong\"\uc740 \uc784\uc758\uc758 \ub9b4\ub9ac\uc988 \uba85\uc73c\ub85c\uc11c, \uc6d0\ud558\ub294 \uc774\ub984\uc744 \uc0ac\uc6a9\ud558\uba74 \ub429\ub2c8\ub2e4. W0401 13:28:12.293718 23860 warnings.go:70] networking.k8s.io/v1beta1 IngressClass is deprecated in v1.19+, unavailable in v1.22+; use networking.k8s.io/v1 IngressClassList W0401 13:28:12.490643 23860 warnings.go:70] networking.k8s.io/v1beta1 IngressClass is deprecated in v1.19+, unavailable in v1.22+; use networking.k8s.io/v1 IngressClassList NAME: dddaong LAST DEPLOYED: Thu Apr 1 13:28:11 2021 NAMESPACE: default STATUS: deployed REVISION: 1 TEST SUITE: None NOTES: The NGINX Ingress Controller has been installed. Custom Resource Definition\ub4e4\uc744 \uc124\uce58\ud569\ub2c8\ub2e4. $ kubectl apply -f crds/ customresourcedefinition.apiextensions.k8s.io/aplogconfs.appprotect.f5.com configured customresourcedefinition.apiextensions.k8s.io/appolicies.appprotect.f5.com configured customresourcedefinition.apiextensions.k8s.io/apusersigs.appprotect.f5.com configured customresourcedefinition.apiextensions.k8s.io/globalconfigurations.k8s.nginx.org configured customresourcedefinition.apiextensions.k8s.io/policies.k8s.nginx.org configured customresourcedefinition.apiextensions.k8s.io/transportservers.k8s.nginx.org configured customresourcedefinition.apiextensions.k8s.io/virtualserverroutes.k8s.nginx.org configured customresourcedefinition.apiextensions.k8s.io/virtualservers.k8s.nginx.org configured \uc124\uce58 \uacb0\uacfc\ub97c \ud655\uc778\ud569\ub2c8\ub2e4. helm\uc73c\ub85c \uc81c\uacf5\ub418\ub294 \uc124\uce58 \ubc29\ubc95\uc740 \ubcc4\ub3c4\uc758 nginx-ingress namespace\ub97c \uc0dd\uc131\ud558\uc9c0 \uc54a\uace0, default namespace\uc5d0 \uc124\uce58\ub429\ub2c8\ub2e4. $ kubectl get namespaces NAME STATUS AGE default Active 13d kube-node-lease Active 13d kube-public Active 13d kube-system Active 13d $ kubectl get pod NAME READY STATUS RESTARTS AGE dddaong-nginx-ingress-64f6d88767-txgvw 1/1 Running 0 3m46s fakeapi-6f89b55d54-4j8vp 1/1 Running 0 2d16h 6. Lua \uc0ac\uc6a9\uc744 \uc704\ud55c configmap\uc744 \uc218\uc815 \u00b6 nginx-ingress\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub294 configmap\uc744 \ud655\uc778\ud569\ub2c8\ub2e4. $ kubectl describe pod dddaong-nginx-ingress-64f6d88767-txgvw | grep configmap -nginx-configmaps=$(POD_NAMESPACE)/dddaong-nginx-ingress $ kubectl get cm NAME DATA AGE dddaong-nginx-ingress 0 8m56s configmap \uc218\uc815\ud569\ub2c8\ub2e4. kubectl edit cm dddaong-nginx-ingress \uae30\uc874 \ud30c\uc77c \ucd5c\ud558\ub2e8\uc5d0 \uc544\ub798 \ub0b4\uc6a9\uc744 \uc791\uc131\ud574\uc8fc\uace0 \uc800\uc7a5\ud569\ub2c8\ub2e4. data: main-snippets: | load_module modules/ndk_http_module.so; load_module modules/ngx_http_lua_module.so; load_module modules/ngx_stream_lua_module.so; load_module modules/ngx_http_encrypted_session_module.so; load_module modules/ngx_http_set_misc_module.so; load_module modules/ngx_http_cookie_flag_filter_module.so; load_module modules/ngx_http_headers_more_filter_module.so; \ubcc0\uacbd\ub41c configmap\uc774 \uc798 \ubc18\uc601\ub418\uc5c8\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4. kubectl exec -it dddaong-nginx-ingress-64f6d88767-txgvw -- cat /etc/nginx/nginx.conf | grep load_module load_module modules/ndk_http_module.so; load_module modules/ngx_http_lua_module.so; load_module modules/ngx_stream_lua_module.so; load_module modules/ngx_http_encrypted_session_module.so; load_module modules/ngx_http_set_misc_module.so; load_module modules/ngx_http_cookie_flag_filter_module.so; load_module modules/ngx_http_headers_more_filter_module.so; 7. \ud14c\uc2a4\ud2b8\ub97c \uc704\ud55c \uc6f9\uc11c\ubc84 \ubc0f Lua \uc11c\ubc84 \ube14\ub85d \uc124\uc815 \u00b6 NPIC \uae30\ubcf8\ub3d9\uc791 \ud14c\uc2a4\ud2b8\uc5d0 \uc0ac\uc6a9\ud560 web server Pod\uc640 Service\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4. kubectl create deployment web --image=gcr.io/google-samples/hello-app:1.0 kubectl expose deployment web --type=NodePort --port=8080 Lua \ud14c\uc2a4\ud2b8\ub97c \uc704\ud55c \uc11c\ubc84 \ube14\ub85d \uc5ed\uc2dc ingress-controller \ud30c\ub4dc \ub0b4\ubd80\uc5d0 \uc791\uc131\ud574 \uc90d\ub2c8\ub2e4. kubectl exec -it dddaong-nginx-ingress-64f6d88767-txgvw -- bash echo 'server { server_name hellworld-lua.test; listen 80; location / { default_type text/html; content_by_lua_block { ngx.say(\"<p>helllo, world</p>\") } } } ' > /etc/nginx/conf.d/lua_test.conf nginx -s reload \ud14c\uc2a4\ud2b8 \ud3b8\uc758\ub97c \uc704\ud574 .spec.externalTrafficPolicy \uc758 \uac12\uc744 Local\uc5d0\uc11c Cluster\ub85c \ubcc0\uacbd\ud574 \uc90d\ub2c8\ub2e4. kubectl edit svc dddaong-nginx-ingress ... [ommitted] spec: clusterIP: 10.101.120.242 clusterIPs: - 10.101.120.242 externalTrafficPolicy: Cluster ports: [ommitted]... curl\ub85c \uac04\ub2e8\ud558\uac8c \uc6f9 \uc11c\ubc84\uc640 Lua \uc11c\ubc84 \ube14\ub85d\uc758 \ud30c\ub4dc \ubc0f \uc11c\ube44\uc2a4\ub97c \ud655\uc778\ud569\ub2c8\ub2e4. $ curl [web Pod Cluster IP]:8080 Hello, world! Version: 1.0.0 Hostname: web-79d88c97d6-gkv29 $ curl [web Svc Cluster IP]:8080 $ curl [nginx ingress Pod Cluster IP]:8888 <p>helllo, world</p> $ curl [nginx ingress Svc Cluster IP]:8888 <p>helllo, world</p> 8. \uac01 \uc11c\ube44\uc2a4\uc5d0 \ub300\ud55c Ingress \uc791\uc131 \ubc0f \ud14c\uc2a4\ud2b8 \u00b6 helloworld.yaml\uc744 \uc544\ub798\uc640 \uac19\uc774 \uc791\uc131 \ud6c4, Kubernetes Cluster\uc5d0 \uc801\uc6a9\ud574 \uc90d\ub2c8\ub2e4. (!\uc8fc\uc758!) Helm \ucc28\ud2b8\ub85c \uc124\uce58\ud55c NPIC\ub294 Default IngressClass\ub85c \uc124\uc815\ub418\uc5b4 \uc788\uc9c0 \uc54a\uae30 \ub54c\ubb38\uc5d0 Ingress \ub9ac\uc18c\uc2a4 \uc0dd\uc131\uc2dc .spec.ingressClassName: nginx\uc744 \ubc18\ub4dc\uc2dc \uc9c0\uc815\ud574\uc8fc\uac70\ub098 nginx IngressClass\ub97c Default\ub85c \uc9c0\uc815\ud574\uc918\uc57c \ud569\ub2c8\ub2e4. apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: helloworld-ingress annotations: nginx.ingress.kubernetes.io/rewrite-target: /$1 spec: ingressClassName: nginx rules: - host: helloworld.test http: paths: - path: / pathType: Prefix backend: service: name: web port: number: 8080 --- apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: helloworld-lua-ingress annotations: nginx.ingress.kubernetes.io/rewrite-target: /$1 spec: ingressClassName: nginx rules: - host: helloworld-lua.test http: paths: - path: / pathType: Prefix backend: service: name: dddaong-nginx-ingress port: number: 8888 kubectl apply -f helloworld.yaml ingress\uac00 Service\uc640 \uc798 \uc5f0\uacb0 \ub418\uc5c8\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4. $ kubectl get ingress NAME CLASS HOSTS ADDRESS PORTS AGE helloworld-ingress nginx helloworld.test 80 112m helloworld-lua-ingress nginx helloworld-lua.test 80 79m $ kubectl describe ingress helloworld-ingress | grep -A4 Rules Rules: Host Path Backends ---- ---- -------- helloworld.test / web:8080 (192.168.225.209:8080) $ kubectl describe ingress helloworld-lua-ingress | grep -A4 Rules Rules: Host Path Backends ---- ---- -------- helloworld-lua.test / dddaong-nginx-ingress:8888 (192.168.225.208:8888) backends \ud56d\ubaa9\uc5d0 Service \ub9ac\uc18c\uc2a4\uc758 Cluster IP\uac00 \ud655\uc778\ub41c\ub2e4\uba74 \uc798 \uc5f0\uacb0\ub41c \uac83\uc785\ub2c8\ub2e4. \ud14c\uc2a4\ud2b8 \uc218\ud589 \ubc0f \uacb0\uacfc \uc544\ub798\uc640 \uac19\uc774 Hostname Base Route\uac00 \uc798 \ub3d9\uc791\ud558\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. $ curl -H Host:helloworld.test <k8s node IP:nodePort> Hello, world! Version: 1.0.0 Hostname: web-79d88c97d6-gkv29 $ curl -H Host:helloworld-lua.test <k8s node IP:nodePort> <p>helllo, world</p>","title":"NGINX+ Ingress Controller - Helm Chart \ubc30\ud3ec"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/Helm-Chart%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4-NPIC-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0/#helm-nginx-plus-ingress-controller","text":"NGINX Plus Ingress Controller (NPIC)\uc758 \uc774\ubbf8\uc9c0 \ube4c\ub4dc\uc5d0\ub294 Docker, git, GNU Make, OpenSSL, \uadf8\ub9ac\uace0 NGINX-Plus \ub77c\uc774\uc120\uc2a4\uac00 \ud544\uc694\ud569\ub2c8\ub2e4.","title":"Helm \ucc28\ud2b8\ub97c \uc0ac\uc6a9\ud574 NGINX Plus Ingress Controller \ubc30\ud3ec"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/Helm-Chart%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4-NPIC-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0/#1-helm-git","text":"Helm\uc740 Kubernetes\uc5d0\uc11c \ub9ac\ub205\uc2a4\uc758 YUM rpm, APT dpkg \uac19\uc774 \ud328\ud0a4\uc9c0\ub97c \uad00\ub9ac\ud574\uc8fc\ub294 \uc5ed\ud560\uc744 \uc218\ud589\ud569\ub2c8\ub2e4. Helm\uc758 \ud328\ud0a4\uc9c0\ub97c Chart\ub77c\uace0 \ud569\ub2c8\ub2e4. Helm 3.5.3\uc744 \ub2e4\uc6b4\ub85c\ub4dc \ud574 \uc555\ucd95\uc744 \ud480\uc5b4\uc8fc\uace0, \uadf8 PATH \uacbd\ub85c(/usr/local/sbin)\uc73c\ub85c \uc774\ub3d9\ud569\ub2c8\ub2e4. curl -L https://get.helm.sh/helm-v3.5.3-linux-amd64.tar.gz | tar zxf - mv linux-amd64/helm /usr/local/sbin git \ub3c4 \uc124\uce58\ud574\uc8fc\uaca0\uc2b5\ub2c8\ub2e4. yum -y install git","title":"1. Helm / git \uc124\uce58"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/Helm-Chart%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4-NPIC-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0/#2-nginx-plus-ingress-controller","text":"\uc774 \ubd80\ubd84\uc740 NPIC + NDK + Lua \ubaa8\ub4c8 \ud14c\uc2a4\ud2b8 \uc758 \uacfc\uc815\uacfc \uc720\uc0ac\ud569\ub2c8\ub2e4. (3\uc6d431\uc77c 1.11.0\ubc84\uc804\uc774 \ub9b4\ub9ac\uc988\ub418\uc5b4 1.11.0 \ubc84\uc804\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4.) mkdir -p /var/tmp/npic && cd /var/tmp/npic git clone https://github.com/nginxinc/kubernetes-ingress/ cd kubernetes-ingress git chechout v1.11.0 \uae30\uc874 Dockerfile \ubc31\uc5c5 v1.11.0\uc5d0\uc11c\ub294 Dockerfile\uc774 \ubcc0\uacbd\ub41c \uac83\uc73c\ub85c \ubcf4\uc785\ub2c8\ub2e4. v1.10.0\uacfc \ub2ec\ub9ac App protect for Plus\uac00 \ubcc4\ub3c4\ub85c \uc81c\uacf5\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. cp /var/tmp/npic/kubernetes-ingress/build/Dockerfile \\ /var/tmp/npic/kubernetes-ingress/build/Dockerfile.bak \uae30\uc874 Dockerfile \uc218\uc815 vi /var/tmp/npic/kubernetes-ingress/build/Dockerfile yum -y install nginx-plus \ucee4\ub9e8\ub4dc\uc5d0 \uc544\ub798 \ud328\ud0a4\uc9c0\ub97c \ucd94\uac00\ud574\uc90d\ub2c8\ub2e4. nginx-plus-module-ndk nginx-plus-module-lua nginx-plus-module-cookie-flag nginx-plus-module-encrypted-session nginx-plus-module-headers-more nginx-plus-module-set-misc \ucd94\uac00\ud55c Dockerfile\uc740 \uc544\ub798 \ud615\ud0dc\uac00 \ub429\ub2c8\ub2e4. (v1.11.0\uc758 Dockerfile \ud30c\uc77c\uc758 52\ubc88 \ub77c\uc778\uc744 \uc218\uc815\ud588\uc2b5\ub2c8\ub2e4.) ...[omitted] apt-transport-https libcap2-bin nginx-plus=${NGINX_PLUS_VERSION} nginx-plus-module-njs= ${NGINX_NJS_VERSION} nginx-plus-module-ndk nginx-plus-module-lua nginx-plus-module-cookie-flag nginx-plus-module-encrypted-session nginx-plus-module-headers-more nginx-plus-module-set-misc \\ ...[omitted]","title":"2. NGINX Plus Ingress Controller \uc774\ubbf8\uc9c0 \uc0dd\uc131"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/Helm-Chart%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4-NPIC-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0/#3-nginx-kubernetes-ingress","text":"NGINX+ \ud14c\uc2a4\ud2b8 \ub77c\uc774\uc120\uc2a4\ub97c \uc0ac\uc6a9\ud588\uc2b5\ub2c8\ub2e4. cp /var/tmp/nginx-repo* /var/tmp/npic/kubernetes-ingress/ \uc774\ubbf8\uc9c0 \ube4c\ub4dc\ub97c \uc2dc\uc791\ud569\ub2c8\ub2e4. (Dockerfile \ubcc0\uacbd\uc5d0 \ub530\ub77c make \uba85\ub839\uc5b4\ub3c4 v1.10.0\uc5d0 \ube44\ud574 \ub2ec\ub77c\uc84c\uc2b5\ub2c8\ub2e4.) make debian-image-plus PREFIX=dddaong/nginx-plus-ingress TARGET=container ~~\ube4c\ub4dc\uac00 \uc644\ub8cc\ub418\uba74 Repository\uc5d0 \uc5c5\ub85c\ub4dc\ub97c \uc2dc\ub3c4\ud558\uae30 \ub54c\ubb38\uc5d0 \uc544\ub798 \uc624\ub958 \uba54\uc2dc\uc9c0\ub294 \ubb34\uc2dc\ud558\uc154\ub3c4 \uc88b\uc2b5\ub2c8\ub2e4.~~ v1.11.0\ubd80\ud130\ub294 \ube4c\ub4dc\uac00 \uc644\ub8cc\ub418\uc5b4\ub3c4 Registry\uc5d0 \uc5c5\ub85c\ub4dc\ub97c \uc2dc\ub3c4\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ube4c\ub4dc\uacfc\uc815\uc774 \uc644\ub8cc\ub418\uba74 docker\uc5d0\uc11c \uc774\ubbf8\uc9c0\ub97c \ud655\uc778\ud569\ub2c8\ub2e4. Tag\uac00 edge\ub85c \uc9c0\uc815\ub418\uc5b4 \uc788\ub294 \uac83\uc774 \ubcf4\uc785\ub2c8\ub2e4. $ docker image ls REPOSITORY TAG IMAGE ID CREATED SIZE dddaong/nginx-plus-ingress edge ab47ffdd0e3a About a minute ago 136MB","title":"3. NGINX+ \ub77c\uc774\uc120\uc2a4\ub97c Kubernetes-ingress \ub514\ub809\ud1a0\ub9ac\uc5d0 \ubcf5\uc0ac\ud558\uace0, \uc774\ubbf8\uc9c0 \ube4c\ub4dc\ub97c \uc2dc\uc791\ud569\ub2c8\ub2e4"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/Helm-Chart%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4-NPIC-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0/#4-image-repository","text":"save docker image docker save dddaong/nginx-plus-ingress:edge -o /var/tmp/npic/dddaong-npic-edge.tgz scp /var/tmp/npic/dddaong-npic-edge.tgz root@<workernode1>:/var/tmp scp /var/tmp/npic/dddaong-npic-edge.tgz root@<workernode2>:/var/tmp load docker image @each node docker load -i /var/tmp/dddaong-npic-edge.tgz","title":"4. \ud14c\uc2a4\ud2b8 \ud658\uacbd\uc5d0 Image repository\uac00 \uc5c6\uc73c\ubbc0\ub85c \uc218\ub3d9\uc73c\ub85c \ub178\ub4dc\uc5d0 \uc774\ubbf8\uc9c0\ub97c \ub85c\ub4dc\ud574\uc90d\ub2c8\ub2e4"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/Helm-Chart%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4-NPIC-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0/#5-1-npic","text":"Helm \ucc28\ud2b8\ub97c \uc0ac\uc6a9\ud55c NPIC \uad6c\ucd95\uc740 5-2\uc5d0\uc11c \uc218\ud589\ud569\ub2c8\ub2e4. \uae30\uc874\uc5d0 NPIC\ub97c \uc0ad\uc81c\ud558\uae30 \uc804\uc5d0, \uc0c8\ub85c \ube4c\ub4dc\ud55c \uc774\ubbf8\uc9c0\ub97c \uc801\uc6a9\ud558\ub294 \ud14c\uc2a4\ud2b8\ub97c \uc218\ud589 \ud588\uc2b5\ub2c8\ub2e4. \uc774\ubc88 \ud14c\uc2a4\ud2b8\uc5d0\uc11c\ub294 kubectl \ucee4\ub9e8\ub4dc\ub85c \ub864\uc544\uc6c3 \uc5c5\ub370\uc774\ud2b8\ub97c \ud574\ubcf4\uaca0\uc2b5\ub2c8\ub2e4. $ kubectl -n nginx-ingress get deployments.apps NAME READY UP-TO-DATE AVAILABLE AGE nginx-ingress 1/1 1 1 13d Deployment \ub9ac\uc18c\uc2a4\uc758 Containers\uc5d0\uc11c \ud56d\ubaa9\uba85\uc744 \ud655\uc778\ud569\ub2c8\ub2e4. \uc774 \ud14c\uc2a4\ud2b8\uc5d0\uc11c \uc774\ubbf8\uc9c0\ub97c \ubcc0\uacbd\ud560 Container \uc774\ub984\uc740 nginx-plus-ingress\ub85c \ud655\uc778\ub429\ub2c8\ub2e4. $ kubectl -n nginx-ingress describe deployments.apps nginx-ingress | grep -A 4 'Container' Containers: nginx-plus-ingress: Image: samsung/nginxplus-ingress:1.10.1 Ports: 80/TCP, 443/TCP, 8081/TCP Host Ports: 0/TCP, 0/TCP, 0/TCP \ud655\uc778\ud55c \ud56d\ubaa9\uc758 \uc774\ubbf8\uc9c0\ub97c kubectl \uba85\ub839\uc5b4\ub85c \ubcc0\uacbd\ud574\uc90d\ub2c8\ub2e4. \ucee4\ub9e8\ub4dc \uc218\ud589\uc2dc \uc989\uc2dc Rollout\uc774 \uc9c4\ud589\ub429\ub2c8\ub2e4!! $ kubectl -n nginx-ingress set image deployments/nginx-ingress nginx-plus-ingress=dddaong/nginx-plus-ingress:edge deployment.apps/nginx-ingress image updated Rollout \uacb0\uacfc\ub97c \ud655\uc778\ud569\ub2c8\ub2e4. $ kubectl -n nginx-ingress rollout status deployment nginx-ingress deployment \"nginx-ingress\" successfully rolled out \ud30c\ub4dc\uc640 Deployment \uc0c1\ud0dc\ub97c \ud655\uc778\ud569\ub2c8\ub2e4. $ kubectl -n nginx-ingress get pod NAME READY STATUS RESTARTS AGE nginx-ingress-6ff488c8c8-xtsn8 1/1 Running 0 34s $ kubectl -n nginx-ingress describe deployments.apps nginx-ingress | grep -A 4 'Container' Containers: nginx-plus-ingress: Image: dddaong/nginx-plus-ingress:edge Ports: 80/TCP, 443/TCP, 8081/TCP Host Ports: 0/TCP, 0/TCP, 0/TCP","title":"5-1. \uae30\uc874 NPIC \uc5d0 \uc0c8\ub85c \ube4c\ub4dc\ud55c \uc774\ubbf8\uc9c0 \uc801\uc6a9"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/Helm-Chart%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4-NPIC-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0/#5-2-helm-kubernetes-npic","text":"\uba3c\uc800 \uae30\uc874 NPIC\ub97c \uc81c\uac70\ud569\ub2c8\ub2e4 kubectl delete namespaces nginx-ingress kubectl delete ingressclasses nginx helm \ucc28\ud2b8 \ub9ac\uc18c\uc2a4\uac00 \uc788\ub294 \ub514\ub809\ud1a0\ub9ac\ub85c \ub4e4\uc5b4\uac11\ub2c8\ub2e4. cd /var/tmp/npic/kubernetes-ingress/deployments/helm-chart git checkout v1.11.0 values-plus.yaml \ud30c\uc77c\uc744 \ubc31\uc5c5\ud55c \ud6c4, \ud30c\uc77c \ub0b4 \uc774\ubbf8\uc9c0 \uacbd\ub85c\ub97c \uc218\uc815\ud569\ub2c8\ub2e4. cp values-plus.yaml values-plus.yaml.bak vi values-plus.yaml controller: nginxplus: true image: repository: <NPIC Repository/image name> tag: \"edge\" \uc774 \ud14c\uc2a4\ud2b8\uc758 \uacbd\uc6b0, dddaong/nginx-plus-ingress\ub85c \uc791\uc131\ud588\uc2b5\ub2c8\ub2e4. helm\uc744 \uc0ac\uc6a9\ud574 \uc778\uc2a4\ud1a8\uc744 \uc218\ud589\ud569\ub2c8\ub2e4. helm install dddaong -f values-plus.yaml . \"dddaong\"\uc740 \uc784\uc758\uc758 \ub9b4\ub9ac\uc988 \uba85\uc73c\ub85c\uc11c, \uc6d0\ud558\ub294 \uc774\ub984\uc744 \uc0ac\uc6a9\ud558\uba74 \ub429\ub2c8\ub2e4. W0401 13:28:12.293718 23860 warnings.go:70] networking.k8s.io/v1beta1 IngressClass is deprecated in v1.19+, unavailable in v1.22+; use networking.k8s.io/v1 IngressClassList W0401 13:28:12.490643 23860 warnings.go:70] networking.k8s.io/v1beta1 IngressClass is deprecated in v1.19+, unavailable in v1.22+; use networking.k8s.io/v1 IngressClassList NAME: dddaong LAST DEPLOYED: Thu Apr 1 13:28:11 2021 NAMESPACE: default STATUS: deployed REVISION: 1 TEST SUITE: None NOTES: The NGINX Ingress Controller has been installed. Custom Resource Definition\ub4e4\uc744 \uc124\uce58\ud569\ub2c8\ub2e4. $ kubectl apply -f crds/ customresourcedefinition.apiextensions.k8s.io/aplogconfs.appprotect.f5.com configured customresourcedefinition.apiextensions.k8s.io/appolicies.appprotect.f5.com configured customresourcedefinition.apiextensions.k8s.io/apusersigs.appprotect.f5.com configured customresourcedefinition.apiextensions.k8s.io/globalconfigurations.k8s.nginx.org configured customresourcedefinition.apiextensions.k8s.io/policies.k8s.nginx.org configured customresourcedefinition.apiextensions.k8s.io/transportservers.k8s.nginx.org configured customresourcedefinition.apiextensions.k8s.io/virtualserverroutes.k8s.nginx.org configured customresourcedefinition.apiextensions.k8s.io/virtualservers.k8s.nginx.org configured \uc124\uce58 \uacb0\uacfc\ub97c \ud655\uc778\ud569\ub2c8\ub2e4. helm\uc73c\ub85c \uc81c\uacf5\ub418\ub294 \uc124\uce58 \ubc29\ubc95\uc740 \ubcc4\ub3c4\uc758 nginx-ingress namespace\ub97c \uc0dd\uc131\ud558\uc9c0 \uc54a\uace0, default namespace\uc5d0 \uc124\uce58\ub429\ub2c8\ub2e4. $ kubectl get namespaces NAME STATUS AGE default Active 13d kube-node-lease Active 13d kube-public Active 13d kube-system Active 13d $ kubectl get pod NAME READY STATUS RESTARTS AGE dddaong-nginx-ingress-64f6d88767-txgvw 1/1 Running 0 3m46s fakeapi-6f89b55d54-4j8vp 1/1 Running 0 2d16h","title":"5-2.  Helm\uc744 \uc0ac\uc6a9\ud574 Kubernetes\uc5d0 NPIC \uc124\uce58"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/Helm-Chart%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4-NPIC-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0/#6-lua-configmap","text":"nginx-ingress\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub294 configmap\uc744 \ud655\uc778\ud569\ub2c8\ub2e4. $ kubectl describe pod dddaong-nginx-ingress-64f6d88767-txgvw | grep configmap -nginx-configmaps=$(POD_NAMESPACE)/dddaong-nginx-ingress $ kubectl get cm NAME DATA AGE dddaong-nginx-ingress 0 8m56s configmap \uc218\uc815\ud569\ub2c8\ub2e4. kubectl edit cm dddaong-nginx-ingress \uae30\uc874 \ud30c\uc77c \ucd5c\ud558\ub2e8\uc5d0 \uc544\ub798 \ub0b4\uc6a9\uc744 \uc791\uc131\ud574\uc8fc\uace0 \uc800\uc7a5\ud569\ub2c8\ub2e4. data: main-snippets: | load_module modules/ndk_http_module.so; load_module modules/ngx_http_lua_module.so; load_module modules/ngx_stream_lua_module.so; load_module modules/ngx_http_encrypted_session_module.so; load_module modules/ngx_http_set_misc_module.so; load_module modules/ngx_http_cookie_flag_filter_module.so; load_module modules/ngx_http_headers_more_filter_module.so; \ubcc0\uacbd\ub41c configmap\uc774 \uc798 \ubc18\uc601\ub418\uc5c8\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4. kubectl exec -it dddaong-nginx-ingress-64f6d88767-txgvw -- cat /etc/nginx/nginx.conf | grep load_module load_module modules/ndk_http_module.so; load_module modules/ngx_http_lua_module.so; load_module modules/ngx_stream_lua_module.so; load_module modules/ngx_http_encrypted_session_module.so; load_module modules/ngx_http_set_misc_module.so; load_module modules/ngx_http_cookie_flag_filter_module.so; load_module modules/ngx_http_headers_more_filter_module.so;","title":"6. Lua \uc0ac\uc6a9\uc744 \uc704\ud55c configmap\uc744 \uc218\uc815"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/Helm-Chart%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4-NPIC-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0/#7-lua","text":"NPIC \uae30\ubcf8\ub3d9\uc791 \ud14c\uc2a4\ud2b8\uc5d0 \uc0ac\uc6a9\ud560 web server Pod\uc640 Service\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4. kubectl create deployment web --image=gcr.io/google-samples/hello-app:1.0 kubectl expose deployment web --type=NodePort --port=8080 Lua \ud14c\uc2a4\ud2b8\ub97c \uc704\ud55c \uc11c\ubc84 \ube14\ub85d \uc5ed\uc2dc ingress-controller \ud30c\ub4dc \ub0b4\ubd80\uc5d0 \uc791\uc131\ud574 \uc90d\ub2c8\ub2e4. kubectl exec -it dddaong-nginx-ingress-64f6d88767-txgvw -- bash echo 'server { server_name hellworld-lua.test; listen 80; location / { default_type text/html; content_by_lua_block { ngx.say(\"<p>helllo, world</p>\") } } } ' > /etc/nginx/conf.d/lua_test.conf nginx -s reload \ud14c\uc2a4\ud2b8 \ud3b8\uc758\ub97c \uc704\ud574 .spec.externalTrafficPolicy \uc758 \uac12\uc744 Local\uc5d0\uc11c Cluster\ub85c \ubcc0\uacbd\ud574 \uc90d\ub2c8\ub2e4. kubectl edit svc dddaong-nginx-ingress ... [ommitted] spec: clusterIP: 10.101.120.242 clusterIPs: - 10.101.120.242 externalTrafficPolicy: Cluster ports: [ommitted]... curl\ub85c \uac04\ub2e8\ud558\uac8c \uc6f9 \uc11c\ubc84\uc640 Lua \uc11c\ubc84 \ube14\ub85d\uc758 \ud30c\ub4dc \ubc0f \uc11c\ube44\uc2a4\ub97c \ud655\uc778\ud569\ub2c8\ub2e4. $ curl [web Pod Cluster IP]:8080 Hello, world! Version: 1.0.0 Hostname: web-79d88c97d6-gkv29 $ curl [web Svc Cluster IP]:8080 $ curl [nginx ingress Pod Cluster IP]:8888 <p>helllo, world</p> $ curl [nginx ingress Svc Cluster IP]:8888 <p>helllo, world</p>","title":"7. \ud14c\uc2a4\ud2b8\ub97c \uc704\ud55c \uc6f9\uc11c\ubc84 \ubc0f Lua \uc11c\ubc84 \ube14\ub85d \uc124\uc815"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/Helm-Chart%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4-NPIC-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0/#8-ingress","text":"helloworld.yaml\uc744 \uc544\ub798\uc640 \uac19\uc774 \uc791\uc131 \ud6c4, Kubernetes Cluster\uc5d0 \uc801\uc6a9\ud574 \uc90d\ub2c8\ub2e4. (!\uc8fc\uc758!) Helm \ucc28\ud2b8\ub85c \uc124\uce58\ud55c NPIC\ub294 Default IngressClass\ub85c \uc124\uc815\ub418\uc5b4 \uc788\uc9c0 \uc54a\uae30 \ub54c\ubb38\uc5d0 Ingress \ub9ac\uc18c\uc2a4 \uc0dd\uc131\uc2dc .spec.ingressClassName: nginx\uc744 \ubc18\ub4dc\uc2dc \uc9c0\uc815\ud574\uc8fc\uac70\ub098 nginx IngressClass\ub97c Default\ub85c \uc9c0\uc815\ud574\uc918\uc57c \ud569\ub2c8\ub2e4. apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: helloworld-ingress annotations: nginx.ingress.kubernetes.io/rewrite-target: /$1 spec: ingressClassName: nginx rules: - host: helloworld.test http: paths: - path: / pathType: Prefix backend: service: name: web port: number: 8080 --- apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: helloworld-lua-ingress annotations: nginx.ingress.kubernetes.io/rewrite-target: /$1 spec: ingressClassName: nginx rules: - host: helloworld-lua.test http: paths: - path: / pathType: Prefix backend: service: name: dddaong-nginx-ingress port: number: 8888 kubectl apply -f helloworld.yaml ingress\uac00 Service\uc640 \uc798 \uc5f0\uacb0 \ub418\uc5c8\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4. $ kubectl get ingress NAME CLASS HOSTS ADDRESS PORTS AGE helloworld-ingress nginx helloworld.test 80 112m helloworld-lua-ingress nginx helloworld-lua.test 80 79m $ kubectl describe ingress helloworld-ingress | grep -A4 Rules Rules: Host Path Backends ---- ---- -------- helloworld.test / web:8080 (192.168.225.209:8080) $ kubectl describe ingress helloworld-lua-ingress | grep -A4 Rules Rules: Host Path Backends ---- ---- -------- helloworld-lua.test / dddaong-nginx-ingress:8888 (192.168.225.208:8888) backends \ud56d\ubaa9\uc5d0 Service \ub9ac\uc18c\uc2a4\uc758 Cluster IP\uac00 \ud655\uc778\ub41c\ub2e4\uba74 \uc798 \uc5f0\uacb0\ub41c \uac83\uc785\ub2c8\ub2e4. \ud14c\uc2a4\ud2b8 \uc218\ud589 \ubc0f \uacb0\uacfc \uc544\ub798\uc640 \uac19\uc774 Hostname Base Route\uac00 \uc798 \ub3d9\uc791\ud558\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. $ curl -H Host:helloworld.test <k8s node IP:nodePort> Hello, world! Version: 1.0.0 Hostname: web-79d88c97d6-gkv29 $ curl -H Host:helloworld-lua.test <k8s node IP:nodePort> <p>helllo, world</p>","title":"8. \uac01 \uc11c\ube44\uc2a4\uc5d0 \ub300\ud55c Ingress \uc791\uc131 \ubc0f \ud14c\uc2a4\ud2b8"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Ingress-Controller-Lua-package-path-%ED%85%8C%EC%8A%A4%ED%8A%B8/","text":"NGINX Ingress Controller - lua_package_path \ud14c\uc2a4\ud2b8 \u00b6 nginx-config ConfigMap \ub9ac\uc18c\uc2a4\uc758 main snippet\uc73c\ub85c \ubaa8\ub4c8\ub85c\ub529, nginx-config ConfigMap \ub9ac\uc18c\uc2a4\uc758 http snippet\uc73c\ub85c lua_package_path \uc124\uc815, \ub9c8\uc9c0\ub9c9\uc73c\ub85c Ingress \ub9ac\uc18c\uc2a4\ub97c \ud1b5\ud574 listen port, location\uc744 \uc791\uc131\ud574 File \ud615\uc2dd\uc758 Lua\ub97c \uc0ac\uc6a9\ud558\ub294 \ud14c\uc2a4\ud2b8\uc785\ub2c8\ub2e4. 1. NPIC Pod\uc5d0 Volume \uc124\uc815 \u00b6 Lua File path \uc0ac\uc6a9\uc744 \uc704\ud574 Volume \uc124\uc815 (Deployment \ub9ac\uc18c\uc2a4) # kubectl edit deployments.apps dddaong-nginx-ingress [Ommitted] terminationMessagePolicy: File ## lines added from Here - volumeMounts: - mountPath: /var/tmp name: luapkg-path ## - to Here dnsPolicy: ClusterFirst [Ommitted] terminationGracePeriodSeconds: 30 ## lines added from Here - volumes: - hostPath: path: /var/tmp/lua type: DirectoryOrCreate name: luapkg-path ## - to Here [Ommitted] 2. Pod\uac00 \uc0dd\uc131\ub41c node\uc5d0 hello.lua \uc791\uc131 \u00b6 mkdir -p /var/tmp/lua/ tee -a /var/tmp/lua/hello.lua <<EOF 1>/dev/null local _M = {} function _M.greet(name) ngx.say(\"Greetings from \", name) end return _M EOF 3. snippet \uc791\uc131\ud574 Conf \ubc18\uc601 \u00b6 kubectl edit cm nginx-config data: http-snippets: | lua_package_path \"/etc/nginx/conf.d/?.lua;;\"; main-snippets: | load_module /etc/nginx/modules/ndk_http_module.so; load_module /etc/nginx/modules/ngx_http_lua_module.so; load_module /etc/nginx/modules/ngx_stream_lua_module.so; load_module /etc/nginx/modules/ngx_http_encrypted_session_module.so; load_module /etc/nginx/modules/ngx_http_set_misc_module.so; load_module /etc/nginx/modules/ngx_http_cookie_flag_filter_module.so; load_module /etc/nginx/modules/ngx_http_headers_more_filter_module.so; 4. Service \ub9ac\uc18c\uc2a4 \uc218\uc815 \ubc0f ingress \uc0dd\uc131 \u00b6 NPIC svc\uc5d0 Port \ucd94\uac00 kubectl edit svc dddaong-nginx-ingress - name: lua nodePort: 30180 port: 8888 protocol: TCP targetPort: 8888 - name: https nodePort: 30443 Ingress \uc0dd\uc131 Ingress\uac00 \uc0dd\uc131\ub418\uba74, Pod \ub0b4 /etc/nginx/conf.d \ub514\ub809\ud1a0\ub9ac\uc5d0 conf \ud30c\uc77c\uc774 \uc0dd\uc131\ub429\ub2c8\ub2e4. \uc0dd\uc131\ub418\ub294 conf \ud30c\uc77c\uc758 Config \uc720\ud6a8\uc131\uc744 \uccb4\ud06c\ud574\uac00\uba70 \uc218\uc815\ud558\uba74 \ub418\uaca0\uc2b5\ub2c8\ub2e4. apiVersion: networking.k8s.io/v1beta1 kind: Ingress metadata: name: lua-server annotations: nginx.org/listen-ports: \"8888\" nginx.org/server-snippets: | location / { default_type text/plain; content_by_lua_block { local hello = require \"hello\" hello.greet(\"a lua module\") } } spec: rules: - host: hello-lua.test http: ### Dummy conf below paths: - path: /lua backend: serviceName: dddaong-nginx-ingress servicePort: 8888 5. \ud14c\uc2a4\ud2b8 \uc218\ud589 \u00b6 curl -H host:hello-lua.test http://<Pod IP>:8888 curl -H host:hello-lua.test http://<Svc ClusterIP>:8888 curl -H host:hello-lua.test http://<Node IP>:30180 \uacb0\uacfc\uac00 \ubaa8\ub450 Greetings from a lua module \ub85c \ub098\uc624\uba74 \uc124\uc815\uc774 \uc798\ub41c \uac83\uc785\ub2c8\ub2e4. \ucc38\uace0\ub85c Ingress\uc758 Dummy conf URI\ub85c Curl\uc744 \ud558\uba74 400 Request Header Or Cookie Too Large \uc624\ub958\uac00 \ubc1c\uc0dd\ud569\ub2c8\ub2e4.","title":"NGINX+ Ingress Controller - lua_package_path \ud14c\uc2a4\ud2b8"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Ingress-Controller-Lua-package-path-%ED%85%8C%EC%8A%A4%ED%8A%B8/#nginx-ingress-controller-lua_package_path","text":"nginx-config ConfigMap \ub9ac\uc18c\uc2a4\uc758 main snippet\uc73c\ub85c \ubaa8\ub4c8\ub85c\ub529, nginx-config ConfigMap \ub9ac\uc18c\uc2a4\uc758 http snippet\uc73c\ub85c lua_package_path \uc124\uc815, \ub9c8\uc9c0\ub9c9\uc73c\ub85c Ingress \ub9ac\uc18c\uc2a4\ub97c \ud1b5\ud574 listen port, location\uc744 \uc791\uc131\ud574 File \ud615\uc2dd\uc758 Lua\ub97c \uc0ac\uc6a9\ud558\ub294 \ud14c\uc2a4\ud2b8\uc785\ub2c8\ub2e4.","title":"NGINX Ingress Controller - lua_package_path \ud14c\uc2a4\ud2b8"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Ingress-Controller-Lua-package-path-%ED%85%8C%EC%8A%A4%ED%8A%B8/#1-npic-pod-volume","text":"Lua File path \uc0ac\uc6a9\uc744 \uc704\ud574 Volume \uc124\uc815 (Deployment \ub9ac\uc18c\uc2a4) # kubectl edit deployments.apps dddaong-nginx-ingress [Ommitted] terminationMessagePolicy: File ## lines added from Here - volumeMounts: - mountPath: /var/tmp name: luapkg-path ## - to Here dnsPolicy: ClusterFirst [Ommitted] terminationGracePeriodSeconds: 30 ## lines added from Here - volumes: - hostPath: path: /var/tmp/lua type: DirectoryOrCreate name: luapkg-path ## - to Here [Ommitted]","title":"1. NPIC Pod\uc5d0 Volume \uc124\uc815"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Ingress-Controller-Lua-package-path-%ED%85%8C%EC%8A%A4%ED%8A%B8/#2-pod-node-hellolua","text":"mkdir -p /var/tmp/lua/ tee -a /var/tmp/lua/hello.lua <<EOF 1>/dev/null local _M = {} function _M.greet(name) ngx.say(\"Greetings from \", name) end return _M EOF","title":"2. Pod\uac00 \uc0dd\uc131\ub41c node\uc5d0 hello.lua \uc791\uc131"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Ingress-Controller-Lua-package-path-%ED%85%8C%EC%8A%A4%ED%8A%B8/#3-snippet-conf","text":"kubectl edit cm nginx-config data: http-snippets: | lua_package_path \"/etc/nginx/conf.d/?.lua;;\"; main-snippets: | load_module /etc/nginx/modules/ndk_http_module.so; load_module /etc/nginx/modules/ngx_http_lua_module.so; load_module /etc/nginx/modules/ngx_stream_lua_module.so; load_module /etc/nginx/modules/ngx_http_encrypted_session_module.so; load_module /etc/nginx/modules/ngx_http_set_misc_module.so; load_module /etc/nginx/modules/ngx_http_cookie_flag_filter_module.so; load_module /etc/nginx/modules/ngx_http_headers_more_filter_module.so;","title":"3. snippet \uc791\uc131\ud574 Conf \ubc18\uc601"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Ingress-Controller-Lua-package-path-%ED%85%8C%EC%8A%A4%ED%8A%B8/#4-service-ingress","text":"NPIC svc\uc5d0 Port \ucd94\uac00 kubectl edit svc dddaong-nginx-ingress - name: lua nodePort: 30180 port: 8888 protocol: TCP targetPort: 8888 - name: https nodePort: 30443 Ingress \uc0dd\uc131 Ingress\uac00 \uc0dd\uc131\ub418\uba74, Pod \ub0b4 /etc/nginx/conf.d \ub514\ub809\ud1a0\ub9ac\uc5d0 conf \ud30c\uc77c\uc774 \uc0dd\uc131\ub429\ub2c8\ub2e4. \uc0dd\uc131\ub418\ub294 conf \ud30c\uc77c\uc758 Config \uc720\ud6a8\uc131\uc744 \uccb4\ud06c\ud574\uac00\uba70 \uc218\uc815\ud558\uba74 \ub418\uaca0\uc2b5\ub2c8\ub2e4. apiVersion: networking.k8s.io/v1beta1 kind: Ingress metadata: name: lua-server annotations: nginx.org/listen-ports: \"8888\" nginx.org/server-snippets: | location / { default_type text/plain; content_by_lua_block { local hello = require \"hello\" hello.greet(\"a lua module\") } } spec: rules: - host: hello-lua.test http: ### Dummy conf below paths: - path: /lua backend: serviceName: dddaong-nginx-ingress servicePort: 8888","title":"4. Service \ub9ac\uc18c\uc2a4 \uc218\uc815 \ubc0f ingress \uc0dd\uc131"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Ingress-Controller-Lua-package-path-%ED%85%8C%EC%8A%A4%ED%8A%B8/#5","text":"curl -H host:hello-lua.test http://<Pod IP>:8888 curl -H host:hello-lua.test http://<Svc ClusterIP>:8888 curl -H host:hello-lua.test http://<Node IP>:30180 \uacb0\uacfc\uac00 \ubaa8\ub450 Greetings from a lua module \ub85c \ub098\uc624\uba74 \uc124\uc815\uc774 \uc798\ub41c \uac83\uc785\ub2c8\ub2e4. \ucc38\uace0\ub85c Ingress\uc758 Dummy conf URI\ub85c Curl\uc744 \ud558\uba74 400 Request Header Or Cookie Too Large \uc624\ub958\uac00 \ubc1c\uc0dd\ud569\ub2c8\ub2e4.","title":"5. \ud14c\uc2a4\ud2b8 \uc218\ud589"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Plus-Ingress-Controller%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/","text":"NGINX Plus Ingress Controller\uc758 JWT \uc778\uc99d \u00b6 NGINX Plus Ingress Controller\uc5d0\uc11c JWT \uc778\uc99d \uad00\ub828 \uae30\ub2a5\uc744 \ud14c\uc2a4\ud2b8\ud55c \ub0b4\uc6a9\uc785\ub2c8\ub2e4. NPIC\uc758 JWT \uc778\uc99d\uc740 \uc544\uc9c1 Preview Policies \uc0c1\ud0dc\uc785\ub2c8\ub2e4. Production \ud658\uacbd\uc5d0\uc11c\uc758 \uc0ac\uc6a9\uc5d0 \uc8fc\uc758\ub97c \uc694\ud569\ub2c8\ub2e4. \ud14c\uc2a4\ud2b8 \ud658\uacbd \u00b6 Helm\uc744 \uc0ac\uc6a9\ud574 NGINX Plus Ingress Controller\uac00 \uc124\uce58\ub41c \uc0c1\ud0dc\uc5d0\uc11c \uc218\ud589\ud588\uc2b5\ub2c8\ub2e4. \ud14c\uc2a4\ud2b8\uc6a9 \ubc31\uc5d4\ub4dc\ub294 NGINX Plus\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 Cafe \uc11c\ube44\uc2a4\ub97c \uc0ac\uc6a9\ud588\uc2b5\ub2c8\ub2e4. \ub3d9\uc77c\ud55c \ubc31\uc5d4\ub4dc\ub97c \uc0ac\uc6a9\ud558\ub824\uba74 \uc544\ub798 YAML\uc744 \ud1b5\ud574 \uc11c\ube44\uc2a4\ub97c \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. apiVersion: apps/v1 kind: Deployment metadata: name: coffee spec: replicas: 1 selector: matchLabels: app: coffee template: metadata: labels: app: coffee spec: containers: - name: coffee image: nginxdemos/hello:plain-text ports: - containerPort: 80 --- apiVersion: v1 kind: Service metadata: name: coffee-svc spec: ports: - port: 80 targetPort: 80 protocol: TCP name: http selector: app: coffee --- apiVersion: apps/v1 kind: Deployment metadata: name: tea spec: replicas: 1 selector: matchLabels: app: tea template: metadata: labels: app: tea spec: containers: - name: tea image: nginxdemos/hello:plain-text ports: - containerPort: 80 --- apiVersion: v1 kind: Service metadata: name: tea-svc labels: spec: ports: - port: 80 targetPort: 80 protocol: TCP name: http selector: app: tea Preview-policies Enable \u00b6 VirtualServer\uc5d0\uc11c \uc0ac\uc6a9\ud558\uae30 \uc704\ud55c JWT \uc778\uc99d\uc744 \uc0ac\uc6a9\ud558\ub824\uba74 Policy\ub97c \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4. \ub2e8, Policy\ub294 \ud604\uc7ac Preview \uae30\ub2a5\uc73c\ub85c\uc11c \uae30\ubcf8\uac12\uc73c\ub85c Disabled \ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uc544\ub798 \ubc29\ubc95\uc73c\ub85c enable-preview-policies Argument\ub97c Enable\ub85c \uc218\uc815\ud574\uc90d\ub2c8\ub2e4. #kubectl edit deployments.apps dddaong-nginx-ingress ...[ommitted] spec: template: spec: containers: - args: - -enable-preview-policies=true [ommitted] ... \uc8fc\uc758 : JWK \uc0ac\uc6a9 \ud544\uc218 \uc694\uac74 \u00b6 Secret Resource\ub294 \ubc18\ub4dc\uc2dc Policy\uc640 \uac19\uc740 namespace\uc5d0 \uc704\uce58\ud574\uc57c \ud569\ub2c8\ub2e4. Secret Resource\ub294 \ubc18\ub4dc\uc2dc nginx.org/jwk type\uc73c\ub85c \uc9c0\uc815\ub418\uc5b4\uc57c \ud558\uba70, JWK \ub0b4\uc6a9\uc740 \ubc18\ub4dc\uc2dc jwk key \uc544\ub798 \uc800\uc7a5\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4. \uadf8\ub807\uc9c0 \uc54a\uc73c\uba74 JWT Validation\uc5d0 \uc2e4\ud328\ud569\ub2c8\ub2e4. NPIC + JWT + RS256 \ud14c\uc2a4\ud2b8 \u00b6 Kubernetes \uae30\ubcf8 \ub9ac\uc18c\uc2a4\uc778 Secret \ub9ac\uc18c\uc2a4\ub97c JWK\ub85c \uc0ac\uc6a9\ud55c JWT \uc778\uc99d\uc744 \ud14c\uc2a4\ud2b8\ud569\ub2c8\ub2e4. \ud14c\uc2a4\ud2b8\uc758 JWT \uc54c\uace0\ub9ac\uc998\uc740 RS256\uc744 \uc0ac\uc6a9\ud588\uc2b5\ub2c8\ub2e4. 1. RSA Private Key / Public Key \uc0dd\uc131 \u00b6 jwk \uc0dd\uc131\uc744 \uc704\ud574 mkjwk: simple JSON Web Key generator \ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uc544\ub798\ub294 \uc0dd\uc131\uc2dc \uc120\ud0dd\ud55c \uc635\uc158\uc785\ub2c8\ub2e4. Tab Key Size Key Use Algorithm Key ID Show X.509 RSA 2048 Signature RS256 Specify [0001] Yes \uc774 \uc0ac\uc774\ud2b8\uc5d0\uc11c \uc0dd\uc131\ub41c \ub0b4\uc6a9\uc744 \ubc14\ud0d5\uc73c\ub85c JWKS Secret \ub9ac\uc18c\uc2a4 \ubc0f \ud14c\uc2a4\ud2b8\ub97c \uc704\ud55c JWT\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4. 2. JWK Secret \uc0dd\uc131 \u00b6 \uc9c1\uc804 \uacfc\uc815\uc5d0\uc11c \uc0dd\uc131\ud55c Public Key\ub85c NGINX Ingress Controller\uac00 \uc694\uad6c\ud558\ub294 \ud615\ud0dc\uc758 Secret \ub9ac\uc18c\uc2a4\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4. \uc8fc\uc758\uc0ac\ud56d(\ud544\uc218\uc694\uac74)\uc744 \ud55c \ubc88 \ub354 \uc9da\uc5b4\ubcf4\uba74... \ubc18\ub4dc\uc2dc Policy\uc640 \uac19\uc740 namespace\uc5d0 \uc704\uce58\ud574\uc57c \ud569\ub2c8\ub2e4. Secret Resource\ub294 \ubc18\ub4dc\uc2dc nginx.org/jwk type\uc73c\ub85c \uc9c0\uc815\ub418\uc5b4\uc57c \ud558\uba70, JWK \ub0b4\uc6a9\uc740 \ubc18\ub4dc\uc2dc jwk key \uc544\ub798 \uc800\uc7a5\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4. mkjwk\uc5d0\uc11c \uc0dd\uc131\ub41c JSON \ud615\uc2dd\uc758 Public Key\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. { \"kty\": \"RSA\", \"e\": \"AQAB\", \"use\": \"sig\", \"kid\": \"0001\", \"alg\": \"RS256\", \"n\": \"ttMDOhyzsRtk5GGBsz7bcIimto_vY2QXU5Vgg3hic7lXMsGVmfypF1aYlyC1a6nkuwmf1rSp5yZd0fJDg4vPWeYT8OtynGF-lzc7PQ-cuSxR-m1uc6qQsP7zvxicl-Jb81nDn2eZ8eVJor0ME0XrsnOsQfy4kPJtex8tkWMZ7DNycaxo_dxcBwqhVFJkGbFv9vzuVctEjIsozCE5XJbVsp8UYKtOIrDomDmar4XSw-JtylgUWti5XbSZmAFM_oF-Vp_wGFhbgmNATnddtoT8VRdu9ky7UyUSIuEG5q-QkfbFrlxeGqJc_2Y7OpYJ_P6jzmHOUo8exLp8EkT6B55qmw\" } { \"keys\": [{ \"kty\": \"RSA\", \"e\": \"AQAB\", \"use\": \"sig\", \"kid\": \"0001\", \"alg\": \"RS256\", \"n\": \"ttMDOhyzsRtk5GGBsz7bcIimto_vY2QXU5Vgg3hic7lXMsGVmfypF1aYlyC1a6nkuwmf1rSp5yZd0fJDg4vPWeYT8OtynGF-lzc7PQ-cuSxR-m1uc6qQsP7zvxicl-Jb81nDn2eZ8eVJor0ME0XrsnOsQfy4kPJtex8tkWMZ7DNycaxo_dxcBwqhVFJkGbFv9vzuVctEjIsozCE5XJbVsp8UYKtOIrDomDmar4XSw-JtylgUWti5XbSZmAFM_oF-Vp_wGFhbgmNATnddtoT8VRdu9ky7UyUSIuEG5q-QkfbFrlxeGqJc_2Y7OpYJ_P6jzmHOUo8exLp8EkT6B55qmw\" }] } \uc774 \ub0b4\uc6a9\uc744 Key Set \ud615\ud0dc\ub85c \ubc14\uafd4\uc11c jwk \ud30c\uc77c\ub85c \uc800\uc7a5\ud574\uc90d\ub2c8\ub2e4. \ud544\uc218 \uc694\uac74\uc744 \ub9cc\uc871\ud558\uae30 \uc704\ud574 \ud30c\uc77c\uc774\ub984\uc744 jwk \ub85c \uc9c0\uc815\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \ub9cc\uc77c \uc774\ub984\uc744 \ub2e4\ub974\uac8c \uc0ac\uc6a9\ud558\ub824\uace0 \ud55c\ub2e4\uba74, \uc0dd\uc131\ud55c JWKS\uac00 \uc694\uac74\uc744 \ub9cc\uc871\ud558\ub3c4\ub85d Secret \ub9ac\uc18c\uc2a4\uc758 Key \uc774\ub984\uc744 \uc218\uc815\ud558\ub294 \uacfc\uc815\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \uc774 \ud30c\uc77c\uc744 \ud1b5\ud574 \uc544\ub798 \uba85\ub839\uc5b4\ub97c \ud1b5\ud574 Secret \ub9ac\uc18c\uc2a4\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4. kubectl create secret generic dddaong-jwks --type=nginx.org/jwk --from-file=jwk \uc544\ub798\uc758 \uba85\ub839\uc5b4\ub85c Secret \ub9ac\uc18c\uc2a4\ub97c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. kubectl get secret dddaong-jwks -o yaml apiVersion: v1 data: jwk: eyAia2V5cyI6Clt7CiAgICAia3R5IjogIlJTQSIsCiAgICAiZSI6ICJBUUFCIiwKICAgICJ1c2UiOiAic2lnIiwKICAgICJraWQiOiAiMDAwMSIsCiAgICAiYWxnIjogIlJTMjU2IiwKICAgICJuIjogInR0TURPaHl6c1J0azVHR0JzejdiY0lpbXRvX3ZZMlFYVTVWZ2czaGljN2xYTXNHVm1meXBGMWFZbHlDMWE2bmt1d21mMXJTcDV5WmQwZkpEZzR2UFdlWVQ4T3R5bkdGLWx6YzdQUS1jdVN4Ui1tMXVjNnFRc1A3enZ4aWNsLUpiODFuRG4yZVo4ZVZKb3IwTUUwWHJzbk9zUWZ5NGtQSnRleDh0a1dNWjdETnljYXhvX2R4Y0J3cWhWRkprR2JGdjl2enVWY3RFaklzb3pDRTVYSmJWc3A4VVlLdE9JckRvbURtYXI0WFN3LUp0eWxnVVd0aTVYYlNabUFGTV9vRi1WcF93R0ZoYmdtTkFUbmRkdG9UOFZSZHU5a3k3VXlVU0l1RUc1cS1Ra2ZiRnJseGVHcUpjXzJZN09wWUpfUDZqem1IT1VvOGV4THA4RWtUNkI1NXFtdyIKfV0KfQo= kind: Secret metadata: creationTimestamp: \"2021-04-13T06:55:14Z\" managedFields: - apiVersion: v1 fieldsType: FieldsV1 fieldsV1: f:data: .: {} f:jwk: {} f:type: {} manager: kubectl-create operation: Update time: \"2021-04-13T06:55:14Z\" name: dddaong-jwks namespace: default resourceVersion: \"3335260\" uid: bfd83b04-0ce2-4302-b53d-a9b115320b91 type: nginx.org/jwk 3. \ud14c\uc2a4\ud2b8\ub97c \uc704\ud55c JWT \uc0dd\uc131 \u00b6 \uc778\uc99d\ud558\ub824\ub294 JWT\ub3c4 \uc791\uc131\ud569\ub2c8\ub2e4. \ucc38\uace0 \ub9c1\ud06c: RSA Signed JWT \uc0dd\uc131 \ubc29\ubc95 NGINX Plus\uc5d0\uc11c JWT \uc791\uc131\uc5d0 \uc0ac\uc6a9\ud55c \ubc29\ubc95\uacfc \ub3d9\uc77c\ud558\uac8c jwt.io\uc758 Debugger\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. Header\uc640 Payload\ub97c \uac01\uac01 \uc791\uc131\ud574 Base64url \uc778\ucf54\ub529\ud569\ub2c8\ub2e4. HEAD=$(echo -n '{\"alg\":\"RS256\",\"typ\":\"JWT\",\"kid\":\"0001\"}' | base64 | sed s/\\+/-/ | sed -E s/=+$//) PAYLOAD=$(echo -n '{\"sub\":\"RS256NPICTEST\",\"aud\":\"dddaong\",\"iat\": 1618295120}' | base64 | sed s/\\+/-/ | sed -E s/=+$//) echo \"$HEAD.$PAYLOAD\" \uacb0\uacfc\ubb3c\uc740 \uc544\ub798\uc640 \uac19\uc774 \ub098\uc635\ub2c8\ub2e4. eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJSUzI1NlRFU1QiLCJhdWQiOiJkZGRhb25nIn0 \uc0dd\uc131\ud55c \ub0b4\uc6a9\uc744 jwt.io Debugger \uc5d0 Encoded \ubd80\ubd84\uc5d0 \ubd99\uc5ec\ub123\uc2b5\ub2c8\ub2e4. jwt.io Debugger \uc6b0\uce21 Decoded\uc758 Verify Signature \ud56d\ubaa9\uc758 \uc544\ub798\ucabd \ubc15\uc2a4\uc5d0 mkjwk JSON Web Key Generator \uc5d0\uc11c \uc0dd\uc131\ud55c Private Key(X.509 PEM \ud3ec\ub9f7)\uc744 \ubd99\uc5ec\ub123\uc2b5\ub2c8\ub2e4. Private Key\ub97c \ubd99\uc5ec\ub123\ub294 \uc989\uc2dc Encoded\uc5d0 JWT\uac00 \uc644\uc131\ub418\uc5b4 \ub098\ud0c0\ub0a9\ub2c8\ub2e4. \uacb0\uacfc\ubb3c\uc740 \uc544\ub798\uc640 \uac19\uc774 \ub098\uc635\ub2c8\ub2e4. eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjAwMDEifQ.eyJzdWIiOiJSUzI1Nk5QSUNURVNUIiwiYXVkIjoiZGRkYW9uZyIsImlhdCI6MTYxODI5NTEyMH0.kaJmcz1YLWOjBUrqMnPR8Kzh8nqG92GFMXYmpOVkjlx7NzxNZ_6e6gv6ziR9UhiiYOICqwwzpLUN9DerumGSRCNe6m_640oA0HnS1MkgSc9Q4V9g7DT66UpM4gfDC9WJlRoigolD8cXG5V479Dun3VOvKvwmDDr4NYMPSh8w-L056Lk6lqZEZktXjIYbTaB9S4gLWhbxsrA61C97Va71dbqKqDc0TJ0oTTCLtyRx3EzsfETGil44uMowfGGVb5Y_S5vojv_dwsFkmxjBH7EbvLsvRwYcahrqtxfF6YCXTwvnppxhI9iHWBQaNF4Zkvsk1XzzhCE3NPjpWPxqjQaE8g \ud14c\uc2a4\ud2b8 \uacfc\uc815\uc5d0\uc11c\ub294 \ud3b8\uc758\ub97c \uc704\ud574 \uc804\uccb4 \ud1a0\ud070 \uc2a4\ud2b8\ub9c1\uc744 dddaong.token \uc774\ub984\uc758 \ubcc4\ub3c4 \ud30c\uc77c\ub85c \uc800\uc7a5\ud588\uc2b5\ub2c8\ub2e4. echo 'eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjAwMDEifQ.eyJzdWIiOiJSUzI1Nk5QSUNURVNUIiwiYXVkIjoiZGRkYW9uZyIsImlhdCI6MTYxODI5NTEyMH0.kaJmcz1YLWOjBUrqMnPR8Kzh8nqG92GFMXYmpOVkjlx7NzxNZ_6e6gv6ziR9UhiiYOICqwwzpLUN9DerumGSRCNe6m_640oA0HnS1MkgSc9Q4V9g7DT66UpM4gfDC9WJlRoigolD8cXG5V479Dun3VOvKvwmDDr4NYMPSh8w-L056Lk6lqZEZktXjIYbTaB9S4gLWhbxsrA61C97Va71dbqKqDc0TJ0oTTCLtyRx3EzsfETGil44uMowfGGVb5Y_S5vojv_dwsFkmxjBH7EbvLsvRwYcahrqtxfF6YCXTwvnppxhI9iHWBQaNF4Zkvsk1XzzhCE3NPjpWPxqjQaE8g' > dddaong.token 4-1. Ingress Resource\uc5d0 \uc5f0\ub3d9 \u00b6 Ingress\uc758 JWT \uc778\uc99d \uc124\uc815 - Annotation\uc758 \uc0ac\uc6a9 \u00b6 JWT \uc778\uc99d\uc744 Ingress Resource\uc5d0 \uc5f0\ub3d9\ud560 \ub54c\ub294 Annotation \ud615\ud0dc\ub85c \uc815\uc758 \ub429\ub2c8\ub2e4. NPIC\uac00 \uc9c0\uc6d0\ud558\ub294 Annotation\uc740 \ub124 \uac00\uc9c0 \uc785\ub2c8\ub2e4. [\ud544\uc218] nginx.com/jwt-key: \"secret\" : JWT\ub97c \uc778\uc99d\ud560 Secret \ub9ac\uc18c\uc2a4\uc758 \uc774\ub984\uc744 \uc9c0\uc815\ud569\ub2c8\ub2e4. [\uc635\uc158] nginx.com/jwt-realm: \"realm\" : Realm \uba85\uc744 \uc9c0\uc815\ud569\ub2c8\ub2e4. [\uc635\uc158] nginx.com/jwt-token: \"token\" : JWT\uc758 \uc704\uce58\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4. \ubcc0\uc218\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. token : \uae30\ubcf8\uac12\uc774\uba70, Authorization \ud5e4\ub354\uc5d0\uc11c Bearer \ud1a0\ud070\uc744 \uc0ac\uc6a9\ud558\ub294 \ubc29\uc2dd\uc785\ub2c8\ub2e4. $http_*name* : JWT\uc758 \uc704\uce58\ub97c 'name' \ud5e4\ub354\ub85c \ubcc0\uacbd\ud569\ub2c8\ub2e4. $cookie_auth_token : JWT\uc758 \uc704\uce58\ub97c auth_token\uc774\ub77c\ub294 \uc774\ub984\uc758 cookie \uac12\uc73c\ub85c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. $arg_apijwt : JWT\uc758 \uc704\uce58\ub97c apijwt\ub77c\ub294 \uc774\ub984\uc758 Argument\uc758 \uac12\uc73c\ub85c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. [\uc635\uc158] nginx.com/jwt-login-url: \"url\" : JWT\uac00 \uc5c6\uac70\ub098 \uc720\ud6a8\ud558\uc9c0 \uc54a\uc740 \uacbd\uc6b0 Redirect\ud560 URL\uc744 \uc9c0\uc815\ud569\ub2c8\ub2e4. cookie_name \ubcc0\uc218\uc640 arg_name\uc758 \ubcc0\uc218 \uc774\ub984\uc740 lowercase\ub85c, - \ub294 _ \ub85c \ub300\uccb4\ub429\ub2c8\ub2e4. \ub354 \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 ngx_http_core_module \ubaa8\ub4c8\uc758 Embedded Variables \ub97c \ucc38\uc870\ud558\uba74 \uc88b\uc2b5\ub2c8\ub2e4. Ingress Resource\uc758 Annotation \uc791\uc131 \uc0d8\ud50c (YAML) \u00b6 apiVersion: networking.k8s.io/v1beta1 kind: Ingress metadata: name: cafe-ingress annotations: nginx.com/jwt-key: \"cafe-jwk\" nginx.com/jwt-realm: \"Cafe App\" nginx.com/jwt-token: \"$cookie_auth_token\" nginx.com/jwt-login-url: \"https://login.example.com\" spec: Ingress Resource \uad00\ub828\ud55c \uc774\uc0c1\uc758 \ub0b4\uc6a9\uc740 NGINX INC Github \ucc38\uace0 \ud398\uc774\uc9c0 \uc5d0 \uc608\uc2dc\uc640 \ud568\uaed8 \uc0c1\uc138\ud788 \uc124\uba85\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. Ingress \ub9ac\uc18c\uc2a4 \uc0dd\uc131 \u00b6 \ud14c\uc2a4\ud2b8\uc5d0 \uc0ac\uc6a9\ud55c Ingress \ub9ac\uc18c\uc2a4\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. apiVersion: networking.k8s.io/v1beta1 kind: Ingress metadata: name: dddaong-jwt-test annotations: nginx.com/jwt-key: \"dddaong-jwks\" nginx.com/jwt-realm: \"dddaong\" spec: rules: - host: auth-ing.test http: paths: - path: / backend: serviceName: coffee-svc servicePort: 80 Ingress JWT \uc778\uc99d TEST \uacb0\uacfc \u00b6 NPIC\uc758 Service \ub9ac\uc18c\uc2a4\uc758 ClusterIP\ub85c Curl \uba85\ub839\uc5b4\ub97c \ud1b5\ud574 \uc778\uc99d \uc5ec\ubd80\ub97c \ud655\uc778\ud569\ub2c8\ub2e4. Case : Authentication Failure curl -IvH 'host:auth-ing.test' http://10.97.46.125 * About to connect() to 10.97.46.125 port 80 (#0) * Trying 10.97.46.125... * Connected to 10.97.46.125 (10.97.46.125) port 80 (#0) > HEAD / HTTP/1.1 > User-Agent: curl/7.29.0 > Accept: */* > host:auth-ing.test > < HTTP/1.1 401 Unauthorized HTTP/1.1 401 Unauthorized < Server: nginx/1.19.5 Server: nginx/1.19.5 < Date: Tue, 13 Apr 2021 07:14:10 GMT Date: Tue, 13 Apr 2021 07:14:10 GMT < Content-Type: text/html Content-Type: text/html < Content-Length: 179 Content-Length: 179 < Connection: keep-alive Connection: keep-alive < WWW-Authenticate: Bearer realm=\"dddaong\" WWW-Authenticate: Bearer realm=\"dddaong\" < * Connection #0 to host 10.97.46.125 left intact Case : Authentication Success # curl -IvH 'host:auth-ing.test' -H \"Authorization: Bearer `cat dddaong.token`\" http://10.97.46.125 * About to connect() to 10.97.46.125 port 80 (#0) * Trying 10.97.46.125... * Connected to 10.97.46.125 (10.97.46.125) port 80 (#0) > HEAD / HTTP/1.1 > User-Agent: curl/7.29.0 > Accept: */* > host:auth-ing.test > Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjAwMDEifQ.eyJzdWIiOiJSUzI1Nk5QSUNURVNUIiwiYXVkIjoiZGRkYW9uZyIsImlhdCI6MTYxODI5NTEyMH0.kaJmcz1YLWOjBUrqMnPR8Kzh8nqG92GFMXYmpOVkjlx7NzxNZ_6e6gv6ziR9UhiiYOICqwwzpLUN9DerumGSRCNe6m_640oA0HnS1MkgSc9Q4V9g7DT66UpM4gfDC9WJlRoigolD8cXG5V479Dun3VOvKvwmDDr4NYMPSh8w-L056Lk6lqZEZktXjIYbTaB9S4gLWhbxsrA61C97Va71dbqKqDc0TJ0oTTCLtyRx3EzsfETGil44uMowfGGVb5Y_S5vojv_dwsFkmxjBH7EbvLsvRwYcahrqtxfF6YCXTwvnppxhI9iHWBQaNF4Zkvsk1XzzhCE3NPjpWPxqjQaE8g > < HTTP/1.1 200 OK HTTP/1.1 200 OK < Server: nginx/1.19.5 Server: nginx/1.19.5 < Date: Tue, 13 Apr 2021 07:15:00 GMT Date: Tue, 13 Apr 2021 07:15:00 GMT < Content-Type: text/plain Content-Type: text/plain < Content-Length: 157 Content-Length: 157 < Connection: keep-alive Connection: keep-alive < Expires: Tue, 13 Apr 2021 07:14:59 GMT Expires: Tue, 13 Apr 2021 07:14:59 GMT < Cache-Control: no-cache Cache-Control: no-cache < * Connection #0 to host 10.97.46.125 left intact 4-2. VirtualServer Crd\uc5d0 \uc5f0\ub3d9 \u00b6 VirtualServer\uc758 JWT \uc778\uc99d \uc124\uc815 - Policy Crd \uc0ac\uc6a9 \u00b6 JWT \uc778\uc99d\uc744 VirtualServer Resource\uc5d0 \uc5f0\ub3d9\ud560 \ub54c\ub294 \ubcc4\ub3c4\uc758 Policy \ub9ac\uc18c\uc2a4\ub85c \uc815\uc758 \ub429\ub2c8\ub2e4. JWT\uc758 \uc704\uce58 \ubcc0\uacbd (Header, Cookie, Argument) \uc5ed\uc2dc Policy\uc5d0\uc11c \uc124\uc815\ud569\ub2c8\ub2e4. \uc544\ub798\ub294 YAML \ud615\uc2dd\uc758 Policy Crd \uc0d8\ud50c\uc785\ub2c8\ub2e4. apiVersion: k8s.nginx.org/v1 kind: Policy metadata: name: jwk-auth spec: jwt: secret: dddaong-jwk-secret # Secret \ub9ac\uc18c\uc2a4 \uc774\ub984\uc744 \uc9c0\uc815\ud569\ub2c8\ub2e4. realm: \"myrealm\" # Realm \uc774\ub984\uc744 \uc9c0\uc815\ud569\ub2c8\ub2e4. token: $http_token # Token \uc704\uce58\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4. Ingress \ub9ac\uc18c\uc2a4\uc640 \ub9c8\ucc2c\uac00\uc9c0\ub85c Token \uc704\uce58\ub97c \ubcc4\ub3c4\ub85c \uc9c0\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc9c0\uc815\ud558\uc9c0 \uc54a\uc73c\uba74 \uae30\ubcf8\uac12\uc744 \uc0ac\uc6a9\ud558\uba70, \uae30\ubcf8\uac12\uc740 \ud45c\uc900 \ud5e4\ub354 Authorization: Bearer <token> \uc785\ub2c8\ub2e4. spec: jwt: secret: jwk-secret realm: \"myrealm\" token: $cookie_cookiename #$arg_argname \ub610\ub294 $http_headername \ub2e4\ub978 \uacbd\uc6b0\uc640 \ub9c8\ucc2c\uac00\uc9c0\ub85c \ubcc0\uc218 \uc774\ub984\uc740 lowercase\ub85c, - \ub294 _ \ub85c \ub300\uccb4\ub429\ub2c8\ub2e4. \ub354 \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 ngx_http_core_module \ubaa8\ub4c8\uc758 Embedded Variables \ub97c \ucc38\uc870\ud558\uba74 \uc88b\uc2b5\ub2c8\ub2e4. Policy \uc0dd\uc131 \u00b6 \uc778\uc99d \ud14c\uc2a4\ud2b8\uc5d0 \uc0ac\uc6a9\ud55c Policy Crd\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. apiVersion: k8s.nginx.org/v1 kind: Policy metadata: name: dddaong-jwk-auth spec: jwt: secret: dddaong-jwks realm: \"dddaong\" Policy\ub97c \uc544\ub798\uc640 \uac19\uc774 VirtualServer\uc5d0 \uc5f0\ub3d9\ud574\uc90d\ub2c8\ub2e4. apiVersion: k8s.nginx.org/v1 kind: VirtualServer metadata: name: dddaong-jwt-test spec: host: auth.test policies: - name: dddaong-jwk-auth upstreams: - name: coffee service: coffee-svc port: 80 routes: - path: / action: pass: coffee VirtualServer\uc758 upstream\uacfc routes \ubd80\ubd84\uc740 \ud14c\uc2a4\ud2b8\ud560 Application\uc5d0 \ub9de\uac8c \uc218\uc815\ud574\uc11c \uc0ac\uc6a9\ud558\uc2dc\uba74 \ub429\ub2c8\ub2e4. VirtualServer JWT \uc778\uc99d TEST \uacb0\uacfc \u00b6 NPIC\uc758 Service \ub9ac\uc18c\uc2a4\uc758 ClusterIP\ub85c Curl \uba85\ub839\uc5b4\ub97c \ud1b5\ud574 \uc778\uc99d \uc5ec\ubd80\ub97c \ud655\uc778\ud569\ub2c8\ub2e4. Case : Authentication Failure [root@kube-master jwt]# curl -IvH 'host:auth.test' http://10.97.46.125 * About to connect() to 10.97.46.125 port 80 (#0) * Trying 10.97.46.125... * Connected to 10.97.46.125 (10.97.46.125) port 80 (#0) > HEAD / HTTP/1.1 > User-Agent: curl/7.29.0 > Accept: */* > host:auth.test > < HTTP/1.1 401 Unauthorized HTTP/1.1 401 Unauthorized < Server: nginx/1.19.5 Server: nginx/1.19.5 < Date: Tue, 13 Apr 2021 07:04:59 GMT Date: Tue, 13 Apr 2021 07:04:59 GMT < Content-Type: text/html Content-Type: text/html < Content-Length: 179 Content-Length: 179 < Connection: keep-alive Connection: keep-alive < WWW-Authenticate: Bearer realm=\"dddaong\" WWW-Authenticate: Bearer realm=\"dddaong\" < * Connection #0 to host 10.97.46.125 left intact Case : Authentication Success # curl -IvH 'host:auth.test' -H \"Authorization: Bearer `cat dddaong.token`\" http://10.97.46.125 * About to connect() to 10.97.46.125 port 80 (#0) * Trying 10.97.46.125... * Connected to 10.97.46.125 (10.97.46.125) port 80 (#0) > HEAD / HTTP/1.1 > User-Agent: curl/7.29.0 > Accept: */* > host:auth.test > Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjAwMDEifQ.eyJzdWIiOiJSUzI1Nk5QSUNURVNUIiwiYXVkIjoiZGRkYW9uZyIsImlhdCI6MTYxODI5NTEyMH0.kaJmcz1YLWOjBUrqMnPR8Kzh8nqG92GFMXYmpOVkjlx7NzxNZ_6e6gv6ziR9UhiiYOICqwwzpLUN9DerumGSRCNe6m_640oA0HnS1MkgSc9Q4V9g7DT66UpM4gfDC9WJlRoigolD8cXG5V479Dun3VOvKvwmDDr4NYMPSh8w-L056Lk6lqZEZktXjIYbTaB9S4gLWhbxsrA61C97Va71dbqKqDc0TJ0oTTCLtyRx3EzsfETGil44uMowfGGVb5Y_S5vojv_dwsFkmxjBH7EbvLsvRwYcahrqtxfF6YCXTwvnppxhI9iHWBQaNF4Zkvsk1XzzhCE3NPjpWPxqjQaE8g > < HTTP/1.1 200 OK HTTP/1.1 200 OK < Server: nginx/1.19.5 Server: nginx/1.19.5 < Date: Tue, 13 Apr 2021 07:06:11 GMT Date: Tue, 13 Apr 2021 07:06:11 GMT < Content-Type: text/plain Content-Type: text/plain < Content-Length: 157 Content-Length: 157 < Connection: keep-alive Connection: keep-alive < Expires: Tue, 13 Apr 2021 07:06:10 GMT Expires: Tue, 13 Apr 2021 07:06:10 GMT < Cache-Control: no-cache Cache-Control: no-cache < * Connection #0 to host 10.97.46.125 left intact \ubcc4\ub3c4 \ucc38\uc870... - HS256 JWT \uc0dd\uc131\uae30","title":"NGINX+ Ingress Controller - JWT \uc778\uc99d"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Plus-Ingress-Controller%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#nginx-plus-ingress-controller-jwt","text":"NGINX Plus Ingress Controller\uc5d0\uc11c JWT \uc778\uc99d \uad00\ub828 \uae30\ub2a5\uc744 \ud14c\uc2a4\ud2b8\ud55c \ub0b4\uc6a9\uc785\ub2c8\ub2e4. NPIC\uc758 JWT \uc778\uc99d\uc740 \uc544\uc9c1 Preview Policies \uc0c1\ud0dc\uc785\ub2c8\ub2e4. Production \ud658\uacbd\uc5d0\uc11c\uc758 \uc0ac\uc6a9\uc5d0 \uc8fc\uc758\ub97c \uc694\ud569\ub2c8\ub2e4.","title":"NGINX Plus Ingress Controller\uc758 JWT \uc778\uc99d"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Plus-Ingress-Controller%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#_1","text":"Helm\uc744 \uc0ac\uc6a9\ud574 NGINX Plus Ingress Controller\uac00 \uc124\uce58\ub41c \uc0c1\ud0dc\uc5d0\uc11c \uc218\ud589\ud588\uc2b5\ub2c8\ub2e4. \ud14c\uc2a4\ud2b8\uc6a9 \ubc31\uc5d4\ub4dc\ub294 NGINX Plus\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 Cafe \uc11c\ube44\uc2a4\ub97c \uc0ac\uc6a9\ud588\uc2b5\ub2c8\ub2e4. \ub3d9\uc77c\ud55c \ubc31\uc5d4\ub4dc\ub97c \uc0ac\uc6a9\ud558\ub824\uba74 \uc544\ub798 YAML\uc744 \ud1b5\ud574 \uc11c\ube44\uc2a4\ub97c \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. apiVersion: apps/v1 kind: Deployment metadata: name: coffee spec: replicas: 1 selector: matchLabels: app: coffee template: metadata: labels: app: coffee spec: containers: - name: coffee image: nginxdemos/hello:plain-text ports: - containerPort: 80 --- apiVersion: v1 kind: Service metadata: name: coffee-svc spec: ports: - port: 80 targetPort: 80 protocol: TCP name: http selector: app: coffee --- apiVersion: apps/v1 kind: Deployment metadata: name: tea spec: replicas: 1 selector: matchLabels: app: tea template: metadata: labels: app: tea spec: containers: - name: tea image: nginxdemos/hello:plain-text ports: - containerPort: 80 --- apiVersion: v1 kind: Service metadata: name: tea-svc labels: spec: ports: - port: 80 targetPort: 80 protocol: TCP name: http selector: app: tea","title":"\ud14c\uc2a4\ud2b8 \ud658\uacbd"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Plus-Ingress-Controller%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#preview-policies-enable","text":"VirtualServer\uc5d0\uc11c \uc0ac\uc6a9\ud558\uae30 \uc704\ud55c JWT \uc778\uc99d\uc744 \uc0ac\uc6a9\ud558\ub824\uba74 Policy\ub97c \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4. \ub2e8, Policy\ub294 \ud604\uc7ac Preview \uae30\ub2a5\uc73c\ub85c\uc11c \uae30\ubcf8\uac12\uc73c\ub85c Disabled \ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uc544\ub798 \ubc29\ubc95\uc73c\ub85c enable-preview-policies Argument\ub97c Enable\ub85c \uc218\uc815\ud574\uc90d\ub2c8\ub2e4. #kubectl edit deployments.apps dddaong-nginx-ingress ...[ommitted] spec: template: spec: containers: - args: - -enable-preview-policies=true [ommitted] ...","title":"Preview-policies Enable"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Plus-Ingress-Controller%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#jwk","text":"Secret Resource\ub294 \ubc18\ub4dc\uc2dc Policy\uc640 \uac19\uc740 namespace\uc5d0 \uc704\uce58\ud574\uc57c \ud569\ub2c8\ub2e4. Secret Resource\ub294 \ubc18\ub4dc\uc2dc nginx.org/jwk type\uc73c\ub85c \uc9c0\uc815\ub418\uc5b4\uc57c \ud558\uba70, JWK \ub0b4\uc6a9\uc740 \ubc18\ub4dc\uc2dc jwk key \uc544\ub798 \uc800\uc7a5\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4. \uadf8\ub807\uc9c0 \uc54a\uc73c\uba74 JWT Validation\uc5d0 \uc2e4\ud328\ud569\ub2c8\ub2e4.","title":"\uc8fc\uc758 : JWK \uc0ac\uc6a9 \ud544\uc218 \uc694\uac74"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Plus-Ingress-Controller%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#npic-jwt-rs256","text":"Kubernetes \uae30\ubcf8 \ub9ac\uc18c\uc2a4\uc778 Secret \ub9ac\uc18c\uc2a4\ub97c JWK\ub85c \uc0ac\uc6a9\ud55c JWT \uc778\uc99d\uc744 \ud14c\uc2a4\ud2b8\ud569\ub2c8\ub2e4. \ud14c\uc2a4\ud2b8\uc758 JWT \uc54c\uace0\ub9ac\uc998\uc740 RS256\uc744 \uc0ac\uc6a9\ud588\uc2b5\ub2c8\ub2e4.","title":"NPIC + JWT + RS256 \ud14c\uc2a4\ud2b8"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Plus-Ingress-Controller%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#1-rsa-private-key-public-key","text":"jwk \uc0dd\uc131\uc744 \uc704\ud574 mkjwk: simple JSON Web Key generator \ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uc544\ub798\ub294 \uc0dd\uc131\uc2dc \uc120\ud0dd\ud55c \uc635\uc158\uc785\ub2c8\ub2e4. Tab Key Size Key Use Algorithm Key ID Show X.509 RSA 2048 Signature RS256 Specify [0001] Yes \uc774 \uc0ac\uc774\ud2b8\uc5d0\uc11c \uc0dd\uc131\ub41c \ub0b4\uc6a9\uc744 \ubc14\ud0d5\uc73c\ub85c JWKS Secret \ub9ac\uc18c\uc2a4 \ubc0f \ud14c\uc2a4\ud2b8\ub97c \uc704\ud55c JWT\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4.","title":"1. RSA Private Key / Public Key \uc0dd\uc131"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Plus-Ingress-Controller%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#2-jwk-secret","text":"\uc9c1\uc804 \uacfc\uc815\uc5d0\uc11c \uc0dd\uc131\ud55c Public Key\ub85c NGINX Ingress Controller\uac00 \uc694\uad6c\ud558\ub294 \ud615\ud0dc\uc758 Secret \ub9ac\uc18c\uc2a4\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4. \uc8fc\uc758\uc0ac\ud56d(\ud544\uc218\uc694\uac74)\uc744 \ud55c \ubc88 \ub354 \uc9da\uc5b4\ubcf4\uba74... \ubc18\ub4dc\uc2dc Policy\uc640 \uac19\uc740 namespace\uc5d0 \uc704\uce58\ud574\uc57c \ud569\ub2c8\ub2e4. Secret Resource\ub294 \ubc18\ub4dc\uc2dc nginx.org/jwk type\uc73c\ub85c \uc9c0\uc815\ub418\uc5b4\uc57c \ud558\uba70, JWK \ub0b4\uc6a9\uc740 \ubc18\ub4dc\uc2dc jwk key \uc544\ub798 \uc800\uc7a5\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4. mkjwk\uc5d0\uc11c \uc0dd\uc131\ub41c JSON \ud615\uc2dd\uc758 Public Key\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. { \"kty\": \"RSA\", \"e\": \"AQAB\", \"use\": \"sig\", \"kid\": \"0001\", \"alg\": \"RS256\", \"n\": \"ttMDOhyzsRtk5GGBsz7bcIimto_vY2QXU5Vgg3hic7lXMsGVmfypF1aYlyC1a6nkuwmf1rSp5yZd0fJDg4vPWeYT8OtynGF-lzc7PQ-cuSxR-m1uc6qQsP7zvxicl-Jb81nDn2eZ8eVJor0ME0XrsnOsQfy4kPJtex8tkWMZ7DNycaxo_dxcBwqhVFJkGbFv9vzuVctEjIsozCE5XJbVsp8UYKtOIrDomDmar4XSw-JtylgUWti5XbSZmAFM_oF-Vp_wGFhbgmNATnddtoT8VRdu9ky7UyUSIuEG5q-QkfbFrlxeGqJc_2Y7OpYJ_P6jzmHOUo8exLp8EkT6B55qmw\" } { \"keys\": [{ \"kty\": \"RSA\", \"e\": \"AQAB\", \"use\": \"sig\", \"kid\": \"0001\", \"alg\": \"RS256\", \"n\": \"ttMDOhyzsRtk5GGBsz7bcIimto_vY2QXU5Vgg3hic7lXMsGVmfypF1aYlyC1a6nkuwmf1rSp5yZd0fJDg4vPWeYT8OtynGF-lzc7PQ-cuSxR-m1uc6qQsP7zvxicl-Jb81nDn2eZ8eVJor0ME0XrsnOsQfy4kPJtex8tkWMZ7DNycaxo_dxcBwqhVFJkGbFv9vzuVctEjIsozCE5XJbVsp8UYKtOIrDomDmar4XSw-JtylgUWti5XbSZmAFM_oF-Vp_wGFhbgmNATnddtoT8VRdu9ky7UyUSIuEG5q-QkfbFrlxeGqJc_2Y7OpYJ_P6jzmHOUo8exLp8EkT6B55qmw\" }] } \uc774 \ub0b4\uc6a9\uc744 Key Set \ud615\ud0dc\ub85c \ubc14\uafd4\uc11c jwk \ud30c\uc77c\ub85c \uc800\uc7a5\ud574\uc90d\ub2c8\ub2e4. \ud544\uc218 \uc694\uac74\uc744 \ub9cc\uc871\ud558\uae30 \uc704\ud574 \ud30c\uc77c\uc774\ub984\uc744 jwk \ub85c \uc9c0\uc815\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \ub9cc\uc77c \uc774\ub984\uc744 \ub2e4\ub974\uac8c \uc0ac\uc6a9\ud558\ub824\uace0 \ud55c\ub2e4\uba74, \uc0dd\uc131\ud55c JWKS\uac00 \uc694\uac74\uc744 \ub9cc\uc871\ud558\ub3c4\ub85d Secret \ub9ac\uc18c\uc2a4\uc758 Key \uc774\ub984\uc744 \uc218\uc815\ud558\ub294 \uacfc\uc815\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \uc774 \ud30c\uc77c\uc744 \ud1b5\ud574 \uc544\ub798 \uba85\ub839\uc5b4\ub97c \ud1b5\ud574 Secret \ub9ac\uc18c\uc2a4\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4. kubectl create secret generic dddaong-jwks --type=nginx.org/jwk --from-file=jwk \uc544\ub798\uc758 \uba85\ub839\uc5b4\ub85c Secret \ub9ac\uc18c\uc2a4\ub97c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. kubectl get secret dddaong-jwks -o yaml apiVersion: v1 data: jwk: eyAia2V5cyI6Clt7CiAgICAia3R5IjogIlJTQSIsCiAgICAiZSI6ICJBUUFCIiwKICAgICJ1c2UiOiAic2lnIiwKICAgICJraWQiOiAiMDAwMSIsCiAgICAiYWxnIjogIlJTMjU2IiwKICAgICJuIjogInR0TURPaHl6c1J0azVHR0JzejdiY0lpbXRvX3ZZMlFYVTVWZ2czaGljN2xYTXNHVm1meXBGMWFZbHlDMWE2bmt1d21mMXJTcDV5WmQwZkpEZzR2UFdlWVQ4T3R5bkdGLWx6YzdQUS1jdVN4Ui1tMXVjNnFRc1A3enZ4aWNsLUpiODFuRG4yZVo4ZVZKb3IwTUUwWHJzbk9zUWZ5NGtQSnRleDh0a1dNWjdETnljYXhvX2R4Y0J3cWhWRkprR2JGdjl2enVWY3RFaklzb3pDRTVYSmJWc3A4VVlLdE9JckRvbURtYXI0WFN3LUp0eWxnVVd0aTVYYlNabUFGTV9vRi1WcF93R0ZoYmdtTkFUbmRkdG9UOFZSZHU5a3k3VXlVU0l1RUc1cS1Ra2ZiRnJseGVHcUpjXzJZN09wWUpfUDZqem1IT1VvOGV4THA4RWtUNkI1NXFtdyIKfV0KfQo= kind: Secret metadata: creationTimestamp: \"2021-04-13T06:55:14Z\" managedFields: - apiVersion: v1 fieldsType: FieldsV1 fieldsV1: f:data: .: {} f:jwk: {} f:type: {} manager: kubectl-create operation: Update time: \"2021-04-13T06:55:14Z\" name: dddaong-jwks namespace: default resourceVersion: \"3335260\" uid: bfd83b04-0ce2-4302-b53d-a9b115320b91 type: nginx.org/jwk","title":"2. JWK Secret \uc0dd\uc131"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Plus-Ingress-Controller%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#3-jwt","text":"\uc778\uc99d\ud558\ub824\ub294 JWT\ub3c4 \uc791\uc131\ud569\ub2c8\ub2e4. \ucc38\uace0 \ub9c1\ud06c: RSA Signed JWT \uc0dd\uc131 \ubc29\ubc95 NGINX Plus\uc5d0\uc11c JWT \uc791\uc131\uc5d0 \uc0ac\uc6a9\ud55c \ubc29\ubc95\uacfc \ub3d9\uc77c\ud558\uac8c jwt.io\uc758 Debugger\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. Header\uc640 Payload\ub97c \uac01\uac01 \uc791\uc131\ud574 Base64url \uc778\ucf54\ub529\ud569\ub2c8\ub2e4. HEAD=$(echo -n '{\"alg\":\"RS256\",\"typ\":\"JWT\",\"kid\":\"0001\"}' | base64 | sed s/\\+/-/ | sed -E s/=+$//) PAYLOAD=$(echo -n '{\"sub\":\"RS256NPICTEST\",\"aud\":\"dddaong\",\"iat\": 1618295120}' | base64 | sed s/\\+/-/ | sed -E s/=+$//) echo \"$HEAD.$PAYLOAD\" \uacb0\uacfc\ubb3c\uc740 \uc544\ub798\uc640 \uac19\uc774 \ub098\uc635\ub2c8\ub2e4. eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJSUzI1NlRFU1QiLCJhdWQiOiJkZGRhb25nIn0 \uc0dd\uc131\ud55c \ub0b4\uc6a9\uc744 jwt.io Debugger \uc5d0 Encoded \ubd80\ubd84\uc5d0 \ubd99\uc5ec\ub123\uc2b5\ub2c8\ub2e4. jwt.io Debugger \uc6b0\uce21 Decoded\uc758 Verify Signature \ud56d\ubaa9\uc758 \uc544\ub798\ucabd \ubc15\uc2a4\uc5d0 mkjwk JSON Web Key Generator \uc5d0\uc11c \uc0dd\uc131\ud55c Private Key(X.509 PEM \ud3ec\ub9f7)\uc744 \ubd99\uc5ec\ub123\uc2b5\ub2c8\ub2e4. Private Key\ub97c \ubd99\uc5ec\ub123\ub294 \uc989\uc2dc Encoded\uc5d0 JWT\uac00 \uc644\uc131\ub418\uc5b4 \ub098\ud0c0\ub0a9\ub2c8\ub2e4. \uacb0\uacfc\ubb3c\uc740 \uc544\ub798\uc640 \uac19\uc774 \ub098\uc635\ub2c8\ub2e4. eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjAwMDEifQ.eyJzdWIiOiJSUzI1Nk5QSUNURVNUIiwiYXVkIjoiZGRkYW9uZyIsImlhdCI6MTYxODI5NTEyMH0.kaJmcz1YLWOjBUrqMnPR8Kzh8nqG92GFMXYmpOVkjlx7NzxNZ_6e6gv6ziR9UhiiYOICqwwzpLUN9DerumGSRCNe6m_640oA0HnS1MkgSc9Q4V9g7DT66UpM4gfDC9WJlRoigolD8cXG5V479Dun3VOvKvwmDDr4NYMPSh8w-L056Lk6lqZEZktXjIYbTaB9S4gLWhbxsrA61C97Va71dbqKqDc0TJ0oTTCLtyRx3EzsfETGil44uMowfGGVb5Y_S5vojv_dwsFkmxjBH7EbvLsvRwYcahrqtxfF6YCXTwvnppxhI9iHWBQaNF4Zkvsk1XzzhCE3NPjpWPxqjQaE8g \ud14c\uc2a4\ud2b8 \uacfc\uc815\uc5d0\uc11c\ub294 \ud3b8\uc758\ub97c \uc704\ud574 \uc804\uccb4 \ud1a0\ud070 \uc2a4\ud2b8\ub9c1\uc744 dddaong.token \uc774\ub984\uc758 \ubcc4\ub3c4 \ud30c\uc77c\ub85c \uc800\uc7a5\ud588\uc2b5\ub2c8\ub2e4. echo 'eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjAwMDEifQ.eyJzdWIiOiJSUzI1Nk5QSUNURVNUIiwiYXVkIjoiZGRkYW9uZyIsImlhdCI6MTYxODI5NTEyMH0.kaJmcz1YLWOjBUrqMnPR8Kzh8nqG92GFMXYmpOVkjlx7NzxNZ_6e6gv6ziR9UhiiYOICqwwzpLUN9DerumGSRCNe6m_640oA0HnS1MkgSc9Q4V9g7DT66UpM4gfDC9WJlRoigolD8cXG5V479Dun3VOvKvwmDDr4NYMPSh8w-L056Lk6lqZEZktXjIYbTaB9S4gLWhbxsrA61C97Va71dbqKqDc0TJ0oTTCLtyRx3EzsfETGil44uMowfGGVb5Y_S5vojv_dwsFkmxjBH7EbvLsvRwYcahrqtxfF6YCXTwvnppxhI9iHWBQaNF4Zkvsk1XzzhCE3NPjpWPxqjQaE8g' > dddaong.token","title":"3. \ud14c\uc2a4\ud2b8\ub97c \uc704\ud55c JWT \uc0dd\uc131"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Plus-Ingress-Controller%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#4-1-ingress-resource","text":"","title":"4-1. Ingress Resource\uc5d0 \uc5f0\ub3d9"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Plus-Ingress-Controller%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#ingress-jwt-annotation","text":"JWT \uc778\uc99d\uc744 Ingress Resource\uc5d0 \uc5f0\ub3d9\ud560 \ub54c\ub294 Annotation \ud615\ud0dc\ub85c \uc815\uc758 \ub429\ub2c8\ub2e4. NPIC\uac00 \uc9c0\uc6d0\ud558\ub294 Annotation\uc740 \ub124 \uac00\uc9c0 \uc785\ub2c8\ub2e4. [\ud544\uc218] nginx.com/jwt-key: \"secret\" : JWT\ub97c \uc778\uc99d\ud560 Secret \ub9ac\uc18c\uc2a4\uc758 \uc774\ub984\uc744 \uc9c0\uc815\ud569\ub2c8\ub2e4. [\uc635\uc158] nginx.com/jwt-realm: \"realm\" : Realm \uba85\uc744 \uc9c0\uc815\ud569\ub2c8\ub2e4. [\uc635\uc158] nginx.com/jwt-token: \"token\" : JWT\uc758 \uc704\uce58\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4. \ubcc0\uc218\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. token : \uae30\ubcf8\uac12\uc774\uba70, Authorization \ud5e4\ub354\uc5d0\uc11c Bearer \ud1a0\ud070\uc744 \uc0ac\uc6a9\ud558\ub294 \ubc29\uc2dd\uc785\ub2c8\ub2e4. $http_*name* : JWT\uc758 \uc704\uce58\ub97c 'name' \ud5e4\ub354\ub85c \ubcc0\uacbd\ud569\ub2c8\ub2e4. $cookie_auth_token : JWT\uc758 \uc704\uce58\ub97c auth_token\uc774\ub77c\ub294 \uc774\ub984\uc758 cookie \uac12\uc73c\ub85c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. $arg_apijwt : JWT\uc758 \uc704\uce58\ub97c apijwt\ub77c\ub294 \uc774\ub984\uc758 Argument\uc758 \uac12\uc73c\ub85c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. [\uc635\uc158] nginx.com/jwt-login-url: \"url\" : JWT\uac00 \uc5c6\uac70\ub098 \uc720\ud6a8\ud558\uc9c0 \uc54a\uc740 \uacbd\uc6b0 Redirect\ud560 URL\uc744 \uc9c0\uc815\ud569\ub2c8\ub2e4. cookie_name \ubcc0\uc218\uc640 arg_name\uc758 \ubcc0\uc218 \uc774\ub984\uc740 lowercase\ub85c, - \ub294 _ \ub85c \ub300\uccb4\ub429\ub2c8\ub2e4. \ub354 \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 ngx_http_core_module \ubaa8\ub4c8\uc758 Embedded Variables \ub97c \ucc38\uc870\ud558\uba74 \uc88b\uc2b5\ub2c8\ub2e4.","title":"Ingress\uc758 JWT \uc778\uc99d \uc124\uc815 - Annotation\uc758 \uc0ac\uc6a9"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Plus-Ingress-Controller%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#ingress-resource-annotation-yaml","text":"apiVersion: networking.k8s.io/v1beta1 kind: Ingress metadata: name: cafe-ingress annotations: nginx.com/jwt-key: \"cafe-jwk\" nginx.com/jwt-realm: \"Cafe App\" nginx.com/jwt-token: \"$cookie_auth_token\" nginx.com/jwt-login-url: \"https://login.example.com\" spec: Ingress Resource \uad00\ub828\ud55c \uc774\uc0c1\uc758 \ub0b4\uc6a9\uc740 NGINX INC Github \ucc38\uace0 \ud398\uc774\uc9c0 \uc5d0 \uc608\uc2dc\uc640 \ud568\uaed8 \uc0c1\uc138\ud788 \uc124\uba85\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.","title":"Ingress Resource\uc758 Annotation \uc791\uc131 \uc0d8\ud50c (YAML)"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Plus-Ingress-Controller%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#ingress","text":"\ud14c\uc2a4\ud2b8\uc5d0 \uc0ac\uc6a9\ud55c Ingress \ub9ac\uc18c\uc2a4\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. apiVersion: networking.k8s.io/v1beta1 kind: Ingress metadata: name: dddaong-jwt-test annotations: nginx.com/jwt-key: \"dddaong-jwks\" nginx.com/jwt-realm: \"dddaong\" spec: rules: - host: auth-ing.test http: paths: - path: / backend: serviceName: coffee-svc servicePort: 80","title":"Ingress \ub9ac\uc18c\uc2a4 \uc0dd\uc131"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Plus-Ingress-Controller%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#ingress-jwt-test","text":"NPIC\uc758 Service \ub9ac\uc18c\uc2a4\uc758 ClusterIP\ub85c Curl \uba85\ub839\uc5b4\ub97c \ud1b5\ud574 \uc778\uc99d \uc5ec\ubd80\ub97c \ud655\uc778\ud569\ub2c8\ub2e4. Case : Authentication Failure curl -IvH 'host:auth-ing.test' http://10.97.46.125 * About to connect() to 10.97.46.125 port 80 (#0) * Trying 10.97.46.125... * Connected to 10.97.46.125 (10.97.46.125) port 80 (#0) > HEAD / HTTP/1.1 > User-Agent: curl/7.29.0 > Accept: */* > host:auth-ing.test > < HTTP/1.1 401 Unauthorized HTTP/1.1 401 Unauthorized < Server: nginx/1.19.5 Server: nginx/1.19.5 < Date: Tue, 13 Apr 2021 07:14:10 GMT Date: Tue, 13 Apr 2021 07:14:10 GMT < Content-Type: text/html Content-Type: text/html < Content-Length: 179 Content-Length: 179 < Connection: keep-alive Connection: keep-alive < WWW-Authenticate: Bearer realm=\"dddaong\" WWW-Authenticate: Bearer realm=\"dddaong\" < * Connection #0 to host 10.97.46.125 left intact Case : Authentication Success # curl -IvH 'host:auth-ing.test' -H \"Authorization: Bearer `cat dddaong.token`\" http://10.97.46.125 * About to connect() to 10.97.46.125 port 80 (#0) * Trying 10.97.46.125... * Connected to 10.97.46.125 (10.97.46.125) port 80 (#0) > HEAD / HTTP/1.1 > User-Agent: curl/7.29.0 > Accept: */* > host:auth-ing.test > Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjAwMDEifQ.eyJzdWIiOiJSUzI1Nk5QSUNURVNUIiwiYXVkIjoiZGRkYW9uZyIsImlhdCI6MTYxODI5NTEyMH0.kaJmcz1YLWOjBUrqMnPR8Kzh8nqG92GFMXYmpOVkjlx7NzxNZ_6e6gv6ziR9UhiiYOICqwwzpLUN9DerumGSRCNe6m_640oA0HnS1MkgSc9Q4V9g7DT66UpM4gfDC9WJlRoigolD8cXG5V479Dun3VOvKvwmDDr4NYMPSh8w-L056Lk6lqZEZktXjIYbTaB9S4gLWhbxsrA61C97Va71dbqKqDc0TJ0oTTCLtyRx3EzsfETGil44uMowfGGVb5Y_S5vojv_dwsFkmxjBH7EbvLsvRwYcahrqtxfF6YCXTwvnppxhI9iHWBQaNF4Zkvsk1XzzhCE3NPjpWPxqjQaE8g > < HTTP/1.1 200 OK HTTP/1.1 200 OK < Server: nginx/1.19.5 Server: nginx/1.19.5 < Date: Tue, 13 Apr 2021 07:15:00 GMT Date: Tue, 13 Apr 2021 07:15:00 GMT < Content-Type: text/plain Content-Type: text/plain < Content-Length: 157 Content-Length: 157 < Connection: keep-alive Connection: keep-alive < Expires: Tue, 13 Apr 2021 07:14:59 GMT Expires: Tue, 13 Apr 2021 07:14:59 GMT < Cache-Control: no-cache Cache-Control: no-cache < * Connection #0 to host 10.97.46.125 left intact","title":"Ingress JWT \uc778\uc99d TEST \uacb0\uacfc"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Plus-Ingress-Controller%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#4-2-virtualserver-crd","text":"","title":"4-2. VirtualServer Crd\uc5d0 \uc5f0\ub3d9"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Plus-Ingress-Controller%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#virtualserver-jwt-policy-crd","text":"JWT \uc778\uc99d\uc744 VirtualServer Resource\uc5d0 \uc5f0\ub3d9\ud560 \ub54c\ub294 \ubcc4\ub3c4\uc758 Policy \ub9ac\uc18c\uc2a4\ub85c \uc815\uc758 \ub429\ub2c8\ub2e4. JWT\uc758 \uc704\uce58 \ubcc0\uacbd (Header, Cookie, Argument) \uc5ed\uc2dc Policy\uc5d0\uc11c \uc124\uc815\ud569\ub2c8\ub2e4. \uc544\ub798\ub294 YAML \ud615\uc2dd\uc758 Policy Crd \uc0d8\ud50c\uc785\ub2c8\ub2e4. apiVersion: k8s.nginx.org/v1 kind: Policy metadata: name: jwk-auth spec: jwt: secret: dddaong-jwk-secret # Secret \ub9ac\uc18c\uc2a4 \uc774\ub984\uc744 \uc9c0\uc815\ud569\ub2c8\ub2e4. realm: \"myrealm\" # Realm \uc774\ub984\uc744 \uc9c0\uc815\ud569\ub2c8\ub2e4. token: $http_token # Token \uc704\uce58\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4. Ingress \ub9ac\uc18c\uc2a4\uc640 \ub9c8\ucc2c\uac00\uc9c0\ub85c Token \uc704\uce58\ub97c \ubcc4\ub3c4\ub85c \uc9c0\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc9c0\uc815\ud558\uc9c0 \uc54a\uc73c\uba74 \uae30\ubcf8\uac12\uc744 \uc0ac\uc6a9\ud558\uba70, \uae30\ubcf8\uac12\uc740 \ud45c\uc900 \ud5e4\ub354 Authorization: Bearer <token> \uc785\ub2c8\ub2e4. spec: jwt: secret: jwk-secret realm: \"myrealm\" token: $cookie_cookiename #$arg_argname \ub610\ub294 $http_headername \ub2e4\ub978 \uacbd\uc6b0\uc640 \ub9c8\ucc2c\uac00\uc9c0\ub85c \ubcc0\uc218 \uc774\ub984\uc740 lowercase\ub85c, - \ub294 _ \ub85c \ub300\uccb4\ub429\ub2c8\ub2e4. \ub354 \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 ngx_http_core_module \ubaa8\ub4c8\uc758 Embedded Variables \ub97c \ucc38\uc870\ud558\uba74 \uc88b\uc2b5\ub2c8\ub2e4.","title":"VirtualServer\uc758 JWT \uc778\uc99d \uc124\uc815 - Policy Crd \uc0ac\uc6a9"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Plus-Ingress-Controller%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#policy","text":"\uc778\uc99d \ud14c\uc2a4\ud2b8\uc5d0 \uc0ac\uc6a9\ud55c Policy Crd\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. apiVersion: k8s.nginx.org/v1 kind: Policy metadata: name: dddaong-jwk-auth spec: jwt: secret: dddaong-jwks realm: \"dddaong\" Policy\ub97c \uc544\ub798\uc640 \uac19\uc774 VirtualServer\uc5d0 \uc5f0\ub3d9\ud574\uc90d\ub2c8\ub2e4. apiVersion: k8s.nginx.org/v1 kind: VirtualServer metadata: name: dddaong-jwt-test spec: host: auth.test policies: - name: dddaong-jwk-auth upstreams: - name: coffee service: coffee-svc port: 80 routes: - path: / action: pass: coffee VirtualServer\uc758 upstream\uacfc routes \ubd80\ubd84\uc740 \ud14c\uc2a4\ud2b8\ud560 Application\uc5d0 \ub9de\uac8c \uc218\uc815\ud574\uc11c \uc0ac\uc6a9\ud558\uc2dc\uba74 \ub429\ub2c8\ub2e4.","title":"Policy \uc0dd\uc131"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NGINX-Plus-Ingress-Controller%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#virtualserver-jwt-test","text":"NPIC\uc758 Service \ub9ac\uc18c\uc2a4\uc758 ClusterIP\ub85c Curl \uba85\ub839\uc5b4\ub97c \ud1b5\ud574 \uc778\uc99d \uc5ec\ubd80\ub97c \ud655\uc778\ud569\ub2c8\ub2e4. Case : Authentication Failure [root@kube-master jwt]# curl -IvH 'host:auth.test' http://10.97.46.125 * About to connect() to 10.97.46.125 port 80 (#0) * Trying 10.97.46.125... * Connected to 10.97.46.125 (10.97.46.125) port 80 (#0) > HEAD / HTTP/1.1 > User-Agent: curl/7.29.0 > Accept: */* > host:auth.test > < HTTP/1.1 401 Unauthorized HTTP/1.1 401 Unauthorized < Server: nginx/1.19.5 Server: nginx/1.19.5 < Date: Tue, 13 Apr 2021 07:04:59 GMT Date: Tue, 13 Apr 2021 07:04:59 GMT < Content-Type: text/html Content-Type: text/html < Content-Length: 179 Content-Length: 179 < Connection: keep-alive Connection: keep-alive < WWW-Authenticate: Bearer realm=\"dddaong\" WWW-Authenticate: Bearer realm=\"dddaong\" < * Connection #0 to host 10.97.46.125 left intact Case : Authentication Success # curl -IvH 'host:auth.test' -H \"Authorization: Bearer `cat dddaong.token`\" http://10.97.46.125 * About to connect() to 10.97.46.125 port 80 (#0) * Trying 10.97.46.125... * Connected to 10.97.46.125 (10.97.46.125) port 80 (#0) > HEAD / HTTP/1.1 > User-Agent: curl/7.29.0 > Accept: */* > host:auth.test > Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjAwMDEifQ.eyJzdWIiOiJSUzI1Nk5QSUNURVNUIiwiYXVkIjoiZGRkYW9uZyIsImlhdCI6MTYxODI5NTEyMH0.kaJmcz1YLWOjBUrqMnPR8Kzh8nqG92GFMXYmpOVkjlx7NzxNZ_6e6gv6ziR9UhiiYOICqwwzpLUN9DerumGSRCNe6m_640oA0HnS1MkgSc9Q4V9g7DT66UpM4gfDC9WJlRoigolD8cXG5V479Dun3VOvKvwmDDr4NYMPSh8w-L056Lk6lqZEZktXjIYbTaB9S4gLWhbxsrA61C97Va71dbqKqDc0TJ0oTTCLtyRx3EzsfETGil44uMowfGGVb5Y_S5vojv_dwsFkmxjBH7EbvLsvRwYcahrqtxfF6YCXTwvnppxhI9iHWBQaNF4Zkvsk1XzzhCE3NPjpWPxqjQaE8g > < HTTP/1.1 200 OK HTTP/1.1 200 OK < Server: nginx/1.19.5 Server: nginx/1.19.5 < Date: Tue, 13 Apr 2021 07:06:11 GMT Date: Tue, 13 Apr 2021 07:06:11 GMT < Content-Type: text/plain Content-Type: text/plain < Content-Length: 157 Content-Length: 157 < Connection: keep-alive Connection: keep-alive < Expires: Tue, 13 Apr 2021 07:06:10 GMT Expires: Tue, 13 Apr 2021 07:06:10 GMT < Cache-Control: no-cache Cache-Control: no-cache < * Connection #0 to host 10.97.46.125 left intact \ubcc4\ub3c4 \ucc38\uc870... - HS256 JWT \uc0dd\uc131\uae30","title":"VirtualServer JWT \uc778\uc99d TEST \uacb0\uacfc"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NPIC%EC%97%90%EC%84%9C-VS-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0/","text":"NPIC\uc5d0\uc11c VirtualServer Crd\ub85c Lua \uc0ac\uc6a9\ud558\uae30 NPIC\uc5d0\uc11c VirtualServer Crd\ub85c Lua \uc0ac\uc6a9\ud558\uae30 \u00b6 1. NGINX Ingress Controller\uc758 Virtual Server \u00b6 Virtual Server\ub294 Ingress\ub97c \ub300\uccb4\ud560 \uc218 \uc788\ub294 \ucee4\uc2a4\ud140 \ub9ac\uc18c\uc2a4 \uc785\ub2c8\ub2e4. Kubernetes\uc758 \uae30\ubcf8\uac12\uc778 Ingress \ub9ac\uc18c\uc2a4\uc5d0\uc11c\ub294 \uc9c0\uc6d0\ud558\uc9c0 \uc54a\ub294 NGINX\uc758 \uae30\ub2a5\uc744 \uc2ed\ubd84 \ud65c\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ud574\uc90d\ub2c8\ub2e4. NGINX.com - References NGINX Inc Github - YAML Examples 2. Virtualserver YAML Sample \u00b6 VirtualServer YAML \ud30c\uc77c\uc740 NGINX Conf\uc5d0 \ub9e4\uce6d\ub418\ub294 \ud615\uc2dd\uc73c\ub85c \uad6c\uc131\ub429\ub2c8\ub2e4. apiVersion: k8s.nginx.org/v1 kind: VirtualServer metadata: name: cafe spec: host: cafe.example.com # NGINX Conf server_name\uc5d0 \ud574\ub2f9 tls: # NGINX Conf ssl_certificate, ssl_certificate_key\uc5d0 \ud574\ub2f9 secret: cafe-secret ingressClassName: # ingressClass \uc120\ud0dd \uac00\ub2a5 http-snippet: | # NGINX Conf - HTTP Block \ub0b4 \uc635\uc158 \uc791\uc131 \uac00\ub2a5 server-snippet: | # NGINX Conf - Server Block \ub0b4 \uc635\uc158 \uc791\uc131 \uac00\ub2a5 policies: # Policy Crd \uc5f0\ub3d9 - name: custom-policy upstreams: # NGINX Conf upstream\uc5d0 \ud574\ub2f9, LB \ub300\uc0c1 \uc11c\ube44\uc2a4 Pool - name: upstream-member service: upstream-member-svc port: 80 routes: # NGINX Conf Location Block\uc5d0 \ud574\ub2f9 - path: /svc action: pass: upstream-member-svc # NGINX Conf Proxy_pass\uc5d0 \ud574\ub2f9 - path: ~ ^/decaf/.*\\\\.jpg$ action: pass: coffee - path: = /green/tea action: pass: tea Main Snippet\uc744 \uc81c\uc678\ud55c http, server Snippet (NGINX Conf \ud615\uc2dd) \uc791\uc131\uc774 \uac00\ub2a5\ud569\ub2c8\ub2e4. VirtualServer.spec.path \uc544\ub798 Location Snippet \uc791\uc131\ub3c4 \uac00\ub2a5\ud569\ub2c8\ub2e4. Policies Crd \ud56d\ubaa9\uc5d0\uc11c\ub294 AccessControl, RateLimit, JWT \uc778\uc99d, Multiple TLS, WAF(N+ AppProtect) \ub4f1\uc758 \uc124\uc815\uc744 \uc9c0\uc815\ud574 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. NGINX Policy Crd Reference 3. Test \u00b6 NGINX Ingress Controller - lua_package_path \ud14c\uc2a4\ud2b8 \ud3ec\uc2a4\ud2b8\uc758 \ud14c\uc2a4\ud2b8 \ud658\uacbd\uc5d0\uc11c ingress\ub97c VS\ub85c \ub300\uccb4\ud558\ub294 \ud14c\uc2a4\ud2b8\uc785\ub2c8\ub2e4. HostPath - Volume \uc124\uc815\uc740 NGINX Ingress Controller - lua_package_path \ud14c\uc2a4\ud2b8 \uc640 \ub3d9\uc77c\ud558\uac8c \uc720\uc9c0 \ud588\uc2b5\ub2c8\ub2e4. nginx-config ConfigMap \ub9ac\uc18c\uc2a4\uc5d0\uc11c main-snippet\uc740 \uc720\uc9c0\ud558\uace0, http-snippets \ud56d\ubaa9\uc744 \uc0ad\uc81c\ud569\ub2c8\ub2e4.(\uc0dd\uc131\ud560 VirtualServer \ub9ac\uc18c\uc2a4\uc5d0 \uc791\uc131\ud569\ub2c8\ub2e4.) ```yaml #kubectl edit cm nginx-config data: main-snippets: | load_module /etc/nginx/modules/ndk_http_module.so; load_module /etc/nginx/modules/ngx_http_lua_module.so; load_module /etc/nginx/modules/ngx_stream_lua_module.so; load_module /etc/nginx/modules/ngx_http_encrypted_session_module.so; load_module /etc/nginx/modules/ngx_http_set_misc_module.so; load_module /etc/nginx/modules/ngx_http_cookie_flag_filter_module.so; load_module /etc/nginx/modules/ngx_http_headers_more_filter_module.so; ``` VS\ub85c \ub300\uccb4\ud560 ingress \ub9ac\uc18c\uc2a4\ub294 \uc0ad\uc81c\ud569\ub2c8\ub2e4. bash kubectl delete ingress lua-server VirtualServer\uc758 Snippet\uc740 \uc544\ub798 \ub2e8\uc810 \ub54c\ubb38\uc5d0 \uae30\ubcf8\uac12\uc73c\ub85c Disabled \ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \ubcf5\uc7a1\uc131\uc774 \uc99d\uac00\ud569\ub2c8\ub2e4. Snippet \ub0b4\uc6a9\uc758 \uc720\ud6a8\uc131\uae4c\uc9c0 \uccb4\ud06c\ud558\uc9c0 \ubabb\ud558\uae30 \ub54c\ubb38\uc5d0 Ingress Controller\uc758 Config Reload \uc624\ub958\ub97c \uc720\ubc1c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Conf \ud30c\uc77c\uc5d0 \uc9c1\uc811\uc801\uc778 \ud3b8\uc9d1\uc774 \uac00\ub2a5\ud55c \uac83\uc740 \uc7a0\uc7ac\uc801\uc73c\ub85c \ubcf4\uc548\uc801 \uc704\ud611\uc774 \ub420 \uc218 \uc788\ub2e4\uace0 \ud569\ub2c8\ub2e4. \ub530\ub77c\uc11c \uc544\ub798 \ubc29\ubc95\uc73c\ub85c enable-snippets Argument\ub97c Enable\ub85c \uc218\uc815\ud574\uc90d\ub2c8\ub2e4. #kubectl edit deployments.apps dddaong-nginx-ingress ...[ommitted] spec: template: spec: containers: - args: - -enable-snippets=true [ommitted] ... VirtualServer\ub294 Listen Port\ub97c \uc218\uc815\ud560 \uc218 \uc5c6\ub294 \uac83\uc73c\ub85c \ubcf4\uc785\ub2c8\ub2e4. (TCP/UDP \uc11c\ube44\uc2a4\ub97c \uc704\ud55c TransportServer Crd\uc758 \uacbd\uc6b0\uc5d0 Listen Port\ub97c \uc9c0\uc815\ud560 \uc218 \uc788\ub294 \uac83\uc73c\ub85c \ubcf4\uc785\ub2c8\ub2e4.) 80 (http) \ud3ec\ud2b8\ub97c \uc0ac\uc6a9\ud558\ub418, \uad73\uc774 Service \ub9ac\uc18c\uc2a4\uc758 8888 \ud3ec\ud2b8\ub97c \uc0ad\uc81c\ud558\uc9c4 \uc54a\uace0 \uadf8\ub300\ub85c \uc0ac\uc6a9\ud588\uc2b5\ub2c8\ub2e4. NGINX Ingress Controller - lua_package_path \ud14c\uc2a4\ud2b8 \ud3ec\uc2a4\ud2b8\uc758 ingress \ub9ac\uc18c\uc2a4\ub97c \ub300\uccb4\ud560 VirtualServer YAML\uc744 \uc544\ub798\uc640 \uac19\uc774 \uc791\uc131\ud588\uc2b5\ub2c8\ub2e4. apiVersion: k8s.nginx.org/v1 kind: VirtualServer metadata: name: hello-lua spec: http-snippets: | lua_package_path \"/var/tmp/?.lua;;\"; host: hello-lua.test upstreams: - name: lua-server service: dddaong-nginx-ingress port: 80 server-snippets: | location / { default_type text/plain; content_by_lua_block { local hello = require \"hello\" hello.greet(\"a lua module\") } } routes: - path: /lua action: return: code: 200 type: text/plain body: \"Dummy Response Text\\n\" kubectl apply -f vs-hello-lua.yaml \ub85c \uc801\uc6a9\ud574\uc90d\ub2c8\ub2e4. \uc801\uc6a9 \ud6c4 \uc0dd\uc131\ub41c Conf \ud30c\uc77c\uc744 \ud655\uc778\ud569\ub2c8\ub2e4. kubectl exec -it [nginx-ingress Podname] -- cat /etc/nginx/conf.d/vs_default_hello-lua.conf | egrep -v ^[[:space:]]*$ \uacb0\uacfc\uac00 \uc544\ub798\uc640 \uac19\uc774 \ub098\ud0c0\ub098\uba74 \uc798 \uc801\uc6a9\ub41c \uac83 \uc785\ub2c8\ub2e4. nginx/conf.d/vs_default_hello-lua.conf | egrep -v ^[[:space:]]*$ upstream vs_default_hello-lua_lua-server { zone vs_default_hello-lua_lua-server 256k; random two least_conn; server 192.168.225.223:80 max_fails=1 fail_timeout=10s max_conns=0; } lua_package_path \"/var/tmp/?.lua;;\"; server { listen 80; server_name hello-lua.test; status_zone hello-lua.test; set $resource_type \"virtualserver\"; set $resource_name \"hello-lua\"; set $resource_namespace \"default\"; server_tokens \"on\"; location / { default_type text/plain; content_by_lua_block { local hello = require \"hello\" hello.greet(\"a lua module\") } } location @return_0 { default_type \"text/plain\"; # status code is ignored here, using 0 return 0 \"Dummy Response Text \"; } location /lua { set $service \"\"; error_page 418 =200 \"@return_0\"; proxy_intercept_errors on; proxy_pass http://unix:/var/lib/nginx/nginx-418-server.sock; } } 4. Test \uc218\ud589 \ubc0f \uacb0\uacfc \u00b6 curl -H host:hello-lua.test http://<Pod IP> curl -H host:hello-lua.test http://<Svc ClusterIP> curl -H host:hello-lua.test http://<Node IP>:30080 \uacb0\uacfc\uac00 \ubaa8\ub450 Greetings from a lua module \ub85c \ub098\uc624\uba74 \uc131\uacf5\uc785\ub2c8\ub2e4. \ucc38\uace0\ub85c, curl -H host:hello-lua.test http://<Node IP>:30080/lua \ub85c Curl\uc744 \ud558\uba74 'Dummy Response text'\ub77c\ub294 \ud14d\uc2a4\ud2b8\ub97c \uc751\ub2f5\uc73c\ub85c \ubc18\ud658\ud569\ub2c8\ub2e4. \uc774 \ub3d9\uc791\uc740 VirtualServer YAML\uc758 'Action' \ubd80\ubd84 \ub54c\ubb38\uc778\ub370, Action\uc744 \uc791\uc131\ud558\uc9c0 \uc54a\uc73c\uba74 Validation\uc5d0 \uc758\ud574 Config\uac00 Refect\ub418\uae30 \ub54c\ubb38\uc5d0 \uc784\uc758\uc758 Location\uc744 \uc791\uc131\ud55c \uac83\uc785\ub2c8\ub2e4.","title":"NGINX+ Ingress Controller - VS Crd\ub85c Lua \uc0ac\uc6a9"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NPIC%EC%97%90%EC%84%9C-VS-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0/#npic-virtualserver-crd-lua","text":"","title":"NPIC\uc5d0\uc11c VirtualServer Crd\ub85c Lua \uc0ac\uc6a9\ud558\uae30"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NPIC%EC%97%90%EC%84%9C-VS-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0/#1-nginx-ingress-controller-virtual-server","text":"Virtual Server\ub294 Ingress\ub97c \ub300\uccb4\ud560 \uc218 \uc788\ub294 \ucee4\uc2a4\ud140 \ub9ac\uc18c\uc2a4 \uc785\ub2c8\ub2e4. Kubernetes\uc758 \uae30\ubcf8\uac12\uc778 Ingress \ub9ac\uc18c\uc2a4\uc5d0\uc11c\ub294 \uc9c0\uc6d0\ud558\uc9c0 \uc54a\ub294 NGINX\uc758 \uae30\ub2a5\uc744 \uc2ed\ubd84 \ud65c\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ud574\uc90d\ub2c8\ub2e4. NGINX.com - References NGINX Inc Github - YAML Examples","title":"1. NGINX Ingress Controller\uc758 Virtual Server"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NPIC%EC%97%90%EC%84%9C-VS-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0/#2-virtualserver-yaml-sample","text":"VirtualServer YAML \ud30c\uc77c\uc740 NGINX Conf\uc5d0 \ub9e4\uce6d\ub418\ub294 \ud615\uc2dd\uc73c\ub85c \uad6c\uc131\ub429\ub2c8\ub2e4. apiVersion: k8s.nginx.org/v1 kind: VirtualServer metadata: name: cafe spec: host: cafe.example.com # NGINX Conf server_name\uc5d0 \ud574\ub2f9 tls: # NGINX Conf ssl_certificate, ssl_certificate_key\uc5d0 \ud574\ub2f9 secret: cafe-secret ingressClassName: # ingressClass \uc120\ud0dd \uac00\ub2a5 http-snippet: | # NGINX Conf - HTTP Block \ub0b4 \uc635\uc158 \uc791\uc131 \uac00\ub2a5 server-snippet: | # NGINX Conf - Server Block \ub0b4 \uc635\uc158 \uc791\uc131 \uac00\ub2a5 policies: # Policy Crd \uc5f0\ub3d9 - name: custom-policy upstreams: # NGINX Conf upstream\uc5d0 \ud574\ub2f9, LB \ub300\uc0c1 \uc11c\ube44\uc2a4 Pool - name: upstream-member service: upstream-member-svc port: 80 routes: # NGINX Conf Location Block\uc5d0 \ud574\ub2f9 - path: /svc action: pass: upstream-member-svc # NGINX Conf Proxy_pass\uc5d0 \ud574\ub2f9 - path: ~ ^/decaf/.*\\\\.jpg$ action: pass: coffee - path: = /green/tea action: pass: tea Main Snippet\uc744 \uc81c\uc678\ud55c http, server Snippet (NGINX Conf \ud615\uc2dd) \uc791\uc131\uc774 \uac00\ub2a5\ud569\ub2c8\ub2e4. VirtualServer.spec.path \uc544\ub798 Location Snippet \uc791\uc131\ub3c4 \uac00\ub2a5\ud569\ub2c8\ub2e4. Policies Crd \ud56d\ubaa9\uc5d0\uc11c\ub294 AccessControl, RateLimit, JWT \uc778\uc99d, Multiple TLS, WAF(N+ AppProtect) \ub4f1\uc758 \uc124\uc815\uc744 \uc9c0\uc815\ud574 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. NGINX Policy Crd Reference","title":"2. Virtualserver YAML Sample"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NPIC%EC%97%90%EC%84%9C-VS-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0/#3-test","text":"NGINX Ingress Controller - lua_package_path \ud14c\uc2a4\ud2b8 \ud3ec\uc2a4\ud2b8\uc758 \ud14c\uc2a4\ud2b8 \ud658\uacbd\uc5d0\uc11c ingress\ub97c VS\ub85c \ub300\uccb4\ud558\ub294 \ud14c\uc2a4\ud2b8\uc785\ub2c8\ub2e4. HostPath - Volume \uc124\uc815\uc740 NGINX Ingress Controller - lua_package_path \ud14c\uc2a4\ud2b8 \uc640 \ub3d9\uc77c\ud558\uac8c \uc720\uc9c0 \ud588\uc2b5\ub2c8\ub2e4. nginx-config ConfigMap \ub9ac\uc18c\uc2a4\uc5d0\uc11c main-snippet\uc740 \uc720\uc9c0\ud558\uace0, http-snippets \ud56d\ubaa9\uc744 \uc0ad\uc81c\ud569\ub2c8\ub2e4.(\uc0dd\uc131\ud560 VirtualServer \ub9ac\uc18c\uc2a4\uc5d0 \uc791\uc131\ud569\ub2c8\ub2e4.) ```yaml #kubectl edit cm nginx-config data: main-snippets: | load_module /etc/nginx/modules/ndk_http_module.so; load_module /etc/nginx/modules/ngx_http_lua_module.so; load_module /etc/nginx/modules/ngx_stream_lua_module.so; load_module /etc/nginx/modules/ngx_http_encrypted_session_module.so; load_module /etc/nginx/modules/ngx_http_set_misc_module.so; load_module /etc/nginx/modules/ngx_http_cookie_flag_filter_module.so; load_module /etc/nginx/modules/ngx_http_headers_more_filter_module.so; ``` VS\ub85c \ub300\uccb4\ud560 ingress \ub9ac\uc18c\uc2a4\ub294 \uc0ad\uc81c\ud569\ub2c8\ub2e4. bash kubectl delete ingress lua-server VirtualServer\uc758 Snippet\uc740 \uc544\ub798 \ub2e8\uc810 \ub54c\ubb38\uc5d0 \uae30\ubcf8\uac12\uc73c\ub85c Disabled \ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \ubcf5\uc7a1\uc131\uc774 \uc99d\uac00\ud569\ub2c8\ub2e4. Snippet \ub0b4\uc6a9\uc758 \uc720\ud6a8\uc131\uae4c\uc9c0 \uccb4\ud06c\ud558\uc9c0 \ubabb\ud558\uae30 \ub54c\ubb38\uc5d0 Ingress Controller\uc758 Config Reload \uc624\ub958\ub97c \uc720\ubc1c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Conf \ud30c\uc77c\uc5d0 \uc9c1\uc811\uc801\uc778 \ud3b8\uc9d1\uc774 \uac00\ub2a5\ud55c \uac83\uc740 \uc7a0\uc7ac\uc801\uc73c\ub85c \ubcf4\uc548\uc801 \uc704\ud611\uc774 \ub420 \uc218 \uc788\ub2e4\uace0 \ud569\ub2c8\ub2e4. \ub530\ub77c\uc11c \uc544\ub798 \ubc29\ubc95\uc73c\ub85c enable-snippets Argument\ub97c Enable\ub85c \uc218\uc815\ud574\uc90d\ub2c8\ub2e4. #kubectl edit deployments.apps dddaong-nginx-ingress ...[ommitted] spec: template: spec: containers: - args: - -enable-snippets=true [ommitted] ... VirtualServer\ub294 Listen Port\ub97c \uc218\uc815\ud560 \uc218 \uc5c6\ub294 \uac83\uc73c\ub85c \ubcf4\uc785\ub2c8\ub2e4. (TCP/UDP \uc11c\ube44\uc2a4\ub97c \uc704\ud55c TransportServer Crd\uc758 \uacbd\uc6b0\uc5d0 Listen Port\ub97c \uc9c0\uc815\ud560 \uc218 \uc788\ub294 \uac83\uc73c\ub85c \ubcf4\uc785\ub2c8\ub2e4.) 80 (http) \ud3ec\ud2b8\ub97c \uc0ac\uc6a9\ud558\ub418, \uad73\uc774 Service \ub9ac\uc18c\uc2a4\uc758 8888 \ud3ec\ud2b8\ub97c \uc0ad\uc81c\ud558\uc9c4 \uc54a\uace0 \uadf8\ub300\ub85c \uc0ac\uc6a9\ud588\uc2b5\ub2c8\ub2e4. NGINX Ingress Controller - lua_package_path \ud14c\uc2a4\ud2b8 \ud3ec\uc2a4\ud2b8\uc758 ingress \ub9ac\uc18c\uc2a4\ub97c \ub300\uccb4\ud560 VirtualServer YAML\uc744 \uc544\ub798\uc640 \uac19\uc774 \uc791\uc131\ud588\uc2b5\ub2c8\ub2e4. apiVersion: k8s.nginx.org/v1 kind: VirtualServer metadata: name: hello-lua spec: http-snippets: | lua_package_path \"/var/tmp/?.lua;;\"; host: hello-lua.test upstreams: - name: lua-server service: dddaong-nginx-ingress port: 80 server-snippets: | location / { default_type text/plain; content_by_lua_block { local hello = require \"hello\" hello.greet(\"a lua module\") } } routes: - path: /lua action: return: code: 200 type: text/plain body: \"Dummy Response Text\\n\" kubectl apply -f vs-hello-lua.yaml \ub85c \uc801\uc6a9\ud574\uc90d\ub2c8\ub2e4. \uc801\uc6a9 \ud6c4 \uc0dd\uc131\ub41c Conf \ud30c\uc77c\uc744 \ud655\uc778\ud569\ub2c8\ub2e4. kubectl exec -it [nginx-ingress Podname] -- cat /etc/nginx/conf.d/vs_default_hello-lua.conf | egrep -v ^[[:space:]]*$ \uacb0\uacfc\uac00 \uc544\ub798\uc640 \uac19\uc774 \ub098\ud0c0\ub098\uba74 \uc798 \uc801\uc6a9\ub41c \uac83 \uc785\ub2c8\ub2e4. nginx/conf.d/vs_default_hello-lua.conf | egrep -v ^[[:space:]]*$ upstream vs_default_hello-lua_lua-server { zone vs_default_hello-lua_lua-server 256k; random two least_conn; server 192.168.225.223:80 max_fails=1 fail_timeout=10s max_conns=0; } lua_package_path \"/var/tmp/?.lua;;\"; server { listen 80; server_name hello-lua.test; status_zone hello-lua.test; set $resource_type \"virtualserver\"; set $resource_name \"hello-lua\"; set $resource_namespace \"default\"; server_tokens \"on\"; location / { default_type text/plain; content_by_lua_block { local hello = require \"hello\" hello.greet(\"a lua module\") } } location @return_0 { default_type \"text/plain\"; # status code is ignored here, using 0 return 0 \"Dummy Response Text \"; } location /lua { set $service \"\"; error_page 418 =200 \"@return_0\"; proxy_intercept_errors on; proxy_pass http://unix:/var/lib/nginx/nginx-418-server.sock; } }","title":"3. Test"},{"location":"NGINX-Plus/NGINX-Ingress-Ctlr/NPIC%EC%97%90%EC%84%9C-VS-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0/#4-test","text":"curl -H host:hello-lua.test http://<Pod IP> curl -H host:hello-lua.test http://<Svc ClusterIP> curl -H host:hello-lua.test http://<Node IP>:30080 \uacb0\uacfc\uac00 \ubaa8\ub450 Greetings from a lua module \ub85c \ub098\uc624\uba74 \uc131\uacf5\uc785\ub2c8\ub2e4. \ucc38\uace0\ub85c, curl -H host:hello-lua.test http://<Node IP>:30080/lua \ub85c Curl\uc744 \ud558\uba74 'Dummy Response text'\ub77c\ub294 \ud14d\uc2a4\ud2b8\ub97c \uc751\ub2f5\uc73c\ub85c \ubc18\ud658\ud569\ub2c8\ub2e4. \uc774 \ub3d9\uc791\uc740 VirtualServer YAML\uc758 'Action' \ubd80\ubd84 \ub54c\ubb38\uc778\ub370, Action\uc744 \uc791\uc131\ud558\uc9c0 \uc54a\uc73c\uba74 Validation\uc5d0 \uc758\ud574 Config\uac00 Refect\ub418\uae30 \ub54c\ubb38\uc5d0 \uc784\uc758\uc758 Location\uc744 \uc791\uc131\ud55c \uac83\uc785\ub2c8\ub2e4.","title":"4. Test \uc218\ud589 \ubc0f \uacb0\uacfc"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/","text":"NGINX Plus\ub85c \uac04\ub7b5\ud55c JWT \uc778\uc99d \ud14c\uc2a4\ud2b8\ub97c \uc218\ud589\ud569\ub2c8\ub2e4. NGINX Plus + JWT \uc778\uc99d \ud14c\uc2a4\ud2b8 \u00b6 NGINX\uc758 JWT Validation Supports \u00b6 NGINX Plus\ub294 R10 \ubc84\uc804\ubd80\ud130 Native JWT Validation\uc744 \uc9c0\uc6d0\ud558\uba70, NGINX OSS\uc5d0\uc11c\ub294 lua-resty-openidc \ub4f1 \uc678\ubd80 \ubaa8\ub4c8 \uc0ac\uc6a9\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. NGINX Plus \ub294 \ud45c\uc900\uc5d0 \uc815\uc758\ub41c HSxxx , RSxxx , and ESxxx signature algorithms \uc744 \uc9c0\uc6d0\ud569\ub2c8\ub2e4. Sample Config : NGINX Plus JWT Authentication Config \u00b6 \uc544\ub798\ub294 Nginx Plus r17 Release \uc5d0\uc11c \ubc1c\ucdcc\ud55c NGINX Plus Config \uc608\uc2dc\uc785\ub2c8\ub2e4. # Create a directory to cache the keys received from IdP proxy_cache_path /var/cache/nginx/jwk levels=1 keys_zone=jwk:1m max_size=10m; server { listen 80; # Use SSL/TLS in production location / { auth_jwt \"closed site\"; auth_jwt_key_request /_jwks_uri; # Keys will be fetched by subrequest proxy_pass http://my_backend; } location = /_jwks_uri { internal; proxy_method GET; proxy_cache jwk; # Cache responses proxy_pass https://idp.example.com/oauth2/keys; # Obtain keys from here } } \uc774 Config\ub294 auth_jwt_key_file \ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0 auth_jwt_key_request Directive\ub97c \uc0ac\uc6a9\ud574 JWK\ub97c Remote Location\uc5d0\uc11c \uac00\uc838\uc624\ub3c4\ub85d \uc791\uc131\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uc774 Config\uc5d0\uc11c Remote Location\uc740 proxy_pass \uc5d0 \uc815\uc758\ub41c IdP URI\uc785\ub2c8\ub2e4. (\ub300\ubd80\ubd84\uc758 idP\ub294 Key Set\uc744 \uac00\uc838\uc62c \uc218 \uc788\ub294 URL\uc744 \uc81c\uacf5\ud55c\ub2e4\uace0 \ud569\ub2c8\ub2e4.) Client Request\ub97c \uc218\uc2e0\ud558\uba74 auth_jet_key_request Directive\uc5d0 \uc758\ud574 /_jwk_uri \ube14\ub85d\uc73c\ub85c Subrequest\ub97c \ubcf4\ub0c5\ub2c8\ub2e4. /_jwk_uri \ube14\ub85d\uc758 proxy_pass\uc5d0 \uc758\ud574 idP\uc758 \uace0\uc815 URL\ub85c Subrequest\uac00 \uc804\ub2ec\ub418\uace0, \uc751\ub2f5\uc73c\ub85c Key Set\uc744 \uc218\uc2e0\ud569\ub2c8\ub2e4. /_jwk_uri Location \ube14\ub85d\uc740 internal Directive\ub97c \uc0ac\uc6a9\ud574 \uc678\ubd80\uc5d0\uc11c\ub294 \uc811\uadfc\ud560 \uc218 \uc5c6\ub3c4\ub85d \ud569\ub2c8\ub2e4. \uc218\uc2e0\ud55c Key Set\uc744 proxy_cache Directive\ub85c jwk keys_zone \uc5d0 \uce90\uc2dc\ud558\uc5ec, Validation Overhead\ub97c \uc904\uc5ec\uc904 \uc218 \uc788\ub3c4\ub85d \ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uc774 Config\ub294 auth_jwt \"closed site\"; \uc5d0\uc11c \uae30\ubcf8\uac12\uc778 Bearer Token\uc744 \uc0ac\uc6a9\ud558\uace0, realm\ub9cc \uc791\uc131\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. JWT\ub294 \uc77c\ubc18\uc801\uc73c\ub85c Authorization \ud5e4\ub354\uc5d0 Bearer Token\uc73c\ub85c \uc778\uc99d \uc694\uccad\ub418\uc9c0\ub9cc, Cookie, Query String\uc73c\ub85c \uc0ac\uc6a9\ub420 \uc218 \uc788\ub3c4\ub85d, auth_jwt Directive\uc5d0\uc11c \uc138\ubd80 \uc124\uc815\uc774 \uac00\ub2a5\ud558\ub3c4\ub85d \ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. nginx auth_jwt string [token=$variable] | off; \uc608\ub97c \ub4e4\uc5b4 \uc544\ub798\uc640 \uac19\uc774 Query String\uc744 \ud1b5\ud574 Token \uc778\uc99d \uc694\uccad\uc744 \uc0ac\uc6a9\ud558\ub824\uba74 curl http://192.168.1.1/products/widget1?apijwt=xxxxxxxxxxxxxxxxxxxxx... string\uc744 realm \uba85, \ud1a0\ud070\uc744 apijwt Argument\uc758 Value\ub97c \ucc38\uc870\ud558\ub3c4\ub85d \ud569\ub2c8\ub2e4. nginx auth_jwt \"API\" token=$arg_apijwt; \ucc38\uace0\ub85c, $arg_name \uacfc $cookie_name \ubcc0\uc218\ub294 ngx_http_core_module \ubaa8\ub4c8\uc758 Embedded Variables \ub97c \ucc38\uc870\ud558\uba74 \ub429\ub2c8\ub2e4. NGINX Plus JWT Auth Test with RS256 \u00b6 NGINX Plus\uc5d0\uc11c JWT \uc778\uc99d \ud14c\uc2a4\ud2b8\ub97c \uae30\ub85d\ud55c \ub0b4\uc6a9\uc785\ub2c8\ub2e4. RSA Pub/Priv Key \uc0dd\uc131 - mkjwk.org \uc0ac\uc6a9 NGINX Plus\uc5d0\uc11c \uc0ac\uc6a9\ud560 JWK \ud30c\uc77c \uc791\uc131 - mkjwk.org \uc0ac\uc6a9 JWT \uc0dd\uc131 - jwt.io Debugger \uc0ac\uc6a9 JWK\uc640 JWT\ub97c \uc704\ud55c RSA256 \ud0a4 \uc0dd\uc131 \u00b6 \ud14c\uc2a4\ud2b8\uc5d0\uc11c\ub294 \ud3b8\uc758\ub97c \uc704\ud574 mkjwk JSON Web Key Generator \ub97c \uc0ac\uc6a9\ud588\uc2b5\ub2c8\ub2e4. \uc544\ub798\ub294 \uc0dd\uc131\uc2dc \uc120\ud0dd\ud55c \uc635\uc158\uc785\ub2c8\ub2e4. Tab Key Size Key Use Algorithm Key ID Show X.509 RSA 2048 Signature RS256 Specify [0001] Yes JWK \ud30c\uc77c \uc0dd\uc131 \u00b6 Public Key \ubc15\uc2a4\uc758 \ub0b4\uc6a9\uc744 \ubcf5\uc0ac\ud574 NGINX Plus\uac00 \ub3d9\uc791\ud558\uace0 \uc788\ub294 \ud638\uc2a4\ud2b8\uc5d0\uc11c vi /etc/nginx/conf.d/dddaong.jwk \ud30c\uc77c\ub85c \uc800\uc7a5\ud569\ub2c8\ub2e4. \uc544\ub798\ub294 \ud14c\uc2a4\ud2b8\uc5d0 \uc0ac\uc6a9\ud55c \uc0d8\ud50c\uc785\ub2c8\ub2e4. json { \"keys\": [{ \"kty\":\"RSA\", \"e\":\"AQAB\", \"use\":\"sig\", \"kid\":\"0001\", \"alg\":\"RS256\", \"n\":\"oS4lA_ePN4bmcaAM5AFnGVtzMmBBXoYxVGgNEtbhotDMkiIfhilRSH_IVktaDwdorEpQZxg66gwV0y5hZ4Nqo3wWxRVWKoVmdY0xQyPCtIHOs40FYVoc85vBU4giQnl_XqNHVnGOIZz7hiKgzzBBWiLFqgajzgvYN6QZBT0rb8OMj2u-iKQra9sHhlXBgg6W3YUE8BoPiDX2ehI35zXbsf4rI1IYeJvzEFLVcv6kHNJ7vSO0qDmVY4_m-0Kdi0KmJ_XZSNs7fRFwp1MYui9SXs-rZxrmHHES3xuTutJ5sJD6J2LgqkA8NgqhiTva-Dfyj08KVEj5RH1Af4F-bo6aBQ\" }] } JWT \uc0dd\uc131 \u00b6 JWT\ub294 jwt.io\uc758 Debugger\ub97c \uc0ac\uc6a9\ud558\uba74 \uac04\ub2e8\ud558\uac8c \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uba3c\uc800, Header\ub97c Base64url \uc778\ucf54\ub529\ud55c \uc2a4\ud2b8\ub9c1 + . + Payload\ub97c Base64url \uc778\ucf54\ub529\ud55c \uc2a4\ud2b8\ub9c1\uc744 \uc900\ube44\ud569\ub2c8\ub2e4. Header\uc640 Payload\ub97c \uac01\uac01 \uc791\uc131\ud574 Base64url \uc778\ucf54\ub529\ud569\ub2c8\ub2e4. HEAD=$(echo -n '{\"alg\":\"RS256\",\"typ\":\"JWT\",\"kid\":\"0001\"}' | base64 | sed s/\\+/-/ | sed -E s/=+$//) PAYLOAD=$(echo -n '{\"sub\":\"RS256TEST\",\"aud\":\"dddaong\",\"iat\": 1617778800}' | base64 | sed s/\\+/-/ | sed -E s/=+$//) echo \"$HEAD.$PAYLOAD\" \uacb0\uacfc\ubb3c\uc740 \uc544\ub798\uc640 \uac19\uc774 \ub098\uc635\ub2c8\ub2e4. eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJSUzI1NlRFU1QiLCJhdWQiOiJkZGRhb25nIn0 \uc0dd\uc131\ud55c \ub0b4\uc6a9\uc744 jwt.io Debugger \uc5d0 Encoded \ubd80\ubd84\uc5d0 \ubd99\uc5ec\ub123\uc2b5\ub2c8\ub2e4. jwt.io Debugger \uc6b0\uce21 Decoded\uc758 Verify Signature \ud56d\ubaa9\uc758 \uc544\ub798\ucabd \ubc15\uc2a4\uc5d0 mkjwk JSON Web Key Generator \uc5d0\uc11c \uc0dd\uc131\ud55c Private Key(X.509 PEM \ud3ec\ub9f7)\uc744 \ubd99\uc5ec\ub123\uc2b5\ub2c8\ub2e4. Private Key\ub97c \ubd99\uc5ec\ub123\ub294 \uc989\uc2dc Encoded\uc5d0 JWT\uac00 \uc644\uc131\ub418\uc5b4 \ub098\ud0c0\ub0a9\ub2c8\ub2e4. \uacb0\uacfc\ubb3c\uc740 \uc544\ub798\uc640 \uac19\uc774 \ub098\uc635\ub2c8\ub2e4. eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJSUzI1NlRFU1QiLCJhdWQiOiJkZGRhb25nIiwiaWF0IjoxNjE3Nzc4ODAwfQ.RgG2pJVjmNs0HRN13PRgI8lhVrZgCClbkA5JWgliewp0FJDqFE_B9HNUOQN_Iroj8s_bWRTSAVpCznVdHiT_4dCpRZxpYdZEYAx9PT0H5J-mj2rBUAJYy6OC7mIXFD11nF2uSId9oVMhaa_itvNOPiV5_rIYVjVOOQWEK08DwAkQJ-dMGf8BNAnWWcsCnHE8jyrKxCpINwGSVNVL65v2Dr66bhbY2uGYs658BXnq233TQMsnj_UdxQkAgFVkm1tnkqq-vPAGV662q22mICIjGDKWyj_abOsvDGaX4PwCxyv_zj0JhiTzhi5iL27WIxXf9Je03KOvsnDc67VFV-yOCA \ud655\uc778\uc744 \uc704\ud574 Public Key\ub85c Validation\uc744 \ud574\ubcf4\uaca0\uc2b5\ub2c8\ub2e4. \uc0dd\uc131\ud55c JWT \ubb38\uc790\uc5f4\uc744 \uba54\ubaa8\uc7a5 \ub4f1\uc5d0 \ub530\ub85c \ubcf4\uad00\ud574\ub461\ub2c8\ub2e4. \ud14c\uc2a4\ud2b8 \uacfc\uc815\uc5d0\uc11c\ub294 \ud3b8\uc758\ub97c \uc704\ud574 \ud1a0\ud070\uc758 \ub0b4\uc6a9\uc744 /etc/nginx/conf.d/dddaong.token \ud30c\uc77c\ub85c \uc800\uc7a5\ud588\uc2b5\ub2c8\ub2e4. bash echo \"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJSUzI1NlRFU1QiLCJhdWQiOiJkZGRhb25nIiwiaWF0IjoxNjE3Nzc4ODAwfQ.RgG2pJVjmNs0HRN13PRgI8lhVrZgCClbkA5JWgliewp0FJDqFE_B9HNUOQN_Iroj8s_bWRTSAVpCznVdHiT_4dCpRZxpYdZEYAx9PT0H5J-mj2rBUAJYy6OC7mIXFD11nF2uSId9oVMhaa_itvNOPiV5_rIYVjVOOQWEK08DwAkQJ-dMGf8BNAnWWcsCnHE8jyrKxCpINwGSVNVL65v2Dr66bhbY2uGYs658BXnq233TQMsnj_UdxQkAgFVkm1tnkqq-vPAGV662q22mICIjGDKWyj_abOsvDGaX4PwCxyv_zj0JhiTzhi5iL27WIxXf9Je03KOvsnDc67VFV-yOCA\" > /etc/nginx/conf.d/dddaong.token jwt.io Debugger \uc758 Decoded\uc5d0 \ubd99\uc5ec\ub123\uc740 Private Key\ub97c \uc9c0\uc6cc\uc90d\ub2c8\ub2e4. Private Key\ub97c \uc9c0\uc6b0\uba74 JWT String\ub3c4 \ubaa8\ub450 \uc0ac\ub77c\uc9d1\ub2c8\ub2e4. \ubcf4\uad00\ud55c JWT String\uc744 \ub2e4\uc2dc \ubd99\uc5ec\ub123\uc5b4 \uc90d\ub2c8\ub2e4. \uc774 \ubd80\ubd84\ub9cc \uc788\uc5b4\ub3c4 Header\uc640 Payload\uc758 \ub0b4\uc6a9\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. mkjwk JSON Web Key Generator \uc758 Public Key(X.509 PEM Format)\ub97c Decoded\uc758 Verify Signature \ud56d\ubaa9\uc758 \uc704\ucabd \ubc15\uc2a4\uc5d0 \ubd99\uc5ec\ub123\uc2b5\ub2c8\ub2e4. Debugger \uc67c\ucabd \ud558\ub2e8\uc5d0 \"Signature Verified\"\uac00 \ub098\ud0c0\ub098\uba74 \uc815\uc0c1\uc785\ub2c8\ub2e4. JWK\ub97c NGINX Plus\uc5d0 \uc801\uc6a9 \u00b6 NGINX Plus\ub97c \uc124\uce58\ud55c \ud6c4, /etc/nginx/conf.d/ \ub514\ub809\ud1a0\ub9ac \uc544\ub798 \ub0b4\uc6a9\uc758 conf \ud30c\uc77c\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4. \uc774 Config\ub294 \ud14c\uc2a4\ud2b8\ub97c \uc704\ud574 \uba87 \uac00\uc9c0 \ud655\uc778 \uae30\ub2a5\uc744 \ub123\uc5c8\uc2b5\ub2c8\ub2e4. Authorization \uc131\uacf5\uc2dc index.html \ud398\uc774\uc9c0\ub97c \ubc18\ud658, \uc2e4\ud328\uc2dc 50x.html \ud398\uc774\uc9c0\ub97c \ubc18\ud658 Access Log\uc5d0\uc11c \ud1a0\ud070 Payload\uc758 sub, aud Claim\uc758 \ub0b4\uc6a9 \ud655\uc778 \uac00\ub2a5 Error \ubc1c\uc0dd\uc2dc Error Log\uc5d0\uc11c \ud655\uc778 \uac00\ub2a5 map $jwt_claim_sub $jwt_sub { \"RS256TEST\" \"Authed\"; default \"CantReadSub\"; } map $jwt_claim_aud $jwt_aud { \"dddaong\" \"Authed\"; default \"CantReadAud\"; } log_format test_log '\"Request: $request\\n Status: $status\\n Request_URI: $request_uri\\n JWT Claim sub: $jwt_sub'\\n JWT Claim aud: $jwt_aud'\\n; server { listen 8080; access_log /etc/nginx/conf.d/jwt.access.log test_log; error_log /etc/nginx/conf.d/jwt.error.log debug; auth_jwt \"dddaong\"; auth_jwt_key_file conf.d/dddaong.jwk; location / { root /usr/share/nginx/html; index index.html index.htm; } error_page 400 401 403 500 502 503 504 /50x.html; location = /50x.html { auth_jwt off; root /usr/share/nginx/html; } } \ud14c\uc2a4\ud2b8 - Authentication Failure \u00b6 \uc774 Config\uac00 \uc801\uc6a9\ub41c \uc0c1\ud0dc\uc5d0\uc11c http://localhost:8080 \uc73c\ub85c \uc811\uadfc\ud558\uba74, \uc544\ub798\uc640 \uac19\uc774 401 Unauthorized\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4. curl -Iv http://localhost:8080 * About to connect() to localhost port 8080 (#0) * Trying ::1... * Connection refused * Trying 127.0.0.1... * Connected to localhost (127.0.0.1) port 8080 (#0) > HEAD / HTTP/1.1 > User-Agent: curl/7.29.0 > Host: localhost:8080 > Accept: */* > < HTTP/1.1 401 Unauthorized HTTP/1.1 401 Unauthorized < Server: nginx/1.19.5 Server: nginx/1.19.5 < Date: Wed, 07 Apr 2021 05:41:47 GMT Date: Wed, 07 Apr 2021 05:41:47 GMT < Content-Type: text/html Content-Type: text/html < Content-Length: 179 Content-Length: 179 < Connection: keep-alive Connection: keep-alive < WWW-Authenticate: Bearer realm=\"dddaong\" WWW-Authenticate: Bearer realm=\"dddaong\" < * Connection #0 to host localhost left intact # tail -5 access.jwt.log && tail -1 error.jwt.log #Access Log Request: HEAD / HTTP/1.1 Status: 401 Request_URI: / JWT Claim sub: CantReadSub JWT Claim aud: CantReadAud #Error Log 2021/04/07 16:19:01 [info] 3405#3405: *93 client 127.0.0.1 closed keepalive connection \ud14c\uc2a4\ud2b8 - Authentication Success \u00b6 \uc774\uc81c \uc0dd\uc131\ud55c Token\uc744 \ud5e4\ub354\uc5d0 \uc0bd\uc785\ud574 \ud14c\uc2a4\ud2b8\ud574\ubcf4\uaca0\uc2b5\ub2c8\ub2e4. \ud14c\uc2a4\ud2b8\uc5d0 \uc0ac\uc6a9\ud55c \uba85\ub839\uc5b4\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. curl -IvH \"Authorization: Bearer `cat /etc/nginx/conf.d/dddaong.token`\" \\ http://localhost:8080 * About to connect() to localhost port 8080 (#0) * Trying ::1... * Connection refused * Trying 127.0.0.1... * Connected to localhost (127.0.0.1) port 8080 (#0) > HEAD / HTTP/1.1 > User-Agent: curl/7.29.0 > Host: localhost:8080 > Accept: */* > Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjAwMDEifQ.eyJzdWIiOiJSUzI1NlRFU1QiLCJhdWQiOiJkZGRhb25nIiwiaWF0IjoxNjE3Nzc4ODAwfQ.GwapbNpOrl8nLlJEo9JenBRMrGXTm03PwWVe6Jtje-lsTakG4M384-TGnmP79NOobE5KHaQ_RvyYmF65jFjoLAnMsC00jb9HBMWmSKMM7lF5BWQhDWQUEjGdZsCuB7jPI-CbdkAno0wRUKECM-wP0chH7PN0dPsQgUetwpM4uCRTRzq2_v5CT_1gcWp2w1VNjBEhXoEzabNhgMDKsVSnpdl30Odg0arYLrJ1USCYPVXnfn54CPwZwts6kooWr28m5i9DGuRT2XuzsGdrrFV_xLtFFhXcTsoNtAHeVCstzB0BG7DwJiNR4Sx1CH1pTR3tkEVZII3ik_Vx0Y7duFitJg > < HTTP/1.1 200 OK HTTP/1.1 200 OK < Server: nginx/1.19.5 Server: nginx/1.19.5 < Date: Wed, 07 Apr 2021 09:17:33 GMT Date: Wed, 07 Apr 2021 09:17:33 GMT < Content-Type: text/html Content-Type: text/html < Content-Length: 612 Content-Length: 612 < Last-Modified: Mon, 07 Dec 2020 21:10:20 GMT Last-Modified: Mon, 07 Dec 2020 21:10:20 GMT < Connection: keep-alive Connection: keep-alive < ETag: \"5fce9a3c-264\" ETag: \"5fce9a3c-264\" < Accept-Ranges: bytes Accept-Ranges: bytes < #tail -5 access.jwt.log && tail -2 error.jwt.log #Access Log Status: 200 Request_URI: / JWT Claim sub: Authed JWT Claim aud: Authed #Error Log 2021/04/07 18:17:33 [info] 3403#3403: *109 client 127.0.0.1 closed keepalive connection 2021/04/07 18:18:16 [info] 3405#3405: *110 client 127.0.0.1 closed keepalive connection Trouble shooting \u00b6 500 Internal Server Error\ub97c \ubc18\ud658\ud558\ub294 \uacbd\uc6b0 \uc77c\ubc18\uc801\uc73c\ub85c JWK\uc758 \ud615\uc2dd\uc774 \ub9de\uc9c0 \uc54a\ub294 \ubb38\uc81c\uc778 \uacbd\uc6b0\uac00 \ub9ce\uc2b5\ub2c8\ub2e4. Access Log\uc5d0\uc11c Header\uc640 Payload\ub97c \uc77d\uc744 \uc218\ub294 \uc788\uc73c\ub098, \uc544\ub798\uc640 \uac19\uc774 Error Log\uc5d0\uc11c Invalid JWK set \uc774\ub77c\ub294 \ub85c\uadf8\ub97c \ub0a8\uae41\ub2c8\ub2e4. Request: HEAD / HTTP/1.1 Status: 500 Request_URI: / JWT Claim sub: Authed JWT Claim aud: Authed 2021/04/07 18:25:26 [info] 3405#3405: *114 invalid JWK set, client: 127.0.0.1, server: , request: \"HEAD / HTTP/1.1\", host: \"localhost:8080\" JWT\uc5d0 \uc624\ub958\uac00 \uc788\uac70\ub098 \ubcc0\uc870\ub418\uba74 401 Unauthorized\ub97c \ubc18\ud658\ud558\uba70, Access Log\uc5d0\uc11c Claim\uc744 \ub300\uc870\ud55c \uacb0\uacfc\ub97c \uc77d\uc5b4\uc624\uc9c0 \ubabb\ud569\ub2c8\ub2e4. Error \ub85c\uadf8\uc5d0\uc11c \uc0c1\uc138 \ub0b4\uc6a9\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Status: 401 Request_URI: / JWT Claim sub: CantReadSub JWT Claim aud: CantReadAud 2021/04/07 18:22:03 [info] 3402#3402: *111 invalid JWT header while logging request, client: 127.0.0.1, server: , request: \"HEAD / HTTP/1.1\", host: \"localhost:8080\" \uc774 \ud14c\uc2a4\ud2b8 \ub0b4\uc6a9\uc744 \ubc14\ud0d5\uc73c\ub85c NGINX Plus Ingress Controller\uc5d0\uc11c JWT \ud14c\uc2a4\ud2b8\ub97c \uc9c4\ud589\ud560 \uc608\uc815\uc785\ub2c8\ub2e4.","title":"NGINX+ - JWT \uc778\uc99d \ud14c\uc2a4\ud2b8"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#nginx-plus-jwt","text":"","title":"NGINX Plus + JWT \uc778\uc99d \ud14c\uc2a4\ud2b8"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#nginx-jwt-validation-supports","text":"NGINX Plus\ub294 R10 \ubc84\uc804\ubd80\ud130 Native JWT Validation\uc744 \uc9c0\uc6d0\ud558\uba70, NGINX OSS\uc5d0\uc11c\ub294 lua-resty-openidc \ub4f1 \uc678\ubd80 \ubaa8\ub4c8 \uc0ac\uc6a9\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. NGINX Plus \ub294 \ud45c\uc900\uc5d0 \uc815\uc758\ub41c HSxxx , RSxxx , and ESxxx signature algorithms \uc744 \uc9c0\uc6d0\ud569\ub2c8\ub2e4.","title":"NGINX\uc758 JWT Validation Supports"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#sample-config-nginx-plus-jwt-authentication-config","text":"\uc544\ub798\ub294 Nginx Plus r17 Release \uc5d0\uc11c \ubc1c\ucdcc\ud55c NGINX Plus Config \uc608\uc2dc\uc785\ub2c8\ub2e4. # Create a directory to cache the keys received from IdP proxy_cache_path /var/cache/nginx/jwk levels=1 keys_zone=jwk:1m max_size=10m; server { listen 80; # Use SSL/TLS in production location / { auth_jwt \"closed site\"; auth_jwt_key_request /_jwks_uri; # Keys will be fetched by subrequest proxy_pass http://my_backend; } location = /_jwks_uri { internal; proxy_method GET; proxy_cache jwk; # Cache responses proxy_pass https://idp.example.com/oauth2/keys; # Obtain keys from here } } \uc774 Config\ub294 auth_jwt_key_file \ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0 auth_jwt_key_request Directive\ub97c \uc0ac\uc6a9\ud574 JWK\ub97c Remote Location\uc5d0\uc11c \uac00\uc838\uc624\ub3c4\ub85d \uc791\uc131\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uc774 Config\uc5d0\uc11c Remote Location\uc740 proxy_pass \uc5d0 \uc815\uc758\ub41c IdP URI\uc785\ub2c8\ub2e4. (\ub300\ubd80\ubd84\uc758 idP\ub294 Key Set\uc744 \uac00\uc838\uc62c \uc218 \uc788\ub294 URL\uc744 \uc81c\uacf5\ud55c\ub2e4\uace0 \ud569\ub2c8\ub2e4.) Client Request\ub97c \uc218\uc2e0\ud558\uba74 auth_jet_key_request Directive\uc5d0 \uc758\ud574 /_jwk_uri \ube14\ub85d\uc73c\ub85c Subrequest\ub97c \ubcf4\ub0c5\ub2c8\ub2e4. /_jwk_uri \ube14\ub85d\uc758 proxy_pass\uc5d0 \uc758\ud574 idP\uc758 \uace0\uc815 URL\ub85c Subrequest\uac00 \uc804\ub2ec\ub418\uace0, \uc751\ub2f5\uc73c\ub85c Key Set\uc744 \uc218\uc2e0\ud569\ub2c8\ub2e4. /_jwk_uri Location \ube14\ub85d\uc740 internal Directive\ub97c \uc0ac\uc6a9\ud574 \uc678\ubd80\uc5d0\uc11c\ub294 \uc811\uadfc\ud560 \uc218 \uc5c6\ub3c4\ub85d \ud569\ub2c8\ub2e4. \uc218\uc2e0\ud55c Key Set\uc744 proxy_cache Directive\ub85c jwk keys_zone \uc5d0 \uce90\uc2dc\ud558\uc5ec, Validation Overhead\ub97c \uc904\uc5ec\uc904 \uc218 \uc788\ub3c4\ub85d \ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uc774 Config\ub294 auth_jwt \"closed site\"; \uc5d0\uc11c \uae30\ubcf8\uac12\uc778 Bearer Token\uc744 \uc0ac\uc6a9\ud558\uace0, realm\ub9cc \uc791\uc131\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. JWT\ub294 \uc77c\ubc18\uc801\uc73c\ub85c Authorization \ud5e4\ub354\uc5d0 Bearer Token\uc73c\ub85c \uc778\uc99d \uc694\uccad\ub418\uc9c0\ub9cc, Cookie, Query String\uc73c\ub85c \uc0ac\uc6a9\ub420 \uc218 \uc788\ub3c4\ub85d, auth_jwt Directive\uc5d0\uc11c \uc138\ubd80 \uc124\uc815\uc774 \uac00\ub2a5\ud558\ub3c4\ub85d \ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. nginx auth_jwt string [token=$variable] | off; \uc608\ub97c \ub4e4\uc5b4 \uc544\ub798\uc640 \uac19\uc774 Query String\uc744 \ud1b5\ud574 Token \uc778\uc99d \uc694\uccad\uc744 \uc0ac\uc6a9\ud558\ub824\uba74 curl http://192.168.1.1/products/widget1?apijwt=xxxxxxxxxxxxxxxxxxxxx... string\uc744 realm \uba85, \ud1a0\ud070\uc744 apijwt Argument\uc758 Value\ub97c \ucc38\uc870\ud558\ub3c4\ub85d \ud569\ub2c8\ub2e4. nginx auth_jwt \"API\" token=$arg_apijwt; \ucc38\uace0\ub85c, $arg_name \uacfc $cookie_name \ubcc0\uc218\ub294 ngx_http_core_module \ubaa8\ub4c8\uc758 Embedded Variables \ub97c \ucc38\uc870\ud558\uba74 \ub429\ub2c8\ub2e4.","title":"Sample Config : NGINX Plus JWT Authentication Config"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#nginx-plus-jwt-auth-test-with-rs256","text":"NGINX Plus\uc5d0\uc11c JWT \uc778\uc99d \ud14c\uc2a4\ud2b8\ub97c \uae30\ub85d\ud55c \ub0b4\uc6a9\uc785\ub2c8\ub2e4. RSA Pub/Priv Key \uc0dd\uc131 - mkjwk.org \uc0ac\uc6a9 NGINX Plus\uc5d0\uc11c \uc0ac\uc6a9\ud560 JWK \ud30c\uc77c \uc791\uc131 - mkjwk.org \uc0ac\uc6a9 JWT \uc0dd\uc131 - jwt.io Debugger \uc0ac\uc6a9","title":"NGINX Plus JWT Auth Test with RS256"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#jwk-jwt-rsa256","text":"\ud14c\uc2a4\ud2b8\uc5d0\uc11c\ub294 \ud3b8\uc758\ub97c \uc704\ud574 mkjwk JSON Web Key Generator \ub97c \uc0ac\uc6a9\ud588\uc2b5\ub2c8\ub2e4. \uc544\ub798\ub294 \uc0dd\uc131\uc2dc \uc120\ud0dd\ud55c \uc635\uc158\uc785\ub2c8\ub2e4. Tab Key Size Key Use Algorithm Key ID Show X.509 RSA 2048 Signature RS256 Specify [0001] Yes","title":"JWK\uc640 JWT\ub97c \uc704\ud55c RSA256 \ud0a4 \uc0dd\uc131"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#jwk","text":"Public Key \ubc15\uc2a4\uc758 \ub0b4\uc6a9\uc744 \ubcf5\uc0ac\ud574 NGINX Plus\uac00 \ub3d9\uc791\ud558\uace0 \uc788\ub294 \ud638\uc2a4\ud2b8\uc5d0\uc11c vi /etc/nginx/conf.d/dddaong.jwk \ud30c\uc77c\ub85c \uc800\uc7a5\ud569\ub2c8\ub2e4. \uc544\ub798\ub294 \ud14c\uc2a4\ud2b8\uc5d0 \uc0ac\uc6a9\ud55c \uc0d8\ud50c\uc785\ub2c8\ub2e4. json { \"keys\": [{ \"kty\":\"RSA\", \"e\":\"AQAB\", \"use\":\"sig\", \"kid\":\"0001\", \"alg\":\"RS256\", \"n\":\"oS4lA_ePN4bmcaAM5AFnGVtzMmBBXoYxVGgNEtbhotDMkiIfhilRSH_IVktaDwdorEpQZxg66gwV0y5hZ4Nqo3wWxRVWKoVmdY0xQyPCtIHOs40FYVoc85vBU4giQnl_XqNHVnGOIZz7hiKgzzBBWiLFqgajzgvYN6QZBT0rb8OMj2u-iKQra9sHhlXBgg6W3YUE8BoPiDX2ehI35zXbsf4rI1IYeJvzEFLVcv6kHNJ7vSO0qDmVY4_m-0Kdi0KmJ_XZSNs7fRFwp1MYui9SXs-rZxrmHHES3xuTutJ5sJD6J2LgqkA8NgqhiTva-Dfyj08KVEj5RH1Af4F-bo6aBQ\" }] }","title":"JWK \ud30c\uc77c \uc0dd\uc131"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#jwt","text":"JWT\ub294 jwt.io\uc758 Debugger\ub97c \uc0ac\uc6a9\ud558\uba74 \uac04\ub2e8\ud558\uac8c \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uba3c\uc800, Header\ub97c Base64url \uc778\ucf54\ub529\ud55c \uc2a4\ud2b8\ub9c1 + . + Payload\ub97c Base64url \uc778\ucf54\ub529\ud55c \uc2a4\ud2b8\ub9c1\uc744 \uc900\ube44\ud569\ub2c8\ub2e4. Header\uc640 Payload\ub97c \uac01\uac01 \uc791\uc131\ud574 Base64url \uc778\ucf54\ub529\ud569\ub2c8\ub2e4. HEAD=$(echo -n '{\"alg\":\"RS256\",\"typ\":\"JWT\",\"kid\":\"0001\"}' | base64 | sed s/\\+/-/ | sed -E s/=+$//) PAYLOAD=$(echo -n '{\"sub\":\"RS256TEST\",\"aud\":\"dddaong\",\"iat\": 1617778800}' | base64 | sed s/\\+/-/ | sed -E s/=+$//) echo \"$HEAD.$PAYLOAD\" \uacb0\uacfc\ubb3c\uc740 \uc544\ub798\uc640 \uac19\uc774 \ub098\uc635\ub2c8\ub2e4. eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJSUzI1NlRFU1QiLCJhdWQiOiJkZGRhb25nIn0 \uc0dd\uc131\ud55c \ub0b4\uc6a9\uc744 jwt.io Debugger \uc5d0 Encoded \ubd80\ubd84\uc5d0 \ubd99\uc5ec\ub123\uc2b5\ub2c8\ub2e4. jwt.io Debugger \uc6b0\uce21 Decoded\uc758 Verify Signature \ud56d\ubaa9\uc758 \uc544\ub798\ucabd \ubc15\uc2a4\uc5d0 mkjwk JSON Web Key Generator \uc5d0\uc11c \uc0dd\uc131\ud55c Private Key(X.509 PEM \ud3ec\ub9f7)\uc744 \ubd99\uc5ec\ub123\uc2b5\ub2c8\ub2e4. Private Key\ub97c \ubd99\uc5ec\ub123\ub294 \uc989\uc2dc Encoded\uc5d0 JWT\uac00 \uc644\uc131\ub418\uc5b4 \ub098\ud0c0\ub0a9\ub2c8\ub2e4. \uacb0\uacfc\ubb3c\uc740 \uc544\ub798\uc640 \uac19\uc774 \ub098\uc635\ub2c8\ub2e4. eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJSUzI1NlRFU1QiLCJhdWQiOiJkZGRhb25nIiwiaWF0IjoxNjE3Nzc4ODAwfQ.RgG2pJVjmNs0HRN13PRgI8lhVrZgCClbkA5JWgliewp0FJDqFE_B9HNUOQN_Iroj8s_bWRTSAVpCznVdHiT_4dCpRZxpYdZEYAx9PT0H5J-mj2rBUAJYy6OC7mIXFD11nF2uSId9oVMhaa_itvNOPiV5_rIYVjVOOQWEK08DwAkQJ-dMGf8BNAnWWcsCnHE8jyrKxCpINwGSVNVL65v2Dr66bhbY2uGYs658BXnq233TQMsnj_UdxQkAgFVkm1tnkqq-vPAGV662q22mICIjGDKWyj_abOsvDGaX4PwCxyv_zj0JhiTzhi5iL27WIxXf9Je03KOvsnDc67VFV-yOCA \ud655\uc778\uc744 \uc704\ud574 Public Key\ub85c Validation\uc744 \ud574\ubcf4\uaca0\uc2b5\ub2c8\ub2e4. \uc0dd\uc131\ud55c JWT \ubb38\uc790\uc5f4\uc744 \uba54\ubaa8\uc7a5 \ub4f1\uc5d0 \ub530\ub85c \ubcf4\uad00\ud574\ub461\ub2c8\ub2e4. \ud14c\uc2a4\ud2b8 \uacfc\uc815\uc5d0\uc11c\ub294 \ud3b8\uc758\ub97c \uc704\ud574 \ud1a0\ud070\uc758 \ub0b4\uc6a9\uc744 /etc/nginx/conf.d/dddaong.token \ud30c\uc77c\ub85c \uc800\uc7a5\ud588\uc2b5\ub2c8\ub2e4. bash echo \"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJSUzI1NlRFU1QiLCJhdWQiOiJkZGRhb25nIiwiaWF0IjoxNjE3Nzc4ODAwfQ.RgG2pJVjmNs0HRN13PRgI8lhVrZgCClbkA5JWgliewp0FJDqFE_B9HNUOQN_Iroj8s_bWRTSAVpCznVdHiT_4dCpRZxpYdZEYAx9PT0H5J-mj2rBUAJYy6OC7mIXFD11nF2uSId9oVMhaa_itvNOPiV5_rIYVjVOOQWEK08DwAkQJ-dMGf8BNAnWWcsCnHE8jyrKxCpINwGSVNVL65v2Dr66bhbY2uGYs658BXnq233TQMsnj_UdxQkAgFVkm1tnkqq-vPAGV662q22mICIjGDKWyj_abOsvDGaX4PwCxyv_zj0JhiTzhi5iL27WIxXf9Je03KOvsnDc67VFV-yOCA\" > /etc/nginx/conf.d/dddaong.token jwt.io Debugger \uc758 Decoded\uc5d0 \ubd99\uc5ec\ub123\uc740 Private Key\ub97c \uc9c0\uc6cc\uc90d\ub2c8\ub2e4. Private Key\ub97c \uc9c0\uc6b0\uba74 JWT String\ub3c4 \ubaa8\ub450 \uc0ac\ub77c\uc9d1\ub2c8\ub2e4. \ubcf4\uad00\ud55c JWT String\uc744 \ub2e4\uc2dc \ubd99\uc5ec\ub123\uc5b4 \uc90d\ub2c8\ub2e4. \uc774 \ubd80\ubd84\ub9cc \uc788\uc5b4\ub3c4 Header\uc640 Payload\uc758 \ub0b4\uc6a9\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. mkjwk JSON Web Key Generator \uc758 Public Key(X.509 PEM Format)\ub97c Decoded\uc758 Verify Signature \ud56d\ubaa9\uc758 \uc704\ucabd \ubc15\uc2a4\uc5d0 \ubd99\uc5ec\ub123\uc2b5\ub2c8\ub2e4. Debugger \uc67c\ucabd \ud558\ub2e8\uc5d0 \"Signature Verified\"\uac00 \ub098\ud0c0\ub098\uba74 \uc815\uc0c1\uc785\ub2c8\ub2e4.","title":"JWT \uc0dd\uc131"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#jwk-nginx-plus","text":"NGINX Plus\ub97c \uc124\uce58\ud55c \ud6c4, /etc/nginx/conf.d/ \ub514\ub809\ud1a0\ub9ac \uc544\ub798 \ub0b4\uc6a9\uc758 conf \ud30c\uc77c\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4. \uc774 Config\ub294 \ud14c\uc2a4\ud2b8\ub97c \uc704\ud574 \uba87 \uac00\uc9c0 \ud655\uc778 \uae30\ub2a5\uc744 \ub123\uc5c8\uc2b5\ub2c8\ub2e4. Authorization \uc131\uacf5\uc2dc index.html \ud398\uc774\uc9c0\ub97c \ubc18\ud658, \uc2e4\ud328\uc2dc 50x.html \ud398\uc774\uc9c0\ub97c \ubc18\ud658 Access Log\uc5d0\uc11c \ud1a0\ud070 Payload\uc758 sub, aud Claim\uc758 \ub0b4\uc6a9 \ud655\uc778 \uac00\ub2a5 Error \ubc1c\uc0dd\uc2dc Error Log\uc5d0\uc11c \ud655\uc778 \uac00\ub2a5 map $jwt_claim_sub $jwt_sub { \"RS256TEST\" \"Authed\"; default \"CantReadSub\"; } map $jwt_claim_aud $jwt_aud { \"dddaong\" \"Authed\"; default \"CantReadAud\"; } log_format test_log '\"Request: $request\\n Status: $status\\n Request_URI: $request_uri\\n JWT Claim sub: $jwt_sub'\\n JWT Claim aud: $jwt_aud'\\n; server { listen 8080; access_log /etc/nginx/conf.d/jwt.access.log test_log; error_log /etc/nginx/conf.d/jwt.error.log debug; auth_jwt \"dddaong\"; auth_jwt_key_file conf.d/dddaong.jwk; location / { root /usr/share/nginx/html; index index.html index.htm; } error_page 400 401 403 500 502 503 504 /50x.html; location = /50x.html { auth_jwt off; root /usr/share/nginx/html; } }","title":"JWK\ub97c NGINX Plus\uc5d0 \uc801\uc6a9"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#-authentication-failure","text":"\uc774 Config\uac00 \uc801\uc6a9\ub41c \uc0c1\ud0dc\uc5d0\uc11c http://localhost:8080 \uc73c\ub85c \uc811\uadfc\ud558\uba74, \uc544\ub798\uc640 \uac19\uc774 401 Unauthorized\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4. curl -Iv http://localhost:8080 * About to connect() to localhost port 8080 (#0) * Trying ::1... * Connection refused * Trying 127.0.0.1... * Connected to localhost (127.0.0.1) port 8080 (#0) > HEAD / HTTP/1.1 > User-Agent: curl/7.29.0 > Host: localhost:8080 > Accept: */* > < HTTP/1.1 401 Unauthorized HTTP/1.1 401 Unauthorized < Server: nginx/1.19.5 Server: nginx/1.19.5 < Date: Wed, 07 Apr 2021 05:41:47 GMT Date: Wed, 07 Apr 2021 05:41:47 GMT < Content-Type: text/html Content-Type: text/html < Content-Length: 179 Content-Length: 179 < Connection: keep-alive Connection: keep-alive < WWW-Authenticate: Bearer realm=\"dddaong\" WWW-Authenticate: Bearer realm=\"dddaong\" < * Connection #0 to host localhost left intact # tail -5 access.jwt.log && tail -1 error.jwt.log #Access Log Request: HEAD / HTTP/1.1 Status: 401 Request_URI: / JWT Claim sub: CantReadSub JWT Claim aud: CantReadAud #Error Log 2021/04/07 16:19:01 [info] 3405#3405: *93 client 127.0.0.1 closed keepalive connection","title":"\ud14c\uc2a4\ud2b8 - Authentication Failure"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#-authentication-success","text":"\uc774\uc81c \uc0dd\uc131\ud55c Token\uc744 \ud5e4\ub354\uc5d0 \uc0bd\uc785\ud574 \ud14c\uc2a4\ud2b8\ud574\ubcf4\uaca0\uc2b5\ub2c8\ub2e4. \ud14c\uc2a4\ud2b8\uc5d0 \uc0ac\uc6a9\ud55c \uba85\ub839\uc5b4\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4. curl -IvH \"Authorization: Bearer `cat /etc/nginx/conf.d/dddaong.token`\" \\ http://localhost:8080 * About to connect() to localhost port 8080 (#0) * Trying ::1... * Connection refused * Trying 127.0.0.1... * Connected to localhost (127.0.0.1) port 8080 (#0) > HEAD / HTTP/1.1 > User-Agent: curl/7.29.0 > Host: localhost:8080 > Accept: */* > Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjAwMDEifQ.eyJzdWIiOiJSUzI1NlRFU1QiLCJhdWQiOiJkZGRhb25nIiwiaWF0IjoxNjE3Nzc4ODAwfQ.GwapbNpOrl8nLlJEo9JenBRMrGXTm03PwWVe6Jtje-lsTakG4M384-TGnmP79NOobE5KHaQ_RvyYmF65jFjoLAnMsC00jb9HBMWmSKMM7lF5BWQhDWQUEjGdZsCuB7jPI-CbdkAno0wRUKECM-wP0chH7PN0dPsQgUetwpM4uCRTRzq2_v5CT_1gcWp2w1VNjBEhXoEzabNhgMDKsVSnpdl30Odg0arYLrJ1USCYPVXnfn54CPwZwts6kooWr28m5i9DGuRT2XuzsGdrrFV_xLtFFhXcTsoNtAHeVCstzB0BG7DwJiNR4Sx1CH1pTR3tkEVZII3ik_Vx0Y7duFitJg > < HTTP/1.1 200 OK HTTP/1.1 200 OK < Server: nginx/1.19.5 Server: nginx/1.19.5 < Date: Wed, 07 Apr 2021 09:17:33 GMT Date: Wed, 07 Apr 2021 09:17:33 GMT < Content-Type: text/html Content-Type: text/html < Content-Length: 612 Content-Length: 612 < Last-Modified: Mon, 07 Dec 2020 21:10:20 GMT Last-Modified: Mon, 07 Dec 2020 21:10:20 GMT < Connection: keep-alive Connection: keep-alive < ETag: \"5fce9a3c-264\" ETag: \"5fce9a3c-264\" < Accept-Ranges: bytes Accept-Ranges: bytes < #tail -5 access.jwt.log && tail -2 error.jwt.log #Access Log Status: 200 Request_URI: / JWT Claim sub: Authed JWT Claim aud: Authed #Error Log 2021/04/07 18:17:33 [info] 3403#3403: *109 client 127.0.0.1 closed keepalive connection 2021/04/07 18:18:16 [info] 3405#3405: *110 client 127.0.0.1 closed keepalive connection","title":"\ud14c\uc2a4\ud2b8 - Authentication Success"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-JWT-%EC%9D%B8%EC%A6%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8/#trouble-shooting","text":"500 Internal Server Error\ub97c \ubc18\ud658\ud558\ub294 \uacbd\uc6b0 \uc77c\ubc18\uc801\uc73c\ub85c JWK\uc758 \ud615\uc2dd\uc774 \ub9de\uc9c0 \uc54a\ub294 \ubb38\uc81c\uc778 \uacbd\uc6b0\uac00 \ub9ce\uc2b5\ub2c8\ub2e4. Access Log\uc5d0\uc11c Header\uc640 Payload\ub97c \uc77d\uc744 \uc218\ub294 \uc788\uc73c\ub098, \uc544\ub798\uc640 \uac19\uc774 Error Log\uc5d0\uc11c Invalid JWK set \uc774\ub77c\ub294 \ub85c\uadf8\ub97c \ub0a8\uae41\ub2c8\ub2e4. Request: HEAD / HTTP/1.1 Status: 500 Request_URI: / JWT Claim sub: Authed JWT Claim aud: Authed 2021/04/07 18:25:26 [info] 3405#3405: *114 invalid JWK set, client: 127.0.0.1, server: , request: \"HEAD / HTTP/1.1\", host: \"localhost:8080\" JWT\uc5d0 \uc624\ub958\uac00 \uc788\uac70\ub098 \ubcc0\uc870\ub418\uba74 401 Unauthorized\ub97c \ubc18\ud658\ud558\uba70, Access Log\uc5d0\uc11c Claim\uc744 \ub300\uc870\ud55c \uacb0\uacfc\ub97c \uc77d\uc5b4\uc624\uc9c0 \ubabb\ud569\ub2c8\ub2e4. Error \ub85c\uadf8\uc5d0\uc11c \uc0c1\uc138 \ub0b4\uc6a9\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Status: 401 Request_URI: / JWT Claim sub: CantReadSub JWT Claim aud: CantReadAud 2021/04/07 18:22:03 [info] 3402#3402: *111 invalid JWT header while logging request, client: 127.0.0.1, server: , request: \"HEAD / HTTP/1.1\", host: \"localhost:8080\" \uc774 \ud14c\uc2a4\ud2b8 \ub0b4\uc6a9\uc744 \ubc14\ud0d5\uc73c\ub85c NGINX Plus Ingress Controller\uc5d0\uc11c JWT \ud14c\uc2a4\ud2b8\ub97c \uc9c4\ud589\ud560 \uc608\uc815\uc785\ub2c8\ub2e4.","title":"Trouble shooting"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/","text":"NGINX Plus, NGINX Plus App Protect WAF, NGINX App Protect DoS \uc124\uce58 \uac00\uc774\ub4dc NGINX Plus, NGINX App Protect (WAF, DOS) \u00b6 NGINX Plus, NGINX Plus App Protect (WAF)\ub294 NGINX Plus r22 \ubc84\uc804\ubd80\ud130 \uc9c0\uc6d0\ud569\ub2c8\ub2e4. NGINX App Protect (DoS)\ub294 NGINX Plus r24 \ubc84\uc804\ubd80\ud130 \uc9c0\uc6d0\ud569\ub2c8\ub2e4. NGINX Plus \u00b6 NGINX Plus \uc124\uce58\ub294 \ud06c\uac8c License \uc5c5\ub85c\ub4dc, Repository \ub4f1\ub85d, Installation \uacfc\uc815\uc73c\ub85c \ub098\ub269\ub2c8\ub2e4. License\ub294 nginx-repo.crt , nginx-repo.key \ub97c \ub9d0\ud558\uba70, /var/tmp \uc704\uce58\uc5d0 \uc5c5\ub85c\ub4dc\ub418\uc5b4 \uc788\ub2e4\uace0 \uac00\uc815\ud569\ub2c8\ub2e4. yum(Centos, RHEL) \u00b6 License \uc5c5\ub85c\ub4dc \u00b6 sudo mkdir -p /etc/ssl/nginx && cp /var/tmp/nginx-repo.* /etc/ssl/nginx/ Repository \ub4f1\ub85d \u00b6 sudo curl -sL https://cs.nginx.com/static/files/nginx-plus-7.repo \\ -o /etc/yum.repos.d/nginx-plus-7.repo sudo yum makecache fast Installation \u00b6 sudo yum install -y nginx-plus ca-certificates sudo systemctl enable --now nginx apt-get(Ubuntu, Debian) \u00b6 License \uc5c5\ub85c\ub4dc \u00b6 sudo mkdir -p /etc/ssl/nginx && cp /var/tmp/nginx-repo.* /etc/ssl/nginx/ Repository \ub4f1\ub85d \u00b6 sudo wget https://cs.nginx.com/static/keys/nginx_signing.key sudo apt-key add nginx_signing.key sudo apt-get install apt-transport-https lsb-release ca-certificates printf \"deb https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-plus.list sudo wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx sudo apt-get update Installation \u00b6 sudo apt-get install -y nginx-plus sudo systemctl enable --now nginx NGINX Plus + App Protect (WAF) \u00b6 NGINX Plus \uc124\uce58\ub294 \ud06c\uac8c License \uc5c5\ub85c\ub4dc, Repository \ub4f1\ub85d, Installation \uacfc\uc815\uc73c\ub85c \ub098\ub269\ub2c8\ub2e4. License\ub294 nginx-repo.crt , nginx-repo.key \ub97c \ub9d0\ud558\uba70, /var/tmp \uc704\uce58\uc5d0 \uc5c5\ub85c\ub4dc\ub418\uc5b4 \uc788\ub2e4\uace0 \uac00\uc815\ud569\ub2c8\ub2e4. yum(Centos 7.4+, RHEL 7.4+) \u00b6 License \uc5c5\ub85c\ub4dc \u00b6 sudo mkdir -p /etc/ssl/nginx && cp /var/tmp/nginx-repo.* /etc/ssl/nginx/ Repository \ub4f1\ub85d \u00b6 sudo yum install wget epel-release sudo curl -sL https://cs.nginx.com/static/files/nginx-plus-7.repo -o /etc/yum.repos.d/nginx-plus-7.repo sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-7.repo sudo yum makecache fast Installation \u00b6 sudo yum install -y nginx-plus ca-certificates sudo yum install -y app-protect app-protect-attack-signatures sudo systemctl enable --now nginx apt-get(Ubuntu, Debian) \u00b6 License \uc5c5\ub85c\ub4dc \u00b6 sudo mkdir -p /etc/ssl/nginx && cp /var/tmp/nginx-repo.* /etc/ssl/nginx/ Repository \ub4f1\ub85d \u00b6 sudo wget https://cs.nginx.com/static/keys/nginx_signing.key sudo apt-key add nginx_signing.key sudo wget https://cs.nginx.com/static/keys/app-protect-security-updates.key sudo apt-key add app-protect-security-updates.key sudo apt-get install apt-transport-https lsb-release ca-certificates printf \"deb https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-plus.list printf \"deb https://pkgs.nginx.com/app-protect/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-app-protect.list printf \"deb https://pkgs.nginx.com/app-protect-security-updates/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee -a /etc/apt/sources.list.d/nginx-app-protect.list sudo wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx sudo apt-get update Installation \u00b6 sudo apt-get install -y nginx-plus sudo apt-get install app-protect app-protect-attack-signatures sudo systemctl enable --now nginx NGINX Plus + App-Protect \uc801\uc6a9 \u00b6 NGINX Config File\uc5d0\uc11c \uc801\uc6a9\ud569\ub2c8\ub2e4. \uc544\ub798\ub294 nginx.conf \uc5d0\uc11c NGINX \uc804\uccb4\uc5d0 App Protect\ub97c \uc801\uc6a9\ud558\ub294 \uc608\uc2dc\uc785\ub2c8\ub2e4. Load module \u00b6 user nginx; worker_processes auto; error_log /var/log/nginx/error.log notice; pid /var/run/nginx.pid; load_module modules/ngx_http_app_protect_module.so; events { worker_connections 1024; } http { app_protect_enable on; ## App Protect Enable ## include /etc/nginx/mime.types; default_type application/octet-stream; \u2026\u2026[\ud6c4\ub7b5] Nginx Reload And App Protect Apply \u00b6 sudo nginx -t && sudo nginx -s reload App Protect \uc801\uc6a9 \uc5ec\ubd80 \ud655\uc778 \u00b6 \uc544\ub798 \uba85\ub839\uc5b4\ub85c NGINX Master/Worker \ud504\ub85c\uc138\uc2a4\uc640 App Protect\uac00 \uc0ac\uc6a9\ud558\ub294 bd_agent , bd-socket-plugin \ud504\ub85c\uc138\uc2a4\uac00 \ub3d9\uc791 \uc911\uc778\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4. sudo ps aux | grep -e \"bd_agent\" -e \"bd-socket-plugin\" -e \"nginx\" NGINX Plus + App Protect (DoS) \u00b6 NGINX Plus \uc124\uce58\ub294 \ud06c\uac8c License \uc5c5\ub85c\ub4dc, Repository \ub4f1\ub85d, Installation \uacfc\uc815\uc73c\ub85c \ub098\ub269\ub2c8\ub2e4. License\ub294 nginx-repo.crt , nginx-repo.key \ub97c \ub9d0\ud558\uba70, /var/tmp \uc704\uce58\uc5d0 \uc5c5\ub85c\ub4dc\ub418\uc5b4 \uc788\ub2e4\uace0 \uac00\uc815\ud569\ub2c8\ub2e4. yum(Centos 7.4+, RHEL 7.4+) \u00b6 License \uc5c5\ub85c\ub4dc \u00b6 sudo mkdir -p /etc/ssl/nginx && cp /var/tmp/nginx-repo.* /etc/ssl/nginx/ Repository \ub4f1\ub85d \u00b6 sudo yum install wget epel-release sudo curl -sL https://cs.nginx.com/static/files/nginx-plus-7.repo -o /etc/yum.repos.d/nginx-plus-7.repo sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-7.repo sudo yum makecache fast Installation \u00b6 sudo yum install -y nginx-plus ca-certificates sudo yum install -y app-protect-dos sudo systemctl enable --now nginx apt-get(Ubuntu 18.04) \u00b6 License \uc5c5\ub85c\ub4dc \u00b6 sudo mkdir -p /etc/ssl/nginx && cp /var/tmp/nginx-repo.* /etc/ssl/nginx/ Repository \ub4f1\ub85d \u00b6 sudo wget https://cs.nginx.com/static/keys/nginx_signing.key sudo apt-key add nginx_signing.key sudo wget https://cs.nginx.com/static/keys/app-protect-security-updates.key sudo apt-key add app-protect-security-updates.key sudo apt-get install apt-transport-https lsb-release ca-certificates printf \"deb https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-plus.list printf \"deb https://pkgs.nginx.com/app-protect/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-app-protect.list printf \"deb https://pkgs.nginx.com/app-protect-dos/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-app-protect-dos.list sudo wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx sudo apt-get update Installation \u00b6 sudo apt-get install -y nginx-plus sudo apt-get install app-protect-dos sudo systemctl enable --now nginx \uc124\uce58 \ud655\uc778 \u00b6 sudo admd -v NGINX Plus + App-Protect DoS \uc801\uc6a9 \u00b6 NGINX Config File\uc5d0\uc11c \uc801\uc6a9\ud569\ub2c8\ub2e4. \uc544\ub798\ub294 nginx.conf \uc5d0\uc11c NGINX \uc804\uccb4\uc5d0 App Protect\ub97c \uc801\uc6a9\ud558\ub294 \uc608\uc2dc\uc785\ub2c8\ub2e4. Load module \u00b6 user nginx; worker_processes auto; error_log /var/log/nginx/error.log notice; pid /var/run/nginx.pid; load_module modules/ngx_http_app_protect_dos_module.so; events { worker_connections 1024; } http { ### App Protect DoS \uc801\uc6a9\ubd80 ### app_protect_dos_enable on; app_protect_dos_name \"vs-example\"; app_protect_dos_policy_file \"/etc/app_protect_dos/BADOSDefaultPolicy.json\"; app_protect_dos_monitor \"example.com/\"; ### App Protect DoS \uc801\uc6a9\ubd80 ### include /etc/nginx/mime.types; default_type application/octet-stream; \u2026\u2026[\ud6c4\ub7b5] Nginx Reload And App Protect Apply \u00b6 sudo nginx -t && sudo nginx -s reload App Protect DoS Selinux Policy \uc218\uc815 \u00b6 sudo vi nginx.te module nginx 1.0; require { type unconfined_t; type httpd_t; type unconfined_service_t; class shm { associate read unix_read unix_write write }; } allow httpd_t unconfined_service_t:shm { associate read unix_read unix_write write }; allow httpd_t unconfined_t:shm { unix_read unix_write }; checkmodule -M -m -o nginx.mod nginx.te semodule_package -o nginx.pp -m nginx.mod semodule -i nginx.pp setsebool -P httpd_can_network_connect 1","title":"NGINX Plus NAP WAF DoS Install Guide"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#nginx-plus-nginx-app-protect-waf-dos","text":"NGINX Plus, NGINX Plus App Protect (WAF)\ub294 NGINX Plus r22 \ubc84\uc804\ubd80\ud130 \uc9c0\uc6d0\ud569\ub2c8\ub2e4. NGINX App Protect (DoS)\ub294 NGINX Plus r24 \ubc84\uc804\ubd80\ud130 \uc9c0\uc6d0\ud569\ub2c8\ub2e4.","title":"NGINX Plus, NGINX App Protect (WAF, DOS)"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#nginx-plus","text":"NGINX Plus \uc124\uce58\ub294 \ud06c\uac8c License \uc5c5\ub85c\ub4dc, Repository \ub4f1\ub85d, Installation \uacfc\uc815\uc73c\ub85c \ub098\ub269\ub2c8\ub2e4. License\ub294 nginx-repo.crt , nginx-repo.key \ub97c \ub9d0\ud558\uba70, /var/tmp \uc704\uce58\uc5d0 \uc5c5\ub85c\ub4dc\ub418\uc5b4 \uc788\ub2e4\uace0 \uac00\uc815\ud569\ub2c8\ub2e4.","title":"NGINX Plus"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#yumcentos-rhel","text":"","title":"yum(Centos, RHEL)"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#license","text":"sudo mkdir -p /etc/ssl/nginx && cp /var/tmp/nginx-repo.* /etc/ssl/nginx/","title":"License \uc5c5\ub85c\ub4dc"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#repository","text":"sudo curl -sL https://cs.nginx.com/static/files/nginx-plus-7.repo \\ -o /etc/yum.repos.d/nginx-plus-7.repo sudo yum makecache fast","title":"Repository \ub4f1\ub85d"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#installation","text":"sudo yum install -y nginx-plus ca-certificates sudo systemctl enable --now nginx","title":"Installation"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#apt-getubuntu-debian","text":"","title":"apt-get(Ubuntu, Debian)"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#license_1","text":"sudo mkdir -p /etc/ssl/nginx && cp /var/tmp/nginx-repo.* /etc/ssl/nginx/","title":"License \uc5c5\ub85c\ub4dc"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#repository_1","text":"sudo wget https://cs.nginx.com/static/keys/nginx_signing.key sudo apt-key add nginx_signing.key sudo apt-get install apt-transport-https lsb-release ca-certificates printf \"deb https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-plus.list sudo wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx sudo apt-get update","title":"Repository \ub4f1\ub85d"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#installation_1","text":"sudo apt-get install -y nginx-plus sudo systemctl enable --now nginx","title":"Installation"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#nginx-plus-app-protect-waf","text":"NGINX Plus \uc124\uce58\ub294 \ud06c\uac8c License \uc5c5\ub85c\ub4dc, Repository \ub4f1\ub85d, Installation \uacfc\uc815\uc73c\ub85c \ub098\ub269\ub2c8\ub2e4. License\ub294 nginx-repo.crt , nginx-repo.key \ub97c \ub9d0\ud558\uba70, /var/tmp \uc704\uce58\uc5d0 \uc5c5\ub85c\ub4dc\ub418\uc5b4 \uc788\ub2e4\uace0 \uac00\uc815\ud569\ub2c8\ub2e4.","title":"NGINX Plus + App Protect (WAF)"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#yumcentos-74-rhel-74","text":"","title":"yum(Centos 7.4+, RHEL 7.4+)"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#license_2","text":"sudo mkdir -p /etc/ssl/nginx && cp /var/tmp/nginx-repo.* /etc/ssl/nginx/","title":"License \uc5c5\ub85c\ub4dc"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#repository_2","text":"sudo yum install wget epel-release sudo curl -sL https://cs.nginx.com/static/files/nginx-plus-7.repo -o /etc/yum.repos.d/nginx-plus-7.repo sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-7.repo sudo yum makecache fast","title":"Repository \ub4f1\ub85d"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#installation_2","text":"sudo yum install -y nginx-plus ca-certificates sudo yum install -y app-protect app-protect-attack-signatures sudo systemctl enable --now nginx","title":"Installation"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#apt-getubuntu-debian_1","text":"","title":"apt-get(Ubuntu, Debian)"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#license_3","text":"sudo mkdir -p /etc/ssl/nginx && cp /var/tmp/nginx-repo.* /etc/ssl/nginx/","title":"License \uc5c5\ub85c\ub4dc"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#repository_3","text":"sudo wget https://cs.nginx.com/static/keys/nginx_signing.key sudo apt-key add nginx_signing.key sudo wget https://cs.nginx.com/static/keys/app-protect-security-updates.key sudo apt-key add app-protect-security-updates.key sudo apt-get install apt-transport-https lsb-release ca-certificates printf \"deb https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-plus.list printf \"deb https://pkgs.nginx.com/app-protect/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-app-protect.list printf \"deb https://pkgs.nginx.com/app-protect-security-updates/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee -a /etc/apt/sources.list.d/nginx-app-protect.list sudo wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx sudo apt-get update","title":"Repository \ub4f1\ub85d"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#installation_3","text":"sudo apt-get install -y nginx-plus sudo apt-get install app-protect app-protect-attack-signatures sudo systemctl enable --now nginx","title":"Installation"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#nginx-plus-app-protect","text":"NGINX Config File\uc5d0\uc11c \uc801\uc6a9\ud569\ub2c8\ub2e4. \uc544\ub798\ub294 nginx.conf \uc5d0\uc11c NGINX \uc804\uccb4\uc5d0 App Protect\ub97c \uc801\uc6a9\ud558\ub294 \uc608\uc2dc\uc785\ub2c8\ub2e4.","title":"NGINX Plus + App-Protect \uc801\uc6a9"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#load-module","text":"user nginx; worker_processes auto; error_log /var/log/nginx/error.log notice; pid /var/run/nginx.pid; load_module modules/ngx_http_app_protect_module.so; events { worker_connections 1024; } http { app_protect_enable on; ## App Protect Enable ## include /etc/nginx/mime.types; default_type application/octet-stream; \u2026\u2026[\ud6c4\ub7b5]","title":"Load module"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#nginx-reload-and-app-protect-apply","text":"sudo nginx -t && sudo nginx -s reload","title":"Nginx Reload And App Protect Apply"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#app-protect","text":"\uc544\ub798 \uba85\ub839\uc5b4\ub85c NGINX Master/Worker \ud504\ub85c\uc138\uc2a4\uc640 App Protect\uac00 \uc0ac\uc6a9\ud558\ub294 bd_agent , bd-socket-plugin \ud504\ub85c\uc138\uc2a4\uac00 \ub3d9\uc791 \uc911\uc778\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4. sudo ps aux | grep -e \"bd_agent\" -e \"bd-socket-plugin\" -e \"nginx\"","title":"App Protect \uc801\uc6a9 \uc5ec\ubd80 \ud655\uc778"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#nginx-plus-app-protect-dos","text":"NGINX Plus \uc124\uce58\ub294 \ud06c\uac8c License \uc5c5\ub85c\ub4dc, Repository \ub4f1\ub85d, Installation \uacfc\uc815\uc73c\ub85c \ub098\ub269\ub2c8\ub2e4. License\ub294 nginx-repo.crt , nginx-repo.key \ub97c \ub9d0\ud558\uba70, /var/tmp \uc704\uce58\uc5d0 \uc5c5\ub85c\ub4dc\ub418\uc5b4 \uc788\ub2e4\uace0 \uac00\uc815\ud569\ub2c8\ub2e4.","title":"NGINX Plus + App Protect (DoS)"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#yumcentos-74-rhel-74_1","text":"","title":"yum(Centos 7.4+, RHEL 7.4+)"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#license_4","text":"sudo mkdir -p /etc/ssl/nginx && cp /var/tmp/nginx-repo.* /etc/ssl/nginx/","title":"License \uc5c5\ub85c\ub4dc"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#repository_4","text":"sudo yum install wget epel-release sudo curl -sL https://cs.nginx.com/static/files/nginx-plus-7.repo -o /etc/yum.repos.d/nginx-plus-7.repo sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-7.repo sudo yum makecache fast","title":"Repository \ub4f1\ub85d"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#installation_4","text":"sudo yum install -y nginx-plus ca-certificates sudo yum install -y app-protect-dos sudo systemctl enable --now nginx","title":"Installation"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#apt-getubuntu-1804","text":"","title":"apt-get(Ubuntu 18.04)"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#license_5","text":"sudo mkdir -p /etc/ssl/nginx && cp /var/tmp/nginx-repo.* /etc/ssl/nginx/","title":"License \uc5c5\ub85c\ub4dc"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#repository_5","text":"sudo wget https://cs.nginx.com/static/keys/nginx_signing.key sudo apt-key add nginx_signing.key sudo wget https://cs.nginx.com/static/keys/app-protect-security-updates.key sudo apt-key add app-protect-security-updates.key sudo apt-get install apt-transport-https lsb-release ca-certificates printf \"deb https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-plus.list printf \"deb https://pkgs.nginx.com/app-protect/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-app-protect.list printf \"deb https://pkgs.nginx.com/app-protect-dos/ubuntu `lsb_release -cs` nginx-plus\\n\" | sudo tee /etc/apt/sources.list.d/nginx-app-protect-dos.list sudo wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx sudo apt-get update","title":"Repository \ub4f1\ub85d"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#installation_5","text":"sudo apt-get install -y nginx-plus sudo apt-get install app-protect-dos sudo systemctl enable --now nginx","title":"Installation"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#_1","text":"sudo admd -v","title":"\uc124\uce58 \ud655\uc778"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#nginx-plus-app-protect-dos_1","text":"NGINX Config File\uc5d0\uc11c \uc801\uc6a9\ud569\ub2c8\ub2e4. \uc544\ub798\ub294 nginx.conf \uc5d0\uc11c NGINX \uc804\uccb4\uc5d0 App Protect\ub97c \uc801\uc6a9\ud558\ub294 \uc608\uc2dc\uc785\ub2c8\ub2e4.","title":"NGINX Plus + App-Protect DoS \uc801\uc6a9"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#load-module_1","text":"user nginx; worker_processes auto; error_log /var/log/nginx/error.log notice; pid /var/run/nginx.pid; load_module modules/ngx_http_app_protect_dos_module.so; events { worker_connections 1024; } http { ### App Protect DoS \uc801\uc6a9\ubd80 ### app_protect_dos_enable on; app_protect_dos_name \"vs-example\"; app_protect_dos_policy_file \"/etc/app_protect_dos/BADOSDefaultPolicy.json\"; app_protect_dos_monitor \"example.com/\"; ### App Protect DoS \uc801\uc6a9\ubd80 ### include /etc/nginx/mime.types; default_type application/octet-stream; \u2026\u2026[\ud6c4\ub7b5]","title":"Load module"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#nginx-reload-and-app-protect-apply_1","text":"sudo nginx -t && sudo nginx -s reload","title":"Nginx Reload And App Protect Apply"},{"location":"NGINX-Plus/NGINX-Plus/NGINX-Plus-NAP-WAF-DoS-Install-Guide/#app-protect-dos-selinux-policy","text":"sudo vi nginx.te module nginx 1.0; require { type unconfined_t; type httpd_t; type unconfined_service_t; class shm { associate read unix_read unix_write write }; } allow httpd_t unconfined_service_t:shm { associate read unix_read unix_write write }; allow httpd_t unconfined_t:shm { unix_read unix_write }; checkmodule -M -m -o nginx.mod nginx.te semodule_package -o nginx.pp -m nginx.mod semodule -i nginx.pp setsebool -P httpd_can_network_connect 1","title":"App Protect DoS Selinux Policy \uc218\uc815"},{"location":"Protocols/Bash-Script%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-JWT-JWK-JWKS-%EC%83%9D%EC%84%B1/","text":"Bash Shell\uc5d0\uc11c JWK, JWT \uc0dd\uc131 \u00b6 Bash Shell\uc5d0\uc11c JWT, JWK, JWKS\ub97c \uc0dd\uc131\ud558\ub294 \uacfc\uc815\uc5d0 \ub300\ud55c \ub0b4\uc6a9\uc785\ub2c8\ub2e4. NGINX Plus\uc758 JWT Validation \uacfc\uc815\uc5d0\uc11c Subrequest \ubc29\uc2dd\uc744 \uad6c\ud604\ud558\ub294\ub370 \ud544\uc694\ud55c \ud658\uacbd \uad6c\uc131\uc744 \ubaa9\uc801\uc73c\ub85c, Bash Shell\uc5d0\uc11c JWK JWT \uc0dd\uc131 \ud14c\uc2a4\ud2b8 \uacfc\uc815\uc744 \uae30\ub85d\ud588\uc2b5\ub2c8\ub2e4. \uc9c4\ud589 \uc21c\uc11c \u00b6 Bash Shell\uc5d0\uc11c PEM Private Key, Public Key \uc0dd\uc131 \uc0dd\uc131\ud55c Key\ub4e4\uc744 \uae30\ubc18\uc73c\ub85c JWK\ub97c \uc0dd\uc131 JWT \uc0dd\uc131 (\ub2e4\uc74c \ud3ec\uc2a4\ud2b8) Mock-Json-Server\uc758 \ud2b9\uc815 URI\uc5d0\uc11c JWK \ubc18\ud658 \ud14c\uc2a4\ud2b8 (\ub2e4\uc74c \ud3ec\uc2a4\ud2b8) NGINX \ubc18\uc601 CentOS7 \ud658\uacbd\uc5d0\uc11c RS256 \uc54c\uace0\ub9ac\uc998\uc744 \uc0ac\uc6a9\ud588\uc2b5\ub2c8\ub2e4. Packages required \u00b6 yum -y install vim openssl epel-release && yum -y install jq vim : xxd \uba85\ub839\uc5b4\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4. openssl : Private, Public Key\ub97c \uc0dd\uc131\ud558\uace0 Encode, Decode\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4. epel-release : jq \uc124\uce58\ub97c \uc704\ud574 \ud544\uc694\ud569\ub2c8\ub2e4. jq : JSON \ud615\uc2dd Validation\uc744 \uc218\ud589\ud569\ub2c8\ub2e4. \uc804\uccb4 \uc258 \uc2a4\ud06c\ub9bd\ud2b8 \uc694\uc57d \u00b6 ## Generate PEM Keys varO='dddaong' varOU='dddaong' varCN='dddaong.test' openssl genrsa -out $varCN.private.pem 1024 > /dev/null 2>&1 openssl rsa -in $varCN.private.pem -out $varCN.public.pem -pubout > /dev/null 2>&1 PEM=$( cat ${varCN}.private.pem ) ## Extract Modulus From Public Key MOD_HEX=$(openssl rsa -pubin -inform PEM -text -noout < $varCN.public.pem | grep -v -e 'Key' -e 'Modulus' -e 'Exponent' | tr -d '\\n' | tr -d ' ' | tr -d ':') MOD=$(echo $MOD_HEX | xxd -r -p | base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n') ## Extract Exponent From Public Key EXP_HEX=$(openssl rsa -pubin -inform PEM -text -noout < $varCN.public.pem | grep 'Exponent' | cut -f 2 -d '(' | cut -f 1 -d ')' ) EXP=$(printf \"%06X\\n\" $EXP_HEX | xxd -r -p | base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n') ## Generate JWK and JWKS in files KID=$(printf \"%04d\" $(expr $RANDOM % 1000)) JWK='{\"kty\":\"RSA\",\"e\":\"'\"${EXP}\"'\",\"use\":\"sig\",\"kid\":\"'\"${KID}\"'\",\"alg\":\"RS256\",\"n\":\"'\"${MOD}\"'\"}' echo $JWK | jq > $varCN.pubkey.jwk JWKS='{\"keys\":['\"${JWK}\"']}' echo $JWKS | jq > $varCN.pubkey.jwks ## Generate JWT - Header and Payload NOW=$( date +%s ) IAT=\"${NOW}\" EXPIRE=$((${NOW} + 3600)) HEADER_RAW='{\"alg\":\"RS256\",\"typ\":\"JWT\",\"kid\":\"'\"${KID}\"'\"}' HEADER=$( echo -n \"${HEADER_RAW}\" | openssl base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n' ) PAYLOAD_RAW='{\"iat\":'\"${IAT}\"',\"exp\":'\"${EXPIRE}\"',\"aud\":\"'\"${varOU}\"'\",\"sub\":\"'\"${varCN}\"'\"}' PAYLOAD=$( echo -n \"${PAYLOAD_RAW}\" | openssl base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n' ) HEADER_PAYLOAD=\"${HEADER}\".\"${PAYLOAD}\" ## Generate JWT - Signature SIGNATURE=$( openssl dgst -sha256 -sign <(echo -n \"${PEM}\") <(echo -n \"${HEADER_PAYLOAD}\") | openssl base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n' ) ## Save JWT in file JWT=\"${HEADER_PAYLOAD}\".\"${SIGNATURE}\" echo ${JWT} > $varCN.token \uc704 \uc2a4\ud06c\ub9bd\ud2b8\uac00 \uc624\ub958 \uc5c6\uc774 \uc798 \uc9c4\ud589\ub418\uc5c8\ub2e4\uba74, \uc544\ub798 5\uac1c \ud30c\uc77c\uc774 \uc0dd\uc131\ub429\ub2c8\ub2e4. PEM Keys : dddaong.test.private.pem, dddaong.test.public.pem JWK, JWKS : dddaong.test.pub.jwk, dddaong.test.pub.jwks JWT : dddaong.test.token Base Knowledges \u00b6 Based Knowledge : \ud544\uc218 \ud544\ub4dc \u00b6 RFC \ubb38\uc11c\uc5d0 \ub530\ub974\uba74, Public JWK\uc5d0\ub294 Modulus\uc640 Exponent \ud544\ub4dc\uac00 \ud544\uc218\ub85c \ub4e4\uc5b4\uac00\uc57c \ud55c\ub2e4\uace0 \ud569\ub2c8\ub2e4. RFC7518: Parameters a Public Key MUST Have Based Knowledge : JWK \ud615\uc2dd\uacfc PEM \ud615\uc2dd\uc758 \ub3d9\uc77c\uc131 \uac80\uc99d - Public Key \u00b6 \uc544\ub798\ub294 mkjwk.org\uc5d0\uc11c \uc0dd\uc131\ud55c JWK Public Key \ubc0f Public Key (x.509 PEM Format) \uc785\ub2c8\ub2e4. JWK Public Key { \"kty\": \"RSA\", \"e\": \"AQAB\", \"use\": \"sig\", \"kid\": \"0985\", \"alg\": \"RS256\", \"n\": \"5v2V21Q3uJOylP6RAoicdUxIuHkc9xBV0KH3H6MycWVwu9XjGdzTTBTGFFTv6tmXeM2wUjiya9b0F0Q5rX-SdzCZnE5XX_NEMr8F9fTzl1NzYO8QV79TcqEfBc3PWHogaIjF7HUn1dOYi-T1U82LRi5W0EXcZUUt43gteXvr1C00gDuIMl9DPEYyJneIxKWpWoZrO8rCPrdQ0L1iE3-fbmiwCg0yproRVoJ-dWuMcAVO5KR-Zyvs9BWc0njMEkOURHGUpyv3rcguzPyEteetuX-Iy6bqAYKncUGP2Gh_JlLIwqeBW9h-Hbs8wrhK21Dj4WK6sJIO9oTxbi0FYcJoKw\" } \ud544\uc218 \ud544\ub4dc\uc778 e, n\uc740 Non-Human-Readable \ud544\ub4dc\ub85c, Base64url Encode \ub41c \uc0c1\ud0dc\uc785\ub2c8\ub2e4. kty, use, kid, alg \ud544\ub4dc\ub294 Human-Readable \ud544\ub4dc\ub85c\uc11c, RS256\uc744 \uc54c\uace0\ub9ac\uc998 \uc0ac\uc6a9\ud558\uaca0\ub2e4\uace0 \uc120\uc5b8\ud55c\ub2e4\uba74, \uace0\uc815\uac12\uc744 \uac16\uac70\ub098 \uc720\uc800\uac00 \uc9c0\uc815\ud55c \uac12\uc744 \uac16\uc2b5\ub2c8\ub2e4. \"e\": \"AQAB\" \ub294 Exponent \ud544\ub4dc\uc774\uba70, 01 00 01 (65537) \uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4. \uc544\ub798 \uba85\ub839\uc5b4\ub85c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uba85\ub839\uc5b4\ub294 \ubb38\uc790\uc5f4 \"AQAB\" \ub97c base64 \ub514\ucf54\ub4dc, Hexdump \ud6c4\uc5d0 10\uc9c4\uc218\ub85c \ubcc0\ud658\ud558\ub294 \uacfc\uc815\uc785\ub2c8\ub2e4. echo $(( 16#$(echo \"AQAB\" | base64 -d | xxd -p) )) 65537 \"n\": \"Some hash value....\" \ub294 Modulus \ud544\ub4dc\uc774\uba70, \uc704 \uba85\ub839\uc5b4\uc5d0\uc11c \uc0dd\ub7b5\ub41c \ubd80\ubd84\uc774 \ucd94\uac00\ub429\ub2c8\ub2e4. MODULUS_RAW=5v2V21Q3uJOylP6RAoicdUxIuHkc9xBV0KH3H6MycWVwu9XjGdzTTBTGFFTv6tmXeM2wUjiya9b0F0Q5rX-SdzCZnE5XX_NEMr8F9fTzl1NzYO8QV79TcqEfBc3PWHogaIjF7HUn1dOYi-T1U82LRi5W0EXcZUUt43gteXvr1C00gDuIMl9DPEYyJneIxKWpWoZrO8rCPrdQ0L1iE3-fbmiwCg0yproRVoJ-dWuMcAVO5KR-Zyvs9BWc0njMEkOURHGUpyv3rcguzPyEteetuX-Iy6bqAYKncUGP2Gh_JlLIwqeBW9h-Hbs8wrhK21Dj4WK6sJIO9oTxbi0FYcJoKw if [ `expr length ${MODULUS_RAW} % 4` == 2 ]; then MODULUS=${MODULUS_RAW}'=='; fi if [ `expr length ${MODULUS_RAW} % 4` == 3 ]; then MODULUS=${MODULUS_RAW}'='; fi echo $MODULUS | tr '_-' '/+' | base64 -d | xxd -p -u E6FD95DB5437B893B294FE9102889C754C48B8791CF71055D0A1F71FA332 716570BBD5E319DCD34C14C61454EFEAD99778CDB05238B26BD6F4174439 AD7F927730999C4E575FF34432BF05F5F4F397537360EF1057BF5372A11F 05CDCF587A206888C5EC7527D5D3988BE4F553CD8B462E56D045DC65452D E3782D797BEBD42D34803B88325F433C4632267788C4A5A95A866B3BCAC2 3EB750D0BD62137F9F6E68B00A0D32A6BA1156827E756B8C70054EE4A47E 672BECF4159CD278CC124394447194A72BF7ADC82ECCFC84B5E7ADB97F88 CBA6EA0182A771418FD8687F2652C8C2A7815BD87E1DBB3CC2B84ADB50E3 E162BAB0920EF684F16E2D0561C2682B Public Key (x.509 PEM Format) -----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5v2V21Q3uJOylP6RAoic dUxIuHkc9xBV0KH3H6MycWVwu9XjGdzTTBTGFFTv6tmXeM2wUjiya9b0F0Q5rX+S dzCZnE5XX/NEMr8F9fTzl1NzYO8QV79TcqEfBc3PWHogaIjF7HUn1dOYi+T1U82L Ri5W0EXcZUUt43gteXvr1C00gDuIMl9DPEYyJneIxKWpWoZrO8rCPrdQ0L1iE3+f bmiwCg0yproRVoJ+dWuMcAVO5KR+Zyvs9BWc0njMEkOURHGUpyv3rcguzPyEteet uX+Iy6bqAYKncUGP2Gh/JlLIwqeBW9h+Hbs8wrhK21Dj4WK6sJIO9oTxbi0FYcJo KwIDAQAB -----END PUBLIC KEY----- \uc608\uc2dc PEM Public Key\uc758 \uc2dc\uc791, \ub05d \ub9c8\ucee4\ub97c \uc81c\uc678\ud55c \ub098\uba38\uc9c0 \ubb38\uc790\uc5f4\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. PEM_RAW='MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5v2V21Q3uJOylP6RAoic dUxIuHkc9xBV0KH3H6MycWVwu9XjGdzTTBTGFFTv6tmXeM2wUjiya9b0F0Q5rX+S dzCZnE5XX/NEMr8F9fTzl1NzYO8QV79TcqEfBc3PWHogaIjF7HUn1dOYi+T1U82L Ri5W0EXcZUUt43gteXvr1C00gDuIMl9DPEYyJneIxKWpWoZrO8rCPrdQ0L1iE3+f bmiwCg0yproRVoJ+dWuMcAVO5KR+Zyvs9BWc0njMEkOURHGUpyv3rcguzPyEteet uX+Iy6bqAYKncUGP2Gh/JlLIwqeBW9h+Hbs8wrhK21Dj4WK6sJIO9oTxbi0FYcJo KwIDAQAB' echo $PEM_RAW | tr -d \" \" | base64 -d | openssl asn1parse -inform DER -i -strparse 19 0:d=0 hl=4 l= 266 cons: SEQUENCE 4:d=1 hl=4 l= 257 prim: INTEGER :E6FD95DB5437B893B294FE9102889C754C48B8791CF71055D0A1F71FA332716570BBD5E319DCD34C14C61454EFEAD99778CDB05238B26BD6F4174439AD7F927730999C4E575FF34432BF05F5F4F397537360EF1057BF5372A11F05CDCF587A206888C5EC7527D5D3988BE4F553CD8B462E56D045DC65452DE3782D797BEBD42D34803B88325F433C4632267788C4A5A95A866B3BCAC23EB750D0BD62137F9F6E68B00A0D32A6BA1156827E756B8C70054EE4A47E672BECF4159CD278CC124394447194A72BF7ADC82ECCFC84B5E7ADB97F88CBA6EA0182A771418FD8687F2652C8C2A7815BD87E1DBB3CC2B84ADB50E3E162BAB0920EF684F16E2D0561C2682B 265:d=1 hl=2 l= 3 prim: INTEGER :010001 base64 \ub514\ucf54\ub529 \ud6c4, ASN.1 \ud615\uc2dd\uc73c\ub85c \ud30c\uc2f1\ud574\uc8fc\uba74 \uc704\uc640 \uac19\uc774 Hex \ud615\uc2dd\uc758 Modulus \uac12, \uadf8\ub9ac\uace0 01 00 01 \uc758 Exponent \uac12\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. JWK \uc791\uc131\uc2dc \ub3d9\uc77c\uc131 \uac80\uc99d \ub0b4\uc6a9\uc744 \ubc14\ud0d5\uc73c\ub85c \ud544\uc218 \ud544\ub4dc\ub97c Public Key\uc5d0\uc11c \ucd94\ucd9c \ubc0f \uc791\uc131\ud558\uace0, \ub098\uba38\uc9c0 \ud544\ub4dc\ub97c \uc218\uae30 \uc791\uc131\ud574\uc8fc\uba74 \ub418\uaca0\uc2b5\ub2c8\ub2e4. Based Knowledge: PEM\uc5d0\uc11c \ucd94\ucd9c\ud55c Modulus (Hex Format)\ub97c Encode\ud558\uae30 \u00b6 # \ucd94\ucd9c\ud55c Hex \uac12\uc758 \ubcc0\uc218 \uc120\uc5b8 PEM='E6FD95DB5437B893B294FE9102889C754C48B8791CF71055D0A1F71FA332716570BBD5E319DCD34C14C61454EFEAD99778CDB05238B26BD6F4174439AD7F927730999C4E575FF34432BF05F5F4F397537360EF1057BF5372A11F05CDCF587A206888C5EC7527D5D3988BE4F553CD8B462E56D045DC65452DE3782D797BEBD42D34803B88325F433C4632267788C4A5A95A866B3BCAC23EB750D0BD62137F9F6E68B00A0D32A6BA1156827E756B8C70054EE4A47E672BECF4159CD278CC124394447194A72BF7ADC82ECCFC84B5E7ADB97F88CBA6EA0182A771418FD8687F2652C8C2A7815BD87E1DBB3CC2B84ADB50E3E162BAB0920EF684F16E2D0561C2682B' # Base64 Encode echo $PEM | xxd -r -p | base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n' 5v2V21Q3uJOylP6RAoicdUxIuHkc9xBV0KH3H6MycWVwu9XjGdzTTBTGFFTv6tmXeM2wUjiya9b0F0Q5rX-SdzCZnE5XX_NEMr8F9fTzl1NzYO8QV79TcqEfBc3PWHogaIjF7HUn1dOYi-T1U82LRi5W0EXcZUUt43gteXvr1C00gDuIMl9DPEYyJneIxKWpWoZrO8rCPrdQ0L1iE3-fbmiwCg0yproRVoJ-dWuMcAVO5KR-Zyvs9BWc0njMEkOURHGUpyv3rcguzPyEteetuX-Iy6bqAYKncUGP2Gh_JlLIwqeBW9h-Hbs8wrhK21Dj4WK6sJIO9oTxbi0FYcJoKw \uc774\uc0c1\uc758 Base Knowledge\ub4e4\uc744 \uc0ac\uc6a9\ud574 PEM Public Key\uc5d0\uc11c Modulus, Exponent\ub97c \ucd94\ucd9c\ud574 JWK \uc0dd\uc131\uc744 \uc218\ud589\ud569\ub2c8\ub2e4. JWK \uc0dd\uc131 \u00b6 \uc774 \uacfc\uc815\uc5d0\uc11c\ub294, Public Key(PEM \ud30c\uc77c, X.509\ud615\uc2dd)\uc5d0\uc11c JWK \uc791\uc131\uc5d0 \ud544\uc694\ud55c \ud544\ub4dc\uac12\uc744 \uad6c\ud574 JWK \ud615\uc2dd\uc73c\ub85c \uc791\uc131, jq\ub97c \uc0ac\uc6a9\ud574 Validation \ubc0f \ucd9c\ub825\uc744 \uc218\ud589\ud569\ub2c8\ub2e4. Openssl\uc744 \uc0ac\uc6a9\ud574 PEM Public / Private Key \uc0dd\uc131 \u00b6 varO='dddaong' varOU='dddaong' varCN='dddaong.test' openssl genrsa -out $varCN.private.pem 1024 > /dev/null 2>&1 openssl rsa -in $varCN.private.pem -out $varCN.public.pem -pubout > /dev/null 2>&1 PEM=$( cat ${varCN}.private.pem ) Extract Modulus (in Hex) and base64url Encode \u00b6 \uc544\ub798 openssl \uba85\ub839\uc5b4\ub97c \uc2e4\ud589\ud574 Modulus\uc640 Exponent\ub97c \ucd94\ucd9c\ud569\ub2c8\ub2e4. \uacb0\uacfc\ub294 \uc544\ub798\uc640 \uac19\uc774 Hex \ud615\uc2dd\uc73c\ub85c \ub098\ud0c0\ub0a9\ub2c8\ub2e4. openssl rsa -pubin -inform PEM -text -noout < $varCN.public.pem Public-Key: (1024 bit) Modulus: 00:bc:d1:11:e3:58:48:61:e9:8d:5f:18:66:b1:64: 5c:5f:3d:15:26:1d:d0:e6:a3:f2:73:bf:58:ca:e3: 63:73:6c:49:5e:62:2c:db:7b:67:d1:09:ca:ba:76: ea:2b:33:71:f6:e1:9b:d5:6d:84:59:71:97:04:c6: ff:bc:dd:d0:1b:ab:e5:20:66:0c:40:b6:4a:e9:68: 27:c4:75:cc:84:2f:bd:d3:d0:b9:e2:7f:ea:97:30: c5:a9:f2:af:03:73:f8:07:57:21:ea:74:c3:9d:3d: b6:a2:71:d9:01:66:c1:57:72:9a:4c:ab:08:ed:5c: 7f:4a:0f:e7:e4:50:5d:48:13 Exponent: 65537 (0x10001) Modulus \uac12\uc744 HEX\ub9cc \uc815\uc81c\ud574\uc11c Base64url \uc778\ucf54\ub529 \ud569\ub2c8\ub2e4. MOD_HEX=$(openssl rsa -pubin -inform PEM -text -noout < $varCN.public.pem | grep -v -e 'Key' -e 'Modulus' -e 'Exponent' | tr -d '\\n' | tr -d ' ' | tr -d ':') MOD=$(echo $MOD_HEX | xxd -r -p | base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n') echo $MOD Extract Exponent (in 6 Digits Hex) and base64url Encode \u00b6 Exponent\ub294 65537 \ub85c \uacb0\uacfc\uac12\uc774 AQAB \uc77c \uac83\uc73c\ub85c \uc608\uc0c1\ub418\uc9c0\ub9cc, \ud14c\uc2a4\ud2b8 \uacfc\uc815\uc774\ubbc0\ub85c \ub3d9\uc77c\ud55c \uacfc\uc815\uc744 \uac70\uccd0\uc90d\ub2c8\ub2e4. Modulus\ub294 Zero-leading Hex \uac12\uc774 \ubaa8\ub450 \ud45c\uc2dc\ub418\uc9c0\ub9cc, Exponent\uc758 \uacbd\uc6b0 010001\uc774 10001\ub85c \ud45c\uae30\ub418\uae30 \ub54c\ubb38\uc5d0 echo \uac00 \uc544\ub2cc printf \ucee4\ub9e8\ub4dc\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. EXP_HEX=$(openssl rsa -pubin -inform PEM -text -noout < $varCN.public.pem | grep 'Exponent' | cut -f 2 -d '(' | cut -f 1 -d ')' ) EXP=$(printf \"%06X\\n\" $EXP_HEX | xxd -r -p | base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n') echo $EXP Extract Modulus and Exponent (\ub2e4\ub978 \ubc29\ubc95) \u00b6 \uc880\ub354 \uba85\ud655\ud558\uac8c Modulus\uc640 Exponent\uc758 Hex \uac12\uc744 \uad6c\ud558\ub294 \ubc29\ubc95\uc774 \uc788\uc2b5\ub2c8\ub2e4. openssl asn1parse -in $varCN.public.pem 0:d=0 hl=3 l= 159 cons: SEQUENCE 3:d=1 hl=2 l= 13 cons: SEQUENCE 5:d=2 hl=2 l= 9 prim: OBJECT :rsaEncryption 16:d=2 hl=2 l= 0 prim: NULL 18:d=1 hl=3 l= 141 prim: BIT STRING asn1parse\ub97c \uc0ac\uc6a9\ud574 \ub098\ud0c0\ub098\ub294 \uacb0\uacfc\uc758 BIT STRING \uc704\uce58\uc5d0 Modulus, Exponent\uac00 \uc788\uc2b5\ub2c8\ub2e4. \ucee4\ub9e8\ub4dc \uc2e4\ud589 \uacb0\uacfc\uc758 \uac01 \ub77c\uc778 \ub9e8 \uc55e\uc758 \uc22b\uc790\ub294 offset\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4. \uadf8\ub7f0\ub370, RSA Key Bit \uc218\uc5d0 \ub530\ub77c \uc774 offset \uc22b\uc790\uac00 \ubcc0\ud560 \ub54c\uac00 \uc788\uc5b4 \uc774 \ubc29\ubc95\uc744 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4. openssl asn1parse -in $varCN.public.pem -strparse 18 0:d=0 hl=3 l= 137 cons: SEQUENCE 3:d=1 hl=3 l= 129 prim: INTEGER :D22FF1D7EF070A99309298BFE5E290E20BDB11C0F86E9CC6E4106D7BF0272AB3FA616C5465606F302CD7265E8AE04796A4D2A3A15D67A1ADFEFB825757AAE59DF965EEEA15CF81E08C1652D8A36A529B8BE9BC39CC9FDB7C4BF6673491D299B55202B091D3B96F8A4079E446DAB436607ACE5620301033F594B15652AAE8A4D7 135:d=1 hl=2 l= 3 prim: INTEGER :010001 Generate JWK, JWKS \u00b6 \ucd94\ucd9c\ud55c \ud544\uc218 \ud544\ub4dc\ub97c \uae30\ubc18\uc73c\ub85c JWKS\ub97c \uc791\uc131\ud569\ub2c8\ub2e4. KID=$(printf \"%04d\" $(expr $RANDOM % 1000)) JWK='{\"kty\":\"RSA\",\"e\":\"'\"${EXP}\"'\",\"use\":\"sig\",\"kid\":\"'\"${KID}\"'\",\"alg\":\"RS256\",\"n\":\"'\"${MOD}\"'\"}' echo $JWK | jq > $varOU.pubkey.jwk JWKS='{\"keys\":['\"${JWK}\"']}' echo $JWKS | jq > $varOU.pubkey.jwks JWT \uc0dd\uc131 \u00b6 Generate JWT \u00b6 1\uc2dc\uac04\uc758 Expiry time\uc744 \uac16\ub294 Token\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4. Signature \ubd80\ubd84\uc758 \uc11c\uba85\uc740 X.509 \ud615\uc2dd PEM Private Key\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. NOW=$( date +%s ) IAT=\"${NOW}\" EXPIRE=$((${NOW} + 3600)) ## [\ucc38\uace0] \uc774\ud558\uc758 \uacfc\uc815\uc740 JWK \uc0dd\uc131\uacfc\uc815\uc5d0\uc11c \uc774\ubbf8 \uc218\ud589\ud55c \ucee4\ub9e8\ub4dc/\ubcc0\uc218 \uc120\uc5b8\uc785\ub2c8\ub2e4. varO='dddaong' varOU='dddaong' varCN='dddaong.test' KID=$(printf \"%04d\" $(expr $RANDOM % 1000)) openssl genrsa -out $varCN.private.pem 1024 > /dev/null 2>&1 openssl rsa -in $varCN.private.pem -out $varCN.public.pem -pubout > /dev/null 2>&1 PEM=$( cat ${varCN}.private.pem ) ## Header HEADER_RAW='{\"alg\":\"RS256\",\"typ\":\"JWT\",\"kid\":\"'\"${KID}\"'\"}' HEADER=$( echo -n \"${HEADER_RAW}\" | openssl base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n' ) ## Payload PAYLOAD_RAW='{\"iat\":'\"${IAT}\"',\"exp\":'\"${EXPIRE}\"',\"aud\":\"'\"${varOU}\"'\",\"sub\":\"'\"${varCN}\"'\"}' PAYLOAD=$( echo -n \"${PAYLOAD_RAW}\" | openssl base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n' ) HEADER_PAYLOAD=\"${HEADER}\".\"${PAYLOAD}\" SIGNATURE=$( openssl dgst -sha256 -sign <(echo -n \"${PEM}\") <(echo -n \"${HEADER_PAYLOAD}\") | openssl base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n' ) JWT=\"${HEADER_PAYLOAD}\".\"${SIGNATURE}\" echo ${JWT} > $varCN.token \uc774\uc0c1\uc73c\ub85c JWK, JWKS, JWT \uc0dd\uc131\uacfc\uc815\uc744 \uc815\ub9ac\ud569\ub2c8\ub2e4.","title":"JWT - Bash Script\ub97c \uc0ac\uc6a9\ud55c JWT, JWK, JWKS \uc0dd\uc131"},{"location":"Protocols/Bash-Script%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-JWT-JWK-JWKS-%EC%83%9D%EC%84%B1/#bash-shell-jwk-jwt","text":"Bash Shell\uc5d0\uc11c JWT, JWK, JWKS\ub97c \uc0dd\uc131\ud558\ub294 \uacfc\uc815\uc5d0 \ub300\ud55c \ub0b4\uc6a9\uc785\ub2c8\ub2e4. NGINX Plus\uc758 JWT Validation \uacfc\uc815\uc5d0\uc11c Subrequest \ubc29\uc2dd\uc744 \uad6c\ud604\ud558\ub294\ub370 \ud544\uc694\ud55c \ud658\uacbd \uad6c\uc131\uc744 \ubaa9\uc801\uc73c\ub85c, Bash Shell\uc5d0\uc11c JWK JWT \uc0dd\uc131 \ud14c\uc2a4\ud2b8 \uacfc\uc815\uc744 \uae30\ub85d\ud588\uc2b5\ub2c8\ub2e4.","title":"Bash Shell\uc5d0\uc11c JWK, JWT \uc0dd\uc131"},{"location":"Protocols/Bash-Script%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-JWT-JWK-JWKS-%EC%83%9D%EC%84%B1/#_1","text":"Bash Shell\uc5d0\uc11c PEM Private Key, Public Key \uc0dd\uc131 \uc0dd\uc131\ud55c Key\ub4e4\uc744 \uae30\ubc18\uc73c\ub85c JWK\ub97c \uc0dd\uc131 JWT \uc0dd\uc131 (\ub2e4\uc74c \ud3ec\uc2a4\ud2b8) Mock-Json-Server\uc758 \ud2b9\uc815 URI\uc5d0\uc11c JWK \ubc18\ud658 \ud14c\uc2a4\ud2b8 (\ub2e4\uc74c \ud3ec\uc2a4\ud2b8) NGINX \ubc18\uc601 CentOS7 \ud658\uacbd\uc5d0\uc11c RS256 \uc54c\uace0\ub9ac\uc998\uc744 \uc0ac\uc6a9\ud588\uc2b5\ub2c8\ub2e4.","title":"\uc9c4\ud589 \uc21c\uc11c"},{"location":"Protocols/Bash-Script%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-JWT-JWK-JWKS-%EC%83%9D%EC%84%B1/#packages-required","text":"yum -y install vim openssl epel-release && yum -y install jq vim : xxd \uba85\ub839\uc5b4\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4. openssl : Private, Public Key\ub97c \uc0dd\uc131\ud558\uace0 Encode, Decode\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4. epel-release : jq \uc124\uce58\ub97c \uc704\ud574 \ud544\uc694\ud569\ub2c8\ub2e4. jq : JSON \ud615\uc2dd Validation\uc744 \uc218\ud589\ud569\ub2c8\ub2e4.","title":"Packages required"},{"location":"Protocols/Bash-Script%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-JWT-JWK-JWKS-%EC%83%9D%EC%84%B1/#_2","text":"## Generate PEM Keys varO='dddaong' varOU='dddaong' varCN='dddaong.test' openssl genrsa -out $varCN.private.pem 1024 > /dev/null 2>&1 openssl rsa -in $varCN.private.pem -out $varCN.public.pem -pubout > /dev/null 2>&1 PEM=$( cat ${varCN}.private.pem ) ## Extract Modulus From Public Key MOD_HEX=$(openssl rsa -pubin -inform PEM -text -noout < $varCN.public.pem | grep -v -e 'Key' -e 'Modulus' -e 'Exponent' | tr -d '\\n' | tr -d ' ' | tr -d ':') MOD=$(echo $MOD_HEX | xxd -r -p | base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n') ## Extract Exponent From Public Key EXP_HEX=$(openssl rsa -pubin -inform PEM -text -noout < $varCN.public.pem | grep 'Exponent' | cut -f 2 -d '(' | cut -f 1 -d ')' ) EXP=$(printf \"%06X\\n\" $EXP_HEX | xxd -r -p | base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n') ## Generate JWK and JWKS in files KID=$(printf \"%04d\" $(expr $RANDOM % 1000)) JWK='{\"kty\":\"RSA\",\"e\":\"'\"${EXP}\"'\",\"use\":\"sig\",\"kid\":\"'\"${KID}\"'\",\"alg\":\"RS256\",\"n\":\"'\"${MOD}\"'\"}' echo $JWK | jq > $varCN.pubkey.jwk JWKS='{\"keys\":['\"${JWK}\"']}' echo $JWKS | jq > $varCN.pubkey.jwks ## Generate JWT - Header and Payload NOW=$( date +%s ) IAT=\"${NOW}\" EXPIRE=$((${NOW} + 3600)) HEADER_RAW='{\"alg\":\"RS256\",\"typ\":\"JWT\",\"kid\":\"'\"${KID}\"'\"}' HEADER=$( echo -n \"${HEADER_RAW}\" | openssl base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n' ) PAYLOAD_RAW='{\"iat\":'\"${IAT}\"',\"exp\":'\"${EXPIRE}\"',\"aud\":\"'\"${varOU}\"'\",\"sub\":\"'\"${varCN}\"'\"}' PAYLOAD=$( echo -n \"${PAYLOAD_RAW}\" | openssl base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n' ) HEADER_PAYLOAD=\"${HEADER}\".\"${PAYLOAD}\" ## Generate JWT - Signature SIGNATURE=$( openssl dgst -sha256 -sign <(echo -n \"${PEM}\") <(echo -n \"${HEADER_PAYLOAD}\") | openssl base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n' ) ## Save JWT in file JWT=\"${HEADER_PAYLOAD}\".\"${SIGNATURE}\" echo ${JWT} > $varCN.token \uc704 \uc2a4\ud06c\ub9bd\ud2b8\uac00 \uc624\ub958 \uc5c6\uc774 \uc798 \uc9c4\ud589\ub418\uc5c8\ub2e4\uba74, \uc544\ub798 5\uac1c \ud30c\uc77c\uc774 \uc0dd\uc131\ub429\ub2c8\ub2e4. PEM Keys : dddaong.test.private.pem, dddaong.test.public.pem JWK, JWKS : dddaong.test.pub.jwk, dddaong.test.pub.jwks JWT : dddaong.test.token","title":"\uc804\uccb4 \uc258 \uc2a4\ud06c\ub9bd\ud2b8 \uc694\uc57d"},{"location":"Protocols/Bash-Script%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-JWT-JWK-JWKS-%EC%83%9D%EC%84%B1/#base-knowledges","text":"","title":"Base Knowledges"},{"location":"Protocols/Bash-Script%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-JWT-JWK-JWKS-%EC%83%9D%EC%84%B1/#based-knowledge","text":"RFC \ubb38\uc11c\uc5d0 \ub530\ub974\uba74, Public JWK\uc5d0\ub294 Modulus\uc640 Exponent \ud544\ub4dc\uac00 \ud544\uc218\ub85c \ub4e4\uc5b4\uac00\uc57c \ud55c\ub2e4\uace0 \ud569\ub2c8\ub2e4. RFC7518: Parameters a Public Key MUST Have","title":"Based Knowledge : \ud544\uc218 \ud544\ub4dc"},{"location":"Protocols/Bash-Script%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-JWT-JWK-JWKS-%EC%83%9D%EC%84%B1/#based-knowledge-jwk-pem-public-key","text":"\uc544\ub798\ub294 mkjwk.org\uc5d0\uc11c \uc0dd\uc131\ud55c JWK Public Key \ubc0f Public Key (x.509 PEM Format) \uc785\ub2c8\ub2e4. JWK Public Key { \"kty\": \"RSA\", \"e\": \"AQAB\", \"use\": \"sig\", \"kid\": \"0985\", \"alg\": \"RS256\", \"n\": \"5v2V21Q3uJOylP6RAoicdUxIuHkc9xBV0KH3H6MycWVwu9XjGdzTTBTGFFTv6tmXeM2wUjiya9b0F0Q5rX-SdzCZnE5XX_NEMr8F9fTzl1NzYO8QV79TcqEfBc3PWHogaIjF7HUn1dOYi-T1U82LRi5W0EXcZUUt43gteXvr1C00gDuIMl9DPEYyJneIxKWpWoZrO8rCPrdQ0L1iE3-fbmiwCg0yproRVoJ-dWuMcAVO5KR-Zyvs9BWc0njMEkOURHGUpyv3rcguzPyEteetuX-Iy6bqAYKncUGP2Gh_JlLIwqeBW9h-Hbs8wrhK21Dj4WK6sJIO9oTxbi0FYcJoKw\" } \ud544\uc218 \ud544\ub4dc\uc778 e, n\uc740 Non-Human-Readable \ud544\ub4dc\ub85c, Base64url Encode \ub41c \uc0c1\ud0dc\uc785\ub2c8\ub2e4. kty, use, kid, alg \ud544\ub4dc\ub294 Human-Readable \ud544\ub4dc\ub85c\uc11c, RS256\uc744 \uc54c\uace0\ub9ac\uc998 \uc0ac\uc6a9\ud558\uaca0\ub2e4\uace0 \uc120\uc5b8\ud55c\ub2e4\uba74, \uace0\uc815\uac12\uc744 \uac16\uac70\ub098 \uc720\uc800\uac00 \uc9c0\uc815\ud55c \uac12\uc744 \uac16\uc2b5\ub2c8\ub2e4. \"e\": \"AQAB\" \ub294 Exponent \ud544\ub4dc\uc774\uba70, 01 00 01 (65537) \uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4. \uc544\ub798 \uba85\ub839\uc5b4\ub85c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uba85\ub839\uc5b4\ub294 \ubb38\uc790\uc5f4 \"AQAB\" \ub97c base64 \ub514\ucf54\ub4dc, Hexdump \ud6c4\uc5d0 10\uc9c4\uc218\ub85c \ubcc0\ud658\ud558\ub294 \uacfc\uc815\uc785\ub2c8\ub2e4. echo $(( 16#$(echo \"AQAB\" | base64 -d | xxd -p) )) 65537 \"n\": \"Some hash value....\" \ub294 Modulus \ud544\ub4dc\uc774\uba70, \uc704 \uba85\ub839\uc5b4\uc5d0\uc11c \uc0dd\ub7b5\ub41c \ubd80\ubd84\uc774 \ucd94\uac00\ub429\ub2c8\ub2e4. MODULUS_RAW=5v2V21Q3uJOylP6RAoicdUxIuHkc9xBV0KH3H6MycWVwu9XjGdzTTBTGFFTv6tmXeM2wUjiya9b0F0Q5rX-SdzCZnE5XX_NEMr8F9fTzl1NzYO8QV79TcqEfBc3PWHogaIjF7HUn1dOYi-T1U82LRi5W0EXcZUUt43gteXvr1C00gDuIMl9DPEYyJneIxKWpWoZrO8rCPrdQ0L1iE3-fbmiwCg0yproRVoJ-dWuMcAVO5KR-Zyvs9BWc0njMEkOURHGUpyv3rcguzPyEteetuX-Iy6bqAYKncUGP2Gh_JlLIwqeBW9h-Hbs8wrhK21Dj4WK6sJIO9oTxbi0FYcJoKw if [ `expr length ${MODULUS_RAW} % 4` == 2 ]; then MODULUS=${MODULUS_RAW}'=='; fi if [ `expr length ${MODULUS_RAW} % 4` == 3 ]; then MODULUS=${MODULUS_RAW}'='; fi echo $MODULUS | tr '_-' '/+' | base64 -d | xxd -p -u E6FD95DB5437B893B294FE9102889C754C48B8791CF71055D0A1F71FA332 716570BBD5E319DCD34C14C61454EFEAD99778CDB05238B26BD6F4174439 AD7F927730999C4E575FF34432BF05F5F4F397537360EF1057BF5372A11F 05CDCF587A206888C5EC7527D5D3988BE4F553CD8B462E56D045DC65452D E3782D797BEBD42D34803B88325F433C4632267788C4A5A95A866B3BCAC2 3EB750D0BD62137F9F6E68B00A0D32A6BA1156827E756B8C70054EE4A47E 672BECF4159CD278CC124394447194A72BF7ADC82ECCFC84B5E7ADB97F88 CBA6EA0182A771418FD8687F2652C8C2A7815BD87E1DBB3CC2B84ADB50E3 E162BAB0920EF684F16E2D0561C2682B Public Key (x.509 PEM Format) -----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5v2V21Q3uJOylP6RAoic dUxIuHkc9xBV0KH3H6MycWVwu9XjGdzTTBTGFFTv6tmXeM2wUjiya9b0F0Q5rX+S dzCZnE5XX/NEMr8F9fTzl1NzYO8QV79TcqEfBc3PWHogaIjF7HUn1dOYi+T1U82L Ri5W0EXcZUUt43gteXvr1C00gDuIMl9DPEYyJneIxKWpWoZrO8rCPrdQ0L1iE3+f bmiwCg0yproRVoJ+dWuMcAVO5KR+Zyvs9BWc0njMEkOURHGUpyv3rcguzPyEteet uX+Iy6bqAYKncUGP2Gh/JlLIwqeBW9h+Hbs8wrhK21Dj4WK6sJIO9oTxbi0FYcJo KwIDAQAB -----END PUBLIC KEY----- \uc608\uc2dc PEM Public Key\uc758 \uc2dc\uc791, \ub05d \ub9c8\ucee4\ub97c \uc81c\uc678\ud55c \ub098\uba38\uc9c0 \ubb38\uc790\uc5f4\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. PEM_RAW='MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5v2V21Q3uJOylP6RAoic dUxIuHkc9xBV0KH3H6MycWVwu9XjGdzTTBTGFFTv6tmXeM2wUjiya9b0F0Q5rX+S dzCZnE5XX/NEMr8F9fTzl1NzYO8QV79TcqEfBc3PWHogaIjF7HUn1dOYi+T1U82L Ri5W0EXcZUUt43gteXvr1C00gDuIMl9DPEYyJneIxKWpWoZrO8rCPrdQ0L1iE3+f bmiwCg0yproRVoJ+dWuMcAVO5KR+Zyvs9BWc0njMEkOURHGUpyv3rcguzPyEteet uX+Iy6bqAYKncUGP2Gh/JlLIwqeBW9h+Hbs8wrhK21Dj4WK6sJIO9oTxbi0FYcJo KwIDAQAB' echo $PEM_RAW | tr -d \" \" | base64 -d | openssl asn1parse -inform DER -i -strparse 19 0:d=0 hl=4 l= 266 cons: SEQUENCE 4:d=1 hl=4 l= 257 prim: INTEGER :E6FD95DB5437B893B294FE9102889C754C48B8791CF71055D0A1F71FA332716570BBD5E319DCD34C14C61454EFEAD99778CDB05238B26BD6F4174439AD7F927730999C4E575FF34432BF05F5F4F397537360EF1057BF5372A11F05CDCF587A206888C5EC7527D5D3988BE4F553CD8B462E56D045DC65452DE3782D797BEBD42D34803B88325F433C4632267788C4A5A95A866B3BCAC23EB750D0BD62137F9F6E68B00A0D32A6BA1156827E756B8C70054EE4A47E672BECF4159CD278CC124394447194A72BF7ADC82ECCFC84B5E7ADB97F88CBA6EA0182A771418FD8687F2652C8C2A7815BD87E1DBB3CC2B84ADB50E3E162BAB0920EF684F16E2D0561C2682B 265:d=1 hl=2 l= 3 prim: INTEGER :010001 base64 \ub514\ucf54\ub529 \ud6c4, ASN.1 \ud615\uc2dd\uc73c\ub85c \ud30c\uc2f1\ud574\uc8fc\uba74 \uc704\uc640 \uac19\uc774 Hex \ud615\uc2dd\uc758 Modulus \uac12, \uadf8\ub9ac\uace0 01 00 01 \uc758 Exponent \uac12\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. JWK \uc791\uc131\uc2dc \ub3d9\uc77c\uc131 \uac80\uc99d \ub0b4\uc6a9\uc744 \ubc14\ud0d5\uc73c\ub85c \ud544\uc218 \ud544\ub4dc\ub97c Public Key\uc5d0\uc11c \ucd94\ucd9c \ubc0f \uc791\uc131\ud558\uace0, \ub098\uba38\uc9c0 \ud544\ub4dc\ub97c \uc218\uae30 \uc791\uc131\ud574\uc8fc\uba74 \ub418\uaca0\uc2b5\ub2c8\ub2e4.","title":"Based Knowledge : JWK \ud615\uc2dd\uacfc PEM \ud615\uc2dd\uc758 \ub3d9\uc77c\uc131 \uac80\uc99d - Public Key"},{"location":"Protocols/Bash-Script%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-JWT-JWK-JWKS-%EC%83%9D%EC%84%B1/#based-knowledge-pem-modulus-hex-format-encode","text":"# \ucd94\ucd9c\ud55c Hex \uac12\uc758 \ubcc0\uc218 \uc120\uc5b8 PEM='E6FD95DB5437B893B294FE9102889C754C48B8791CF71055D0A1F71FA332716570BBD5E319DCD34C14C61454EFEAD99778CDB05238B26BD6F4174439AD7F927730999C4E575FF34432BF05F5F4F397537360EF1057BF5372A11F05CDCF587A206888C5EC7527D5D3988BE4F553CD8B462E56D045DC65452DE3782D797BEBD42D34803B88325F433C4632267788C4A5A95A866B3BCAC23EB750D0BD62137F9F6E68B00A0D32A6BA1156827E756B8C70054EE4A47E672BECF4159CD278CC124394447194A72BF7ADC82ECCFC84B5E7ADB97F88CBA6EA0182A771418FD8687F2652C8C2A7815BD87E1DBB3CC2B84ADB50E3E162BAB0920EF684F16E2D0561C2682B' # Base64 Encode echo $PEM | xxd -r -p | base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n' 5v2V21Q3uJOylP6RAoicdUxIuHkc9xBV0KH3H6MycWVwu9XjGdzTTBTGFFTv6tmXeM2wUjiya9b0F0Q5rX-SdzCZnE5XX_NEMr8F9fTzl1NzYO8QV79TcqEfBc3PWHogaIjF7HUn1dOYi-T1U82LRi5W0EXcZUUt43gteXvr1C00gDuIMl9DPEYyJneIxKWpWoZrO8rCPrdQ0L1iE3-fbmiwCg0yproRVoJ-dWuMcAVO5KR-Zyvs9BWc0njMEkOURHGUpyv3rcguzPyEteetuX-Iy6bqAYKncUGP2Gh_JlLIwqeBW9h-Hbs8wrhK21Dj4WK6sJIO9oTxbi0FYcJoKw \uc774\uc0c1\uc758 Base Knowledge\ub4e4\uc744 \uc0ac\uc6a9\ud574 PEM Public Key\uc5d0\uc11c Modulus, Exponent\ub97c \ucd94\ucd9c\ud574 JWK \uc0dd\uc131\uc744 \uc218\ud589\ud569\ub2c8\ub2e4.","title":"Based Knowledge: PEM\uc5d0\uc11c \ucd94\ucd9c\ud55c Modulus (Hex Format)\ub97c Encode\ud558\uae30"},{"location":"Protocols/Bash-Script%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-JWT-JWK-JWKS-%EC%83%9D%EC%84%B1/#jwk","text":"\uc774 \uacfc\uc815\uc5d0\uc11c\ub294, Public Key(PEM \ud30c\uc77c, X.509\ud615\uc2dd)\uc5d0\uc11c JWK \uc791\uc131\uc5d0 \ud544\uc694\ud55c \ud544\ub4dc\uac12\uc744 \uad6c\ud574 JWK \ud615\uc2dd\uc73c\ub85c \uc791\uc131, jq\ub97c \uc0ac\uc6a9\ud574 Validation \ubc0f \ucd9c\ub825\uc744 \uc218\ud589\ud569\ub2c8\ub2e4.","title":"JWK \uc0dd\uc131"},{"location":"Protocols/Bash-Script%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-JWT-JWK-JWKS-%EC%83%9D%EC%84%B1/#openssl-pem-public-private-key","text":"varO='dddaong' varOU='dddaong' varCN='dddaong.test' openssl genrsa -out $varCN.private.pem 1024 > /dev/null 2>&1 openssl rsa -in $varCN.private.pem -out $varCN.public.pem -pubout > /dev/null 2>&1 PEM=$( cat ${varCN}.private.pem )","title":"Openssl\uc744 \uc0ac\uc6a9\ud574 PEM Public / Private Key \uc0dd\uc131"},{"location":"Protocols/Bash-Script%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-JWT-JWK-JWKS-%EC%83%9D%EC%84%B1/#extract-modulus-in-hex-and-base64url-encode","text":"\uc544\ub798 openssl \uba85\ub839\uc5b4\ub97c \uc2e4\ud589\ud574 Modulus\uc640 Exponent\ub97c \ucd94\ucd9c\ud569\ub2c8\ub2e4. \uacb0\uacfc\ub294 \uc544\ub798\uc640 \uac19\uc774 Hex \ud615\uc2dd\uc73c\ub85c \ub098\ud0c0\ub0a9\ub2c8\ub2e4. openssl rsa -pubin -inform PEM -text -noout < $varCN.public.pem Public-Key: (1024 bit) Modulus: 00:bc:d1:11:e3:58:48:61:e9:8d:5f:18:66:b1:64: 5c:5f:3d:15:26:1d:d0:e6:a3:f2:73:bf:58:ca:e3: 63:73:6c:49:5e:62:2c:db:7b:67:d1:09:ca:ba:76: ea:2b:33:71:f6:e1:9b:d5:6d:84:59:71:97:04:c6: ff:bc:dd:d0:1b:ab:e5:20:66:0c:40:b6:4a:e9:68: 27:c4:75:cc:84:2f:bd:d3:d0:b9:e2:7f:ea:97:30: c5:a9:f2:af:03:73:f8:07:57:21:ea:74:c3:9d:3d: b6:a2:71:d9:01:66:c1:57:72:9a:4c:ab:08:ed:5c: 7f:4a:0f:e7:e4:50:5d:48:13 Exponent: 65537 (0x10001) Modulus \uac12\uc744 HEX\ub9cc \uc815\uc81c\ud574\uc11c Base64url \uc778\ucf54\ub529 \ud569\ub2c8\ub2e4. MOD_HEX=$(openssl rsa -pubin -inform PEM -text -noout < $varCN.public.pem | grep -v -e 'Key' -e 'Modulus' -e 'Exponent' | tr -d '\\n' | tr -d ' ' | tr -d ':') MOD=$(echo $MOD_HEX | xxd -r -p | base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n') echo $MOD","title":"Extract Modulus (in Hex) and base64url Encode"},{"location":"Protocols/Bash-Script%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-JWT-JWK-JWKS-%EC%83%9D%EC%84%B1/#extract-exponent-in-6-digits-hex-and-base64url-encode","text":"Exponent\ub294 65537 \ub85c \uacb0\uacfc\uac12\uc774 AQAB \uc77c \uac83\uc73c\ub85c \uc608\uc0c1\ub418\uc9c0\ub9cc, \ud14c\uc2a4\ud2b8 \uacfc\uc815\uc774\ubbc0\ub85c \ub3d9\uc77c\ud55c \uacfc\uc815\uc744 \uac70\uccd0\uc90d\ub2c8\ub2e4. Modulus\ub294 Zero-leading Hex \uac12\uc774 \ubaa8\ub450 \ud45c\uc2dc\ub418\uc9c0\ub9cc, Exponent\uc758 \uacbd\uc6b0 010001\uc774 10001\ub85c \ud45c\uae30\ub418\uae30 \ub54c\ubb38\uc5d0 echo \uac00 \uc544\ub2cc printf \ucee4\ub9e8\ub4dc\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. EXP_HEX=$(openssl rsa -pubin -inform PEM -text -noout < $varCN.public.pem | grep 'Exponent' | cut -f 2 -d '(' | cut -f 1 -d ')' ) EXP=$(printf \"%06X\\n\" $EXP_HEX | xxd -r -p | base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n') echo $EXP","title":"Extract Exponent (in 6 Digits Hex) and base64url Encode"},{"location":"Protocols/Bash-Script%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-JWT-JWK-JWKS-%EC%83%9D%EC%84%B1/#extract-modulus-and-exponent","text":"\uc880\ub354 \uba85\ud655\ud558\uac8c Modulus\uc640 Exponent\uc758 Hex \uac12\uc744 \uad6c\ud558\ub294 \ubc29\ubc95\uc774 \uc788\uc2b5\ub2c8\ub2e4. openssl asn1parse -in $varCN.public.pem 0:d=0 hl=3 l= 159 cons: SEQUENCE 3:d=1 hl=2 l= 13 cons: SEQUENCE 5:d=2 hl=2 l= 9 prim: OBJECT :rsaEncryption 16:d=2 hl=2 l= 0 prim: NULL 18:d=1 hl=3 l= 141 prim: BIT STRING asn1parse\ub97c \uc0ac\uc6a9\ud574 \ub098\ud0c0\ub098\ub294 \uacb0\uacfc\uc758 BIT STRING \uc704\uce58\uc5d0 Modulus, Exponent\uac00 \uc788\uc2b5\ub2c8\ub2e4. \ucee4\ub9e8\ub4dc \uc2e4\ud589 \uacb0\uacfc\uc758 \uac01 \ub77c\uc778 \ub9e8 \uc55e\uc758 \uc22b\uc790\ub294 offset\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4. \uadf8\ub7f0\ub370, RSA Key Bit \uc218\uc5d0 \ub530\ub77c \uc774 offset \uc22b\uc790\uac00 \ubcc0\ud560 \ub54c\uac00 \uc788\uc5b4 \uc774 \ubc29\ubc95\uc744 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4. openssl asn1parse -in $varCN.public.pem -strparse 18 0:d=0 hl=3 l= 137 cons: SEQUENCE 3:d=1 hl=3 l= 129 prim: INTEGER :D22FF1D7EF070A99309298BFE5E290E20BDB11C0F86E9CC6E4106D7BF0272AB3FA616C5465606F302CD7265E8AE04796A4D2A3A15D67A1ADFEFB825757AAE59DF965EEEA15CF81E08C1652D8A36A529B8BE9BC39CC9FDB7C4BF6673491D299B55202B091D3B96F8A4079E446DAB436607ACE5620301033F594B15652AAE8A4D7 135:d=1 hl=2 l= 3 prim: INTEGER :010001","title":"Extract Modulus and Exponent (\ub2e4\ub978 \ubc29\ubc95)"},{"location":"Protocols/Bash-Script%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-JWT-JWK-JWKS-%EC%83%9D%EC%84%B1/#generate-jwk-jwks","text":"\ucd94\ucd9c\ud55c \ud544\uc218 \ud544\ub4dc\ub97c \uae30\ubc18\uc73c\ub85c JWKS\ub97c \uc791\uc131\ud569\ub2c8\ub2e4. KID=$(printf \"%04d\" $(expr $RANDOM % 1000)) JWK='{\"kty\":\"RSA\",\"e\":\"'\"${EXP}\"'\",\"use\":\"sig\",\"kid\":\"'\"${KID}\"'\",\"alg\":\"RS256\",\"n\":\"'\"${MOD}\"'\"}' echo $JWK | jq > $varOU.pubkey.jwk JWKS='{\"keys\":['\"${JWK}\"']}' echo $JWKS | jq > $varOU.pubkey.jwks","title":"Generate JWK, JWKS"},{"location":"Protocols/Bash-Script%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-JWT-JWK-JWKS-%EC%83%9D%EC%84%B1/#jwt","text":"","title":"JWT \uc0dd\uc131"},{"location":"Protocols/Bash-Script%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-JWT-JWK-JWKS-%EC%83%9D%EC%84%B1/#generate-jwt","text":"1\uc2dc\uac04\uc758 Expiry time\uc744 \uac16\ub294 Token\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4. Signature \ubd80\ubd84\uc758 \uc11c\uba85\uc740 X.509 \ud615\uc2dd PEM Private Key\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. NOW=$( date +%s ) IAT=\"${NOW}\" EXPIRE=$((${NOW} + 3600)) ## [\ucc38\uace0] \uc774\ud558\uc758 \uacfc\uc815\uc740 JWK \uc0dd\uc131\uacfc\uc815\uc5d0\uc11c \uc774\ubbf8 \uc218\ud589\ud55c \ucee4\ub9e8\ub4dc/\ubcc0\uc218 \uc120\uc5b8\uc785\ub2c8\ub2e4. varO='dddaong' varOU='dddaong' varCN='dddaong.test' KID=$(printf \"%04d\" $(expr $RANDOM % 1000)) openssl genrsa -out $varCN.private.pem 1024 > /dev/null 2>&1 openssl rsa -in $varCN.private.pem -out $varCN.public.pem -pubout > /dev/null 2>&1 PEM=$( cat ${varCN}.private.pem ) ## Header HEADER_RAW='{\"alg\":\"RS256\",\"typ\":\"JWT\",\"kid\":\"'\"${KID}\"'\"}' HEADER=$( echo -n \"${HEADER_RAW}\" | openssl base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n' ) ## Payload PAYLOAD_RAW='{\"iat\":'\"${IAT}\"',\"exp\":'\"${EXPIRE}\"',\"aud\":\"'\"${varOU}\"'\",\"sub\":\"'\"${varCN}\"'\"}' PAYLOAD=$( echo -n \"${PAYLOAD_RAW}\" | openssl base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n' ) HEADER_PAYLOAD=\"${HEADER}\".\"${PAYLOAD}\" SIGNATURE=$( openssl dgst -sha256 -sign <(echo -n \"${PEM}\") <(echo -n \"${HEADER_PAYLOAD}\") | openssl base64 | tr -d '=' | tr '/+' '_-' | tr -d '\\n' ) JWT=\"${HEADER_PAYLOAD}\".\"${SIGNATURE}\" echo ${JWT} > $varCN.token \uc774\uc0c1\uc73c\ub85c JWK, JWKS, JWT \uc0dd\uc131\uacfc\uc815\uc744 \uc815\ub9ac\ud569\ub2c8\ub2e4.","title":"Generate JWT"},{"location":"Protocols/JWT%EC%9D%98%EC%9D%B4%ED%95%B4-NGINX%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D/","text":"JWT\uc758 \uc774\ud574 \u00b6 NGINX JWT \ud14c\uc2a4\ud2b8\uc5d0 \uc55e\uc11c JWT\uc5d0 \ub300\ud574 \uac04\ub7b5\ud788 \uc815\ub9ac\ud55c \ub0b4\uc6a9\uc785\ub2c8\ub2e4. JWT \u00b6 JWT\ub294 JSON Web Token\uc758 \uc57d\uc790\ub85c, HTTP Request \ud5e4\ub354\uc5d0 Token \uc0bd\uc785\ub418\uc5b4, \ud074\ub77c\uc774\uc5b8\ud2b8\uc640 \uc11c\ubc84 \uac04 \uc778\uc99d\uc744 \uc218\ud589\ud569\ub2c8\ub2e4. JWT Introduction JWT\uc758 \uad6c\uc870 \u00b6 \ud1a0\ud070\uc740 \ud5e4\ub354, \ud398\uc774\ub85c\ub4dc, \uc11c\uba85\uc73c\ub85c \uc138 \ubd80\ubd84\uc73c\ub85c \uad6c\uc131\ub418\uba70, Base64url \uc778\ucf54\ub529\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \ud5e4\ub354 : \uc77c\ubc18\uc801\uc73c\ub85c \ud1a0\ud070\uc758 \ud0c0\uc785\uacfc \ud574\uc2dc \uc554\ud638\ud654 \uc54c\uace0\ub9ac\uc998\uc774 \uba85\uc2dc\ub429\ub2c8\ub2e4. json { \"alg\": \"HS256\", \"typ\": \"JWT\" } \ud398\uc774\ub85c\ub4dc : \ud074\ub808\uc784(Claim) \uc815\ubcf4\ub97c \ud3ec\ud568\ud569\ub2c8\ub2e4. \ud074\ub808\uc784\uc740 Name-Value \uc30d\uc73c\ub85c \uc774\ub904\uc9c0\uba70, \uc5ec\ub7ec \uac1c\uac00 \uc874\uc7ac\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud074\ub808\uc784\uc774 \ub9ce\uc744 \uc218\ub85d \ud1a0\ud070 \uc0ac\uc774\uc988\uac00 \ucee4\uc9c0\uba70, \ud2b8\ub798\ud53d \ud06c\uae30\uc5d0 \uc601\ud5a5\uc744 \uc904 \uc218 \uc788\uc2b5\ub2c8\ub2e4. json { \"sub\": \"1234567890\", \"name\": \"John Doe\", \"admin\": true } \ud074\ub808\uc784\uc5d0\ub294 Registered, Public, Private\uc758 \uc138 \uc885\ub958\uac00 \uc788\uc2b5\ub2c8\ub2e4. Registered Claim : \uc0ac\uc804 \uc124\uc815\ub41c \ud074\ub808\uc784\uc73c\ub85c\uc11c, iss, exp, sub \ub4f1\uc774 \uc788\uc2b5\ub2c8\ub2e4. \ud544\uc218\ub294 \uc544\ub2d9\ub2c8\ub2e4. Public Claim : Claim \uc774\ub984\uc740 \uc0ac\uc6a9\uc790\uac00 \ub9c8\uc74c\ub300\ub85c \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc Claim\uba85\uc758 \ucda9\ub3cc\uc744 \ud53c\ud558\uae30 \uc704\ud574 \uc9c0\uc815\ud55c \uc774\ub984\uc744 \uc900\uc218\ud558\uac70\ub098, Collision-Resistant Namespace\ub97c \uc0ac\uc6a9\ud560 \uac83\uc744 \uc694\uad6c\ud558\ub294, IANA\uc5d0\uc11c \uc9c0\uc815\ud55c Claim \uc774\ub984\ub4e4 \uc785\ub2c8\ub2e4. IANA JWT Claim Registry Private Claim : \uc778\uc99d/\ud53c\uc778\uc99d\uc790 \uac04\uc5d0 \ud611\uc758\ub97c \ud1b5\ud574 \uc0ac\uc6a9\ud558\ub294 \ud074\ub808\uc784\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4. \uc11c\uba85 (Signature) : \uc11c\uba85 \ubd80\ubd84\uc740 [Base64url \uc778\ucf54\ub529\ub41c Header]+\".\"+[Base64url \uc778\ucf54\ub529\ub41c Payload]\uc744 \ud5e4\ub354\uc5d0 \uba85\uc2dc\ub41c \uc554\ud638\ud654 \uc54c\uace0\ub9ac\uc998 \ubc0f [Secret]\uc73c\ub85c \uc554\ud638\ud654\ud55c \ub0b4\uc6a9\uc785\ub2c8\ub2e4. \ub530\ub77c\uc11c \uba54\uc2dc\uc9c0\uac00 \ubcc0\uc870\ub418\uc9c0\ub294 \uc54a\uc558\ub294\uc9c0 \ud655\uc778\uc774 \uac00\ub2a5\ud558\uba70, Private Key\ub85c \uc11c\uba85\ub41c \ud1a0\ud070\uc758 \uacbd\uc6b0, \uc1a1\uc2e0\uc790\uac00 \ub204\uad6c\uc778\uc9c0\uae4c\uc9c0 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. JWT \ud2b9\uc9d5 \u00b6 JWT\ub294 \uc0ac\uc6a9\uc790 \uc778\uc99d\uc5d0 \ud544\uc694\ud55c \ubaa8\ub4e0 \uc815\ubcf4\ub97c \ud1a0\ud070\uc774 \uac16\uace0 \uc788\uae30 \ub54c\ubb38\uc5d0 \ubcc4\ub3c4\uc758 \uc778\uc99d \uc800\uc7a5\uc774 \ud544\uc694\uc5c6\ub2e4\ub294 \uc810\uc774 \uc7a5\uc810\uc785\ub2c8\ub2e4. Header\uc640 Payload\ub294 \ub204\uad6c\ub098 \ubcfc \uc218 \uc788\ub294 \uc815\ubcf4\uac00 \ub429\ub2c8\ub2e4. \ub530\ub77c\uc11c \ubc18\ub4dc\uc2dc HTTPS\ub97c \uc0ac\uc6a9\ud560 \uac83\uc774 \uad8c\uace0\ub418\uba70, \ube44\ubc00 \uc815\ubcf4\ub294 Payload Claim\uc5d0 \uc791\uc131\ud558\uc9c0 \uc54a\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uc77c\ubc18\uc801\uc73c\ub85c Authorization: Bearer <token> \ud615\ud0dc\ub85c \uc0bd\uc785\ub429\ub2c8\ub2e4. \uc9c0\uc6d0\ud558\ub294 \uc54c\uace0\ub9ac\uc998\uc744 jwt.io Libraries \uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. JWK / JWKS \u00b6 JWK\ub294 JSON Web Key\uc758 \uc57d\uc790\ub85c, JSON\ud615\uc2dd\uc73c\ub85c \ud45c\ud604\ub41c Key Pair \ub610\ub294 Key\ub97c \uc758\ubbf8\ud569\ub2c8\ub2e4. JWKS\ub294 \uc774 JWK\uc758 Set\ub97c \uc758\ubbf8\ud558\uba70, \ubc18\ub4dc\uc2dc \ud558\ub098 \uc774\uc0c1\uc758 JWK \ubc30\uc5f4[keys]\ub97c \uba64\ubc84\ub85c \uac16\uc2b5\ub2c8\ub2e4. jwk\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 jwks\uc758 \uad6c\uc870 \uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. jwks\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 Auth0.com JSON Web Key Sets \uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud45c\uc900 \ubb38\uc11c \ub9c1\ud06c : RFC-7517 JWT Specification \uc694\uc57d\ud558\uc790\uba74, JWK\uc640 JWKS\uc758 \ucc28\uc774\ub294 JWKS\uc5d0\ub294 \uc5ec\ub7ec\uac1c\uc758 JWK\uac00 \ud3ec\ud568\ub420 \uc218 \uc788\ub2e4\ub294 \uc810\uc785\ub2c8\ub2e4. \uc544\ub798\ub294 JWK, JWKS\uc758 \ucc28\uc774\uc785\ub2c8\ub2e4. JWKS\uc758 \ucd5c\uc0c1\ub2e8\uc5d0 \"Keys\" Field \uc544\ub798 \ubc30\uc5f4\uc758 \ud615\ud0dc\ub85c JWK\uac00 \uc0bd\uc785\ub41c \ud615\ud0dc\ub97c \ub208\uc73c\ub85c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. ### JWK (RSA Public Key) { \"kty\": \"RSA\", \"e\": \"AQAB\", \"use\": \"sig\", \"kid\": \"0001\", \"alg\": \"RS256\", \"n\": \"oS4lA_ePN4bmcaAM5AFnGVtzMmBBXoYxVGgNEtbhotDMkiIfhilRSH_IVktaDwdorEpQZxg66gwV0y5hZ4Nqo3wWxRVWKoVmdY0xQyPCtIHOs40FYVoc85vBU4giQnl_XqNHVnGOIZz7hiKgzzBBWiLFqgajzgvYN6QZBT0rb8OMj2u-iKQra9sHhlXBgg6W3YUE8BoPiDX2ehI35zXbsf4rI1IYeJvzEFLVcv6kHNJ7vSO0qDmVY4_m-0Kdi0KmJ_XZSNs7fRFwp1MYui9SXs-rZxrmHHES3xuTutJ5sJD6J2LgqkA8NgqhiTva-Dfyj08KVEj5RH1Af4F-bo6aBQ\" } ### JWKS (RSA Public Key) { \"keys\": [{ \"kty\":\"RSA\", \"e\":\"AQAB\", \"use\":\"sig\", \"kid\":\"0001\", \"alg\":\"RS256\", \"n\":\"oS4lA_ePN4bmcaAM5AFnGVtzMmBBXoYxVGgNEtbhotDMkiIfhilRSH_IVktaDwdorEpQZxg66gwV0y5hZ4Nqo3wWxRVWKoVmdY0xQyPCtIHOs40FYVoc85vBU4giQnl_XqNHVnGOIZz7hiKgzzBBWiLFqgajzgvYN6QZBT0rb8OMj2u-iKQra9sHhlXBgg6W3YUE8BoPiDX2ehI35zXbsf4rI1IYeJvzEFLVcv6kHNJ7vSO0qDmVY4_m-0Kdi0KmJ_XZSNs7fRFwp1MYui9SXs-rZxrmHHES3xuTutJ5sJD6J2LgqkA8NgqhiTva-Dfyj08KVEj5RH1Af4F-bo6aBQ\" }] } JWK Fields\uc758 \uc758\ubbf8 - RSA \u00b6 Key \uc774\ub984 \uc758\ubbf8 alg \uc54c\uace0\ub9ac\uc998 kty \ud0a4 \ud0c0\uc785 use \ud0a4 \uc0ac\uc6a9 \ud615\ud0dc (sig: signature Verification / enc: Encryption) e \ud45c\uc900 pem exponent n \ud45c\uc900 pem moduluos kid \ud0a4 \uc2dd\ubcc4\uc790 \uc54c\uace0\ub9ac\uc998 \u00b6 \uc55e\uc73c\ub85c\uc758 \ud14c\uc2a4\ud2b8\uc5d0 \uc0ac\uc6a9\ud560 \uc54c\uace0\ub9ac\uc998\uc740 \uac80\uc0c9\ud558\uba74 \ub098\uc624\ub294 \uae30\uc220 \ubb38\uc11c\uc5d0 \ud754\ud788 \ub4f1\uc7a5\ud558\ub294 HS256\uacfc RS256\uc785\ub2c8\ub2e4. HS256 \u00b6 HS256\uc740 HMAC with SHA-256\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4. \ub300\uce6d\ud0a4 \ubc29\uc2dd\uc73c\ub85c \ud558\ub098\uc758 Key\ub9cc \uc874\uc7ac\ud569\ub2c8\ub2e4. \uc804\ub2ec\ud558\ub824\ub294 Message\uc5d0 SHA256 \uc801\uc6a9 \ud6c4 \ub300\uce6d \ud0a4\ub97c \uc0ac\uc6a9\ud574 \uc554\ud638\ud654 \ud569\ub2c8\ub2e4. \ub300\uce6d \ud0a4\ub97c \uc54c\uace0 \uc788\ub294 \uc8fc\uccb4\ub4e4\ub9cc \uc720\ud6a8\uc131\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. RS256 \u00b6 RS256\uc740 RSA Signature with SHA-256\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4. \ube44\ub300\uce6d\ud0a4 \ubc29\uc2dd\uc73c\ub85c Private Key, Public Key\uac00 \uc874\uc7ac\ud569\ub2c8\ub2e4. \uc804\ub2ec\ud558\ub824\ub294 Message\uc5d0 SHA256 \uc801\uc6a9 \ud6c4 Private Key\ub85c \uc554\ud638\ud654 \ud569\ub2c8\ub2e4. \uc720\ud6a8\uc131 \uac80\uc99d\uc744 \uacf5\uac1c\ud0a4\ub85c \uc218\ud589\ud558\ubbc0\ub85c \ub204\uad6c\ub098 \uc720\ud6a8\uc131\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Public Key\ub294 \uc77c\ubc18\uc801\uc73c\ub85c JWT\ub97c \ubc1c\uae09\ud55c \uc11c\ubc84\uc5d0\uc11c JWK\uc5d0 \uc815\uc758\ub41c \ubc29\uc2dd\uc73c\ub85c \uc81c\uacf5\ud558\uac8c \ub429\ub2c8\ub2e4.","title":"JWT - JWT Concept"},{"location":"Protocols/JWT%EC%9D%98%EC%9D%B4%ED%95%B4-NGINX%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D/#jwt","text":"NGINX JWT \ud14c\uc2a4\ud2b8\uc5d0 \uc55e\uc11c JWT\uc5d0 \ub300\ud574 \uac04\ub7b5\ud788 \uc815\ub9ac\ud55c \ub0b4\uc6a9\uc785\ub2c8\ub2e4.","title":"JWT\uc758 \uc774\ud574"},{"location":"Protocols/JWT%EC%9D%98%EC%9D%B4%ED%95%B4-NGINX%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D/#jwt_1","text":"JWT\ub294 JSON Web Token\uc758 \uc57d\uc790\ub85c, HTTP Request \ud5e4\ub354\uc5d0 Token \uc0bd\uc785\ub418\uc5b4, \ud074\ub77c\uc774\uc5b8\ud2b8\uc640 \uc11c\ubc84 \uac04 \uc778\uc99d\uc744 \uc218\ud589\ud569\ub2c8\ub2e4. JWT Introduction","title":"JWT"},{"location":"Protocols/JWT%EC%9D%98%EC%9D%B4%ED%95%B4-NGINX%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D/#jwt_2","text":"\ud1a0\ud070\uc740 \ud5e4\ub354, \ud398\uc774\ub85c\ub4dc, \uc11c\uba85\uc73c\ub85c \uc138 \ubd80\ubd84\uc73c\ub85c \uad6c\uc131\ub418\uba70, Base64url \uc778\ucf54\ub529\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \ud5e4\ub354 : \uc77c\ubc18\uc801\uc73c\ub85c \ud1a0\ud070\uc758 \ud0c0\uc785\uacfc \ud574\uc2dc \uc554\ud638\ud654 \uc54c\uace0\ub9ac\uc998\uc774 \uba85\uc2dc\ub429\ub2c8\ub2e4. json { \"alg\": \"HS256\", \"typ\": \"JWT\" } \ud398\uc774\ub85c\ub4dc : \ud074\ub808\uc784(Claim) \uc815\ubcf4\ub97c \ud3ec\ud568\ud569\ub2c8\ub2e4. \ud074\ub808\uc784\uc740 Name-Value \uc30d\uc73c\ub85c \uc774\ub904\uc9c0\uba70, \uc5ec\ub7ec \uac1c\uac00 \uc874\uc7ac\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud074\ub808\uc784\uc774 \ub9ce\uc744 \uc218\ub85d \ud1a0\ud070 \uc0ac\uc774\uc988\uac00 \ucee4\uc9c0\uba70, \ud2b8\ub798\ud53d \ud06c\uae30\uc5d0 \uc601\ud5a5\uc744 \uc904 \uc218 \uc788\uc2b5\ub2c8\ub2e4. json { \"sub\": \"1234567890\", \"name\": \"John Doe\", \"admin\": true } \ud074\ub808\uc784\uc5d0\ub294 Registered, Public, Private\uc758 \uc138 \uc885\ub958\uac00 \uc788\uc2b5\ub2c8\ub2e4. Registered Claim : \uc0ac\uc804 \uc124\uc815\ub41c \ud074\ub808\uc784\uc73c\ub85c\uc11c, iss, exp, sub \ub4f1\uc774 \uc788\uc2b5\ub2c8\ub2e4. \ud544\uc218\ub294 \uc544\ub2d9\ub2c8\ub2e4. Public Claim : Claim \uc774\ub984\uc740 \uc0ac\uc6a9\uc790\uac00 \ub9c8\uc74c\ub300\ub85c \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc Claim\uba85\uc758 \ucda9\ub3cc\uc744 \ud53c\ud558\uae30 \uc704\ud574 \uc9c0\uc815\ud55c \uc774\ub984\uc744 \uc900\uc218\ud558\uac70\ub098, Collision-Resistant Namespace\ub97c \uc0ac\uc6a9\ud560 \uac83\uc744 \uc694\uad6c\ud558\ub294, IANA\uc5d0\uc11c \uc9c0\uc815\ud55c Claim \uc774\ub984\ub4e4 \uc785\ub2c8\ub2e4. IANA JWT Claim Registry Private Claim : \uc778\uc99d/\ud53c\uc778\uc99d\uc790 \uac04\uc5d0 \ud611\uc758\ub97c \ud1b5\ud574 \uc0ac\uc6a9\ud558\ub294 \ud074\ub808\uc784\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4. \uc11c\uba85 (Signature) : \uc11c\uba85 \ubd80\ubd84\uc740 [Base64url \uc778\ucf54\ub529\ub41c Header]+\".\"+[Base64url \uc778\ucf54\ub529\ub41c Payload]\uc744 \ud5e4\ub354\uc5d0 \uba85\uc2dc\ub41c \uc554\ud638\ud654 \uc54c\uace0\ub9ac\uc998 \ubc0f [Secret]\uc73c\ub85c \uc554\ud638\ud654\ud55c \ub0b4\uc6a9\uc785\ub2c8\ub2e4. \ub530\ub77c\uc11c \uba54\uc2dc\uc9c0\uac00 \ubcc0\uc870\ub418\uc9c0\ub294 \uc54a\uc558\ub294\uc9c0 \ud655\uc778\uc774 \uac00\ub2a5\ud558\uba70, Private Key\ub85c \uc11c\uba85\ub41c \ud1a0\ud070\uc758 \uacbd\uc6b0, \uc1a1\uc2e0\uc790\uac00 \ub204\uad6c\uc778\uc9c0\uae4c\uc9c0 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.","title":"JWT\uc758 \uad6c\uc870"},{"location":"Protocols/JWT%EC%9D%98%EC%9D%B4%ED%95%B4-NGINX%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D/#jwt_3","text":"JWT\ub294 \uc0ac\uc6a9\uc790 \uc778\uc99d\uc5d0 \ud544\uc694\ud55c \ubaa8\ub4e0 \uc815\ubcf4\ub97c \ud1a0\ud070\uc774 \uac16\uace0 \uc788\uae30 \ub54c\ubb38\uc5d0 \ubcc4\ub3c4\uc758 \uc778\uc99d \uc800\uc7a5\uc774 \ud544\uc694\uc5c6\ub2e4\ub294 \uc810\uc774 \uc7a5\uc810\uc785\ub2c8\ub2e4. Header\uc640 Payload\ub294 \ub204\uad6c\ub098 \ubcfc \uc218 \uc788\ub294 \uc815\ubcf4\uac00 \ub429\ub2c8\ub2e4. \ub530\ub77c\uc11c \ubc18\ub4dc\uc2dc HTTPS\ub97c \uc0ac\uc6a9\ud560 \uac83\uc774 \uad8c\uace0\ub418\uba70, \ube44\ubc00 \uc815\ubcf4\ub294 Payload Claim\uc5d0 \uc791\uc131\ud558\uc9c0 \uc54a\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uc77c\ubc18\uc801\uc73c\ub85c Authorization: Bearer <token> \ud615\ud0dc\ub85c \uc0bd\uc785\ub429\ub2c8\ub2e4. \uc9c0\uc6d0\ud558\ub294 \uc54c\uace0\ub9ac\uc998\uc744 jwt.io Libraries \uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.","title":"JWT \ud2b9\uc9d5"},{"location":"Protocols/JWT%EC%9D%98%EC%9D%B4%ED%95%B4-NGINX%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D/#jwk-jwks","text":"JWK\ub294 JSON Web Key\uc758 \uc57d\uc790\ub85c, JSON\ud615\uc2dd\uc73c\ub85c \ud45c\ud604\ub41c Key Pair \ub610\ub294 Key\ub97c \uc758\ubbf8\ud569\ub2c8\ub2e4. JWKS\ub294 \uc774 JWK\uc758 Set\ub97c \uc758\ubbf8\ud558\uba70, \ubc18\ub4dc\uc2dc \ud558\ub098 \uc774\uc0c1\uc758 JWK \ubc30\uc5f4[keys]\ub97c \uba64\ubc84\ub85c \uac16\uc2b5\ub2c8\ub2e4. jwk\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 jwks\uc758 \uad6c\uc870 \uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. jwks\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 Auth0.com JSON Web Key Sets \uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud45c\uc900 \ubb38\uc11c \ub9c1\ud06c : RFC-7517 JWT Specification \uc694\uc57d\ud558\uc790\uba74, JWK\uc640 JWKS\uc758 \ucc28\uc774\ub294 JWKS\uc5d0\ub294 \uc5ec\ub7ec\uac1c\uc758 JWK\uac00 \ud3ec\ud568\ub420 \uc218 \uc788\ub2e4\ub294 \uc810\uc785\ub2c8\ub2e4. \uc544\ub798\ub294 JWK, JWKS\uc758 \ucc28\uc774\uc785\ub2c8\ub2e4. JWKS\uc758 \ucd5c\uc0c1\ub2e8\uc5d0 \"Keys\" Field \uc544\ub798 \ubc30\uc5f4\uc758 \ud615\ud0dc\ub85c JWK\uac00 \uc0bd\uc785\ub41c \ud615\ud0dc\ub97c \ub208\uc73c\ub85c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. ### JWK (RSA Public Key) { \"kty\": \"RSA\", \"e\": \"AQAB\", \"use\": \"sig\", \"kid\": \"0001\", \"alg\": \"RS256\", \"n\": \"oS4lA_ePN4bmcaAM5AFnGVtzMmBBXoYxVGgNEtbhotDMkiIfhilRSH_IVktaDwdorEpQZxg66gwV0y5hZ4Nqo3wWxRVWKoVmdY0xQyPCtIHOs40FYVoc85vBU4giQnl_XqNHVnGOIZz7hiKgzzBBWiLFqgajzgvYN6QZBT0rb8OMj2u-iKQra9sHhlXBgg6W3YUE8BoPiDX2ehI35zXbsf4rI1IYeJvzEFLVcv6kHNJ7vSO0qDmVY4_m-0Kdi0KmJ_XZSNs7fRFwp1MYui9SXs-rZxrmHHES3xuTutJ5sJD6J2LgqkA8NgqhiTva-Dfyj08KVEj5RH1Af4F-bo6aBQ\" } ### JWKS (RSA Public Key) { \"keys\": [{ \"kty\":\"RSA\", \"e\":\"AQAB\", \"use\":\"sig\", \"kid\":\"0001\", \"alg\":\"RS256\", \"n\":\"oS4lA_ePN4bmcaAM5AFnGVtzMmBBXoYxVGgNEtbhotDMkiIfhilRSH_IVktaDwdorEpQZxg66gwV0y5hZ4Nqo3wWxRVWKoVmdY0xQyPCtIHOs40FYVoc85vBU4giQnl_XqNHVnGOIZz7hiKgzzBBWiLFqgajzgvYN6QZBT0rb8OMj2u-iKQra9sHhlXBgg6W3YUE8BoPiDX2ehI35zXbsf4rI1IYeJvzEFLVcv6kHNJ7vSO0qDmVY4_m-0Kdi0KmJ_XZSNs7fRFwp1MYui9SXs-rZxrmHHES3xuTutJ5sJD6J2LgqkA8NgqhiTva-Dfyj08KVEj5RH1Af4F-bo6aBQ\" }] }","title":"JWK / JWKS"},{"location":"Protocols/JWT%EC%9D%98%EC%9D%B4%ED%95%B4-NGINX%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D/#jwk-fields-rsa","text":"Key \uc774\ub984 \uc758\ubbf8 alg \uc54c\uace0\ub9ac\uc998 kty \ud0a4 \ud0c0\uc785 use \ud0a4 \uc0ac\uc6a9 \ud615\ud0dc (sig: signature Verification / enc: Encryption) e \ud45c\uc900 pem exponent n \ud45c\uc900 pem moduluos kid \ud0a4 \uc2dd\ubcc4\uc790","title":"JWK Fields\uc758 \uc758\ubbf8 - RSA"},{"location":"Protocols/JWT%EC%9D%98%EC%9D%B4%ED%95%B4-NGINX%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D/#_1","text":"\uc55e\uc73c\ub85c\uc758 \ud14c\uc2a4\ud2b8\uc5d0 \uc0ac\uc6a9\ud560 \uc54c\uace0\ub9ac\uc998\uc740 \uac80\uc0c9\ud558\uba74 \ub098\uc624\ub294 \uae30\uc220 \ubb38\uc11c\uc5d0 \ud754\ud788 \ub4f1\uc7a5\ud558\ub294 HS256\uacfc RS256\uc785\ub2c8\ub2e4.","title":"\uc54c\uace0\ub9ac\uc998"},{"location":"Protocols/JWT%EC%9D%98%EC%9D%B4%ED%95%B4-NGINX%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D/#hs256","text":"HS256\uc740 HMAC with SHA-256\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4. \ub300\uce6d\ud0a4 \ubc29\uc2dd\uc73c\ub85c \ud558\ub098\uc758 Key\ub9cc \uc874\uc7ac\ud569\ub2c8\ub2e4. \uc804\ub2ec\ud558\ub824\ub294 Message\uc5d0 SHA256 \uc801\uc6a9 \ud6c4 \ub300\uce6d \ud0a4\ub97c \uc0ac\uc6a9\ud574 \uc554\ud638\ud654 \ud569\ub2c8\ub2e4. \ub300\uce6d \ud0a4\ub97c \uc54c\uace0 \uc788\ub294 \uc8fc\uccb4\ub4e4\ub9cc \uc720\ud6a8\uc131\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.","title":"HS256"},{"location":"Protocols/JWT%EC%9D%98%EC%9D%B4%ED%95%B4-NGINX%EC%9D%98-JWT-%EC%9D%B8%EC%A6%9D/#rs256","text":"RS256\uc740 RSA Signature with SHA-256\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4. \ube44\ub300\uce6d\ud0a4 \ubc29\uc2dd\uc73c\ub85c Private Key, Public Key\uac00 \uc874\uc7ac\ud569\ub2c8\ub2e4. \uc804\ub2ec\ud558\ub824\ub294 Message\uc5d0 SHA256 \uc801\uc6a9 \ud6c4 Private Key\ub85c \uc554\ud638\ud654 \ud569\ub2c8\ub2e4. \uc720\ud6a8\uc131 \uac80\uc99d\uc744 \uacf5\uac1c\ud0a4\ub85c \uc218\ud589\ud558\ubbc0\ub85c \ub204\uad6c\ub098 \uc720\ud6a8\uc131\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Public Key\ub294 \uc77c\ubc18\uc801\uc73c\ub85c JWT\ub97c \ubc1c\uae09\ud55c \uc11c\ubc84\uc5d0\uc11c JWK\uc5d0 \uc815\uc758\ub41c \ubc29\uc2dd\uc73c\ub85c \uc81c\uacf5\ud558\uac8c \ub429\ub2c8\ub2e4.","title":"RS256"},{"location":"Tools/IP-Changer-Batch-Script/","text":"Windows IP Changer Batch Script \u00b6 \uc708\ub3c4\uc6b0\uc988\uc6a9 IP \ubcc0\uacbd Batch \uc2a4\ud06c\ub9bd\ud2b8 \uc785\ub2c8\ub2e4. \ucd5c\ucd08 \uc2e4\ud589\uc2dc \uc778\ud130\ud398\uc774\uc2a4 \uc7a1\uc544\uc8fc\ub294 \uacfc\uc815\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \ucd5c\ucd08 \uc2e4\ud589 \ubc0f \uc778\ud130\ud398\uc774\uc2a4\uba85 \uc124\uc815 \uc644\ub8cc \uc2dc ipch.bat \ud30c\uc77c\uc774 \uc874\uc7ac\ud558\ub294 \ub514\ub809\ud1a0\ub9ac\uc5d0 ipch_cfg.txt \ud30c\uc77c\uc774 \uc790\ub3d9\uc73c\ub85c \uc791\uc131\ub429\ub2c8\ub2e4. {: .block-warning} CUI \uba54\ub274 \uc2a4\ud06c\ub9bd\ud2b8 \uc2e4\ud589 \uc2dc CUI \uba54\ub274\ub85c \uc9c4\uc785\ud569\ub2c8\ub2e4. \ucee4\ub9e8\ub4dc\ub85c \uc0ac\uc6a9 \uac00\ub2a5 Cmd \ubaa8\ub4dc\ub85c \uc0ac\uc6a9\ud558\ub824\uba74 \uc544\ub798\ucc98\ub7fc CIDR \ud615\uc2dd, GW \uc21c\uc11c\ub85c \uc791\uc131\ud574\uc8fc\uc2dc\uba74 \ub429\ub2c8\ub2e4. \uc608\uc2dc > ipch.bat 192.168.10.10/24 192.168.10.1 IP\ubcc0\uacbd\uc5d0\ub294 \uad00\ub9ac\uc790 \uad8c\ud55c \uc2e4\ud589\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. {: .block-warning} \uc544\ub798 \uc2a4\ud06c\ub9bd\ud2b8\ub97c ipch.bat \ud30c\uc77c\ub85c \uc800\uc7a5\ud558\uc5ec, \ubc14\ub85c\uac00\uae30 \uc0dd\uc131 \ud6c4 \ubc14\ub85c\uac00\uae30\uc5d0\uc11c \uad00\ub9ac\uc790 \uad8c\ud55c\uc73c\ub85c \uc2e4\ud589\ud558\uae30 \uc635\uc158 Enable \ud574\uc8fc\uc2dc\uba74 \ud3b8\ub9ac\ud569\ub2c8\ub2e4. {: .block-tip} @echo off setlocal enabledelayedexpansion :: HEAD title IPCH Script mode con cols=90 lines=40 color F0 :: HEAD SET IPcmd Vars set \"dir=%~dp0\" set \"cidr=%1\" set \"gw=%2\" :: -- ENTRY FORKS -- :: ipch_cfg.txt \ud30c\uc77c\uc774 \uc788\uc73c\uba74 \ubcc0\uc218 \ub85c\ub4dc IF exist %dir%ipch_cfg.txt FOR /f \"delims== tokens=1,2\" %%G in (%dir%ipch_cfg.txt) do set %%G=%%H :: ipch_cfg.txt \ud30c\uc77c\uc774 \uc788\uc5b4\ub3c4 Target NIC \ubcc0\uc218\uac12\uc774 \uc5c6\uc73c\uba74 Config \uc2e4\ud589 IF \"!tnic!X\"==\"X\" GOTO _config :: \ud30c\ub77c\ubbf8\ud130\uac00 \uc788\uc73c\uba74 IPcmd \uc2e4\ud589 IF NOT \"%*\"==\"\" GOTO _IPcmd :: ipch_cfg.txt \ud30c\uc77c\uc774 \uc5c6\uc73c\uba74 config \uc2e4\ud589 IF NOT exist %dir%ipch_cfg.txt GOTO _config GOTO _Menu :_Menu cls echo ========================================= echo = = echo = IPCH script = echo = = echo ========================================= echo = Current Directory is %dir% echo = Target NIC is %tnicindex% %tnic% echo ========================================= echo 1. Ethernet Static IP echo 2. Ethernet DHCP IP echo 3. Ethernet Secondary IP \ucd94\uac00 echo 4. Ethernet Secondary IP \uc0ad\uc81c echo 5. \ub0b4 IP \ud655\uc778 echo ========================================= echo c. IPCH \uc124\uc815 echo h. Command Mode \uc548\ub0b4 echo q. Exit echo ========================================= set /p num=Choose the task : if \"%num%\"==\"1\" goto _IPstatic if \"%num%\"==\"2\" goto _IPdhcp if \"%num%\"==\"3\" goto _IPsecond if \"%num%\"==\"4\" goto _IPseconddelete if \"%num%\"==\"5\" goto _my_eth if \"%num%\"==\"q\" goto _exit if \"%num%\"==\"c\" goto _config if \"%num%\"==\"h\" goto _help goto _Menu :_config cls echo ***** Interface List ***** netsh interface ipv4 show interface | findstr /V disconnected echo ************************** set /p tnicindex=Choose a Target Network Interface: FOR /F \"usebackq skip=3 tokens=1,5* delims= \" %%G in (`netsh interface ipv4 show interface ^| findstr /V disconnected`) do ( IF %%G==%tnicindex% set tnic1=%%H IF %%G==%tnicindex% set tnic2=%%I ) IF \"%tnic2%x\"==\"x\" set tnic=\"%tnic1%\" IF NOT \"%tnic2%x\"==\"x\" set tnic=\"%tnic1% %tnic2%\" echo Target NIC is %tnic% ( echo tnic=%tnic% echo tnicindex=%tnicindex% echo dir=%dir% )>%dir%ipch_cfg.txt goto _Success_menu :_IPdhcp netsh -c int ip set address name=%tnic% source=dhcp goto _Success_menu :_my_eth netsh -c int ip show addresses %tnic% pause goto _Menu :_IPstatic echo \uace0\uc815 IP\ub97c \uc124\uc815\ud569\ub2c8\ub2e4. set /p addr=IP\ub97c \uc785\ub825\ud558\uc138\uc694 : set /p netmask=Network Mask\ub97c \uc785\ub825\ud558\uc138\uc694 : set gw=\"0.0.0.0\" set /p gw=\uac8c\uc774\ud2b8\uc6e8\uc774\ub97c \uc785\ub825\ud558\uc138\uc694[\uae30\ubcf8\uac12 0.0.0.0] : netsh -c int ip set address name=%tnic% source=static addr=%addr% mask=%netmask% gateway=%gw% gwmetric=0 ::netsh interface ip set dns \"%tnic%\" static 8.8.8.8 goto _Success_menu :_IPsecond echo Secondary IP\ub97c \uc124\uc815\ud569\ub2c8\ub2e4. set /p addr=IP\ub97c \uc785\ub825\ud558\uc138\uc694 : set /p netmask=Network Mask\ub97c \uc785\ub825\ud558\uc138\uc694 : set \"gw=0.0.0.0\" set /p gw=\uac8c\uc774\ud2b8\uc6e8\uc774\ub97c \uc785\ub825\ud558\uc138\uc694[\uae30\ubcf8\uac12 0.0.0.0] : echo %tnic% \"%addr%\" \"%netmask%\" \"%gw%\" pause netsh -c interface ip add address name=%tnic% addr=\"%addr%\" mask=\"%netmask%\" gateway=\"%gw%\" ::netsh interface ip set dns \"%tnic%\" static 8.8.8.8 goto _Success_menu :_IPseconddelete echo \uc124\uc815\ub41c Secondary IP\ub97c \uc0ad\uc81c\ud569\ub2c8\ub2e4. set /p addr=\uc0ad\uc81c\ud560 IP\ub97c \uc785\ub825\ud558\uc138\uc694 : netsh -c interface ip delete address name=%tnic% addr=\"%addr%\" goto _Success_menu :_IPcmd echo Target NIC is %tnicindex% %tnic% echo %* FOR /F \"tokens=1,2 delims=/ \" %%G in (\"%cidr%\") do ( set addr=\"%%G\" set cmask=%%H ) IF \"%cmask%\"==\"8\" set mask=\"255.0.0.0\" IF \"%cmask%\"==\"9\" set mask=\"255.128.0.0\" IF \"%cmask%\"==\"10\" set mask=\"255.192.0.0\" IF \"%cmask%\"==\"11\" set mask=\"255.224.0.0\" IF \"%cmask%\"==\"12\" set mask=\"255.240.0.0\" IF \"%cmask%\"==\"13\" set mask=\"255.248.0.0\" IF \"%cmask%\"==\"14\" set mask=\"255.252.0.0\" IF \"%cmask%\"==\"15\" set mask=\"255.254.0.0\" IF \"%cmask%\"==\"16\" set mask=\"255.255.0.0\" IF \"%cmask%\"==\"17\" set mask=\"255.255.128.0\" IF \"%cmask%\"==\"18\" set mask=\"255.255.192.0\" IF \"%cmask%\"==\"19\" set mask=\"255.255.224.0\" IF \"%cmask%\"==\"20\" set mask=\"255.2550.240.0\" IF \"%cmask%\"==\"21\" set mask=\"255.255.248.0\" IF \"%cmask%\"==\"22\" set mask=\"255.255.252.0\" IF \"%cmask%\"==\"23\" set mask=\"255.255.254.0\" IF \"%cmask%\"==\"24\" set mask=\"255.255.255.0\" IF \"%cmask%\"==\"25\" set mask=\"255.255.255.128\" IF \"%cmask%\"==\"26\" set mask=\"255.255.255.196\" IF \"%cmask%\"==\"27\" set mask=\"255.255.255.224\" IF \"%cmask%\"==\"28\" set mask=\"255.255.255.240\" IF \"%cmask%\"==\"29\" set mask=\"255.255.255.248\" IF \"%cmask%\"==\"30\" set mask=\"255.255.255.252\" IF \"%cmask%\"==\"31\" set mask=\"255.255.255.254\" IF \"%gw%x\"==\"x\" set \"gw=0.0.0.0\" echo %tnic% %addr% %mask% \"%gw%\" pause netsh -c int ip set address name=%tnic% source=static addr=%addr% mask=%mask% gateway=\"%gw%\" GOTO _Success_exit :_help cls echo =============================== echo = = echo = IPCH script = echo = = echo =============================== echo. echo - \uba54\ub274\uc5d0 \ub4e4\uc5b4\uc624\uc9c0 \uc54a\uace0\ub3c4 \ucee4\ub9e8\ub4dc\ub9cc\uc73c\ub85c IP \ubcc0\uacbd\uc774 \uac00\ub2a5\ud569\ub2c8\ub2e4. echo - \uc544\ub798 \ud615\uc2dd\uc73c\ub85c \uc2e4\ud589\ud558\uba74 \ub429\ub2c8\ub2e4. echo. echo ^>^> Usage \\: echo ipch [IP Address/Netmask (CIDR)] echo ^>^> sample \\: echo ipch 192.168.0.100/24 echo. pause GOTO _Menu :_exit echo \uc885\ub8cc\ud569\ub2c8\ub2e4. pause exit :_Success_exit cls echo The operation completed successfully. pause > nul GOTO _exit :_Success_menu echo The operation completed successfully. pause > nul goto _Menu","title":"Windows IP Changer Batch Script"},{"location":"Tools/IP-Changer-Batch-Script/#windows-ip-changer-batch-script","text":"\uc708\ub3c4\uc6b0\uc988\uc6a9 IP \ubcc0\uacbd Batch \uc2a4\ud06c\ub9bd\ud2b8 \uc785\ub2c8\ub2e4. \ucd5c\ucd08 \uc2e4\ud589\uc2dc \uc778\ud130\ud398\uc774\uc2a4 \uc7a1\uc544\uc8fc\ub294 \uacfc\uc815\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \ucd5c\ucd08 \uc2e4\ud589 \ubc0f \uc778\ud130\ud398\uc774\uc2a4\uba85 \uc124\uc815 \uc644\ub8cc \uc2dc ipch.bat \ud30c\uc77c\uc774 \uc874\uc7ac\ud558\ub294 \ub514\ub809\ud1a0\ub9ac\uc5d0 ipch_cfg.txt \ud30c\uc77c\uc774 \uc790\ub3d9\uc73c\ub85c \uc791\uc131\ub429\ub2c8\ub2e4. {: .block-warning} CUI \uba54\ub274 \uc2a4\ud06c\ub9bd\ud2b8 \uc2e4\ud589 \uc2dc CUI \uba54\ub274\ub85c \uc9c4\uc785\ud569\ub2c8\ub2e4. \ucee4\ub9e8\ub4dc\ub85c \uc0ac\uc6a9 \uac00\ub2a5 Cmd \ubaa8\ub4dc\ub85c \uc0ac\uc6a9\ud558\ub824\uba74 \uc544\ub798\ucc98\ub7fc CIDR \ud615\uc2dd, GW \uc21c\uc11c\ub85c \uc791\uc131\ud574\uc8fc\uc2dc\uba74 \ub429\ub2c8\ub2e4. \uc608\uc2dc > ipch.bat 192.168.10.10/24 192.168.10.1 IP\ubcc0\uacbd\uc5d0\ub294 \uad00\ub9ac\uc790 \uad8c\ud55c \uc2e4\ud589\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. {: .block-warning} \uc544\ub798 \uc2a4\ud06c\ub9bd\ud2b8\ub97c ipch.bat \ud30c\uc77c\ub85c \uc800\uc7a5\ud558\uc5ec, \ubc14\ub85c\uac00\uae30 \uc0dd\uc131 \ud6c4 \ubc14\ub85c\uac00\uae30\uc5d0\uc11c \uad00\ub9ac\uc790 \uad8c\ud55c\uc73c\ub85c \uc2e4\ud589\ud558\uae30 \uc635\uc158 Enable \ud574\uc8fc\uc2dc\uba74 \ud3b8\ub9ac\ud569\ub2c8\ub2e4. {: .block-tip} @echo off setlocal enabledelayedexpansion :: HEAD title IPCH Script mode con cols=90 lines=40 color F0 :: HEAD SET IPcmd Vars set \"dir=%~dp0\" set \"cidr=%1\" set \"gw=%2\" :: -- ENTRY FORKS -- :: ipch_cfg.txt \ud30c\uc77c\uc774 \uc788\uc73c\uba74 \ubcc0\uc218 \ub85c\ub4dc IF exist %dir%ipch_cfg.txt FOR /f \"delims== tokens=1,2\" %%G in (%dir%ipch_cfg.txt) do set %%G=%%H :: ipch_cfg.txt \ud30c\uc77c\uc774 \uc788\uc5b4\ub3c4 Target NIC \ubcc0\uc218\uac12\uc774 \uc5c6\uc73c\uba74 Config \uc2e4\ud589 IF \"!tnic!X\"==\"X\" GOTO _config :: \ud30c\ub77c\ubbf8\ud130\uac00 \uc788\uc73c\uba74 IPcmd \uc2e4\ud589 IF NOT \"%*\"==\"\" GOTO _IPcmd :: ipch_cfg.txt \ud30c\uc77c\uc774 \uc5c6\uc73c\uba74 config \uc2e4\ud589 IF NOT exist %dir%ipch_cfg.txt GOTO _config GOTO _Menu :_Menu cls echo ========================================= echo = = echo = IPCH script = echo = = echo ========================================= echo = Current Directory is %dir% echo = Target NIC is %tnicindex% %tnic% echo ========================================= echo 1. Ethernet Static IP echo 2. Ethernet DHCP IP echo 3. Ethernet Secondary IP \ucd94\uac00 echo 4. Ethernet Secondary IP \uc0ad\uc81c echo 5. \ub0b4 IP \ud655\uc778 echo ========================================= echo c. IPCH \uc124\uc815 echo h. Command Mode \uc548\ub0b4 echo q. Exit echo ========================================= set /p num=Choose the task : if \"%num%\"==\"1\" goto _IPstatic if \"%num%\"==\"2\" goto _IPdhcp if \"%num%\"==\"3\" goto _IPsecond if \"%num%\"==\"4\" goto _IPseconddelete if \"%num%\"==\"5\" goto _my_eth if \"%num%\"==\"q\" goto _exit if \"%num%\"==\"c\" goto _config if \"%num%\"==\"h\" goto _help goto _Menu :_config cls echo ***** Interface List ***** netsh interface ipv4 show interface | findstr /V disconnected echo ************************** set /p tnicindex=Choose a Target Network Interface: FOR /F \"usebackq skip=3 tokens=1,5* delims= \" %%G in (`netsh interface ipv4 show interface ^| findstr /V disconnected`) do ( IF %%G==%tnicindex% set tnic1=%%H IF %%G==%tnicindex% set tnic2=%%I ) IF \"%tnic2%x\"==\"x\" set tnic=\"%tnic1%\" IF NOT \"%tnic2%x\"==\"x\" set tnic=\"%tnic1% %tnic2%\" echo Target NIC is %tnic% ( echo tnic=%tnic% echo tnicindex=%tnicindex% echo dir=%dir% )>%dir%ipch_cfg.txt goto _Success_menu :_IPdhcp netsh -c int ip set address name=%tnic% source=dhcp goto _Success_menu :_my_eth netsh -c int ip show addresses %tnic% pause goto _Menu :_IPstatic echo \uace0\uc815 IP\ub97c \uc124\uc815\ud569\ub2c8\ub2e4. set /p addr=IP\ub97c \uc785\ub825\ud558\uc138\uc694 : set /p netmask=Network Mask\ub97c \uc785\ub825\ud558\uc138\uc694 : set gw=\"0.0.0.0\" set /p gw=\uac8c\uc774\ud2b8\uc6e8\uc774\ub97c \uc785\ub825\ud558\uc138\uc694[\uae30\ubcf8\uac12 0.0.0.0] : netsh -c int ip set address name=%tnic% source=static addr=%addr% mask=%netmask% gateway=%gw% gwmetric=0 ::netsh interface ip set dns \"%tnic%\" static 8.8.8.8 goto _Success_menu :_IPsecond echo Secondary IP\ub97c \uc124\uc815\ud569\ub2c8\ub2e4. set /p addr=IP\ub97c \uc785\ub825\ud558\uc138\uc694 : set /p netmask=Network Mask\ub97c \uc785\ub825\ud558\uc138\uc694 : set \"gw=0.0.0.0\" set /p gw=\uac8c\uc774\ud2b8\uc6e8\uc774\ub97c \uc785\ub825\ud558\uc138\uc694[\uae30\ubcf8\uac12 0.0.0.0] : echo %tnic% \"%addr%\" \"%netmask%\" \"%gw%\" pause netsh -c interface ip add address name=%tnic% addr=\"%addr%\" mask=\"%netmask%\" gateway=\"%gw%\" ::netsh interface ip set dns \"%tnic%\" static 8.8.8.8 goto _Success_menu :_IPseconddelete echo \uc124\uc815\ub41c Secondary IP\ub97c \uc0ad\uc81c\ud569\ub2c8\ub2e4. set /p addr=\uc0ad\uc81c\ud560 IP\ub97c \uc785\ub825\ud558\uc138\uc694 : netsh -c interface ip delete address name=%tnic% addr=\"%addr%\" goto _Success_menu :_IPcmd echo Target NIC is %tnicindex% %tnic% echo %* FOR /F \"tokens=1,2 delims=/ \" %%G in (\"%cidr%\") do ( set addr=\"%%G\" set cmask=%%H ) IF \"%cmask%\"==\"8\" set mask=\"255.0.0.0\" IF \"%cmask%\"==\"9\" set mask=\"255.128.0.0\" IF \"%cmask%\"==\"10\" set mask=\"255.192.0.0\" IF \"%cmask%\"==\"11\" set mask=\"255.224.0.0\" IF \"%cmask%\"==\"12\" set mask=\"255.240.0.0\" IF \"%cmask%\"==\"13\" set mask=\"255.248.0.0\" IF \"%cmask%\"==\"14\" set mask=\"255.252.0.0\" IF \"%cmask%\"==\"15\" set mask=\"255.254.0.0\" IF \"%cmask%\"==\"16\" set mask=\"255.255.0.0\" IF \"%cmask%\"==\"17\" set mask=\"255.255.128.0\" IF \"%cmask%\"==\"18\" set mask=\"255.255.192.0\" IF \"%cmask%\"==\"19\" set mask=\"255.255.224.0\" IF \"%cmask%\"==\"20\" set mask=\"255.2550.240.0\" IF \"%cmask%\"==\"21\" set mask=\"255.255.248.0\" IF \"%cmask%\"==\"22\" set mask=\"255.255.252.0\" IF \"%cmask%\"==\"23\" set mask=\"255.255.254.0\" IF \"%cmask%\"==\"24\" set mask=\"255.255.255.0\" IF \"%cmask%\"==\"25\" set mask=\"255.255.255.128\" IF \"%cmask%\"==\"26\" set mask=\"255.255.255.196\" IF \"%cmask%\"==\"27\" set mask=\"255.255.255.224\" IF \"%cmask%\"==\"28\" set mask=\"255.255.255.240\" IF \"%cmask%\"==\"29\" set mask=\"255.255.255.248\" IF \"%cmask%\"==\"30\" set mask=\"255.255.255.252\" IF \"%cmask%\"==\"31\" set mask=\"255.255.255.254\" IF \"%gw%x\"==\"x\" set \"gw=0.0.0.0\" echo %tnic% %addr% %mask% \"%gw%\" pause netsh -c int ip set address name=%tnic% source=static addr=%addr% mask=%mask% gateway=\"%gw%\" GOTO _Success_exit :_help cls echo =============================== echo = = echo = IPCH script = echo = = echo =============================== echo. echo - \uba54\ub274\uc5d0 \ub4e4\uc5b4\uc624\uc9c0 \uc54a\uace0\ub3c4 \ucee4\ub9e8\ub4dc\ub9cc\uc73c\ub85c IP \ubcc0\uacbd\uc774 \uac00\ub2a5\ud569\ub2c8\ub2e4. echo - \uc544\ub798 \ud615\uc2dd\uc73c\ub85c \uc2e4\ud589\ud558\uba74 \ub429\ub2c8\ub2e4. echo. echo ^>^> Usage \\: echo ipch [IP Address/Netmask (CIDR)] echo ^>^> sample \\: echo ipch 192.168.0.100/24 echo. pause GOTO _Menu :_exit echo \uc885\ub8cc\ud569\ub2c8\ub2e4. pause exit :_Success_exit cls echo The operation completed successfully. pause > nul GOTO _exit :_Success_menu echo The operation completed successfully. pause > nul goto _Menu","title":"Windows IP Changer Batch Script"}]}